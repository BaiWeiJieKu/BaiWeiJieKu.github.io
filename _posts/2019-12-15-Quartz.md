---
layout: post
title:  "Quartz"
categories: Quartz
tags: Quartz
author: 百味皆苦
music-id: 5188665
---

* content
{:toc}
### 简介

#### Job

- Job：实现业务逻辑的任务接口。job接口很容易实现，只有一个execute方法，类似TimerTask的run方法，在里面编写业务逻辑。
- Job实例在quartz中的生命周期：每次调度器执行job时，它在调用execute方法前会创建一个新的job实例。当调用完成后，关联的job对象实例会被释放，释放的实例会被垃圾回收机制回收。

#### JobDetail

- JobDetail为Job实例提供了许多设置属性，以及JobDataMap成员变量属性，它用来存储特定Job实例的状态信息，调度器需要借助JobDetail对象来添加Job实例。
  - name：名称
  - group：所在组
  - jobClass：任务类
  - jobDataMap：

#### JobExecutionContext

- 当Scheduler调用一个job，就会将JobExecutionContext传递给job的execute方法
- job能通过JobExecutionContext对象访问到quartz运行时候的环境以及job本身的明细数据

#### JobDataMap

- 在进行任务调度时JobDataMap存储在JobExecutionContext中，非常方便获取。
- JobDataMap可以用来装载任何可序列化的对象，当job实例对象被执行时这些参数对象会传递给它
- JobDataMap实现了JDK中的Map接口，并且添加了一些非常方便的方法来存取基本数据类型。

#### Trigger

- quartz中的触发器用来告诉调度程序作业什么时候触发。即Trigger对象是用来触发执行job的

- 三个属性：

  - JobKey：表示job实例的标识，触发器被触发时，该指定的job实例会执行。
  - StartTime：表示触发器的时间表首次被触发的时间。类型是java.util.Date
  - EndTime：指定触发器的不再被触发的时间，类型是java.util.Date

- SimpleTrigger：在一个指定时间段内执行一次作业任务，或是在指定的时间间隔内多次执行作业任务

  - 重复次数可以为0，正整数或SimpleTrigger.REPEAT_INDEFINITELY常量值。
  - 重复执行间隔必须为0或长整数
  - 一旦被指定了endTime参数，那么它会重复次数参数的效果

- CronTrigger：基于日历的作业调度器，而不是像SimpleTrigger那样精确指定时间间隔，比SimpleTrigger更常用。

  - Cron表达式：用于配置CronTrigger实例，是由七个子表达式组成的字符串，描述了时间表的详细信息。格式为：【秒】【分】【小时】【日】【月】【周】【年】

  - | 字段 | 是否必填 |      允许值      |   允许的字符    |
    | :--: | :------: | :--------------: | :-------------: |
    |  秒  |    是    |       0~59       |     ，- * /     |
    |  分  |    是    |       0~59       |     ，- * /     |
    | 小时 |    是    |       0~23       |     ，- * /     |
    |  日  |    是    |       0~31       | ，- * ? / L W C |
    |  月  |    是    |  0~12或JAN-DEC   |     ，- * /     |
    |  周  |    是    |   1~7或SUN-SAT   | ，- * ? / L # C |
    |  年  |    否    | empty，1970~2099 |     ，- * /     |

  - | 表达式                    | 含义                                            |
    | ------------------------- | ----------------------------------------------- |
    | 0 15 10 ？ * *            | 每天10点15分触发                                |
    | 0 0/15 14 * * ?           | 每天下午的2点到2点59分（整点开始，每隔5分触发） |
    | 0 15 10 ？ * MON-FRI      | 从周一到周五每天上午的10点15分触发              |
    | 0 15 10 ？ * 6#3          | 每月的第三周的星期五开始触发                    |
    | 0 15 10 ？ * 6L 2016~2017 | 从2016~2017年每月最后一周的星期五的10点15分触发 |

  - 可借助在线生成器进行规则生成