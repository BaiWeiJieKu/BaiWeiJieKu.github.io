```
layout: post
title: "ft工具类"
categories: 工具类
tags: 
author: 百味皆苦
music-id: 3136952023
```

{:toc}



### 配置文件读取

#### PropertiesUtil

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.io.InputStreamReader;
import java.nio.charset.StandardCharsets;
import java.util.Objects;
import java.util.Properties;

public class PropertiesUtil {

    private static final Logger logger = LoggerFactory.getLogger(PropertiesUtil.class);

    private static Properties p = new Properties();

    static{
        init();
    }

    private static void init(){
        try {
            p.load(new InputStreamReader(Objects.requireNonNull(PropertiesUtil.class.getClassLoader().getResourceAsStream("env_config.properties")), StandardCharsets.UTF_8));
        } catch (IOException e) {
            logger.error("Loading properties file error：", e);
        }
    }

    /**
     * Fetch value by key
     * @param key key
     * @return String
     */
    public static String getValue(String key) {
        return p.getProperty(key);
    }

    /**
     * Put new value into file
     * @param key key
     * @param value value
     */
    public static void writeProperty(String key, String value) {
        p.setProperty(key.trim(), value.trim());
    }

    public static void main(String[] args) {
        
    }
}

```



### 自定义异常

#### BusinessException

```java
public class BusinessException extends RuntimeException {

	private static final long serialVersionUID = 2874510430549463213L;

	public BusinessException() {
		super();
	}

	public BusinessException(String message, Throwable cause) {
		super(message, cause);
	}

	public BusinessException(String message) {
		super(message);
	}

	public BusinessException(Throwable cause) {
		super(cause);
	}

	private int returnCode;

	public BusinessException(int returnCode) {
		super();
		this.returnCode = returnCode;
	}

	public BusinessException(Exception e, int returnCode) {
		super(e);
		this.returnCode = returnCode;
	}

	public BusinessException(String message, int returnCode) {
		super(message);
		this.returnCode = returnCode;
	}

	public BusinessException(String message, Exception e, int returnCode) {
		super(message, e);
		this.returnCode = returnCode;
	}

	public int getReturnCode() {
		return returnCode;
	}

	public void setReturnCode(int returnCode) {
		this.returnCode = returnCode;
	}
}
```



### redis相关

#### 分布式锁

```java
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.script.DefaultRedisScript;
import org.springframework.data.redis.core.script.RedisScript;
import org.springframework.stereotype.Component;
import org.springframework.util.Assert;

import javax.annotation.Resource;
import java.util.Collections;
import java.util.UUID;

@Component
public class RedisDistributedLock {

    private static final String LUA_SCRIPT_LOCK = "return redis.call('set',KEYS[1],ARGV[1],'NX','PX',ARGV[2])";
    private static final RedisScript<String> SCRIPT_LOCK = new DefaultRedisScript<String>(LUA_SCRIPT_LOCK, String.class);
    private static final String LUA_SCRIPT_UNLOCK = "if redis.call('get',KEYS[1]) == ARGV[1] then return tostring(redis.call('del', KEYS[1])) else return '0' end";
    private static final RedisScript<String> SCRIPT_UNLOCK = new DefaultRedisScript<String>(LUA_SCRIPT_UNLOCK, String.class);
    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    /**
     * 加锁
     *
     * @param redisKey   缓存KEY
     * @param expire     到期时间 毫秒
     * @param tryTimeout 尝试获取锁超时时间 毫秒
     * @return redis锁信息
     */
    public RedisLockInfo tryLock(String redisKey, long expire, long tryTimeout) {
        Assert.isTrue(tryTimeout > 0, "tryTimeout必须大于0");
        long timestamp = System.currentTimeMillis();
        int tryCount = 0;
        String lockId = UUID.randomUUID().toString();
        while ((System.currentTimeMillis() - timestamp) < tryTimeout) {
            try {
                Object lockResult = redisTemplate.execute(SCRIPT_LOCK,
                        redisTemplate.getStringSerializer(),
                        redisTemplate.getStringSerializer(),
                        Collections.singletonList(redisKey),
                        lockId, String.valueOf(expire));
                tryCount++;
                if ("OK".equals(lockResult)) {
                    return new RedisLockInfo(lockId, redisKey, expire, tryTimeout, tryCount);
                } else {
                    Thread.sleep(50);
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
        return null;
    }

    /**
     * 解锁
     *
     * @param redisLockInfo 获取锁返回的对象
     * @return 是释放成功
     */
    public boolean releaseLock(RedisLockInfo redisLockInfo) {
        Object releaseResult = null;
        try {
            releaseResult = redisTemplate.execute(SCRIPT_UNLOCK,
                    redisTemplate.getStringSerializer(),
                    redisTemplate.getStringSerializer(),
                    Collections.singletonList(redisLockInfo.getRedisKey()),
                    redisLockInfo.getLockId());
        } catch (Exception e) {
            e.printStackTrace();
        }
        return null != releaseResult && releaseResult.equals(1);
    }
}

```

- 锁信息

```java
import lombok.AllArgsConstructor;
import lombok.Data;

@Data
@AllArgsConstructor
public class RedisLockInfo {

    /**
     * 锁ID UUID
     */
    private String lockId;

    /**
     * REDIS KEY
     */
    private String redisKey;

    /**
     * 过期时间
     */
    private Long expire;

    /**
     * 尝试获取锁超时时间
     */
    private Long tryTimeout;

    /**
     * 尝试获取锁次数
     */
    private int tryCount;

}

```

#### RedisCacheManager

```java
import org.springframework.data.redis.core.RedisCallback;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.util.CollectionUtils;
import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisCluster;

import java.util.*;
import java.util.concurrent.TimeUnit;

/**
 * @description: redis 工具类
 */
public class RedisCacheManager {

     /**
     * LOCK Result-成功标记
     */
    private static final String LOCK_SUCCESS = "OK";
    /**
     * 当key不存在，进行set操作；若key已存在，则不做任何操作
     */
    private static final String SET_IF_NOT_EXIST = "NX";
    /**
     * key加一个过期的设置
     */
    private static final String SET_WITH_EXPIRE_TIME = "PX";

    /**
     * 锁的超时时间（毫秒）
     */
    private static final Long TIMEOUT = 5000L;

    /**
     * RELEASE Result-成功标记
     */
    private static final Long RELEASE_SUCCESS = 1L;

    /**
     * 单个节点相关requestId
     * 可以用UUID.randomUUID().toString()
     */
    public static final String REQUESTID_DEFAULT="fittime_requestId";

    /**
     * redisTemplate 对象
     */
    private RedisTemplate<String, Object> redisTemplate;

    public void setRedisTemplate(RedisTemplate<String, Object> redisTemplate) {
        this.redisTemplate = redisTemplate;
    }

    /**
     * 尝试获取分布式锁
     * @param lockKey 锁（即key）
     * @param requestId 请求标识，解锁时使用（即value或者UUID.randomUUID().toString()生成）
     * @param expireTime 超期时间（单位毫秒）
     * @return 是否获取成功
     */
    public boolean tryGetDistributedLock(String lockKey, String requestId,Long expireTime) {
       return redisTemplate.execute((RedisCallback<Boolean>) connection -> {
           String timeoutStr;
           if(expireTime!=null){
               timeoutStr=expireTime.toString();
           }else {
               timeoutStr=TIMEOUT.toString();
           }
           //加锁命令
           Object obj = connection.execute("SET", lockKey.getBytes(), requestId.getBytes(),
                   SET_WITH_EXPIRE_TIME.getBytes(), timeoutStr.getBytes(), SET_IF_NOT_EXIST.getBytes());
           return Arrays.equals(LOCK_SUCCESS.getBytes(), (byte[]) obj);
       });
    }

    /**
     * 释放分布式锁
     * @param lockKey 锁（即key）
     * @param requestId 请求标识，解锁时使用（即value）
     * @return 是否释放成功
     */
    public boolean releaseDistributedLock(String lockKey, String requestId) {
        return redisTemplate.execute((RedisCallback<Boolean>) connection -> {
            //Lua脚本代码（原子性）：先获取锁对应的value值，检查是否与requestId相等，如果相等则删除锁（解锁）
            String script = "if redis.call('get', KEYS[1]) == ARGV[1] then return redis.call('del', KEYS[1]) else return 0 end";
            List<String> keys=Collections.singletonList(lockKey);
            List<String> args=Collections.singletonList(requestId);

            Object nativeConnection = connection.getNativeConnection();
            Long result=0L;
            if (nativeConnection instanceof JedisCluster) {
                // 集群模式
                result= (Long) ((JedisCluster) nativeConnection).eval(script, keys, args);
            } else if (nativeConnection instanceof Jedis) {
                // 单机模式
                result= (Long) ((Jedis) nativeConnection).eval(script, keys, args);
            }

            if(RELEASE_SUCCESS.equals(result)) {
                return true;
            }
            return false;
        });
    }
    //=============================common============================
    /**
     * 指定缓存失效时间
     * @param key 键
     * @param time 时间(秒)
     * @return
     */
    public boolean expire(String key,long time){
        try {
            if(time>0){
                redisTemplate.expire(key, time, TimeUnit.SECONDS);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 根据key 获取过期时间
     * @param key 键 不能为null
     * @return 时间(秒) 返回0代表为永久有效
     */
    public long getExpire(String key){
        return redisTemplate.getExpire(key,TimeUnit.SECONDS);
    }

    /**
     * 判断key是否存在
     * @param key 键
     * @return true 存在 false不存在
     */
    public boolean hasKey(String key){
        try {
            return redisTemplate.hasKey(key);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 删除缓存
     * @param key 可以传一个值 或多个
     */
    @SuppressWarnings("unchecked")
    public void del(String ... key){
        if(key!=null&&key.length>0){
            if(key.length==1){
                redisTemplate.delete(key[0]);
            }else{
                redisTemplate.delete(CollectionUtils.arrayToList(key));
            }
        }
    }

    //============================String=============================
    /**
     * 普通缓存获取
     * @param key 键
     * @return 值
     */
    public Object get(String key){
        return key==null?null:redisTemplate.opsForValue().get(key);
    }

    /**
     * 普通缓存放入
     * @param key 键
     * @param value 值
     * @return true成功 false失败
     */
    public boolean set(String key,Object value) {
        try {
            redisTemplate.opsForValue().set(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

    }

    /**
     * 普通缓存放入并设置时间
     * @param key 键
     * @param value 值
     * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期
     * @return true成功 false 失败
     */
    public boolean set(String key,Object value,long time){
        try {
            if(time>0){
                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);
            }else{
                set(key, value);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 递增
     * @param key 键
     * @param delta 要增加几(大于0)
     * @return
     */
    public long incr(String key, long delta){
        if(delta<0){
            throw new RuntimeException("递增因子必须大于0");
        }
        return redisTemplate.opsForValue().increment(key, delta);
    }

    /**
     * 递减
     * @param key 键
     * @param delta 要减少几(小于0)
     * @return
     */
    public long decr(String key, long delta){
        if(delta<0){
            throw new RuntimeException("递减因子必须大于0");
        }
        return redisTemplate.opsForValue().increment(key, -delta);
    }

    //================================Map=================================
    /**
     * HashGet
     * @param key 键 不能为null
     * @param item 项 不能为null
     * @return 值
     */
    public Object hget(String key,String item){
        return redisTemplate.opsForHash().get(key, item);
    }

    /**
     * 获取hashKey对应的所有键值
     * @param key 键
     * @return 对应的多个键值
     */
    public Map<Object,Object> hmget(String key){
        return redisTemplate.opsForHash().entries(key);
    }

    /**
     * HashSet
     * @param key 键
     * @param map 对应多个键值
     * @return true 成功 false 失败
     */
    public boolean hmset(String key, Map<String,Object> map){
        try {
            redisTemplate.opsForHash().putAll(key, map);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * HashSet 并设置时间
     * @param key 键
     * @param map 对应多个键值
     * @param time 时间(秒)
     * @return true成功 false失败
     */
    public boolean hmset(String key, Map<String,Object> map, long time){
        try {
            redisTemplate.opsForHash().putAll(key, map);
            if(time>0){
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 向一张hash表中放入数据,如果不存在将创建
     * @param key 键
     * @param item 项
     * @param value 值
     * @return true 成功 false失败
     */
    public boolean hset(String key,String item,Object value) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 向一张hash表中放入数据,如果不存在将创建
     * @param key 键
     * @param item 项
     * @param value 值
     * @param time 时间(秒)  注意:如果已存在的hash表有时间,这里将会替换原有的时间
     * @return true 成功 false失败
     */
    public boolean hset(String key,String item,Object value,long time) {
        try {
            redisTemplate.opsForHash().put(key, item, value);
            if(time>0){
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 删除hash表中的值
     * @param key 键 不能为null
     * @param item 项 可以使多个 不能为null
     */
    public void hdel(String key, Object... item){
        redisTemplate.opsForHash().delete(key,item);
    }

    /**
     * 判断hash表中是否有该项的值
     * @param key 键 不能为null
     * @param item 项 不能为null
     * @return true 存在 false不存在
     */
    public boolean hHasKey(String key, String item){
        return redisTemplate.opsForHash().hasKey(key, item);
    }

    /**
     * hash递增 如果不存在,就会创建一个 并把新增后的值返回
     * @param key 键
     * @param item 项
     * @param by 要增加几(大于0)
     * @return
     */
    public double hincr(String key, String item,double by){
        return redisTemplate.opsForHash().increment(key, item, by);
    }

    /**
     * hash递减
     * @param key 键
     * @param item 项
     * @param by 要减少记(小于0)
     * @return
     */
    public double hdecr(String key, String item,double by){
        return redisTemplate.opsForHash().increment(key, item,-by);
    }

    //============================set=============================
    /**
     * 根据key获取Set中的所有值
     * @param key 键
     * @return
     */
    public Set<Object> sGet(String key){
        try {
            return redisTemplate.opsForSet().members(key);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * 根据value从一个set中查询,是否存在
     * @param key 键
     * @param value 值
     * @return true 存在 false不存在
     */
    public boolean sHasKey(String key,Object value){
        try {
            return redisTemplate.opsForSet().isMember(key, value);
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 将数据放入set缓存
     * @param key 键
     * @param values 值 可以是多个
     * @return 成功个数
     */
    public long sSet(String key, Object...values) {
        try {
            return redisTemplate.opsForSet().add(key, values);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * 将set数据放入缓存
     * @param key 键
     * @param time 时间(秒)
     * @param values 值 可以是多个
     * @return 成功个数
     */
    public long sSetAndTime(String key,long time,Object...values) {
        try {
            Long count = redisTemplate.opsForSet().add(key, values);
            if(time>0) {
                expire(key, time);
            }
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * 获取set缓存的长度
     * @param key 键
     * @return
     */
    public long sGetSetSize(String key){
        try {
            return redisTemplate.opsForSet().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * 移除值为value的
     * @param key 键
     * @param values 值 可以是多个
     * @return 移除的个数
     */
    public long setRemove(String key, Object ...values) {
        try {
            Long count = redisTemplate.opsForSet().remove(key, values);
            return count;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }
    //===============================list=================================

    /**
     * 获取list缓存的内容
     * @param key 键
     * @param start 开始
     * @param end 结束  0 到 -1代表所有值
     * @return
     */
    public List<Object> lGet(String key,long start, long end){
        try {
            return redisTemplate.opsForList().range(key, start, end);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * 获取list缓存的长度
     * @param key 键
     * @return
     */
    public long lGetListSize(String key){
        try {
            return redisTemplate.opsForList().size(key);
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }

    /**
     * 通过索引 获取list中的值
     * @param key 键
     * @param index 索引  index>=0时， 0 表头，1 第二个元素，依次类推；index<0时，-1，表尾，-2倒数第二个元素，依次类推
     * @return
     */
    public Object lGetIndex(String key,long index){
        try {
            return redisTemplate.opsForList().index(key, index);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }

    /**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @return
     */
    public boolean lSet(String key, Object value) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @param time 时间(秒)
     * @return
     */
    public boolean lSet(String key, Object value, long time) {
        try {
            redisTemplate.opsForList().rightPush(key, value);
            if (time > 0) {
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @return
     */
    public boolean lSet(String key, List<Object> value) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 将list放入缓存
     * @param key 键
     * @param value 值
     * @param time 时间(秒)
     * @return
     */
    public boolean lSet(String key, List<Object> value, long time) {
        try {
            redisTemplate.opsForList().rightPushAll(key, value);
            if (time > 0) {
                expire(key, time);
            }
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 根据索引修改list中的某条数据
     * @param key 键
     * @param index 索引
     * @param value 值
     * @return
     */
    public boolean lUpdateIndex(String key, long index,Object value) {
        try {
            redisTemplate.opsForList().set(key, index, value);
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }

    /**
     * 移除N个值为value
     * @param key 键
     * @param count 移除多少个
     * @param value 值
     * @return 移除的个数
     */
    public long lRemove(String key,long count,Object value) {
        try {
            Long remove = redisTemplate.opsForList().remove(key, count, value);
            return remove;
        } catch (Exception e) {
            e.printStackTrace();
            return 0;
        }
    }


    /**
     * 获取redis中以某些字符串为前缀的KEY列表
     * @param prefix key 前缀
     * @return 移除的个数
     */
    public Set<String> keySet(String prefix){
        Set<String> keys = redisTemplate.keys(prefix);
        return keys;
    }

}

```

#### RedisLock

```java
import org.apache.commons.lang3.StringUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

@Component
public class RedisLock {

    private Logger logger = LoggerFactory.getLogger(this.getClass());

    @Resource
    private RedisTemplate<String, Object> redisTemplate;

    /**
     * Redis 加锁
     * @param key  KEY
     * @param value 超时时间
     * @return boolean 加锁是否成功 true是  false否
     */
    public boolean lock(String key, String value) {
        // 先获取当前值
        Object currentValue = redisTemplate.opsForValue().get(key);
        if (null != currentValue) {
            // 锁过期/重新设置值
            if (Long.parseLong(String.valueOf(currentValue)) < System.currentTimeMillis()) {
                redisTemplate.opsForValue().set(key, value);
                return false;
            } else {
                return true;
            }
        }
        redisTemplate.opsForValue().set(key, value);
        return false;
//        // 避免死锁，且只让一个线程拿到锁
//        String currentValue = String.valueOf(redisTemplate.opsForValue().get(key));
//
//        // 如果锁过期了
//        if (!StringUtils.isEmpty(currentValue) && Long.parseLong(currentValue) < System.currentTimeMillis()) {
//
//            // 获取上一个锁的时间
//            String oldValues = String.valueOf(redisTemplate.opsForValue().getAndSet(key, value));
//
//            // 如果旧的value和currentValue相等，只会有一个线程达成条件，因为第二个线程拿到的oldValue已经和currentValue不一样了
//            return !StringUtils.isEmpty(oldValues) && oldValues.equals(currentValue);
//        }
//        return false;
    }


    /**
     * Redis 解锁
     * @param key KEY
     * @param value VALUE
     */
    public void unlock(String key, String value) {
        try {
            String currentValue = String.valueOf(redisTemplate.opsForValue().get(key));
            if (!StringUtils.isEmpty(currentValue) && currentValue.equals(value)) {
                redisTemplate.opsForValue().getOperations().delete(key);
            }
        } catch (Exception e) {
            logger.error("[Redis分布式锁] 解锁异常: ", e);
        }
    }
}
```



### 返回信息

#### ResponseBean

```java
public class ResponseBean<T> {

    private Integer code = 0;

    private String msg = null;

    private T data = null;


    public ResponseBean() {
    }

    public ResponseBean(T data) {
        this.data = data;
    }

    public ResponseBean(String info, T data) {
        this.msg = info;
        this.data = data;
    }

    public ResponseBean(Integer code, String info, T data) {
        super();
        this.code = code;
        this.msg = info;
        this.data = data;
    }

    public ResponseBean(Integer code, String info) {
        super();
        this.code = code;
        this.msg = info;
    }

    public static <T> ResponseBean onSuccess() {
        ResponseBean<T> responseBean = new ResponseBean<>();
        responseBean.fillResponse(ResponseCode.Common.SUCCESS, null);
        return responseBean;
    }

    public static <T> ResponseBean onSuccess(ResponseCode.IResponseCode responseCode) {
        ResponseBean<T> responseBean = new ResponseBean<>();
        responseBean.fillResponse(responseCode, null);
        return responseBean;
    }


    public static <T> ResponseBean onSuccess(T data) {
        ResponseBean<T> result = new ResponseBean<>();
        result.fillResponse(ResponseCode.Common.SUCCESS, data);
        return result;
    }

    public static <T> ResponseBean onSuccess(ResponseCode.IResponseCode responseCode, T data) {
        ResponseBean<T> result = new ResponseBean<>();
        result.fillResponse(responseCode, data);
        return result;
    }


    public static ResponseBean onFailure(ResponseCode.IResponseCode responseCode) {
        return onFailure(responseCode, null);
    }

    public static <T> ResponseBean<T> onFailure(ResponseCode.IResponseCode responseCode, T data) {
        ResponseBean<T> responseBean = new ResponseBean<>();
        responseBean.fillResponse(responseCode, data);
        return responseBean;
    }

    public static <T> ResponseBean<T> onFailureMessage( String message) {
        ResponseBean<T> responseBean = new ResponseBean<>();
        responseBean.fillResponse(ResponseCode.Common.FAILURE, null);
        responseBean.setMsg(message);
        return responseBean;
    }

    public static <T> ResponseBean<T> onFailureMessage(ResponseCode.IResponseCode responseCode, String message) {
        ResponseBean<T> responseBean = new ResponseBean<>();
        responseBean.fillResponse(responseCode, null);
        responseBean.setMsg(message);
        return responseBean;
}



    public Integer getCode() {
        return code;
    }

    public void setCode(Integer code) {
        this.code = code;
    }

    public String getMsg() {
        return msg;
    }

    public void setMsg(String msg) {
        this.msg = msg;
    }

    public T getData() {
        return data;
    }

    public void setData(T data) {
        this.data = data;
    }

    private void fillResponse(ResponseCode.IResponseCode responseCode, T data) {
        setCode(responseCode.getCode());
        setMsg(responseCode.getMsg());
        setData(data);
    }

}

```

#### ResponseCode

```java
import com.fasterxml.jackson.annotation.JsonFormat;

/**
 * 系统错误码： 16 01 001
 * 系统 模块 详细错误
 */
public class ResponseCode {

    @JsonFormat(shape = JsonFormat.Shape.OBJECT)
    public enum Common implements IResponseCode {
        /* 返回Code码 */
        SUCCESS(0, "成功"),
        FAILURE(-1, "失败"),
        INVALID_PARAMETER(400, "参数非法"),
        UNAUTHORIZED(401, "无权访问"),
        INTERFACE_EXCEPTION(402, "调用接口异常"),
        PARAM_EXCEED_LIMIT(403, "超过字数限制");

        private int code;
        private String msg;

        Common(int code, String msg) {
            this.code = code;
            this.msg = msg;
        }

        @Override
        public int getCode() {
            return code;
        }

        @Override
        public String getMsg() {
            return msg;
        }
    }

    @JsonFormat(shape = JsonFormat.Shape.OBJECT)
    public enum PreSaleQn implements IResponseCode {
        /* 返回Code码 */
        RECORD_ALREADY_EXISTS(1601001, "不可重复插入");

        private int code;
        private String msg;

        PreSaleQn(int code, String msg) {
            this.code = code;
            this.msg = msg;
        }

        @Override
        public int getCode() {
            return code;
        }

        @Override
        public String getMsg() {
            return msg;
        }
    }

    public interface IResponseCode {

        int getCode();

        String getMsg();

    }
}

```

#### ResultJson

```java
import com.alibaba.fastjson.JSONObject;
import com.fittime.common.util.DateUtils;
import com.fittime.common.util.enums.ResponseCodeEnums;
import lombok.Data;

import java.util.Date;

/**
 * @description: ResultJson
 */
@Data
public class ResultJson {

	private Integer returnCode;

    private Object object;

    private String returnDesc;

    private String currentTime;

    public ResultJson() {}

    private ResultJson(Integer returnCode, Object object, String returnDesc) {
        this.returnCode = returnCode;
        this.object = object;
        this.returnDesc = returnDesc;
        this.currentTime = DateUtils.dateToStr(new Date(), DateUtils.DEFAULTPATTERN);
    }

    /**
     * 成功操作返回数据
     * @param data data
     * @param <E> E
     * @return E
     */
    public static ResultJson success(Object data) {
        JSONObject jsonSucess = new JSONObject();
        jsonSucess.put("data", data);
        return new ResultJson(ResponseCodeEnums.SUCCESS.getReturnCode(), jsonSucess, ResponseCodeEnums.SUCCESS.getChMessage());
    }

    /**
     * 错误操作返回数据
     * @param returnCode 状态码
     * @param message 信息
     * @param <E> 泛型
     * @return ResultJson
     */
    public static ResultJson badRequest(int returnCode, String message) {
        JSONObject jsonBad = new JSONObject();
        jsonBad.put("data", null);
        return new ResultJson(returnCode, jsonBad, message);
    }

    /**
     * 错误操作返回数据
     * @return ResultJson
     */
    public static ResultJson badRequest() {
        JSONObject jsonBad = new JSONObject();
        jsonBad.put("data", null);
        return new ResultJson(ResponseCodeEnums.ERROR.getReturnCode(), jsonBad, ResponseCodeEnums.ERROR.getChMessage());
    }

    /**
     * 设置结果数据
     * @param resultJson ResultJson
     * @param data 数据
     */
    public static void setResultJson(ResultJson resultJson, Object data) {
        if (null != resultJson) {
            JSONObject jsonObject = new JSONObject();
            jsonObject.put("data", null == data ? "" : data);
            resultJson.setObject(jsonObject);
            resultJson.setCurrentTime(DateUtils.dateToStr(new Date(), DateUtils.DEFAULTPATTERN));
        }
    }

}

```



### 枚举

#### ResponseCodeEnums

```java
/**
 * 服务返回状态枚举
 */
public enum ResponseCodeEnums {

    SUCCESS(200, "成功", "success"),
    ERROR(500, "系统异常", "error"),
    NAUTHORIZED(401, "未授权", "unauthorized"),
    ACCESSFORBIDDEN(403, "禁止访问", "access forbidden"),
    NOTFOUND(404, "您访问的资源不存在", "not found"),

    // 自定义的错误码建议从10000开始
    PLEASE_OPEN_IN_WEIXIN(10000, "请在微信中打开链接", ""),
    USERID_IS_NOT_NULL(10001, "userId不能为空", ""),
    SOURCE_IS_NULL(10002, "渠道码为空", ""),
    CLUETYPE_IS_NULL(10003, "clueType不能为空", ""),
    CLUETYPE_IS_ERROR(10004, "clueType只能为1或2", ""),
    QUESTIONNAIREAGE_NULL(10005, "questionnaireAge不能为空", ""),
    QUESTIONNAIREAGE_ERROR(10006, "questionnaireAge应为1~99整数", ""),
    YOU_ARE_BUSYING(10007, "不能操作太频繁哦！", ""),

    ;

    // 状态码
    private Integer returnCode;

    // 中文信息
    private String chMessage;

    // 英文信息
    private String enMessage;

    private ResponseCodeEnums(int returnCode, String chMessage, String enMessage) {
        this.returnCode = returnCode;
        this.chMessage = chMessage;
        this.enMessage = enMessage;
    }

    public Integer getReturnCode() {
        return returnCode;
    }

    public void setReturnCode(Integer returnCode) {
        this.returnCode = returnCode;
    }

    public String getChMessage() {
        return chMessage;
    }

    public void setChMessage(String chMessage) {
        this.chMessage = chMessage;
    }

    public String getEnMessage() {
        return enMessage;
    }

    public void setEnMessage(String enMessage) {
        this.enMessage = enMessage;
    }
}

```



### 跨域

#### CrossDomainFilter

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.filter.OncePerRequestFilter;

import javax.servlet.FilterChain;
import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * 处理跨域
 */
@Configuration
public class CrossDomainFilter extends OncePerRequestFilter {

    private Logger log = LoggerFactory.getLogger(getClass());

	@Override
	protected void doFilterInternal(HttpServletRequest request, HttpServletResponse response, FilterChain filterChain)
			throws ServletException, IOException {
        log.info("跨域处理初始化......");
        response.setHeader("Access-Control-Allow-Origin", "*");
        //response.setHeader("Access-Control-Allow-Methods", "POST, GET, PUT, OPTIONS, DELETE, PATCH");
        response.setHeader("Access-Control-Max-Age", "3600");
        response.setHeader("Access-Control-Allow-Headers", "Origin, X-Requested-With, Content-Type, Accept, Authorization, x-rjft-request");
        //response.setHeader("Access-Control-Expose-Headers", "Location");
        filterChain.doFilter(request, response);
	}

}

```



### 日期

#### DateUtils

```java
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.text.DateFormat;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;

/**
 * 日期工具类
 */
public class DateUtils {

    private static Logger logger = LoggerFactory.getLogger(DateUtils.class);

    public static final String DEFAULTPATTERN = "yyyy-MM-dd HH:mm:ss";
    public static final String PATTERN_YYYY_MM_DD = "yyyy-MM-dd";
    public static final String PATTERN_YYYY_MM = "yyyy-MM";
    public static final String PATTERN_yyyyMMddhhmmss = "yyyyMMddHHmmss";
    public static final String PATTERN_yyyyMMdd = "yyyyMMdd";
    public static final String PATTERN_yyyyMMddHHmm = "yyyy-MM-dd HH:mm";
    public static final String PATTERN_yyyyMMddHH = "yyyy-MM-dd HH";
    public static final String PATTERN_YYYY_MM_DD2 = "yyyy年MM月dd日";
    public static final String PATTERN_MM_DD = "MM月dd日";
    public static final String PATTERN_hh_ss = "HH:mm";
    public static final String DEFAULTPATTERN_EN = "EEE MMM dd HH:mm:ss Z yyyy";

    /**
     * Date convert to string
     * @param date 日期
     * @param pattern 时间规则
     * @return StringDate
     */
    public static String dateToStr(Date date, String pattern) {
        if (null != date) {
            SimpleDateFormat format = new SimpleDateFormat(pattern);
            return format.format(date);
        } else {
            return null;
        }
    }

    /**
     * 给定一个时间计算距离现在的时间差精准到毫秒
     * @param date 字符串时间
     * @return 相差时间毫秒数
     */
    public static long differentDaysms(String date) {
        try {
            Date d = new SimpleDateFormat(DateUtils.DEFAULTPATTERN).parse(date);
            long daysms = System.currentTimeMillis() - d.getTime();
            logger.info("系统现在的毫秒数为 {} ：", System.currentTimeMillis());
            logger.info("数据库的入库时间为 {} ：", d.getTime());
            return daysms;
        } catch (Exception e) {
            logger.error("differentDays error：", e);
        }
        return 0;
    }

    /**
     * String to date
     * @param str String
     * @return Date
     */
    public static Date stringToDate(String str) {
        DateFormat df = new SimpleDateFormat(DateUtils.PATTERN_YYYY_MM_DD);
        Date date = null;
        try {
            date = df.parse(str);
        } catch (ParseException e) {
            logger.error("[stringToDate][出错] : ", e);
        }
        return date;
    }

}
```



### IP地址

#### IpAddressUtil

```java
import javax.servlet.http.HttpServletRequest;
import java.net.InetAddress;
import java.net.UnknownHostException;

/**
 */
public class IpAddressUtil {
    public static String getIpAddr(HttpServletRequest request) {
        String ipAddress = request.getHeader("x-forwarded-for");
        if (ipAddress == null || ipAddress.length() == 0 || CommonConstants.UNKNOWN.equalsIgnoreCase(ipAddress)) {
            ipAddress = request.getHeader("Proxy-Client-IP");
        }
        if (ipAddress == null || ipAddress.length() == 0 || CommonConstants.UNKNOWN.equalsIgnoreCase(ipAddress)) {
            ipAddress = request.getHeader("WL-Proxy-Client-IP");
        }
        if (ipAddress == null || ipAddress.length() == 0 || CommonConstants.UNKNOWN.equalsIgnoreCase(ipAddress)) {
            ipAddress = request.getRemoteAddr();
            if (CommonConstants.LOCAL_HOST.equals(ipAddress) || CommonConstants.MAC_ADDR.equals(ipAddress)) {
                //根据网卡取本机配置的IP  
                InetAddress inet = null;
                try {
                    inet = InetAddress.getLocalHost();
                } catch (UnknownHostException e) {
                    e.printStackTrace();
                }
                assert inet != null;
                ipAddress = inet.getHostAddress();
            }
        }
        // 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照','分割
        if (ipAddress != null && ipAddress.length() > CommonConstants.N15) {
            if (ipAddress.indexOf(CommonConstants.DOU_HAO) > 0) {
                ipAddress = ipAddress.substring(0, ipAddress.indexOf(CommonConstants.DOU_HAO));
            }
        }
        return ipAddress;
    }
}

```

#### IpUtil

```java
import com.alibaba.fastjson.JSON;
import com.fittime.common.constant.CommonConstants;
import lombok.extern.slf4j.Slf4j;
import org.lionsoul.ip2region.DataBlock;
import org.lionsoul.ip2region.DbConfig;
import org.lionsoul.ip2region.DbSearcher;
import org.lionsoul.ip2region.Util;

import java.io.File;
import java.lang.reflect.Method;
import java.util.Objects;


/**
 * 查询算法
 * DbSearcher.BINARY_ALGORITHM //Binary
 * DbSearcher.MEMORY_ALGORITYM //Memory
 * @createdate 2020-07-30 15:17
 */
@Slf4j
public class IpUtil {

    private static final String DBPATH = Objects.requireNonNull(IpUtil.class.getClassLoader().getResource("ip2region.db")).getPath();

    private static String getCityInfo(String ip) {

        File file = new File(DBPATH);

        if (!file.exists()) {
            log.info("[Error: Invalid ip2region.db file] {}", ip);
        }

        try {

            DbConfig config = new DbConfig();

            DbSearcher searcher = new DbSearcher(config, DBPATH);

            Method method = searcher.getClass().getMethod("btreeSearch", String.class);

            DataBlock dataBlock;
            if (!Util.isIpAddress(ip)) {
                log.info("[Error: Invalid ip address] {}", ip);
            }

            dataBlock = (DataBlock) method.invoke(searcher, ip);

            return dataBlock.getRegion();

        } catch (Exception e) {
            log.error("[IP获取地域错误]", e);
        }

        return null;
    }

    /**
     * 获取IP信息数组
     * 上海IP：114.80.166.240 ["中国","0","上海","上海市","电信"]
     * 北京IP：210.51.167.169 ["中国","0","北京","北京市","联通"]
     * 广州IP：192.168.1.157  ["中国","0","广东省","广州市","电信"]
     * 深圳IP：116.76.73.232 ["中国","0","广东省","深圳市","天威"]
     * 其它省份：["中国","0","山西省","临汾市","电信"]
     * 无效IP：["0","0","0","内网IP","内网IP"]
     * @param ip IP
     * @return String[]
     */
    public static String[] getIpInfos(String ip) {
        String ipStr = IpUtil.getCityInfo(ip);
        log.info("[根据IP获取到到地址信息] {}, {}", ip, ipStr);
        return Objects.requireNonNull(ipStr).split(CommonConstants.FEN_GE_FU);
    }

    public static void main(String[] args) {
        long start = System.currentTimeMillis();
        String ip = "116.76.73.233";
        System.out.println(JSON.toJSONString(IpUtil.getIpInfos(ip)));
        System.out.println("耗时："+ (System.currentTimeMillis() - start));
    }

}
```



### json相关

#### JacksonUtil

```java
import com.fasterxml.jackson.core.JsonGenerator;
import com.fasterxml.jackson.core.JsonParser;
import com.fasterxml.jackson.core.JsonParser.Feature;
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.DeserializationFeature;
import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.dataformat.xml.XmlMapper;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.IOException;
import java.io.StringWriter;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Map.Entry;

public class JacksonUtil {
	
	private static Logger log = LoggerFactory.getLogger(JacksonUtil.class);

	private static ObjectMapper objectMapper = new ObjectMapper();
	static {
		objectMapper.configure(Feature.ALLOW_UNQUOTED_FIELD_NAMES, true);// 允许字段名不带引号
		objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
		objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
	}

	private static XmlMapper xmlMapper = new XmlMapper();

	/**
	 * map convert to xml string
	 * 
	 * @param obj
	 * @return
	 */
	public static String map2xml(Map<String, Object> map) {
		try {
			return xmlMapper.writeValueAsString(map);
		} catch (JsonProcessingException e) {
			log.error("map2xml error. map=" + map, e);
			return null;
		}
	}

	/**
	 * javabean,list,array convert to xml string
	 * 
	 * @param obj
	 * @return
	 */
	public static String obj2xml(Object obj) {
		try {
			return xmlMapper.writeValueAsString(obj);
		} catch (JsonProcessingException e) {
			// log.error("obj2xml error. obj=" + ToStringBuilder.reflectionToString(obj), e);
			return null;
		}
	}

	/**
	 * javaBean,list,array convert to json string
	 */
	public static String obj2json(Object obj) {
		try {
			return objectMapper.writeValueAsString(obj);
		} catch (JsonProcessingException e) {
			// log.error("obj2json error. obj=" + ToStringBuilder.reflectionToString(obj), e);
			return null;
		}
	}

	/**
	 * xml string convert to java bean
	 * 
	 * @param xmlStr
	 * @param clazz
	 * @return
	 */
	public static <T> T xml2pojo(String xmlStr, Class<T> clazz) {
		try {
			return xmlMapper.readValue(xmlStr, clazz);
		} catch (IOException e) {
			log.error("xml2pojo error. xml=" + xmlStr + "clazz=" + clazz, e);
			return null;
		}
	}

	/**
	 * json string convert to javaBean
	 */
	public static <T> T json2pojo(String jsonStr, Class<T> clazz) {
		try {
			return objectMapper.readValue(jsonStr, clazz);
		} catch (IOException e) {
			log.error("json2pojo error. json=" + jsonStr + ", clazz=" + clazz, e);
			return null;
		}
	}

	/**
	 * xml string convert to map
	 * 
	 * @param xmlStr
	 * @return
	 */
	@SuppressWarnings("unchecked")
	public static Map<String, Object> xml2map(String xmlStr) {
		try {
			return xmlMapper.readValue(xmlStr, Map.class);
		} catch (IOException e) {
			log.error("xml2map error. xml=" + xmlStr, e);
			return null;
		}
	}

	/**
	 * json string convert to map
	 */
	@SuppressWarnings("unchecked")
	public static <T> Map<String, Object> json2map(String jsonStr) {
		try {
			return objectMapper.readValue(jsonStr, Map.class);
		} catch (IOException e) {
			log.error("json2map error, json=" + jsonStr, e);
			return null;
		}
	}

	/**
	 * json string convert to map with javaBean
	 */
	public static <T> Map<String, T> json2map(String jsonStr, Class<T> clazz) {
		try {
			Map<String, Map<String, Object>> map = objectMapper.readValue(jsonStr, new TypeReference<Map<String, T>>() {
			});
			Map<String, T> result = new HashMap<String, T>();
			for (Entry<String, Map<String, Object>> entry : map.entrySet()) {
				result.put(entry.getKey(), objectMapper.convertValue(entry.getValue(), clazz));
			}
			return result;
		} catch (Exception e) {
			log.error("json2map error, json=" + jsonStr + ", clazz=" + clazz, e);
			return null;
		}
	}

	/**
	 * json array string convert to list with javaBean
	 */
	public static <T> List<T> json2list(String jsonArrayStr, Class<T> clazz) throws Exception {
		List<Map<String, Object>> list = objectMapper.readValue(jsonArrayStr, new TypeReference<List<T>>() {
		});
		List<T> result = new ArrayList<T>();
		for (Map<String, Object> map : list) {
			result.add(map2pojo(map, clazz));
		}
		return result;
	}

	/**
	 * map convert to javaBean
	 */
	@SuppressWarnings("rawtypes")
	public static <T> T map2pojo(Map map, Class<T> clazz) {
		return objectMapper.convertValue(map, clazz);
	}

	/**
	 * json string convert to xml string
	 */
	public static String json2xml(String jsonStr) throws Exception {
		JsonNode root = objectMapper.readTree(jsonStr);
		String xml = xmlMapper.writeValueAsString(root);
		return xml;
	}

	/**
	 * xml string convert to json string
	 */
	public static String xml2json(String xml) throws Exception {
		StringWriter w = new StringWriter();
		JsonParser jp = xmlMapper.getFactory().createParser(xml);
		JsonGenerator jg = objectMapper.getFactory().createGenerator(w);
		while (jp.nextToken() != null) {
			jg.copyCurrentEvent(jp);
		}
		jp.close();
		jg.close();
		return w.toString();
	}

}
```

#### JSONUtils

```java
import com.fasterxml.jackson.core.JsonProcessingException;
import com.fasterxml.jackson.databind.JavaType;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.extern.slf4j.Slf4j;
import org.apache.commons.lang3.StringUtils;

import java.io.IOException;
import java.util.ArrayList;
import java.util.List;

@Slf4j
public class JSONUtils {

    private static final ObjectMapper MAPPER = new ObjectMapper();

    private JSONUtils() {
    }

    public static String writeString(Object o) {
        if (o != null) {
            try {
                return MAPPER.writeValueAsString(o);
            } catch (JsonProcessingException ignored) {
                log.error("JSONUtils writeString exception {}", ignored);
            }
        }
        return "";
    }

    public static <T> T readValue(String json, JavaType javaType) {
        if (StringUtils.isNotEmpty(json)) {
            try {
                return MAPPER.readValue(json, javaType);
            } catch (IOException ignored) {
                log.error("JSONUtils readValue exception {}", ignored);
            }
        }
        return null;
    }

    public static <T> T readValue(String json, Class<T> clazz) {
        if (StringUtils.isNotEmpty(json)) {
            try {
                return MAPPER.readValue(json, clazz);
            } catch (IOException ignored) {
                log.error("JSONUtils readValue exception {}", ignored);
            }
        }
        return null;
    }

    public static <T> List<T> readListValue(String json, Class<T> clazz) {
        if (StringUtils.isNotEmpty(json)) {
            JavaType javaType = MAPPER.getTypeFactory().constructParametricType(ArrayList.class, clazz);
            try {
                return  MAPPER.readValue(json, javaType);
            } catch (IOException ignored) {
                log.error("JSONUtils readListValue exception {}", ignored);
            }
        }
        return null;
    }
}

```

