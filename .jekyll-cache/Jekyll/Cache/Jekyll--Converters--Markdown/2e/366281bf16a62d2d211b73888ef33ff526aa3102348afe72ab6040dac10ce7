I"{ç<ul id="markdown-toc">
  <li><a href="#å­—ç¬¦ä¸²è§£æ" id="markdown-toc-å­—ç¬¦ä¸²è§£æ">å­—ç¬¦ä¸²è§£æ</a></li>
  <li><a href="#å¯†ç åŠ å¯†" id="markdown-toc-å¯†ç åŠ å¯†">å¯†ç åŠ å¯†</a></li>
  <li><a href="#md5åŠ å¯†" id="markdown-toc-md5åŠ å¯†">MD5åŠ å¯†</a></li>
  <li><a href="#é‚®ä»¶å‘é€" id="markdown-toc-é‚®ä»¶å‘é€">é‚®ä»¶å‘é€</a></li>
  <li><a href="#jsonè½¬æ¢" id="markdown-toc-jsonè½¬æ¢">jsonè½¬æ¢</a></li>
  <li><a href="#ipè·å–" id="markdown-toc-ipè·å–">IPè·å–</a></li>
  <li><a href="#æ•°æ®æ ¡éªŒ" id="markdown-toc-æ•°æ®æ ¡éªŒ">æ•°æ®æ ¡éªŒ</a></li>
  <li><a href="#åˆ†é¡µæŸ¥è¯¢" id="markdown-toc-åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</a></li>
  <li><a href="#springä¸Šä¸‹æ–‡" id="markdown-toc-springä¸Šä¸‹æ–‡">springä¸Šä¸‹æ–‡</a></li>
  <li><a href="#ç›‘å¬å·¥å…·" id="markdown-toc-ç›‘å¬å·¥å…·">ç›‘å¬å·¥å…·</a></li>
  <li><a href="#è¯·æ±‚holder" id="markdown-toc-è¯·æ±‚holder">è¯·æ±‚holder</a></li>
  <li><a href="#å¼‚å¸¸å¤„ç†" id="markdown-toc-å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</a></li>
  <li><a href="#å‚æ•°å¼‚å¸¸ç±»" id="markdown-toc-å‚æ•°å¼‚å¸¸ç±»">å‚æ•°å¼‚å¸¸ç±»</a></li>
  <li><a href="#è‡ªå®šä¹‰å¼‚å¸¸" id="markdown-toc-è‡ªå®šä¹‰å¼‚å¸¸">è‡ªå®šä¹‰å¼‚å¸¸</a></li>
  <li><a href="#ç™»å½•è¿‡æ»¤å™¨" id="markdown-toc-ç™»å½•è¿‡æ»¤å™¨">ç™»å½•è¿‡æ»¤å™¨</a></li>
  <li><a href="#æƒé™æ‹¦æˆª" id="markdown-toc-æƒé™æ‹¦æˆª">æƒé™æ‹¦æˆª</a></li>
  <li><a href="#æ¥æ”¶å‚æ•°" id="markdown-toc-æ¥æ”¶å‚æ•°">æ¥æ”¶å‚æ•°</a></li>
</ul>
<h3 id="å­—ç¬¦ä¸²è§£æ">å­—ç¬¦ä¸²è§£æ</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Splitter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.stream.Collectors</span><span class="o">;</span>
<span class="cm">/**
 * å­—ç¬¦ä¸²è§£æå·¥å…·
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StringUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="nf">splitToListInt</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">strList</span> <span class="o">=</span> <span class="nc">Splitter</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">","</span><span class="o">).</span><span class="na">trimResults</span><span class="o">().</span><span class="na">omitEmptyStrings</span><span class="o">().</span><span class="na">splitToList</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">strList</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">map</span><span class="o">(</span><span class="n">strItem</span> <span class="o">-&gt;</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">strItem</span><span class="o">)).</span><span class="na">collect</span><span class="o">(</span><span class="nc">Collectors</span><span class="o">.</span><span class="na">toList</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="å¯†ç åŠ å¯†">å¯†ç åŠ å¯†</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="cm">/**
 * å¯†ç å¤„ç†å·¥å…·ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PasswordUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">word</span> <span class="o">=</span> <span class="o">{</span>
            <span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">,</span> <span class="s">"g"</span><span class="o">,</span>
            <span class="s">"h"</span><span class="o">,</span> <span class="s">"j"</span><span class="o">,</span> <span class="s">"k"</span><span class="o">,</span> <span class="s">"m"</span><span class="o">,</span> <span class="s">"n"</span><span class="o">,</span>
            <span class="s">"p"</span><span class="o">,</span> <span class="s">"q"</span><span class="o">,</span> <span class="s">"r"</span><span class="o">,</span> <span class="s">"s"</span><span class="o">,</span> <span class="s">"t"</span><span class="o">,</span>
            <span class="s">"u"</span><span class="o">,</span> <span class="s">"v"</span><span class="o">,</span> <span class="s">"w"</span><span class="o">,</span> <span class="s">"x"</span><span class="o">,</span> <span class="s">"y"</span><span class="o">,</span> <span class="s">"z"</span><span class="o">,</span>
            <span class="s">"A"</span><span class="o">,</span> <span class="s">"B"</span><span class="o">,</span> <span class="s">"C"</span><span class="o">,</span> <span class="s">"D"</span><span class="o">,</span> <span class="s">"E"</span><span class="o">,</span> <span class="s">"F"</span><span class="o">,</span> <span class="s">"G"</span><span class="o">,</span>
            <span class="s">"H"</span><span class="o">,</span> <span class="s">"J"</span><span class="o">,</span> <span class="s">"K"</span><span class="o">,</span> <span class="s">"M"</span><span class="o">,</span> <span class="s">"N"</span><span class="o">,</span>
            <span class="s">"P"</span><span class="o">,</span> <span class="s">"Q"</span><span class="o">,</span> <span class="s">"R"</span><span class="o">,</span> <span class="s">"S"</span><span class="o">,</span> <span class="s">"T"</span><span class="o">,</span>
            <span class="s">"U"</span><span class="o">,</span> <span class="s">"V"</span><span class="o">,</span> <span class="s">"W"</span><span class="o">,</span> <span class="s">"X"</span><span class="o">,</span> <span class="s">"Y"</span><span class="o">,</span> <span class="s">"Z"</span>
    <span class="o">};</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">num</span> <span class="o">=</span> <span class="o">{</span>
            <span class="s">"2"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">,</span> <span class="s">"4"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">,</span> <span class="s">"6"</span><span class="o">,</span> <span class="s">"7"</span><span class="o">,</span> <span class="s">"8"</span><span class="o">,</span> <span class="s">"9"</span>
    <span class="o">};</span>
    <span class="cm">/**
     * éšæœºç”Ÿæˆå¯†ç 
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">randomPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">StringBuffer</span> <span class="n">stringBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="c1">//æ ¹æ®æ—¶é—´æˆ³ç”Ÿæˆéšæœºè§„åˆ™</span>
        <span class="nc">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">());</span>
        <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="mi">8</span><span class="o">;</span><span class="c1">//å¯†ç é•¿åº¦åœ¨8åˆ°10å­—ç¬¦ä¹‹é—´</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">flag</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">num</span><span class="o">[</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">length</span><span class="o">)]);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">word</span><span class="o">[</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">length</span><span class="o">)]);</span>
            <span class="o">}</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="o">!</span><span class="n">flag</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">stringBuffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">randomPassword</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">randomPassword</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">randomPassword</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="md5åŠ å¯†">MD5åŠ å¯†</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
<span class="cm">/**
 * MD5å¯†ç åŠ å¯†å·¥å…·
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MD5Util</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">encrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">char</span> <span class="n">hexDigits</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="sc">'0'</span><span class="o">,</span> <span class="sc">'1'</span><span class="o">,</span> <span class="sc">'2'</span><span class="o">,</span> <span class="sc">'3'</span><span class="o">,</span> <span class="sc">'4'</span><span class="o">,</span> <span class="sc">'5'</span><span class="o">,</span> <span class="sc">'6'</span><span class="o">,</span> <span class="sc">'7'</span><span class="o">,</span> <span class="sc">'8'</span><span class="o">,</span> <span class="sc">'9'</span><span class="o">,</span> <span class="sc">'A'</span><span class="o">,</span> <span class="sc">'B'</span><span class="o">,</span> <span class="sc">'C'</span><span class="o">,</span> <span class="sc">'D'</span><span class="o">,</span> <span class="sc">'E'</span><span class="o">,</span> <span class="sc">'F'</span> <span class="o">};</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">btInput</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
            <span class="c1">// è·å¾—MD5æ‘˜è¦ç®—æ³•çš„ MessageDigest å¯¹è±¡</span>
            <span class="nc">MessageDigest</span> <span class="n">mdInst</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"MD5"</span><span class="o">);</span>
            <span class="c1">// ä½¿ç”¨æŒ‡å®šçš„å­—èŠ‚æ›´æ–°æ‘˜è¦</span>
            <span class="n">mdInst</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">btInput</span><span class="o">);</span>
            <span class="c1">// è·å¾—å¯†æ–‡</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">md</span> <span class="o">=</span> <span class="n">mdInst</span><span class="o">.</span><span class="na">digest</span><span class="o">();</span>
            <span class="c1">// æŠŠå¯†æ–‡è½¬æ¢æˆåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²å½¢å¼</span>
            <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="kt">char</span> <span class="n">str</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="kt">byte</span> <span class="n">byte0</span> <span class="o">=</span> <span class="n">md</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">str</span><span class="o">[</span><span class="n">k</span><span class="o">++]</span> <span class="o">=</span> <span class="n">hexDigits</span><span class="o">[</span><span class="n">byte0</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="o">];</span>
                <span class="n">str</span><span class="o">[</span><span class="n">k</span><span class="o">++]</span> <span class="o">=</span> <span class="n">hexDigits</span><span class="o">[</span><span class="n">byte0</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"generate md5 error, {}"</span><span class="o">,</span> <span class="n">s</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="é‚®ä»¶å‘é€">é‚®ä»¶å‘é€</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.beans.Mail</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.mail.EmailException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.mail.HtmlEmail</span><span class="o">;</span>
<span class="cm">/**
 * å‘é€é‚®ä»¶å·¥å…·ç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">send</span><span class="o">(</span><span class="nc">Mail</span> <span class="n">mail</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// TODO</span>
        <span class="nc">String</span> <span class="n">from</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">25</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">host</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">pass</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">nickname</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

        <span class="nc">HtmlEmail</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HtmlEmail</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="n">host</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setCharset</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">str</span> <span class="o">:</span> <span class="n">mail</span><span class="o">.</span><span class="na">getReceivers</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="n">from</span><span class="o">,</span> <span class="n">nickname</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">from</span><span class="o">,</span> <span class="n">pass</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getSubject</span><span class="o">());</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"{} å‘é€é‚®ä»¶åˆ° {}"</span><span class="o">,</span> <span class="n">from</span><span class="o">,</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getReceivers</span><span class="o">(),</span> <span class="s">","</span><span class="o">));</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">EmailException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">from</span> <span class="o">+</span> <span class="s">"å‘é€é‚®ä»¶åˆ°"</span> <span class="o">+</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getReceivers</span><span class="o">(),</span> <span class="s">","</span><span class="o">)</span> <span class="o">+</span> <span class="s">"å¤±è´¥"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>


</code></pre></div></div>

<h3 id="jsonè½¬æ¢">jsonè½¬æ¢</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.DeserializationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.SerializationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.annotate.JsonSerialize</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.ser.impl.SimpleFilterProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.type.TypeReference</span><span class="o">;</span>
<span class="cm">/**
 * jsonè½¬æ¢å·¥å…·ï¼Œç±»å’Œjsonçš„è½¬æ¢
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonMapper</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="c1">// config</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">disable</span><span class="o">(</span><span class="nc">DeserializationConfig</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">FAIL_ON_UNKNOWN_PROPERTIES</span><span class="o">);</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="nc">SerializationConfig</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">FAIL_ON_EMPTY_BEANS</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleFilterProvider</span><span class="o">().</span><span class="na">setFailOnUnknownId</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">setSerializationInclusion</span><span class="o">(</span><span class="nc">JsonSerialize</span><span class="o">.</span><span class="na">Inclusion</span><span class="o">.</span><span class="na">NON_EMPTY</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * å¯¹è±¡è½¬å­—ç¬¦ä¸²
     * @param src
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">String</span> <span class="nf">obj2String</span><span class="o">(</span><span class="no">T</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
        	<span class="c1">//å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥è¾“å‡ºï¼Œå¦åˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
            <span class="k">return</span> <span class="n">src</span> <span class="k">instanceof</span> <span class="nc">String</span> <span class="o">?</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">src</span> <span class="o">:</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"parse object to String exception, error:{}"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡
     * @param src
     * @param typeReference
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">string2Obj</span><span class="o">(</span><span class="nc">String</span> <span class="n">src</span><span class="o">,</span> <span class="nc">TypeReference</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">typeReference</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">typeReference</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">)</span> <span class="o">(</span><span class="n">typeReference</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">?</span> <span class="n">src</span> <span class="o">:</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">src</span><span class="o">,</span> <span class="n">typeReference</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"parse String to Object exception, String:{}, TypeReference&lt;T&gt;:{}, error:{}"</span><span class="o">,</span> <span class="n">src</span><span class="o">,</span> <span class="n">typeReference</span><span class="o">.</span><span class="na">getType</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="cm">/**
 * jsonæ•°æ®è¿”å›
 * @author Administrator
 *
 */</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonData</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">ret</span><span class="o">;</span><span class="c1">//ç»“æœ</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span><span class="c1">//æ¶ˆæ¯</span>

    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">data</span><span class="o">;</span><span class="c1">//æ•°æ®</span>

    <span class="kd">public</span> <span class="nf">JsonData</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">ret</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">success</span><span class="o">(</span><span class="nc">Object</span> <span class="n">object</span><span class="o">,</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonData</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">jsonData</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">success</span><span class="o">(</span><span class="nc">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonData</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">jsonData</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">success</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">JsonData</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">fail</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonData</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">jsonData</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">toMap</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;();</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ret"</span><span class="o">,</span> <span class="n">ret</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"msg"</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="ipè·å–">IPè·å–</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.InetAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.UnknownHostException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>
<span class="cm">/**
 * IPè·å–å·¥å…·ç±»ï¼Œä¸åŒæœåŠ¡å™¨æœ‰å·®åˆ«
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IpUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">ERROR_IP</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">Pattern</span> <span class="n">pattern</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span>
            <span class="nf">compile</span><span class="o">(</span><span class="s">"(2[5][0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})"</span><span class="o">);</span>

    <span class="cm">/**
     * å–å¤–ç½‘IP
     *
     * @param request
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getRemoteIp</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"x-real-ip"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//è¿‡æ»¤åå‘ä»£ç†çš„ip</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">stemps</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">stemps</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">stemps</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//å¾—åˆ°ç¬¬ä¸€ä¸ªIPï¼Œå³å®¢æˆ·ç«¯çœŸå®IP</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">stemps</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>

        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">23</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">23</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * è·å–ç”¨æˆ·çš„çœŸå®ip
     *
     * @param request
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getUserIP</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// ä¼˜å…ˆå–X-Real-IP</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"X-Real-IP"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"x-forwarded-for"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"0:0:0:0:0:0:0:1"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="no">ERROR_IP</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="no">ERROR_IP</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">','</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">pos</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getLastIpSegment</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getUserIP</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="sc">'.'</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValidIP</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getUserIP</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">isValidIP</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * åˆ¤æ–­æˆ‘ä»¬è·å–çš„ipæ˜¯å¦æ˜¯ä¸€ä¸ªç¬¦åˆè§„åˆ™ip
     *
     * @param ip
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValidIP</span><span class="o">(</span><span class="nc">String</span> <span class="n">ip</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"ip is null. valid result is false"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">Matcher</span> <span class="n">matcher</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">isValid</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="na">matches</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"valid ip:"</span> <span class="o">+</span> <span class="n">ip</span> <span class="o">+</span> <span class="s">" result is: "</span> <span class="o">+</span> <span class="n">isValid</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">isValid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getLastServerIpSegment</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getServerIP</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="sc">'.'</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getServerIP</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">InetAddress</span> <span class="n">inet</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">inet</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">hostAddress</span> <span class="o">=</span> <span class="n">inet</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hostAddress</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"127.0.0.1"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="æ•°æ®æ ¡éªŒ">æ•°æ®æ ¡éªŒ</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Preconditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Maps</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.exception.ParamException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.collections.MapUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.ConstraintViolation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Validation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Validator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.ValidatorFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="cm">/**
 * æ•°æ®æ ¡éªŒï¼ˆå®ä½“ç±»ï¼ŒåŸºäºæ³¨è§£ï¼‰
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanValidator</span> <span class="o">{</span>
	<span class="c1">//å…¨å±€æ ¡éªŒå·¥å‚</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ValidatorFactory</span> <span class="n">validatorFactory</span> <span class="o">=</span> <span class="nc">Validation</span><span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">();</span>
    <span class="c1">//æ ¡éªŒæ–¹æ³•ï¼Œå•ä¸ªç±»</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">validate</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">,</span> <span class="nc">Class</span><span class="o">...</span> <span class="n">groups</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">validatorFactory</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
        <span class="c1">//è·å–æ ¡éªŒç»“æœ</span>
        <span class="nc">Set</span> <span class="n">validateResult</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">groups</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">validateResult</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">();</span><span class="c1">//æ²¡æœ‰é”™è¯¯ä¿¡æ¯è¿”å›ç©ºmap</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">LinkedHashMap</span> <span class="n">errors</span> <span class="o">=</span> <span class="nc">Maps</span><span class="o">.</span><span class="na">newLinkedHashMap</span><span class="o">();</span>
            <span class="nc">Iterator</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">validateResult</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
                <span class="nc">ConstraintViolation</span> <span class="n">violation</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ConstraintViolation</span><span class="o">)</span><span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="c1">//å°è£…æœ‰é—®é¢˜çš„å­—æ®µå’Œé”™è¯¯ä¿¡æ¯</span>
                <span class="n">errors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">violation</span><span class="o">.</span><span class="na">getPropertyPath</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">violation</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">errors</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//æ ¡éªŒé›†åˆ</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">validateList</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">collection</span><span class="o">)</span> <span class="o">{</span>
    	<span class="c1">//åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º</span>
        <span class="nc">Preconditions</span><span class="o">.</span><span class="na">checkNotNull</span><span class="o">(</span><span class="n">collection</span><span class="o">);</span>
        <span class="c1">//è¿­ä»£å™¨</span>
        <span class="nc">Iterator</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="nc">Map</span> <span class="n">errors</span><span class="o">;</span>

        <span class="k">do</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">();</span><span class="c1">//æ²¡æœ‰å€¼ï¼Œè¿”å›ç©ºé›†åˆ</span>
            <span class="o">}</span>
            <span class="nc">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span><span class="c1">//å¦åˆ™è·å–å½“å‰æ•°æ®</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">validate</span><span class="o">(</span><span class="n">object</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span><span class="c1">//è°ƒç”¨æ ¡éªŒå•ä¸ªæ–¹æ³•</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">errors</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="c1">//æ ¡éªŒä»»ä½•å¯¹è±¡</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">validateObject</span><span class="o">(</span><span class="nc">Object</span> <span class="n">first</span><span class="o">,</span> <span class="nc">Object</span><span class="o">...</span> <span class="n">objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">objects</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">objects</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">validateList</span><span class="o">(</span><span class="nc">Lists</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">objects</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">validate</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * åªåˆ¤æ–­æ˜¯å¦æœ‰å¼‚å¸¸
     * @param param
     * @throws ParamExceptionï¼ŒæŠ›å‡ºè‡ªå®šä¹‰çš„å‚æ•°å¼‚å¸¸com.mmall.exception.ParamException
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">check</span><span class="o">(</span><span class="nc">Object</span> <span class="n">param</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ParamException</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="nc">BeanValidator</span><span class="o">.</span><span class="na">validateObject</span><span class="o">(</span><span class="n">param</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">MapUtils</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">map</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ParamException</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="åˆ†é¡µæŸ¥è¯¢">åˆ†é¡µæŸ¥è¯¢</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.beans</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Min</span><span class="o">;</span>
<span class="cm">/**
 * åˆ†é¡µæŸ¥è¯¢å°è£…ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageQuery</span> <span class="o">{</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Setter</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"å½“å‰é¡µç ä¸åˆæ³•"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">pageNo</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>

    <span class="nd">@Getter</span>
    <span class="nd">@Setter</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"æ¯é¡µå±•ç¤ºæ•°é‡ä¸åˆæ³•"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">pageSize</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>

    <span class="nd">@Setter</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">offset</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOffset</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="n">pageNo</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">*</span> <span class="n">pageSize</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.beans</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="cm">/**
 * åˆ†é¡µç»“æœ
 * @author Administrator
 *
 * @param &lt;T&gt;
 */</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="nd">@Builder</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PageResult</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="nc">Lists</span><span class="o">.</span><span class="na">newArrayList</span><span class="o">();</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="springä¸Šä¸‹æ–‡">springä¸Šä¸‹æ–‡</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.BeansException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContextAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
<span class="cm">/**
 * è·å–springä¸Šä¸‹æ–‡å·¥å…·ç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"applicationContextHelper"</span><span class="o">)</span><span class="c1">//è¢«springç®¡ç†</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContextHelper</span> <span class="kd">implements</span> <span class="nc">ApplicationContextAware</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApplicationContext</span><span class="o">(</span><span class="nc">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="n">applicationContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="cm">/**
     * ä»applicationContextä¸­å–springä¸Šä¸‹æ–‡çš„bean
     * @param clazz
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">popBean</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">applicationContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">popBean</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">applicationContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="ç›‘å¬å·¥å…·">ç›‘å¬å·¥å…·</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.util.JsonMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.handler.HandlerInterceptorAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="cm">/**
 * Httpè¯·æ±‚å‰åç›‘å¬å·¥å…·
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpInterceptor</span> <span class="kd">extends</span> <span class="nc">HandlerInterceptorAdapter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">START_TIME</span> <span class="o">=</span> <span class="s">"requestStartTime"</span><span class="o">;</span>
    <span class="cm">/**
     * è¯·æ±‚å¤„ç†ä¹‹å‰è°ƒç”¨æ‰§è¡Œ
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">//è·å–å½“å‰è¯·æ±‚è·¯å¾„</span>
    	<span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="c1">//è·å–è¯·æ±‚å‚æ•°</span>
    	<span class="nc">Map</span> <span class="n">parameterMap</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"request start. url:{}, params:{}"</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">parameterMap</span><span class="o">));</span>
        <span class="c1">//è®°å½•è¯·æ±‚ç›¸åº”æ—¶é—´ï¼Œå¼€å§‹</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">START_TIME</span><span class="o">,</span> <span class="n">start</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="cm">/**
     * è¯·æ±‚å¤„ç†å®Œä¹‹åæ‰§è¡Œï¼Œåªæ‰§è¡Œæ­£å¸¸è¯·æ±‚
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
<span class="c1">//        String url = request.getRequestURI().toString();</span>
<span class="c1">//        long start = (Long) request.getAttribute(START_TIME);</span>
<span class="c1">//        long end = System.currentTimeMillis();</span>
<span class="c1">//        log.info("request finished. url:{}, cost:{}", url, end - start);</span>
        <span class="n">removeThreadLocalInfo</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * è¯·æ±‚å¤„ç†å®Œä¹‹åæ‰§è¡Œï¼Œä»»ä½•è¯·æ±‚ï¼ŒåŒ…æ‹¬å‡ºç°å¼‚å¸¸åä¹Ÿæ‰§è¡Œ
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="no">START_TIME</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"request completed. url:{}, cost:{}æ¯«ç§’"</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">);</span>

        <span class="n">removeThreadLocalInfo</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * ç§»é™¤å½“å‰çº¿ç¨‹çš„ä¿¡æ¯
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeThreadLocalInfo</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">remove</span><span class="o">();;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="è¯·æ±‚holder">è¯·æ±‚holder</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="cm">/**
 * è¯·æ±‚holderï¼Œè§£å†³é«˜å¹¶å‘ï¼Œç™»å½•æˆåŠŸåæŠŠå¯¹è±¡å­˜å…¥ï¼Œå¯åœ¨ä»»æ„åœ°æ–¹å–å‡ºä½¿ç”¨
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestHolder</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">SysUser</span><span class="o">&gt;</span> <span class="n">userHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">SysUser</span><span class="o">&gt;();</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;</span> <span class="n">requestHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">SysUser</span> <span class="n">sysUser</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userHolder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">sysUser</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">requestHolder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SysUser</span> <span class="nf">getCurrentUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userHolder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">HttpServletRequest</span> <span class="nf">getCurrentRequest</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">requestHolder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">userHolder</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
        <span class="n">requestHolder</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="å¼‚å¸¸å¤„ç†">å¼‚å¸¸å¤„ç†</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.exception.ParamException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.exception.PermissionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerExceptionResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="cm">/**
 * å…¨å±€å¼‚å¸¸å¤„ç†ç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringExceptionResolver</span> <span class="kd">implements</span> <span class="nc">HandlerExceptionResolver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ModelAndView</span> <span class="nf">resolveException</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="nc">ModelAndView</span> <span class="n">mv</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">defaultMsg</span> <span class="o">=</span> <span class="s">"System error"</span><span class="o">;</span>

        <span class="c1">// è¿™é‡Œæˆ‘ä»¬è¦æ±‚é¡¹ç›®ä¸­æ‰€æœ‰è¯·æ±‚jsonæ•°æ®ï¼Œéƒ½ä½¿ç”¨.jsonç»“å°¾,æ¥æ”¶å‰å°æ•°æ®å…ˆæ ¡éªŒæ˜¯å¦ç¬¦åˆå®ä½“ç±»è¦æ±‚</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="nc">PermissionException</span> <span class="o">||</span> <span class="n">ex</span> <span class="k">instanceof</span> <span class="nc">ParamException</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"jsonView"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"unknown json exception, url:"</span> <span class="o">+</span> <span class="n">url</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">defaultMsg</span><span class="o">);</span>
                <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"jsonView"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".page"</span><span class="o">)){</span> <span class="c1">// è¿™é‡Œæˆ‘ä»¬è¦æ±‚é¡¹ç›®ä¸­æ‰€æœ‰è¯·æ±‚pageé¡µé¢ï¼Œéƒ½ä½¿ç”¨.pageç»“å°¾</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"unknown page exception, url:"</span> <span class="o">+</span> <span class="n">url</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
            <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">defaultMsg</span><span class="o">);</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"exception"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"unknow exception, url:"</span> <span class="o">+</span> <span class="n">url</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
            <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">defaultMsg</span><span class="o">);</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"jsonView"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="å‚æ•°å¼‚å¸¸ç±»">å‚æ•°å¼‚å¸¸ç±»</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.exception</span><span class="o">;</span>
<span class="cm">/**
 * å‚æ•°å¼‚å¸¸ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParamException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">writableStackTrace</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">,</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="n">writableStackTrace</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="è‡ªå®šä¹‰å¼‚å¸¸">è‡ªå®šä¹‰å¼‚å¸¸</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.exception</span><span class="o">;</span>
<span class="cm">/**
 * è‡ªå®šä¹‰å¼‚å¸¸ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PermissionException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">writableStackTrace</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">,</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="n">writableStackTrace</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="ç™»å½•è¿‡æ»¤å™¨">ç™»å½•è¿‡æ»¤å™¨</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.common.RequestHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="cm">/**
 * ç™»å½•è¿‡æ»¤å™¨
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
        <span class="nc">HttpServletResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">servletResponse</span><span class="o">;</span>

        <span class="nc">SysUser</span> <span class="n">sysUser</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SysUser</span><span class="o">)</span><span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sysUser</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"/signin.jsp"</span><span class="o">;</span>
            <span class="n">resp</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//å¦‚æœç™»é™†æˆåŠŸæŠŠç”¨æˆ·ä¿¡æ¯æ”¾åˆ°RequestHolderä¸­ï¼Œä½¿ç”¨çš„æ—¶å€™å†å–å‡ºæ¥</span>
        <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">sysUser</span><span class="o">);</span>
        <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="æƒé™æ‹¦æˆª">æƒé™æ‹¦æˆª</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Splitter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Sets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.common.ApplicationContextHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.common.JsonData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.common.RequestHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.service.SysCoreService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.util.JsonMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="cm">/**
 * æƒé™æ‹¦æˆª
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AclControlFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">exclusionUrlSet</span> <span class="o">=</span> <span class="nc">Sets</span><span class="o">.</span><span class="na">newConcurrentHashSet</span><span class="o">();</span>
    <span class="c1">//æ— æƒé™è®¿é—®é¡µé¢URL</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">noAuthUrl</span> <span class="o">=</span> <span class="s">"/sys/user/noAuth.page"</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
    	<span class="c1">//å®šä¹‰ç™½åå•</span>
        <span class="nc">String</span> <span class="n">exclusionUrls</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"exclusionUrls"</span><span class="o">);</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">exclusionUrlList</span> <span class="o">=</span> <span class="nc">Splitter</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">","</span><span class="o">).</span><span class="na">trimResults</span><span class="o">().</span><span class="na">omitEmptyStrings</span><span class="o">().</span><span class="na">splitToList</span><span class="o">(</span><span class="n">exclusionUrls</span><span class="o">);</span>
        <span class="n">exclusionUrlSet</span> <span class="o">=</span> <span class="nc">Sets</span><span class="o">.</span><span class="na">newConcurrentHashSet</span><span class="o">(</span><span class="n">exclusionUrlList</span><span class="o">);</span>
        <span class="n">exclusionUrlSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">noAuthUrl</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
        <span class="nc">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">servletResponse</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">servletPath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
        <span class="nc">Map</span> <span class="n">requestMap</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
        <span class="c1">//è¯·æ±‚åœ¨ç™½åå•å†…åˆ™ä¸æ‹¦æˆª</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exclusionUrlSet</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">servletPath</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//å–å‡ºå½“å‰ç™»å½•ç”¨æˆ·</span>
        <span class="nc">SysUser</span> <span class="n">sysUser</span> <span class="o">=</span> <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">();</span>
        <span class="c1">//å¦‚æœæ²¡æœ‰ç™»å½•å°±è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ— æƒé™æ–¹æ³•</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sysUser</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"someone visit {}, but no login, parameter:{}"</span><span class="o">,</span> <span class="n">servletPath</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">requestMap</span><span class="o">));</span>
            <span class="n">noAuth</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="nc">SysCoreService</span> <span class="n">sysCoreService</span> <span class="o">=</span> <span class="nc">ApplicationContextHelper</span><span class="o">.</span><span class="na">popBean</span><span class="o">(</span><span class="nc">SysCoreService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">//æ˜¯å¦æœ‰æƒé™è®¿é—®URL</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">sysCoreService</span><span class="o">.</span><span class="na">hasUrlAcl</span><span class="o">(</span><span class="n">servletPath</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"{} visit {}, but no login, parameter:{}"</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">sysUser</span><span class="o">),</span> <span class="n">servletPath</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">requestMap</span><span class="o">));</span>
            <span class="n">noAuth</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="cm">/**
     * æ— æƒé™è®¿é—®æ–¹æ³•
     * @param request
     * @param response
     * @throws IOException
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">noAuth</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">servletPath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">servletPath</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"æ²¡æœ‰è®¿é—®æƒé™ï¼Œå¦‚éœ€è¦è®¿é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">jsonData</span><span class="o">));</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">clientRedirect</span><span class="o">(</span><span class="n">noAuthUrl</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * æ— æƒé™ï¼Œè·³è½¬æ— æƒé™é¡µé¢
     * @param url
     * @param response
     * @throws IOException
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">clientRedirect</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/html"</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="s">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n"</span>
                <span class="o">+</span> <span class="s">"&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;head&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"/&gt;\n"</span>
                <span class="o">+</span> <span class="s">"&lt;title&gt;è·³è½¬ä¸­...&lt;/title&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;/head&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;body&gt;\n"</span> <span class="o">+</span> <span class="s">"è·³è½¬ä¸­ï¼Œè¯·ç¨å€™...\n"</span> <span class="o">+</span> <span class="s">"&lt;script type=\"text/javascript\"&gt;//&lt;![CDATA[\n"</span>
                <span class="o">+</span> <span class="s">"window.location.href='"</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s">"?ret='+encodeURIComponent(window.location.href);\n"</span> <span class="o">+</span> <span class="s">"//]]&gt;&lt;/script&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;/body&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;/html&gt;\n"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h3 id="æ¥æ”¶å‚æ•°">æ¥æ”¶å‚æ•°</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.param</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.Length</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.NotBlank</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Max</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.Min</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="cm">/**
 * ç”¨æˆ·å‚æ•°
 * @author Administrator
 *
 */</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserParam</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"ç”¨æˆ·åä¸å¯ä»¥ä¸ºç©º"</span><span class="o">)</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">20</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"ç”¨æˆ·åé•¿åº¦éœ€è¦åœ¨20ä¸ªå­—ä»¥å†…"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"ç”µè¯ä¸å¯ä»¥ä¸ºç©º"</span><span class="o">)</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">1</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">13</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"ç”µè¯é•¿åº¦éœ€è¦åœ¨13ä¸ªå­—ä»¥å†…"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">telephone</span><span class="o">;</span>

    <span class="nd">@NotBlank</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"é‚®ç®±ä¸å…è®¸ä¸ºç©º"</span><span class="o">)</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">50</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"é‚®ç®±é•¿åº¦éœ€è¦åœ¨50ä¸ªå­—ç¬¦ä»¥å†…"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">mail</span><span class="o">;</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"å¿…é¡»æä¾›ç”¨æˆ·æ‰€åœ¨çš„éƒ¨é—¨"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">deptId</span><span class="o">;</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"å¿…é¡»æŒ‡å®šç”¨æˆ·çš„çŠ¶æ€"</span><span class="o">)</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"ç”¨æˆ·çŠ¶æ€ä¸åˆæ³•"</span><span class="o">)</span>
    <span class="nd">@Max</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">2</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"ç”¨æˆ·çŠ¶æ€ä¸åˆæ³•"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">status</span><span class="o">;</span>

    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">200</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"å¤‡æ³¨é•¿åº¦éœ€è¦åœ¨200ä¸ªå­—ä»¥å†…"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">remark</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

:ET