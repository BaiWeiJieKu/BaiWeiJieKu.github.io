I"%»<ul id="markdown-toc">
  <li><a href="#è¿‡æ»¤å™¨" id="markdown-toc-è¿‡æ»¤å™¨">è¿‡æ»¤å™¨</a>    <ul>
      <li><a href="#ç¼–å†™" id="markdown-toc-ç¼–å†™">ç¼–å†™</a></li>
      <li><a href="#ä¸­æ–‡å¤„ç†" id="markdown-toc-ä¸­æ–‡å¤„ç†">ä¸­æ–‡å¤„ç†</a></li>
      <li><a href="#ç™»å½•éªŒè¯" id="markdown-toc-ç™»å½•éªŒè¯">ç™»å½•éªŒè¯</a></li>
    </ul>
  </li>
  <li><a href="#ç›‘å¬å™¨" id="markdown-toc-ç›‘å¬å™¨">ç›‘å¬å™¨</a>    <ul>
      <li><a href="#context" id="markdown-toc-context">context</a></li>
      <li><a href="#session" id="markdown-toc-session">session</a></li>
      <li><a href="#request" id="markdown-toc-request">request</a></li>
      <li><a href="#åœ¨çº¿äººæ•°" id="markdown-toc-åœ¨çº¿äººæ•°">åœ¨çº¿äººæ•°</a></li>
    </ul>
  </li>
</ul>
<h2 id="è¿‡æ»¤å™¨">è¿‡æ»¤å™¨</h2>

<ul>
  <li>è¿‡æ»¤å™¨Filterå°±åƒä¸€ä¸ªä¸€ä¸ªå“¨å¡ï¼Œç”¨æˆ·çš„è¯·æ±‚éœ€è¦ç»è¿‡Filterï¼Œå¹¶ä¸”å¯ä»¥æœ‰å¤šä¸ªè¿‡æ»¤å™¨</li>
</ul>

<p><img src="http://stepimagewm.how2j.cn/1719.png" alt="" /></p>

<h3 id="ç¼–å†™">ç¼–å†™</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FirstFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">res</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="c1">//ç±»å‹å¼ºè½¬</span>
		<span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">req</span><span class="o">;</span>
		<span class="nc">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">res</span><span class="o">;</span>
		<span class="c1">//è·å–æ¥è·¯ç”¨æˆ·çš„ipåœ°å€</span>
		<span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
        <span class="c1">//è·å–ç”¨æˆ·è®¿é—®çš„é¡µé¢åœ°å€</span>
		<span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
		<span class="nc">SimpleDateFormat</span> <span class="n">sdf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
		<span class="nc">Date</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">String</span> <span class="n">date</span> <span class="o">=</span> <span class="n">sdf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">d</span><span class="o">);</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">"%s %s è®¿é—®äº† %s%n"</span><span class="o">,</span> <span class="n">date</span><span class="o">,</span> <span class="n">ip</span><span class="o">,</span> <span class="n">url</span><span class="o">);</span>
        <span class="c1">//è¿‡æ»¤å™¨æ”¾è¡Œï¼Œè¡¨ç¤ºç»§ç»­è¿è¡Œä¸‹ä¸€ä¸ªè¿‡æ»¤å™¨ï¼Œæˆ–è€…æœ€ç»ˆè®¿é—®çš„æŸä¸ªservlet,jsp,htmlç­‰ç­‰</span>
		<span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">arg0</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
		<span class="c1">//ä¸Servletéœ€è¦é…ç½®è‡ªå¯åŠ¨æ‰ä¼šéšç€tomcatçš„å¯åŠ¨è€Œæ‰§è¡Œinit()æ–¹æ³•ä¸ä¸€æ ·ã€‚</span>
        <span class="c1">//Filterä¸€å®šä¼šéšç€tomcatçš„å¯åŠ¨è‡ªå¯åŠ¨ã€‚</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"First Filter init()"</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<p>web.xml</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>FirstFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>filter.FirstFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>

	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>FirstFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>

</code></pre></div></div>

<ul>
  <li>Filteræ˜¯webåº”ç”¨éå¸¸é‡è¦çš„ä¸€ä¸ªç¯èŠ‚ï¼Œå¦‚æœFilterå¯åŠ¨å¤±è´¥ï¼Œæˆ–è€…æœ¬èº«æœ‰ç¼–è¯‘é”™è¯¯ï¼Œ<strong>ä¸ä»…è¿™ä¸ªFilterä¸èƒ½ä½¿ç”¨</strong>ï¼Œ<strong>æ•´ä¸ªwebåº”ç”¨ä¼šå¯åŠ¨å¤±è´¥</strong>ï¼Œå¯¼è‡´ç”¨æˆ·æ— æ³•è®¿é—®é¡µé¢</li>
  <li>åœ¨å¯åŠ¨tomcatè¿‡ç¨‹ä¸­ï¼Œä¹Ÿä¼šçœ‹åˆ°è¿™æ ·çš„å­—æ ·ï¼š <code class="language-plaintext highlighter-rouge">ä¸¥é‡: Context [] startup failed due to previous errors</code>è¿™å¸¸å¸¸ç”¨äºæç¤ºFilterå¯åŠ¨å¤±è´¥äº†</li>
</ul>

<h3 id="ä¸­æ–‡å¤„ç†">ä¸­æ–‡å¤„ç†</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EncodingFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">res</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
		<span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">req</span><span class="o">;</span>
		<span class="nc">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">res</span><span class="o">;</span>

		<span class="n">request</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>

		<span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">arg0</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>EncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>filter.EncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>

	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>EncodingFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>

</code></pre></div></div>

<h3 id="ç™»å½•éªŒè¯">ç™»å½•éªŒè¯</h3>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.text.SimpleDateFormat</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AuthFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">req</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">res</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">chain</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
		<span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">req</span><span class="o">;</span>
		<span class="nc">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">res</span><span class="o">;</span>

		<span class="nc">String</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">();</span>
		<span class="k">if</span> <span class="o">(</span><span class="n">uri</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"login.html"</span><span class="o">)</span> <span class="o">||</span> <span class="n">uri</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">"login"</span><span class="o">)</span> <span class="o">||</span> <span class="n">uri</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".css"</span><span class="o">)</span> 			<span class="o">||</span> <span class="n">uri</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".js"</span><span class="o">)</span> <span class="o">||</span> <span class="n">uri</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".jpg"</span><span class="o">))</span> <span class="o">{</span>
			<span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
			<span class="k">return</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="nc">String</span> <span class="n">userName</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"userName"</span><span class="o">);</span>
		<span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>
			<span class="n">response</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="s">"login.html"</span><span class="o">);</span>
			<span class="k">return</span><span class="o">;</span>
		<span class="o">}</span>

		<span class="n">chain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">arg0</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;filter&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>AuthFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;filter-class&gt;</span>filter.AuthFilter<span class="nt">&lt;/filter-class&gt;</span>
	<span class="nt">&lt;/filter&gt;</span>

	<span class="nt">&lt;filter-mapping&gt;</span>
		<span class="nt">&lt;filter-name&gt;</span>AuthFilter<span class="nt">&lt;/filter-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/filter-mapping&gt;</span>
		

</code></pre></div></div>

<h2 id="ç›‘å¬å™¨">ç›‘å¬å™¨</h2>

<ul>
  <li>Listener çš„ä½œç”¨æ˜¯ç”¨äºç›‘å¬ webåº”ç”¨çš„åˆ›å»ºå’Œé”€æ¯ï¼Œä»¥åŠåœ¨å…¶ä¸Šattributeå‘ç”Ÿçš„å˜åŒ–ã€‚</li>
  <li>webåº”ç”¨å³ServletContextå¯¹è±¡(jspçš„éšå¼å¯¹è±¡application)</li>
  <li>é™¤äº†å¯¹webåº”ç”¨çš„ç›‘å¬å¤–ï¼Œè¿˜èƒ½ç›‘å¬sessionå’Œrequestçš„ç”Ÿå‘½å‘¨æœŸï¼Œä»¥åŠä»–ä»¬çš„attributeå‘ç”Ÿçš„å˜åŒ–ã€‚</li>
</ul>

<h3 id="context">context</h3>

<ul>
  <li>å¯¹Contextçš„ç›‘å¬åˆ†ç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬ï¼Œå’ŒContextä¸ŠAttributeå˜åŒ–çš„ç›‘å¬ä¸¤ç§ã€‚</li>
  <li>ç¼–å†™ ContextListener</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletContextEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletContextListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContextListener</span> <span class="kd">implements</span> <span class="nc">ServletContextListener</span> <span class="o">{</span>
	<span class="c1">//å¯¹åº”å½“å‰webåº”ç”¨çš„é”€æ¯</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextDestroyed</span><span class="o">(</span><span class="nc">ServletContextEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"web åº”ç”¨é”€æ¯  "</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="c1">//å¯¹åº”å½“å‰webåº”ç”¨çš„åˆå§‹åŒ–</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">contextInitialized</span><span class="o">(</span><span class="nc">ServletContextEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"web åº”ç”¨åˆå§‹åŒ– "</span><span class="o">);</span>

	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>é…ç½® web.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>listener.ContextListener<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>åœ¨å¯åŠ¨tomcatä»¥åŠå½“å‰webåº”ç”¨é‡è½½çš„æ—¶å€™å¯ä»¥è§‚å¯Ÿåˆ°
webåº”ç”¨çš„è‡ªåŠ¨é‡è½½éœ€è¦å¦‚ä¸‹å‰æï¼š
1. é…ç½®ï¼š server.xmlä¸­å¯¹åº”çš„&lt;contexté…ç½® çš„å±æ€§ @reloadable="true"
2. æŸä¸ªservlet å‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¼è‡´è¿™ä¸ªwebåº”ç”¨è‡ªåŠ¨é‡å¯
</code></pre></div></div>

<p><img src="http://stepimagewm.how2j.cn/1794.png" alt="" /></p>

<ul>
  <li>ç¼–å†™ ContextAttributeListener</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletContextAttributeEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletContextAttributeListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ContextAttributeListener</span> <span class="kd">implements</span> <span class="nc">ServletContextAttributeListener</span> <span class="o">{</span>
	<span class="c1">//ç›‘å¬å±æ€§çš„å¢åŠ </span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å¢åŠ å±æ€§ "</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å±æ€§æ˜¯"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å€¼æ˜¯"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>

	<span class="o">}</span>
	<span class="c1">//ç›‘å¬å±æ€§çš„ç§»é™¤</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ç§»é™¤å±æ€§ "</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="c1">//ç›‘å¬å±æ€§çš„æ›¿æ¢</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">ServletContextAttributeEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ›¿æ¢å±æ€§"</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>listener.ContextAttributeListener<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>

</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>
  </li>
  <li>
    <p>testContext.jsp</p>
  </li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na">
	pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>

<span class="nt">&lt;%</span>
	<span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
	<span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
	<span class="n">application</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
<span class="nt">%&gt;</span>

</code></pre></div></div>

<p><img src="http://stepimagewm.how2j.cn/1798.png" alt="" /></p>

<h3 id="session">session</h3>

<ul>
  <li>å¯¹Sessionçš„ç›‘å¬åˆ†ç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬ï¼Œå’ŒSessionä¸ŠAttributeå˜åŒ–çš„ç›‘å¬ä¸¤ç§ã€‚</li>
  <li>ç¼–å†™ SessionListener</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionListener</span> <span class="kd">implements</span> <span class="nc">HttpSessionListener</span> <span class="o">{</span>
	<span class="c1">//è¡¨ç¤ºsessionåˆ›å»ºçš„æ—¶å€™æ‰§è¡Œ</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionCreated</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ç›‘å¬åˆ° session åˆ›å»º, sessionid æ˜¯ï¼š "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
	<span class="o">}</span>
	<span class="c1">//è¡¨ç¤ºsessioné”€æ¯çš„æ—¶å€™æ‰§è¡Œ</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionDestroyed</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ç›‘å¬åˆ° session é”€æ¯, sessionid æ˜¯ï¼š "</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getId</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>é…ç½®web.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>listener.SessionListener<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•</li>
</ul>

<p><img src="http://stepimagewm.how2j.cn/1801.png" alt="" /></p>

<ul>
  <li>ç¼–å†™ SessionAttributeListener</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionAttributeListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionBindingEvent</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SessionAttributeListener</span> <span class="kd">implements</span> <span class="nc">HttpSessionAttributeListener</span> <span class="o">{</span>
	<span class="c1">//å½“åœ¨sessionä¸­å¢åŠ å±æ€§æ—¶è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"session å¢åŠ å±æ€§ "</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å±æ€§æ˜¯"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å€¼æ˜¯"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>

	<span class="o">}</span>
	<span class="c1">//å½“åœ¨sessionä¸­ç§»é™¤å±æ€§æ—¶è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"session ç§»é™¤å±æ€§ "</span><span class="o">);</span>

	<span class="o">}</span>
	<span class="c1">//å½“æ›¿æ¢sessionä¸­çš„å±æ€§æ—¶è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">HttpSessionBindingEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// TODO Auto-generated method stub</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"session æ›¿æ¢å±æ€§ "</span><span class="o">);</span>

	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>listener.SessionAttributeListener<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>	

</code></pre></div></div>

<ul>
  <li>testSession.jsp</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na">
	pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>

<span class="nt">&lt;%</span>
	<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
	<span class="n">session</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
	<span class="n">session</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
<span class="nt">%&gt;</span>

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•</li>
</ul>

<p><img src="http://stepimagewm.how2j.cn/1805.png" alt="" /></p>

<h3 id="request">request</h3>

<ul>
  <li>å¯¹Requestçš„ç›‘å¬åˆ†ç”Ÿå‘½å‘¨æœŸçš„ç›‘å¬ï¼Œå’ŒRequestä¸ŠAttributeå˜åŒ–çš„ç›‘å¬ä¸¤éƒ¨åˆ†ã€‚</li>
  <li>ç¼–å†™ RequestListener</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequestAttributeEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequestAttributeListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequestEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequestListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestListener</span> <span class="kd">implements</span> <span class="nc">ServletRequestListener</span><span class="o">,</span> <span class="nc">ServletRequestAttributeListener</span> <span class="o">{</span>
	<span class="c1">//å½“æœ¬æ¬¡è¯·æ±‚ç»“æŸçš„æ—¶å€™è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestDestroyed</span><span class="o">(</span><span class="nc">ServletRequestEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"é”€æ¯äº†ä¸€ä¸ªRequest "</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="cm">/**
	å½“æ–°åˆ›å»ºäº†ä¸€ä¸ªRequestçš„æ—¶å€™è§¦å‘ï¼Œåªè¦è®¿é—®äº†æœåŠ¡ç«¯çš„èµ„æºï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªRequestï¼Œæ— è®ºæ˜¯jsp,servletè¿˜	 æ˜¯html
	*/</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">requestInitialized</span><span class="o">(</span><span class="nc">ServletRequestEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"åˆ›å»ºäº†ä¸€ä¸ªRequest "</span><span class="o">);</span>
        
	<span class="o">}</span>
	<span class="c1">//å½“æœ‰æ–°å¢å±æ€§æ—¶è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeAdded</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request å¢åŠ å±æ€§ "</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å±æ€§æ˜¯"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"å€¼æ˜¯"</span> <span class="o">+</span> <span class="n">e</span><span class="o">.</span><span class="na">getValue</span><span class="o">());</span>
	<span class="o">}</span>
	<span class="c1">//å½“æœ‰ç§»é™¤å±æ€§æ—¶è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeRemoved</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request ç§»é™¤å±æ€§ "</span><span class="o">);</span>
		
	<span class="o">}</span>
	<span class="c1">//å½“æœ‰æ›¿æ¢å±æ€§æ—¶è§¦å‘</span>
	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">attributeReplaced</span><span class="o">(</span><span class="nc">ServletRequestAttributeEvent</span> <span class="n">arg0</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"request æ›¿æ¢å±æ€§ "</span><span class="o">);</span>
		
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>listener.RequestListener<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>	

</code></pre></div></div>

<ul>
  <li>testRequest.jsp</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na">
	pageEncoding=</span><span class="s">"UTF-8"</span><span class="nt">%&gt;</span>

<span class="nt">&lt;%</span>
	<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
	<span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">,</span> <span class="mi">2</span><span class="o">);</span>
	<span class="n">request</span><span class="o">.</span><span class="na">removeAttribute</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
<span class="nt">%&gt;</span>

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•</li>
</ul>

<p><img src="http://stepimagewm.how2j.cn/1809.png" alt="" /></p>

<h3 id="åœ¨çº¿äººæ•°">åœ¨çº¿äººæ•°</h3>

<ul>
  <li>HTTPåè®®æ˜¯çŸ­é“¾æ¥çš„ï¼Œæ‰€ä»¥æ— æ³•åœ¨æœåŠ¡ç«¯æ ¹æ®å»ºç«‹äº†å¤šå°‘è¿æ¥æ¥ç»Ÿè®¡å½“å‰æœ‰å¤šå°‘äººåœ¨çº¿</li>
  <li>ä¸è¿‡å¯ä»¥é€šè¿‡ç»Ÿè®¡sessionæœ‰å¤šå°‘æ¥ä¼°è®¡åœ¨çº¿äººæ•°</li>
  <li>ä¸€æ—¦ä¸€ä¸ªç”¨æˆ·è®¿é—®æœåŠ¡å™¨ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªsession. å¦‚æœè¯¥ç”¨æˆ·æŒç»­è®¿é—®ï¼Œé‚£ä¹ˆè¯¥sessionä¼šæŒç»­æœ‰æ•ˆã€‚</li>
  <li>å¦‚æœç»å†äº†<a href="http://how2j.cn/k/jsp/jsp-session/583.html#step1676">30åˆ†é’Ÿ</a>ï¼Œè¯¥ç”¨æˆ·ä¹Ÿæ²¡æœ‰åšä»»ä½•æ“ä½œï¼Œå°±è¡¨ç¤ºè¯¥ç”¨æˆ·â€œä¸‹çº¿â€ äº†ï¼Œå…¶å¯¹åº”çš„sessionä¹Ÿä¼šè¢«é”€æ¯ã€‚</li>
  <li>æ‰€ä»¥å¯ä»¥é€šè¿‡ç»Ÿè®¡æœ‰å¤šå°‘sessionè¢«ä¿ç•™æ¥ä¼°è®¡å½“å‰åœ¨çº¿äººæ•°ã€‚</li>
  <li>ç¼–å†™ OnlineNumberListener</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">listener</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.ServletContext</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpSessionListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OnlineNumberListener</span> <span class="kd">implements</span> <span class="nc">HttpSessionListener</span> <span class="o">{</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionCreated</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">ServletContext</span> <span class="n">application</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">();</span>

		<span class="nc">Integer</span> <span class="n">online_number</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">application</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"online_number"</span><span class="o">);</span>

		<span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">==</span> <span class="n">online_number</span><span class="o">)</span>
			<span class="n">online_number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="n">online_number</span><span class="o">++;</span>
		<span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"online_number"</span><span class="o">,</span> <span class="n">online_number</span><span class="o">);</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ–°å¢ä¸€ä½åœ¨çº¿ç”¨æˆ·"</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">sessionDestroyed</span><span class="o">(</span><span class="nc">HttpSessionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

		<span class="nc">ServletContext</span> <span class="n">application</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">();</span>

		<span class="nc">Integer</span> <span class="n">online_number</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Integer</span><span class="o">)</span> <span class="n">application</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"online_number"</span><span class="o">);</span>

		<span class="k">if</span><span class="o">(</span><span class="kc">null</span><span class="o">==</span><span class="n">online_number</span><span class="o">){</span>
			<span class="n">online_number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
		<span class="o">}</span>
		<span class="k">else</span>
			<span class="n">online_number</span><span class="o">--;</span>
		<span class="n">application</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="s">"online_number"</span><span class="o">,</span> <span class="n">online_number</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ä¸€ä½ç”¨æˆ·ç¦»çº¿"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>é…ç½®web.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="nt">&lt;listener&gt;</span>
		<span class="nt">&lt;listener-class&gt;</span>listener.OnlineNumberListener<span class="nt">&lt;/listener-class&gt;</span>
	<span class="nt">&lt;/listener&gt;</span>	

</code></pre></div></div>

<ul>
  <li>checkOnlineNumber.jsp</li>
</ul>

<div class="language-jsp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;%@ page </span><span class="na">language=</span><span class="s">"java"</span><span class="na"> contentType=</span><span class="s">"text/html; charset=UTF-8"</span><span class="na">
    pageEncoding=</span><span class="s">"UTF-8"</span><span class="na"> isELIgnored=</span><span class="s">"false"</span><span class="nt">%&gt;</span>
 
 å½“å‰ åœ¨çº¿äººæ•° ï¼š ${online_number}

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•</li>
</ul>

<p><img src="http://stepimagewm.how2j.cn/1813.png" alt="" /></p>

:ET