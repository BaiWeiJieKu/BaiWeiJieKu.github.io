I"ùu<ul id="markdown-toc">
  <li><a href="#ä¸€çº§ç¼“å­˜" id="markdown-toc-ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</a>    <ul>
      <li><a href="#ç¼“å­˜ç”Ÿæ•ˆ" id="markdown-toc-ç¼“å­˜ç”Ÿæ•ˆ">ç¼“å­˜ç”Ÿæ•ˆ</a></li>
      <li><a href="#ç¼“å­˜å¤±æ•ˆ" id="markdown-toc-ç¼“å­˜å¤±æ•ˆ">ç¼“å­˜å¤±æ•ˆ</a></li>
    </ul>
  </li>
  <li><a href="#äºŒçº§ç¼“å­˜" id="markdown-toc-äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</a></li>
  <li><a href="#ç¼“å­˜è®¾ç½®" id="markdown-toc-ç¼“å­˜è®¾ç½®">ç¼“å­˜è®¾ç½®</a></li>
  <li><a href="#æ•´åˆehcache" id="markdown-toc-æ•´åˆehcache">æ•´åˆehcache</a></li>
  <li><a href="#æµç¨‹å›¾" id="markdown-toc-æµç¨‹å›¾">æµç¨‹å›¾</a></li>
</ul>
<h3 id="ä¸€çº§ç¼“å­˜">ä¸€çº§ç¼“å­˜</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">ä¸€çº§ç¼“å­˜ï¼šï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰ï¼šsqlSessionçº§åˆ«çš„ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜æ˜¯ä¸€ç›´å¼€å¯çš„ï¼›SqlSessionçº§åˆ«çš„ä¸€ä¸ªMap</span>
	 <span class="err">ä¸æ•°æ®åº“åŒä¸€æ¬¡ä¼šè¯æœŸé—´æŸ¥è¯¢åˆ°çš„æ•°æ®ä¼šæ”¾åœ¨æœ¬åœ°ç¼“å­˜ä¸­ã€‚</span>
	 <span class="err">ä»¥åå¦‚æœéœ€è¦è·å–ç›¸åŒçš„æ•°æ®ï¼Œç›´æ¥ä»ç¼“å­˜ä¸­æ‹¿ï¼Œæ²¡å¿…è¦å†å»æŸ¥è¯¢æ•°æ®åº“ï¼›</span>

	 <span class="err">ä¸€çº§ç¼“å­˜å¤±æ•ˆæƒ…å†µï¼ˆæ²¡æœ‰ä½¿ç”¨åˆ°å½“å‰ä¸€çº§ç¼“å­˜çš„æƒ…å†µï¼Œæ•ˆæœå°±æ˜¯ï¼Œè¿˜éœ€è¦å†å‘æ•°æ®åº“å‘å‡ºæŸ¥è¯¢ï¼‰ï¼š</span>
	 <span class="err">1ã€sqlSessionä¸åŒã€‚</span>
	 <span class="err">2ã€sqlSessionç›¸åŒï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸åŒ.(å½“å‰ä¸€çº§ç¼“å­˜ä¸­è¿˜æ²¡æœ‰è¿™ä¸ªæ•°æ®)</span>
	 <span class="err">3ã€sqlSessionç›¸åŒï¼Œä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æ‰§è¡Œäº†å¢åˆ æ”¹æ“ä½œ(è¿™æ¬¡å¢åˆ æ”¹å¯èƒ½å¯¹å½“å‰æ•°æ®æœ‰å½±å“)</span>
	 <span class="err">4ã€sqlSessionç›¸åŒï¼Œæ‰‹åŠ¨æ¸…é™¤äº†ä¸€çº§ç¼“å­˜ï¼ˆç¼“å­˜æ¸…ç©ºï¼‰</span>
</code></pre></div></div>

<h4 id="ç¼“å­˜ç”Ÿæ•ˆ">ç¼“å­˜ç”Ÿæ•ˆ</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFirstLevelCache</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		<span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="n">getSqlSessionFactory</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">openSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp01</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp02</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp02</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">==</span><span class="n">emp02</span><span class="o">);</span><span class="c1">//true,åªå‘é€ä¸€æ¡sql</span>
			
		<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<h4 id="ç¼“å­˜å¤±æ•ˆ">ç¼“å­˜å¤±æ•ˆ</h4>

<ul>
  <li>sqlSessionä¸åŒ</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFirstLevelCache</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		<span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="n">getSqlSessionFactory</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
        <span class="nc">SqlSession</span> <span class="n">openSession2</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">openSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
            <span class="nc">EmployeeMapper</span> <span class="n">mapper2</span> <span class="o">=</span> <span class="n">openSession2</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp01</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp02</span> <span class="o">=</span> <span class="n">mapper2</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp02</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">==</span><span class="n">emp02</span><span class="o">);</span><span class="c1">//false,å‘é€2æ¡sql</span>
			
		<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">openSession2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>sqlSessionç›¸åŒï¼ŒæŸ¥è¯¢æ¡ä»¶ä¸åŒ.(å½“å‰ä¸€çº§ç¼“å­˜ä¸­è¿˜æ²¡æœ‰è¿™ä¸ªæ•°æ®)</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFirstLevelCache</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		<span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="n">getSqlSessionFactory</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">openSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp01</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp02</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp02</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">==</span><span class="n">emp02</span><span class="o">);</span><span class="c1">//false,å‘é€2æ¡ä¸åŒçš„sql</span>
			
		<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>sqlSessionç›¸åŒï¼Œä¸¤æ¬¡æŸ¥è¯¢ä¹‹é—´æ‰§è¡Œäº†å¢åˆ æ”¹æ“ä½œ(è¿™æ¬¡å¢åˆ æ”¹å¯èƒ½å¯¹å½“å‰æ•°æ®æœ‰å½±å“)</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFirstLevelCache</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		<span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="n">getSqlSessionFactory</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">openSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp01</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">);</span>
			
			<span class="n">mapper</span><span class="o">.</span><span class="na">addEmp</span><span class="o">(</span><span class="k">new</span> <span class="nc">Employee</span><span class="o">(</span><span class="kc">null</span><span class="o">,</span> <span class="s">"testCache"</span><span class="o">,</span> <span class="s">"cache"</span><span class="o">,</span> <span class="s">"1"</span><span class="o">));</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ•°æ®æ·»åŠ æˆåŠŸ"</span><span class="o">);</span>
			
			<span class="nc">Employee</span> <span class="n">emp02</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp02</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">==</span><span class="n">emp02</span><span class="o">);</span><span class="c1">//false,å‘é€2æ¡sql</span>
			
		<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>sqlSessionç›¸åŒï¼Œæ‰‹åŠ¨æ¸…é™¤äº†ä¸€çº§ç¼“å­˜ï¼ˆç¼“å­˜æ¸…ç©ºï¼‰</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testFirstLevelCache</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		<span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="n">getSqlSessionFactory</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">openSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="nc">Employee</span> <span class="n">emp01</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">);</span>
            
			<span class="c1">//ç¼“å­˜æ¸…ç©º</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">clearCache</span><span class="o">();</span>
			
			<span class="nc">Employee</span> <span class="n">emp02</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp02</span><span class="o">);</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">==</span><span class="n">emp02</span><span class="o">);</span><span class="c1">//false,å‘é€2æ¡sql</span>
			
		<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<h3 id="äºŒçº§ç¼“å­˜">äºŒçº§ç¼“å­˜</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">äºŒçº§ç¼“å­˜ï¼šï¼ˆå…¨å±€ç¼“å­˜ï¼‰ï¼šåŸºäºnamespaceçº§åˆ«çš„ç¼“å­˜ï¼šä¸€ä¸ªnamespaceå¯¹åº”ä¸€ä¸ªäºŒçº§ç¼“å­˜ï¼š</span>
	 <span class="err">å·¥ä½œæœºåˆ¶ï¼š</span>
	 <span class="err">1ã€ä¸€ä¸ªä¼šè¯ï¼ŒæŸ¥è¯¢ä¸€æ¡æ•°æ®ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šè¢«æ”¾åœ¨å½“å‰ä¼šè¯çš„ä¸€çº§ç¼“å­˜ä¸­ï¼›</span>
	 <span class="err">2ã€å¦‚æœä¼šè¯å…³é—­ï¼›ä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®ä¼šè¢«ä¿å­˜åˆ°äºŒçº§ç¼“å­˜ä¸­ï¼›æ–°çš„ä¼šè¯æŸ¥è¯¢ä¿¡æ¯ï¼Œå°±å¯ä»¥å‚ç…§äºŒçº§ç¼“å­˜ä¸­çš„å†…å®¹ï¼›</span>
	 <span class="err">3ã€</span><span class="py">sqlSession</span><span class="p">=</span><span class="s">==EmployeeMapper==&gt;Employee</span>
	  				<span class="py">DepartmentMapper</span><span class="p">=</span><span class="s">==&gt;Department</span>
	 		<span class="err">ä¸åŒnamespaceæŸ¥å‡ºçš„æ•°æ®ä¼šæ”¾åœ¨è‡ªå·±å¯¹åº”çš„ç¼“å­˜ä¸­ï¼ˆmapï¼‰</span>
	  		<span class="err">æ•ˆæœï¼šæ•°æ®ä¼šä»äºŒçº§ç¼“å­˜ä¸­è·å–</span>
	  			<span class="err">æŸ¥å‡ºçš„æ•°æ®éƒ½ä¼šè¢«é»˜è®¤å…ˆæ”¾åœ¨ä¸€çº§ç¼“å­˜ä¸­ã€‚</span>
	  			<span class="err">åªæœ‰ä¼šè¯æäº¤æˆ–è€…å…³é—­ä»¥åï¼Œä¸€çº§ç¼“å­˜ä¸­çš„æ•°æ®æ‰ä¼šè½¬ç§»åˆ°äºŒçº§ç¼“å­˜ä¸­</span>
	 <span class="err">ä½¿ç”¨ï¼š</span>
	  		<span class="err">1ï¼‰ã€å¼€å¯å…¨å±€äºŒçº§ç¼“å­˜é…ç½®ï¼š&lt;setting</span> <span class="py">name</span><span class="p">=</span><span class="s">"cacheEnabled"</span> <span class="s">value="true"/&gt;</span>
	  		<span class="err">2ï¼‰ã€å»mapper.xmlä¸­é…ç½®ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼š</span>
	  				<span class="err">&lt;cache&gt;&lt;/cache&gt;</span>
	  		<span class="err">3ï¼‰ã€æˆ‘ä»¬çš„POJOéœ€è¦å®ç°åºåˆ—åŒ–æ¥å£</span>
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cache</span> <span class="na">eviction=</span><span class="s">"FIFO"</span> <span class="na">flushInterval=</span><span class="s">"60000"</span> <span class="na">readOnly=</span><span class="s">"false"</span> <span class="na">size=</span><span class="s">"1024"</span><span class="nt">&gt;&lt;/cache&gt;</span>
	<span class="c">&lt;!--  
	eviction:ç¼“å­˜çš„å›æ”¶ç­–ç•¥ï¼š
		â€¢ LRU â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„ï¼šç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚
		â€¢ FIFO â€“ å…ˆè¿›å…ˆå‡ºï¼šæŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚
		â€¢ SOFT â€“ è½¯å¼•ç”¨ï¼šç§»é™¤åŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚
		â€¢ WEAK â€“ å¼±å¼•ç”¨ï¼šæ›´ç§¯æåœ°ç§»é™¤åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚
		â€¢ é»˜è®¤çš„æ˜¯ LRUã€‚
	flushIntervalï¼šç¼“å­˜åˆ·æ–°é—´éš”
		ç¼“å­˜å¤šé•¿æ—¶é—´æ¸…ç©ºä¸€æ¬¡ï¼Œé»˜è®¤ä¸æ¸…ç©ºï¼Œè®¾ç½®ä¸€ä¸ªæ¯«ç§’å€¼
	readOnly:æ˜¯å¦åªè¯»ï¼š
		trueï¼šåªè¯»ï¼›mybatisè®¤ä¸ºæ‰€æœ‰ä»ç¼“å­˜ä¸­è·å–æ•°æ®çš„æ“ä½œéƒ½æ˜¯åªè¯»æ“ä½œï¼Œä¸ä¼šä¿®æ”¹æ•°æ®ã€‚
				 mybatisä¸ºäº†åŠ å¿«è·å–é€Ÿåº¦ï¼Œç›´æ¥å°±ä¼šå°†æ•°æ®åœ¨ç¼“å­˜ä¸­çš„å¼•ç”¨äº¤ç»™ç”¨æˆ·ã€‚ä¸å®‰å…¨ï¼Œé€Ÿåº¦å¿«
		falseï¼šéåªè¯»ï¼šmybatisè§‰å¾—è·å–çš„æ•°æ®å¯èƒ½ä¼šè¢«ä¿®æ”¹ã€‚
				mybatisä¼šåˆ©ç”¨åºåˆ—åŒ–&amp;ååºåˆ—çš„æŠ€æœ¯å…‹éš†ä¸€ä»½æ–°çš„æ•°æ®ç»™ä½ ã€‚å®‰å…¨ï¼Œé€Ÿåº¦æ…¢
	sizeï¼šç¼“å­˜å­˜æ”¾å¤šå°‘å…ƒç´ ï¼›
	type=""ï¼šæŒ‡å®šè‡ªå®šä¹‰ç¼“å­˜çš„å…¨ç±»åï¼›
			å®ç°Cacheæ¥å£å³å¯ï¼›
	--&gt;</span>

</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSecondLevelCache</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		<span class="nc">SqlSessionFactory</span> <span class="n">sqlSessionFactory</span> <span class="o">=</span> <span class="n">getSqlSessionFactory</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="nc">SqlSession</span> <span class="n">openSession2</span> <span class="o">=</span> <span class="n">sqlSessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">();</span>
		<span class="k">try</span><span class="o">{</span>
			<span class="c1">//1ã€</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper</span> <span class="o">=</span> <span class="n">openSession</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			<span class="nc">EmployeeMapper</span> <span class="n">mapper2</span> <span class="o">=</span> <span class="n">openSession2</span><span class="o">.</span><span class="na">getMapper</span><span class="o">(</span><span class="nc">EmployeeMapper</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
			
			<span class="nc">Employee</span> <span class="n">emp01</span> <span class="o">=</span> <span class="n">mapper</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp01</span><span class="o">);</span>
			<span class="n">openSession</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
			
			<span class="c1">//ç¬¬äºŒæ¬¡æŸ¥è¯¢æ˜¯ä»äºŒçº§ç¼“å­˜ä¸­æ‹¿åˆ°çš„æ•°æ®ï¼Œå¹¶æ²¡æœ‰å‘é€æ–°çš„sql</span>
			<span class="nc">Employee</span> <span class="n">emp02</span> <span class="o">=</span> <span class="n">mapper2</span><span class="o">.</span><span class="na">getEmpById</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">emp02</span><span class="o">);</span>
			<span class="n">openSession2</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
			
		<span class="o">}</span><span class="k">finally</span><span class="o">{</span>
			
		<span class="o">}</span>
	<span class="o">}</span>
</code></pre></div></div>

<h3 id="ç¼“å­˜è®¾ç½®">ç¼“å­˜è®¾ç½®</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">å’Œç¼“å­˜æœ‰å…³çš„è®¾ç½®/å±æ€§ï¼š</span>
	<span class="err">1ï¼‰ã€</span><span class="py">cacheEnabled</span><span class="p">=</span><span class="s">trueï¼šfalseï¼šå…³é—­ç¼“å­˜ï¼ˆäºŒçº§ç¼“å­˜å…³é—­ï¼‰(ä¸€çº§ç¼“å­˜ä¸€ç›´å¯ç”¨çš„)</span>
	<span class="err">2ï¼‰ã€æ¯ä¸ªselectæ ‡ç­¾éƒ½æœ‰</span><span class="py">useCache</span><span class="p">=</span><span class="s">"true"ï¼š</span>
	  		<span class="err">falseï¼šä¸ä½¿ç”¨ç¼“å­˜ï¼ˆä¸€çº§ç¼“å­˜ä¾ç„¶ä½¿ç”¨ï¼ŒäºŒçº§ç¼“å­˜ä¸ä½¿ç”¨ï¼‰</span>
	<span class="err">3ï¼‰ã€ã€æ¯ä¸ªå¢åˆ æ”¹æ ‡ç­¾çš„ï¼š</span><span class="py">flushCache</span><span class="p">=</span><span class="s">"true"ï¼šï¼ˆä¸€çº§äºŒçº§éƒ½ä¼šæ¸…é™¤ï¼‰ã€‘</span>
	  		<span class="err">å¢åˆ æ”¹æ‰§è¡Œå®Œæˆåå°±ä¼šæ¸…æ¥šç¼“å­˜ï¼›</span>
	  		<span class="err">æµ‹è¯•ï¼š</span><span class="py">flushCache</span><span class="p">=</span><span class="s">"true"ï¼šä¸€çº§ç¼“å­˜å°±æ¸…ç©ºäº†ï¼›äºŒçº§ä¹Ÿä¼šè¢«æ¸…é™¤ï¼›</span>
	  		<span class="err">æŸ¥è¯¢æ ‡ç­¾ï¼š</span><span class="py">flushCache</span><span class="p">=</span><span class="s">"false"ï¼š</span>
	 				<span class="err">å¦‚æœ</span><span class="py">flushCache</span><span class="p">=</span><span class="s">true;æ¯æ¬¡æŸ¥è¯¢ä¹‹åéƒ½ä¼šæ¸…ç©ºç¼“å­˜ï¼›ç¼“å­˜æ˜¯æ²¡æœ‰è¢«ä½¿ç”¨çš„ï¼›</span>
	<span class="err">4ï¼‰ã€sqlSession.clearCache();åªæ˜¯æ¸…æ¥šå½“å‰sessionçš„ä¸€çº§ç¼“å­˜ï¼›</span>
	<span class="err">5ï¼‰ã€localCacheScopeï¼šæœ¬åœ°ç¼“å­˜ä½œç”¨åŸŸï¼šï¼ˆä¸€çº§ç¼“å­˜SESSIONï¼‰ï¼›å½“å‰ä¼šè¯çš„æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨ä¼šè¯ç¼“å­˜ä¸­ï¼›</span>
	  					<span class="err">STATEMENTï¼šå¯ä»¥ç¦ç”¨ä¸€çº§ç¼“å­˜ï¼›</span>		
</code></pre></div></div>

<h3 id="æ•´åˆehcache">æ•´åˆehcache</h3>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆï¼š</span>
	 <span class="err">1ï¼‰ã€å¯¼å…¥ç¬¬ä¸‰æ–¹ç¼“å­˜åŒ…å³å¯ï¼›</span>
	 <span class="err">2ï¼‰ã€å¯¼å…¥ä¸ç¬¬ä¸‰æ–¹ç¼“å­˜æ•´åˆçš„é€‚é…åŒ…ï¼›å®˜æ–¹æœ‰ï¼›</span>
	 <span class="err">3ï¼‰ã€å†™é…åˆæ–‡ä»¶ï¼šehcache.xml</span>
	 <span class="err">4ï¼‰ã€mapper.xmlä¸­ä½¿ç”¨è‡ªå®šä¹‰ç¼“å­˜</span>
	 <span class="err">&lt;cache</span> <span class="py">type</span><span class="p">=</span><span class="s">"org.mybatis.caches.ehcache.EhcacheCache"&gt;&lt;/cache&gt;</span>
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;cache</span> <span class="na">type=</span><span class="s">"org.mybatis.caches.ehcache.EhcacheCache"</span><span class="nt">&gt;&lt;/cache&gt;</span>
</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- å¼•ç”¨ç¼“å­˜ï¼šnamespaceï¼šæŒ‡å®šå’Œå“ªä¸ªåç§°ç©ºé—´ä¸‹çš„ç¼“å­˜ä¸€æ · --&gt;</span>
<span class="nt">&lt;cache-ref</span> <span class="na">namespace=</span><span class="s">"com.atguigu.mybatis.dao.EmployeeMapper"</span><span class="nt">/&gt;</span>
</code></pre></div></div>

<ul>
  <li>ehcache.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;ehcache</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
 <span class="na">xsi:noNamespaceSchemaLocation=</span><span class="s">"../config/ehcache.xsd"</span><span class="nt">&gt;</span>
 <span class="c">&lt;!-- ç£ç›˜ä¿å­˜è·¯å¾„ --&gt;</span>
 <span class="nt">&lt;diskStore</span> <span class="na">path=</span><span class="s">"D:\44\ehcache"</span> <span class="nt">/&gt;</span>
 
 <span class="nt">&lt;defaultCache</span> 
   <span class="na">maxElementsInMemory=</span><span class="s">"10000"</span> 
   <span class="na">maxElementsOnDisk=</span><span class="s">"10000000"</span>
   <span class="na">eternal=</span><span class="s">"false"</span> 
   <span class="na">overflowToDisk=</span><span class="s">"true"</span> 
   <span class="na">timeToIdleSeconds=</span><span class="s">"120"</span>
   <span class="na">timeToLiveSeconds=</span><span class="s">"120"</span> 
   <span class="na">diskExpiryThreadIntervalSeconds=</span><span class="s">"120"</span>
   <span class="na">memoryStoreEvictionPolicy=</span><span class="s">"LRU"</span><span class="nt">&gt;</span>
 <span class="nt">&lt;/defaultCache&gt;</span>
<span class="nt">&lt;/ehcache&gt;</span>
 
<span class="c">&lt;!-- 
å±æ€§è¯´æ˜ï¼š
l diskStoreï¼šæŒ‡å®šæ•°æ®åœ¨ç£ç›˜ä¸­çš„å­˜å‚¨ä½ç½®ã€‚
l defaultCacheï¼šå½“å€ŸåŠ©CacheManager.add("demoCache")åˆ›å»ºCacheæ—¶ï¼ŒEhCacheä¾¿ä¼šé‡‡ç”¨&lt;defalutCache/&gt;æŒ‡å®šçš„çš„ç®¡ç†ç­–ç•¥
 
ä»¥ä¸‹å±æ€§æ˜¯å¿…é¡»çš„ï¼š
l maxElementsInMemory - åœ¨å†…å­˜ä¸­ç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›® 
l maxElementsOnDisk - åœ¨ç£ç›˜ä¸Šç¼“å­˜çš„elementçš„æœ€å¤§æ•°ç›®ï¼Œè‹¥æ˜¯0è¡¨ç¤ºæ— ç©·å¤§
l eternal - è®¾å®šç¼“å­˜çš„elementsæ˜¯å¦æ°¸è¿œä¸è¿‡æœŸã€‚å¦‚æœä¸ºtrueï¼Œåˆ™ç¼“å­˜çš„æ•°æ®å§‹ç»ˆæœ‰æ•ˆï¼Œå¦‚æœä¸ºfalseé‚£ä¹ˆè¿˜è¦æ ¹æ®timeToIdleSecondsï¼ŒtimeToLiveSecondsåˆ¤æ–­
l overflowToDisk - è®¾å®šå½“å†…å­˜ç¼“å­˜æº¢å‡ºçš„æ—¶å€™æ˜¯å¦å°†è¿‡æœŸçš„elementç¼“å­˜åˆ°ç£ç›˜ä¸Š
 
ä»¥ä¸‹å±æ€§æ˜¯å¯é€‰çš„ï¼š
l timeToIdleSeconds - å½“ç¼“å­˜åœ¨EhCacheä¸­çš„æ•°æ®å‰åä¸¤æ¬¡è®¿é—®çš„æ—¶é—´è¶…è¿‡timeToIdleSecondsçš„å±æ€§å–å€¼æ—¶ï¼Œè¿™äº›æ•°æ®ä¾¿ä¼šåˆ é™¤ï¼Œé»˜è®¤å€¼æ˜¯0,ä¹Ÿå°±æ˜¯å¯é—²ç½®æ—¶é—´æ— ç©·å¤§
l timeToLiveSeconds - ç¼“å­˜elementçš„æœ‰æ•ˆç”Ÿå‘½æœŸï¼Œé»˜è®¤æ˜¯0.,ä¹Ÿå°±æ˜¯elementå­˜æ´»æ—¶é—´æ— ç©·å¤§
 diskSpoolBufferSizeMB è¿™ä¸ªå‚æ•°è®¾ç½®DiskStore(ç£ç›˜ç¼“å­˜)çš„ç¼“å­˜åŒºå¤§å°.é»˜è®¤æ˜¯30MB.æ¯ä¸ªCacheéƒ½åº”è¯¥æœ‰è‡ªå·±çš„ä¸€ä¸ªç¼“å†²åŒº.
l diskPersistent - åœ¨VMé‡å¯çš„æ—¶å€™æ˜¯å¦å¯ç”¨ç£ç›˜ä¿å­˜EhCacheä¸­çš„æ•°æ®ï¼Œé»˜è®¤æ˜¯falseã€‚
l diskExpiryThreadIntervalSeconds - ç£ç›˜ç¼“å­˜çš„æ¸…ç†çº¿ç¨‹è¿è¡Œé—´éš”ï¼Œé»˜è®¤æ˜¯120ç§’ã€‚æ¯ä¸ª120sï¼Œç›¸åº”çš„çº¿ç¨‹ä¼šè¿›è¡Œä¸€æ¬¡EhCacheä¸­æ•°æ®çš„æ¸…ç†å·¥ä½œ
l memoryStoreEvictionPolicy - å½“å†…å­˜ç¼“å­˜è¾¾åˆ°æœ€å¤§ï¼Œæœ‰æ–°çš„elementåŠ å…¥çš„æ—¶å€™ï¼Œ ç§»é™¤ç¼“å­˜ä¸­elementçš„ç­–ç•¥ã€‚é»˜è®¤æ˜¯LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰ï¼Œå¯é€‰çš„æœ‰LFUï¼ˆæœ€ä¸å¸¸ä½¿ç”¨ï¼‰å’ŒFIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰
 --&gt;</span>
</code></pre></div></div>

<h3 id="æµç¨‹å›¾">æµç¨‹å›¾</h3>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/mybatiscache.png" alt="" /></p>
:ET