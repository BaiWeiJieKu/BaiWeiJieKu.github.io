I"Yâ<ul id="markdown-toc">
  <li><a href="#å¯¹è±¡æŒä¹…åŒ–" id="markdown-toc-å¯¹è±¡æŒä¹…åŒ–">å¯¹è±¡æŒä¹…åŒ–</a></li>
  <li><a href="#orm" id="markdown-toc-orm">ORM</a></li>
  <li><a href="#å¼€å‘æ­¥éª¤" id="markdown-toc-å¼€å‘æ­¥éª¤">å¼€å‘æ­¥éª¤</a>    <ul>
      <li><a href="#é…ç½®æ–‡ä»¶" id="markdown-toc-é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</a></li>
      <li><a href="#æŒä¹…åŒ–ç±»" id="markdown-toc-æŒä¹…åŒ–ç±»">æŒä¹…åŒ–ç±»</a></li>
      <li><a href="#æ˜ å°„æ–‡ä»¶" id="markdown-toc-æ˜ å°„æ–‡ä»¶">æ˜ å°„æ–‡ä»¶</a></li>
      <li><a href="#è®¿é—®æ•°æ®åº“" id="markdown-toc-è®¿é—®æ•°æ®åº“">è®¿é—®æ•°æ®åº“</a></li>
      <li><a href="#æ€»ç»“" id="markdown-toc-æ€»ç»“">æ€»ç»“</a></li>
    </ul>
  </li>
  <li><a href="#configuration" id="markdown-toc-configuration">Configuration</a></li>
  <li><a href="#sessionfactory" id="markdown-toc-sessionfactory">SessionFactory</a></li>
  <li><a href="#sessionæ¥å£" id="markdown-toc-sessionæ¥å£">Sessionæ¥å£</a>    <ul>
      <li><a href="#æ–¹æ³•" id="markdown-toc-æ–¹æ³•">æ–¹æ³•</a></li>
      <li><a href="#save" id="markdown-toc-save">save</a></li>
      <li><a href="#getload" id="markdown-toc-getload">get&amp;load</a></li>
      <li><a href="#update" id="markdown-toc-update">update</a></li>
      <li><a href="#saveorupdate" id="markdown-toc-saveorupdate">saveOrUpdate</a></li>
      <li><a href="#delete" id="markdown-toc-delete">delete</a></li>
    </ul>
  </li>
  <li><a href="#queryæ¥å£" id="markdown-toc-queryæ¥å£">Queryæ¥å£</a>    <ul>
      <li><a href="#ä½¿ç”¨æ­¥éª¤" id="markdown-toc-ä½¿ç”¨æ­¥éª¤">ä½¿ç”¨æ­¥éª¤</a></li>
      <li><a href="#å¸¸ç”¨æ–¹æ³•" id="markdown-toc-å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</a></li>
    </ul>
  </li>
  <li><a href="#criteriaæ¥å£" id="markdown-toc-criteriaæ¥å£">Criteriaæ¥å£</a>    <ul>
      <li><a href="#å¸¸ç”¨ç±»" id="markdown-toc-å¸¸ç”¨ç±»">å¸¸ç”¨ç±»</a></li>
      <li><a href="#ä½¿ç”¨æ­¥éª¤-1" id="markdown-toc-ä½¿ç”¨æ­¥éª¤-1">ä½¿ç”¨æ­¥éª¤</a></li>
      <li><a href="#å¸¸ç”¨æ–¹æ³•-1" id="markdown-toc-å¸¸ç”¨æ–¹æ³•-1">å¸¸ç”¨æ–¹æ³•</a></li>
    </ul>
  </li>
  <li><a href="#transaction" id="markdown-toc-transaction">Transaction</a>    <ul>
      <li><a href="#æ–¹æ³•-1" id="markdown-toc-æ–¹æ³•-1">æ–¹æ³•</a></li>
    </ul>
  </li>
</ul>
<h3 id="å¯¹è±¡æŒä¹…åŒ–">å¯¹è±¡æŒä¹…åŒ–</h3>

<ul>
  <li>ç‹­ä¹‰çš„ç†è§£ï¼Œâ€œæŒä¹…åŒ–â€ä»…ä»…æŒ‡æŠŠå¯¹è±¡æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­</li>
  <li>å¹¿ä¹‰çš„ç†è§£ï¼Œâ€œæŒä¹…åŒ–â€åŒ…æ‹¬å’Œæ•°æ®åº“ç›¸å…³çš„å„ç§æ“ä½œï¼š</li>
  <li>ä¿å­˜ï¼šæŠŠå¯¹è±¡æ°¸ä¹…ä¿å­˜åˆ°æ•°æ®åº“ä¸­</li>
  <li>æ›´æ–°ï¼šæ›´æ–°æ•°æ®åº“ä¸­å¯¹è±¡(è®°å½•)çš„çŠ¶æ€</li>
  <li>åˆ é™¤ï¼šä»æ•°æ®åº“ä¸­åˆ é™¤ä¸€ä¸ªå¯¹è±¡</li>
  <li>æŸ¥è¯¢ï¼šæ ¹æ®ç‰¹å®šçš„æŸ¥è¯¢æ¡ä»¶ï¼ŒæŠŠç¬¦åˆæŸ¥è¯¢æ¡ä»¶çš„ä¸€ä¸ªæˆ–å¤šä¸ªå¯¹è±¡ä»æ•°æ®åº“åŠ è½½åˆ°å†…å­˜ä¸­</li>
</ul>

<h3 id="orm">ORM</h3>

<ul>
  <li>ORM(Object/Relation Mapping): å¯¹è±¡/å…³ç³»æ˜ å°„</li>
  <li>ç±»â€”ã€‹è¡¨</li>
  <li>å¯¹è±¡â€”ã€‹è¡¨çš„è¡Œï¼ˆè®°å½•ï¼‰</li>
  <li>å±æ€§â€”ã€‹è¡¨çš„åˆ—ï¼ˆå­—æ®µï¼‰</li>
  <li>ORMçš„æ€æƒ³ï¼šå°†å…³ç³»æ•°æ®åº“ä¸­è¡¨ä¸­çš„è®°å½•æ˜ å°„æˆä¸ºå¯¹è±¡ï¼Œä»¥å¯¹è±¡çš„å½¢å¼å±•ç°ï¼Œ<strong>ç¨‹åºå‘˜å¯ä»¥æŠŠå¯¹æ•°æ®åº“çš„æ“ä½œè½¬åŒ–ä¸ºå¯¹å¯¹è±¡çš„æ“ä½œ</strong></li>
  <li>ORM é‡‡ç”¨<strong>å…ƒæ•°æ®</strong>æ¥æè¿°å¯¹è±¡-å…³ç³»æ˜ å°„ç»†èŠ‚, å…ƒæ•°æ®é€šå¸¸é‡‡ç”¨ XML æ ¼å¼, å¹¶ä¸”å­˜æ”¾åœ¨ä¸“é—¨çš„å¯¹è±¡-å…³ç³»æ˜ å°„æ–‡ä»¶ä¸­</li>
</ul>

<h3 id="å¼€å‘æ­¥éª¤">å¼€å‘æ­¥éª¤</h3>

<h4 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h4>

<ul>
  <li>
    <p>Hibernate ä»å…¶é…ç½®æ–‡ä»¶ä¸­è¯»å–å’Œæ•°æ®åº“è¿æ¥çš„æœ‰å…³ä¿¡æ¯, è¿™ä¸ªæ–‡ä»¶åº”è¯¥ä½äºåº”ç”¨çš„ classpath ä¸‹</p>
  </li>
  <li>
    <p>hibernate.cfg.xml</p>
  </li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE hibernate-configuration PUBLIC
		"-//Hibernate/Hibernate Configuration DTD 3.0//EN"
		"http://hibernate.sourceforge.net/hibernate-configuration-3.0.dtd"&gt;</span>
<span class="nt">&lt;hibernate-configuration&gt;</span>
    <span class="nt">&lt;session-factory&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.driver_class"</span><span class="nt">&gt;</span>com.mysql.jdbc.Driver<span class="nt">&lt;/property&gt;</span>
        
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.username"</span><span class="nt">&gt;</span>mysql<span class="nt">&lt;/property&gt;</span>
        
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.password"</span><span class="nt">&gt;</span>mysql<span class="nt">&lt;/property&gt;</span>
        
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.connection.url"</span><span class="nt">&gt;</span>jdbc:mysql://localhost:3306/mysqldb<span class="nt">&lt;/property&gt;</span>
        
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hibernate.dialect"</span><span class="nt">&gt;</span>org.hibernate.dialect.MySQLDialect<span class="nt">&lt;/property&gt;</span>
        
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"connection.pool_size"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/property&gt;</span>
        
        <span class="c">&lt;!--   é…ç½®æ•°æ®åº“æ–¹è¨€ --&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dialect"</span><span class="nt">&gt;</span>org.hibernate.dialect.MySQLDialect<span class="nt">&lt;/property&gt;</span>
        
        <span class="c">&lt;!--  è¾“å‡ºè¿è¡Œæ—¶ç”Ÿæˆçš„SQLè¯­å¥--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"show_sql"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/property&gt;</span>
        
        <span class="c">&lt;!--æŒ‡å®šæ˜¯å¦å¯¹è¾“å‡ºsqlè¯­å¥è¿›è¡Œæ ¼å¼åŒ–--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"format_sql"</span><span class="nt">&gt;</span>true<span class="nt">&lt;/property&gt;</span>
        
        <span class="c">&lt;!--æŒ‡å®šç¨‹åºè¿è¡Œæ—¶æ˜¯å¦åœ¨æ•°æ®åº“è‡ªåŠ¨ç”Ÿæˆæ•°æ®è¡¨--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"hbm2ddl.auto"</span><span class="nt">&gt;</span>update<span class="nt">&lt;/property&gt;</span>
        
        <span class="c">&lt;!-- åˆ—å‡ºæ‰€æœ‰çš„æ˜ å°„æ–‡ä»¶ --&gt;</span>
        <span class="nt">&lt;mapping</span> <span class="na">resource=</span><span class="s">"org/hibernate/entity/User.hbm.xml"</span><span class="nt">/&gt;</span>
        
    <span class="nt">&lt;/session-factory&gt;</span>
<span class="nt">&lt;/hibernate-configuration&gt;</span>

</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hbm2ddl.autoï¼šè¯¥å±æ€§å¯å¸®åŠ©ç¨‹åºå‘˜å®ç°æ­£å‘å·¥ç¨‹:create | update | create-drop | validate

create : ä¼šæ ¹æ® .hbm.xml  æ–‡ä»¶æ¥ç”Ÿæˆæ•°æ®è¡¨, ä½†æ˜¯æ¯æ¬¡è¿è¡Œéƒ½ä¼šåˆ é™¤ä¸Šä¸€æ¬¡çš„è¡¨ ,é‡æ–°ç”Ÿæˆè¡¨, å“ªæ€•äºŒæ¬¡æ²¡æœ‰ä»»ä½•æ”¹å˜ 

create-drop : ä¼šæ ¹æ® .hbm.xml æ–‡ä»¶ç”Ÿæˆè¡¨,ä½†æ˜¯SessionFactoryä¸€å…³é—­, è¡¨å°±è‡ªåŠ¨åˆ é™¤ 

update : æœ€å¸¸ç”¨çš„å±æ€§å€¼ï¼Œä¹Ÿä¼šæ ¹æ® .hbm.xml æ–‡ä»¶ç”Ÿæˆè¡¨, ä½†è‹¥ .hbm.xml  æ–‡ä»¶å’Œæ•°æ®åº“ä¸­å¯¹åº”çš„æ•°æ®è¡¨çš„è¡¨ç»“æ„ä¸åŒ, Hiberante  å°†æ›´æ–°æ•°æ®è¡¨ç»“æ„ï¼Œä½†ä¸ä¼šåˆ é™¤å·²æœ‰çš„è¡Œå’Œåˆ— 

validate : ä¼šå’Œæ•°æ®åº“ä¸­çš„è¡¨è¿›è¡Œæ¯”è¾ƒ, è‹¥ .hbm.xml æ–‡ä»¶ä¸­çš„åˆ—åœ¨æ•°æ®è¡¨ä¸­ä¸å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸

</code></pre></div></div>

<h4 id="æŒä¹…åŒ–ç±»">æŒä¹…åŒ–ç±»</h4>

<ul>
  <li><strong>æä¾›ä¸€ä¸ªæ— å‚çš„æ„é€ å™¨</strong>:ä½¿Hibernateå¯ä»¥ä½¿ç”¨Constructor.newInstance() æ¥å®ä¾‹åŒ–æŒä¹…åŒ–ç±»</li>
  <li><strong>æä¾›ä¸€ä¸ªæ ‡è¯†å±æ€§(identifier property)</strong>: é€šå¸¸æ˜ å°„ä¸ºæ•°æ®åº“è¡¨çš„ä¸»é”®å­—æ®µ. å¦‚æœæ²¡æœ‰è¯¥å±æ€§ï¼Œä¸€äº›åŠŸèƒ½å°†ä¸èµ·ä½œç”¨ï¼Œå¦‚ï¼šSession.saveOrUpdate()</li>
  <li><strong>ä¸ºç±»çš„æŒä¹…åŒ–ç±»å­—æ®µå£°æ˜è®¿é—®æ–¹æ³•</strong>(get/set): Hibernateå¯¹JavaBeans é£æ ¼çš„å±æ€§å®è¡ŒæŒä¹…åŒ–</li>
  <li><strong>ä½¿ç”¨é</strong> <strong>final</strong> <strong>ç±»</strong>: åœ¨è¿è¡Œæ—¶ç”Ÿæˆä»£ç†æ˜¯ Hibernate çš„ä¸€ä¸ªé‡è¦çš„åŠŸèƒ½. å¦‚æœæŒä¹…åŒ–ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£, Hibnernate ä½¿ç”¨ CGLIB ç”Ÿæˆä»£ç†. å¦‚æœä½¿ç”¨çš„æ˜¯ final ç±», åˆ™æ— æ³•ç”Ÿæˆ CGLIB ä»£ç†</li>
  <li><strong>é‡å†™ eqauls å’Œ hashCode æ–¹æ³•</strong>: å¦‚æœéœ€è¦æŠŠæŒä¹…åŒ–ç±»çš„å®ä¾‹æ”¾åˆ° Set ä¸­(å½“éœ€è¦è¿›è¡Œå…³è”æ˜ å°„æ—¶), åˆ™åº”è¯¥é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•</li>
  <li>Hibernate ä¸è¦æ±‚æŒä¹…åŒ–ç±»ç»§æ‰¿ä»»ä½•çˆ¶ç±»æˆ–å®ç°æ¥å£ï¼Œè¿™å¯ä»¥ä¿è¯ä»£ç ä¸è¢«æ±¡æŸ“ï¼ˆä½ä¾µå…¥å¼è®¾è®¡ï¼‰</li>
</ul>

<h4 id="æ˜ å°„æ–‡ä»¶">æ˜ å°„æ–‡ä»¶</h4>

<ul>
  <li>Hibernate é‡‡ç”¨ XML æ ¼å¼çš„æ–‡ä»¶æ¥æŒ‡å®šå¯¹è±¡å’Œå…³ç³»æ•°æ®ä¹‹é—´çš„æ˜ å°„</li>
  <li>åœ¨è¿è¡Œæ—¶ Hibernateå°†æ ¹æ®è¿™ä¸ªæ˜ å°„æ–‡ä»¶æ¥ç”Ÿæˆå„ç§ SQL è¯­å¥</li>
  <li>æ˜ å°„æ–‡ä»¶çš„æ‰©å±•åä¸º XXX.hbm.xml</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.hibernate.entity</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">User</span><span class="o">{</span>
	<span class="c1">// Fields</span>
	<span class="kd">private</span> <span class="kt">int</span> <span class="n">id</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">password</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">type</span><span class="o">;</span>
	<span class="c1">// Constructors</span>
	<span class="cm">/** default constructor */</span>
	<span class="kd">public</span> <span class="nf">User</span><span class="o">()</span> <span class="o">{</span>                                                      
	<span class="o">}</span>
	<span class="cm">/** full constructor */</span>
	<span class="kd">public</span> <span class="nf">User</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">,</span> <span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">String</span> <span class="n">password</span><span class="o">,</span> <span class="nc">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
		<span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="c1">// Property accessors</span>
	<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setId</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">id</span> <span class="o">=</span> <span class="n">id</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPassword</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">password</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPassword</span><span class="o">(</span><span class="nc">String</span> <span class="n">password</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">password</span> <span class="o">=</span> <span class="n">password</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
		<span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">type</span><span class="o">;</span>
	<span class="o">}</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setType</span><span class="o">(</span><span class="nc">String</span> <span class="n">type</span><span class="o">)</span> <span class="o">{</span>
		<span class="k">this</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd"&gt;</span>
<span class="nt">&lt;hibernate-mapping&gt;</span>
	<span class="c">&lt;!--nameæŒ‡å®šæŒä¹…åŒ–ç±»çš„ç±»åï¼ŒtableæŒ‡å®šæ•°æ®è¡¨çš„è¡¨å--&gt;</span>
    <span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">"org.hibernate.entity.User"</span> <span class="na">table=</span><span class="s">"USER"</span><span class="nt">&gt;</span>
    	<span class="c">&lt;!--å°†userç±»ä¸­çš„idå±æ€§æ˜ å°„ä¸ºæ•°æ®è¡¨USERä¸­çš„ä¸»é”®USER_ID--&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">name=</span><span class="s">"id"</span> <span class="na">type=</span><span class="s">"java.lang.Integer"</span> <span class="na">column=</span><span class="s">"USER_ID"</span><span class="nt">&gt;</span>
        	<span class="c">&lt;!--ä¸»é”®ç”Ÿæˆç­–ç•¥ï¼Œæ„å‘³ç€idçš„è‡ªå¢é•¿æ–¹å¼é‡‡ç”¨æ•°æ®åº“çš„è‡ªå¢é•¿æ¨¡å¼--&gt;</span>
            <span class="nt">&lt;generator</span> <span class="na">class=</span><span class="s">"increment"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/id&gt;</span>
        <span class="c">&lt;!--æ˜ å°„Userç±»ä¸­çš„nameå±æ€§--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"name"</span> <span class="na">type=</span><span class="s">"java.lang.String"</span><span class="nt">&gt;</span>
       		<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"NAME"</span> <span class="na">length=</span><span class="s">"20"</span><span class="nt">&gt;&lt;/column&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="c">&lt;!--æ˜ å°„Userç±»ä¸­çš„passwordå±æ€§--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">type=</span><span class="s">"java.lang.String"</span> <span class="nt">&gt;</span>
        	<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"PASSWORD"</span> <span class="na">length=</span><span class="s">"12"</span><span class="nt">&gt;&lt;/column&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="c">&lt;!--æ˜ å°„Userç±»ä¸­çš„typeå±æ€§--&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"type"</span> <span class="na">type=</span><span class="s">"java.lang.String"</span> <span class="nt">&gt;</span>
        	<span class="nt">&lt;column</span> <span class="na">name=</span><span class="s">"TYPE"</span> <span class="na">length=</span><span class="s">"6"</span><span class="nt">&gt;&lt;/column&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/class&gt;</span>
<span class="nt">&lt;/hibernate-mapping&gt;</span>


</code></pre></div></div>

<h4 id="è®¿é—®æ•°æ®åº“">è®¿é—®æ•°æ®åº“</h4>

<ul>
  <li>å·¥å…·ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.hibernate.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.cfg.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HibernateUtil</span> <span class="o">{</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">SessionFactory</span> <span class="n">sessionFactory</span><span class="o">;</span>
	<span class="kd">private</span>  <span class="kd">static</span> <span class="nc">Configuration</span> <span class="n">configuration</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Configuration</span><span class="o">();</span>   
    <span class="c1">//åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡threadLocalï¼Œç”¨æ¥ä¿å­˜Hibernateçš„Session</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">Session</span><span class="o">&gt;</span> <span class="n">threadLocal</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">Session</span><span class="o">&gt;();</span>
	<span class="c1">//ä½¿ç”¨é™æ€ä»£ç å—åˆå§‹åŒ–Hibernate</span>
    <span class="kd">static</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
        <span class="nc">Configuration</span> <span class="n">cfg</span><span class="o">=</span><span class="k">new</span> <span class="nc">Configuration</span><span class="o">().</span><span class="na">configure</span><span class="o">();</span>	<span class="c1">//è¯»å–é…ç½®æ–‡ä»¶hibernate.cfg.xml</span>
        <span class="c1">//åˆ›å»ºServiceRegistryå¯¹è±¡</span>
        <span class="nc">ServiceRegistry</span> <span class="n">serviceRegistey</span><span class="o">=</span><span class="k">new</span> <span class="nc">ServiceRegistryBuilder</span><span class="o">().</span><span class="na">applySettings</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">getProperties</span><span class="o">()).</span><span class="na">buildServiceRegistry</span><span class="o">();</span>
        <span class="c1">//åˆ›å»ºSessionFactory</span>
        <span class="n">sessionFactory</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">(</span><span class="n">serviceRegistey</span><span class="o">);</span>		
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        	<span class="k">throw</span> <span class="k">new</span> <span class="nf">ExceptionInInitializerError</span><span class="o">(</span><span class="n">ex</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="c1">//è·å¾—SessionFactoryå®ä¾‹</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">SessionFactory</span> <span class="nf">getSessionFactory</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">return</span> <span class="n">sessionFactory</span><span class="o">;</span>
<span class="o">}</span>
<span class="c1">//è·å¾—ThreadLocal å¯¹è±¡ç®¡ç†çš„Sessionå®ä¾‹.  </span>
<span class="kd">public</span> <span class="kd">static</span> <span class="nc">Session</span> <span class="nf">getSession</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">HibernateException</span> <span class="o">{</span>                
        <span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Session</span><span class="o">)</span> <span class="n">threadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">session</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">sessionFactory</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>

                <span class="n">rebuildSessionFactory</span><span class="o">();</span>
            <span class="o">}</span>
            <span class="c1">//é€šè¿‡SessionFactoryå¯¹è±¡åˆ›å»ºSessionå¯¹è±¡</span>
            <span class="n">session</span> <span class="o">=</span> <span class="o">(</span><span class="n">sessionFactory</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">?</span> <span class="n">sessionFactory</span><span class="o">.</span><span class="na">openSession</span><span class="o">():</span> <span class="kc">null</span><span class="o">;</span>
             <span class="c1">//å°†æ–°æ‰“å¼€çš„Sessionå®ä¾‹ä¿å­˜åˆ°çº¿ç¨‹å±€éƒ¨å˜é‡threadLocalä¸­</span>
            <span class="n">threadLocal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
        <span class="o">}</span>
            <span class="k">return</span> <span class="n">session</span><span class="o">;</span>
	<span class="o">}</span>
<span class="c1">//å…³é—­Sessionå®ä¾‹</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">closeSession</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">HibernateException</span> <span class="o">{</span>
<span class="c1">//ä»çº¿ç¨‹å±€éƒ¨å˜é‡threadLocalä¸­è·å–ä¹‹å‰å­˜å…¥çš„Sessionå®ä¾‹</span>
<span class="nc">Session</span> <span class="n">session</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Session</span><span class="o">)</span> <span class="n">threadLocal</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
        <span class="n">threadLocal</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">session</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="c1">//é‡å»ºSessionFactory</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">rebuildSessionFactory</span><span class="o">()</span> <span class="o">{</span>
	<span class="k">try</span> <span class="o">{</span>
	<span class="n">configuration</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="s">"/hibernate.cfg.xml"</span><span class="o">);</span>			<span class="c1">//è¯»å–é…ç½®æ–‡ä»¶hibernate.cfg.xml</span>
<span class="n">sessionFactory</span> <span class="o">=</span> <span class="n">configuration</span><span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">();</span>		<span class="c1">//åˆ›å»ºSessionFactory</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Error Creating SessionFactory "</span><span class="o">);</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
<span class="c1">//å…³é—­ç¼“å­˜å’Œè¿æ¥æ± </span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">shutdown</span><span class="o">()</span> <span class="o">{</span>
		<span class="n">getSessionFactory</span><span class="o">().</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<ul>
  <li>DAO</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.hibernate.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.entity.User</span><span class="o">;</span>
<span class="c1">//åˆ›å»ºUserDAOæ¥å£</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">UserDAO</span> <span class="o">{</span>
	 <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">);</span>				<span class="c1">//æ·»åŠ ç”¨æˆ·</span>
	 <span class="nc">User</span> <span class="nf">findById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">);</span>				<span class="c1">//æ ¹æ®ç”¨æˆ·æ ‡è¯†æŸ¥æ‰¾æŒ‡å®šç”¨æˆ·	 </span>
	<span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">);</span>				<span class="c1">//åˆ é™¤ç”¨æˆ·	</span>
	 <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">);</span>			<span class="c1">//ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</span>
<span class="o">}</span>


</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.hibernate.dao</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.hibernate.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.entity.*</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserDAOImpl</span> <span class="kd">implements</span> <span class="nc">UserDAO</span> <span class="o">{</span>
	<span class="c1">//æ·»åŠ ç”¨æˆ·</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="nc">Session</span> <span class="n">session</span><span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>	<span class="c1">//ç”ŸæˆSessionå®ä¾‹</span>
        <span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>	<span class="c1">//åˆ›å»ºTransactionå®ä¾‹</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>				<span class="c1">//ä½¿ç”¨Sessionçš„saveæ–¹æ³•å°†æŒä¹…åŒ–å¯¹è±¡ä¿å­˜åˆ°æ•°æ®åº“</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>						<span class="c1">//æäº¤äº‹åŠ¡</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>					<span class="c1">//å›æ»šäº‹åŠ¡</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
             <span class="nc">HibernateUtil</span><span class="o">.</span> <span class="nf">closeSession</span><span class="o">();</span>		<span class="c1">//å…³é—­Sessionå®ä¾‹</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="c1">//æ ¹æ®ç”¨æˆ·æ ‡è¯†æŸ¥æ‰¾æŒ‡å®šç”¨æˆ·	 </span>
    <span class="kd">public</span> <span class="nc">User</span> <span class="nf">findById</span><span class="o">(</span><span class="kt">int</span> <span class="n">id</span><span class="o">){</span>	 
        <span class="nc">User</span> <span class="n">user</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
        <span class="nc">Session</span> <span class="n">session</span><span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>	<span class="c1">//ç”ŸæˆSessionå®ä¾‹</span>
        <span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>	<span class="c1">//åˆ›å»ºTransactionå®ä¾‹</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">user</span><span class="o">=(</span><span class="nc">User</span><span class="o">)</span><span class="n">session</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">id</span><span class="o">);</span><span class="c1">//ä½¿ç”¨Sessionçš„getæ–¹æ³•è·å–æŒ‡å®šidçš„ç”¨æˆ·åˆ°å†…å­˜ä¸­</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>								<span class="c1">//æäº¤äº‹åŠ¡</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>								<span class="c1">//å›æ»šäº‹åŠ¡</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
             <span class="nc">HibernateUtil</span><span class="o">.</span> <span class="nf">closeSession</span><span class="o">();</span>				<span class="c1">//å…³é—­Sessionå®ä¾‹</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
	<span class="c1">//åˆ é™¤ç”¨æˆ·	</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">delete</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="nc">Session</span> <span class="n">session</span><span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>	<span class="c1">//ç”ŸæˆSessionå®ä¾‹</span>
        <span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>	<span class="c1">//åˆ›å»ºTransactionå®ä¾‹</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>						<span class="c1">//ä½¿ç”¨Sessionçš„deleteæ–¹æ³•å°†æŒä¹…åŒ–å¯¹è±¡åˆ é™¤</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>								<span class="c1">//æäº¤äº‹åŠ¡</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>								<span class="c1">//å›æ»šäº‹åŠ¡</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
             <span class="nc">HibernateUtil</span><span class="o">.</span> <span class="nf">closeSession</span><span class="o">();</span>				<span class="c1">//å…³é—­Sessionå®ä¾‹</span>
        <span class="o">}</span>
    <span class="o">}</span>					
    <span class="c1">//ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">update</span><span class="o">(</span><span class="nc">User</span> <span class="n">user</span><span class="o">){</span>
        <span class="nc">Session</span> <span class="n">session</span><span class="o">=</span> <span class="nc">HibernateUtil</span><span class="o">.</span><span class="na">getSession</span><span class="o">();</span>	<span class="c1">//ç”ŸæˆSessionå®ä¾‹</span>
        <span class="nc">Transaction</span> <span class="n">tx</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>	<span class="c1">//åˆ›å»ºTransactionå®ä¾‹</span>
        <span class="k">try</span><span class="o">{</span>
            <span class="n">session</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">user</span><span class="o">);</span>						<span class="c1">//ä½¿ç”¨Sessionçš„updateæ–¹æ³•æ›´æ–°æŒä¹…åŒ–å¯¹è±¡	</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">commit</span><span class="o">();</span>								<span class="c1">//æäº¤äº‹åŠ¡</span>
        <span class="o">}</span> <span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="n">tx</span><span class="o">.</span><span class="na">rollback</span><span class="o">();</span>								<span class="c1">//å›æ»šäº‹åŠ¡</span>
        <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
             <span class="nc">HibernateUtil</span><span class="o">.</span> <span class="nf">closeSession</span><span class="o">();</span>				<span class="c1">//å…³é—­Sessionå®ä¾‹</span>
        <span class="o">}</span>
    <span class="o">}</span>					
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>test</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">org.hibernate.test</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.dao.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.entity.User</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Before</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.junit.Test</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">UserTest</span> <span class="o">{</span>
	<span class="nd">@Before</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setUp</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
	<span class="o">}</span>
	<span class="nd">@Test</span> <span class="c1">//testæ³¨é‡Šè¡¨æ˜è¯¥æ–¹æ³•ä¸ºä¸€ä¸ªæµ‹è¯•æ–¹æ³•</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testSave</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">UserDAO</span> <span class="n">userdao</span><span class="o">=</span><span class="k">new</span> <span class="nc">UserDAOImpl</span><span class="o">();</span>	
	     <span class="k">try</span><span class="o">{</span>
		  <span class="nc">User</span> <span class="n">u</span><span class="o">=</span><span class="k">new</span> <span class="nc">User</span><span class="o">();</span>			<span class="c1">//åˆ›å»ºUserå¯¹è±¡</span>
		  <span class="c1">//è®¾ç½®Userå¯¹è±¡ä¸­çš„å„ä¸ªå±æ€§å€¼</span>
		  <span class="n">u</span><span class="o">.</span><span class="na">setId</span><span class="o">(</span><span class="mi">20</span><span class="o">);</span>
		  <span class="n">u</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"zhangsan"</span><span class="o">);</span>
		  <span class="n">u</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"456"</span><span class="o">);</span>
		  <span class="n">u</span><span class="o">.</span><span class="na">setType</span><span class="o">(</span><span class="s">"admin"</span><span class="o">);</span>
		  <span class="n">userdao</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">u</span><span class="o">);</span>				<span class="c1">//ä½¿ç”¨userdaoimplçš„saveæ–¹æ³•å°†Userå¯¹è±¡å­˜å…¥æ•°æ®åº“</span>
	     <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">){</span>
	    	 <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
	     <span class="o">}</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="æ€»ç»“">æ€»ç»“</h4>

<ul>
  <li>ç¼–å†™æŒä¹…åŒ–ç±»ï¼š POJO + æ˜ å°„æ–‡ä»¶</li>
  <li>è·å– Configurationå¯¹è±¡</li>
  <li>è·å– SessionFactory å¯¹è±¡</li>
  <li>è·å– Sessionï¼Œæ‰“å¼€äº‹åŠ¡</li>
  <li>ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼æ“ä½œæ•°æ®åº“</li>
  <li>å…³é—­äº‹åŠ¡ï¼Œå…³é—­ Session</li>
</ul>

<h3 id="configuration">Configuration</h3>

<ul>
  <li>Configuration ç±»è´Ÿè´£ç®¡ç† Hibernate çš„é…ç½®ä¿¡æ¯ã€‚åŒ…æ‹¬å¦‚ä¸‹å†…å®¹</li>
  <li>
    <p>Hibernate è¿è¡Œçš„åº•å±‚ä¿¡æ¯ï¼šæ•°æ®åº“çš„URLã€ç”¨æˆ·åã€å¯†ç ã€JDBCé©±åŠ¨ç±»ï¼Œæ•°æ®åº“Dialect,æ•°æ®åº“è¿æ¥æ± ç­‰ï¼ˆå¯¹åº” <strong>hibernate.cfg.xml</strong> æ–‡ä»¶ï¼‰</p>
  </li>
  <li>åˆ›å»º Configurationçš„ä¸¤ç§æ–¹å¼ï¼š</li>
  <li>å±æ€§æ–‡ä»¶ï¼ˆhibernate.propertiesï¼‰:<strong>Configuration cfg = new Configuration();</strong></li>
  <li>Xmlæ–‡ä»¶ï¼ˆhibernate.cfg.xmlï¼‰ï¼š<strong>Configuration cfg = new Configuration().configure();</strong></li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="err">â€œ</span><span class="n">simpleit</span><span class="o">.</span><span class="na">xml</span><span class="err">â€</span><span class="o">);</span>
<span class="nc">Configuration</span> <span class="n">cfg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Configuration</span><span class="o">().</span><span class="na">configure</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="sessionfactory">SessionFactory</h3>

<ul>
  <li>é’ˆå¯¹å•ä¸ªæ•°æ®åº“æ˜ å°„å…³ç³»ç»è¿‡ç¼–è¯‘åçš„å†…å­˜é•œåƒï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„</li>
  <li>SessionFactory å¯¹è±¡ä¸€æ—¦æ„é€ å®Œæ¯•ï¼Œå³è¢«èµ‹äºˆç‰¹å®šçš„é…ç½®ä¿¡æ¯</li>
  <li>SessionFactoryæ˜¯ç”ŸæˆSessionçš„å·¥å‚</li>
  <li>æ„é€  SessionFactory å¾ˆæ¶ˆè€—èµ„æºï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸€ä¸ªåº”ç”¨ä¸­åªåˆå§‹åŒ–ä¸€ä¸ª SessionFactory å¯¹è±¡</li>
  <li>Hibernate4 æ–°å¢äº†ä¸€ä¸ª ServiceRegistry æ¥å£ï¼Œæ‰€æœ‰åŸºäº Hibernate çš„é…ç½®æˆ–è€…æœåŠ¡éƒ½å¿…é¡»ç»Ÿä¸€å‘è¿™ä¸ª ServiceRegistry  æ³¨å†Œåæ‰èƒ½ç”Ÿæ•ˆ</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Configuration</span> <span class="n">cfg</span><span class="o">=</span><span class="k">new</span> <span class="nc">Configuration</span><span class="o">().</span><span class="na">configure</span><span class="o">();</span>	<span class="c1">//è¯»å–é…ç½®æ–‡ä»¶hibernate.cfg.xml</span>
<span class="c1">//åˆ›å»ºServiceRegistryå¯¹è±¡</span>
<span class="nc">ServiceRegistry</span> <span class="n">serviceRegistey</span><span class="o">=</span><span class="k">new</span> <span class="nc">ServiceRegistryBuilder</span><span class="o">().</span><span class="na">applySettings</span><span class="o">(</span><span class="n">cfg</span><span class="o">.</span><span class="na">getProperties</span><span class="o">()).</span><span class="na">buildServiceRegistry</span><span class="o">();</span>
<span class="c1">//åˆ›å»ºSessionFactory</span>
<span class="n">sessionFactory</span><span class="o">=</span><span class="n">cfg</span><span class="o">.</span><span class="na">buildSessionFactory</span><span class="o">(</span><span class="n">serviceRegistey</span><span class="o">);</span>
</code></pre></div></div>

<h3 id="sessionæ¥å£">Sessionæ¥å£</h3>

<ul>
  <li>Session æ˜¯åº”ç”¨ç¨‹åºä¸æ•°æ®åº“ä¹‹é—´äº¤äº’æ“ä½œçš„ä¸€ä¸ª<strong>å•çº¿ç¨‹å¯¹è±¡</strong></li>
  <li>æ˜¯ Hibernateè¿ä½œçš„ä¸­å¿ƒï¼Œæ‰€æœ‰æŒä¹…åŒ–å¯¹è±¡å¿…é¡»åœ¨ session çš„ç®¡ç†ä¸‹æ‰å¯ä»¥è¿›è¡ŒæŒä¹…åŒ–æ“ä½œ</li>
  <li>æ­¤å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­</li>
  <li>Session å¯¹è±¡æœ‰ä¸€ä¸ªä¸€çº§ç¼“å­˜ï¼Œæ˜¾å¼æ‰§è¡Œflush ä¹‹å‰ï¼Œæ‰€æœ‰çš„æŒä¹…å±‚æ“ä½œçš„æ•°æ®éƒ½ç¼“å­˜åœ¨ session å¯¹è±¡å¤„</li>
  <li>
    <p>ç›¸å½“äº JDBC ä¸­çš„ Connection</p>
  </li>
  <li>æŒä¹…åŒ–ç±»ä¸ Session å…³è”èµ·æ¥åå°±å…·æœ‰äº†æŒä¹…åŒ–çš„èƒ½åŠ›</li>
</ul>

<h4 id="æ–¹æ³•">æ–¹æ³•</h4>

<ul>
  <li>get() ï¼Œload()ï¼šå–å¾—æŒä¹…åŒ–å¯¹è±¡çš„æ–¹æ³•</li>
  <li>save(),update(),saveOrUpdate(),delete()ï¼šæŒä¹…åŒ–å¯¹è±¡éƒ½å¾—ä¿å­˜ï¼Œæ›´æ–°å’Œåˆ é™¤</li>
  <li>beginTransaction()ï¼šå¼€å¯äº‹åŠ¡</li>
  <li>isOpen(),flush(),clear(), evict(), close()ï¼šç®¡ç† Session çš„æ–¹æ³•</li>
</ul>

<h4 id="save">save</h4>

<ul>
  <li>Session çš„ save() æ–¹æ³•ä½¿ä¸€ä¸ªä¸´æ—¶å¯¹è±¡è½¬å˜ä¸ºæŒä¹…åŒ–å¯¹è±¡</li>
  <li>æŠŠ News å¯¹è±¡åŠ å…¥åˆ° Session ç¼“å­˜ä¸­, ä½¿å®ƒè¿›å…¥æŒä¹…åŒ–çŠ¶æ€</li>
  <li>é€‰ç”¨æ˜ å°„æ–‡ä»¶æŒ‡å®šçš„æ ‡è¯†ç¬¦ç”Ÿæˆå™¨, ä¸ºæŒä¹…åŒ–å¯¹è±¡åˆ†é…å”¯ä¸€çš„ OID</li>
  <li>è®¡åˆ’æ‰§è¡Œä¸€æ¡ insert è¯­å¥ï¼šåœ¨ flush ç¼“å­˜çš„æ—¶å€™</li>
  <li>Hibernate é€šè¿‡æŒä¹…åŒ–å¯¹è±¡çš„ OID æ¥ç»´æŒå®ƒå’Œæ•°æ®åº“ç›¸å…³è®°å½•çš„å¯¹åº”å…³ç³»</li>
  <li>å½“ News å¯¹è±¡å¤„äºæŒä¹…åŒ–çŠ¶æ€æ—¶, ä¸å…è®¸ç¨‹åºéšæ„ä¿®æ”¹å®ƒçš„ID</li>
  <li>å½“å¯¹ä¸€ä¸ª OID ä¸ä¸º Null çš„å¯¹è±¡æ‰§è¡Œ save() æ–¹æ³•æ—¶, ä¼šæŠŠè¯¥å¯¹è±¡ä»¥ä¸€ä¸ªæ–°çš„ oid ä¿å­˜åˆ°æ•°æ®åº“ä¸­;  ä½†æ‰§è¡Œ persist() æ–¹æ³•æ—¶ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸</li>
</ul>

<h4 id="getload">get&amp;load</h4>

<ul>
  <li>éƒ½å¯ä»¥æ ¹æ®è·Ÿå®šçš„ OID ä»æ•°æ®åº“ä¸­åŠ è½½ä¸€ä¸ªæŒä¹…åŒ–å¯¹è±¡</li>
  <li>å½“æ•°æ®åº“ä¸­ä¸å­˜åœ¨ä¸ OID å¯¹åº”çš„è®°å½•æ—¶, load() æ–¹æ³•æŠ›å‡º ObjectNotFoundException å¼‚å¸¸, è€Œ get() æ–¹æ³•è¿”å› null</li>
  <li>ä¸¤è€…é‡‡ç”¨ä¸åŒçš„å»¶è¿Ÿæ£€ç´¢ç­–ç•¥ï¼šload æ–¹æ³•æ”¯æŒå»¶è¿ŸåŠ è½½ç­–ç•¥ã€‚è€Œget ä¸æ”¯æŒ</li>
</ul>

<h4 id="update">update</h4>

<ul>
  <li>Session çš„ update() æ–¹æ³•ä½¿ä¸€ä¸ªæ¸¸ç¦»å¯¹è±¡è½¬å˜ä¸ºæŒä¹…åŒ–å¯¹è±¡, å¹¶ä¸”è®¡åˆ’æ‰§è¡Œä¸€æ¡ update è¯­å¥</li>
  <li>è‹¥å¸Œæœ› Session ä»…å½“ä¿®æ”¹äº† News å¯¹è±¡çš„å±æ€§æ—¶, æ‰æ‰§è¡Œ update() è¯­å¥, å¯ä»¥æŠŠæ˜ å°„æ–‡ä»¶ä¸­ <code class="language-plaintext highlighter-rouge">&lt;class&gt; </code>å…ƒç´ çš„ select-before-update è®¾ä¸º true. è¯¥å±æ€§çš„é»˜è®¤å€¼ä¸º false</li>
  <li>å½“ update() æ–¹æ³•å…³è”ä¸€ä¸ªæ¸¸ç¦»å¯¹è±¡æ—¶, å¦‚æœåœ¨ Session çš„ç¼“å­˜ä¸­å·²ç»å­˜åœ¨ç›¸åŒ
OID çš„æŒä¹…åŒ–å¯¹è±¡, ä¼šæŠ›å‡ºå¼‚å¸¸</li>
  <li>å½“ update() æ–¹æ³•å…³è”ä¸€ä¸ªæ¸¸ç¦»å¯¹è±¡æ—¶, å¦‚æœåœ¨æ•°æ®åº“ä¸­ä¸å­˜åœ¨ç›¸åº”çš„è®°å½•, ä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸</li>
</ul>

<h4 id="saveorupdate">saveOrUpdate</h4>

<ul>
  <li>Session çš„ saveOrUpdate() æ–¹æ³•åŒæ—¶åŒ…å«äº† save() ä¸ update() æ–¹æ³•çš„åŠŸèƒ½</li>
</ul>

<h4 id="delete">delete</h4>

<ul>
  <li>Session çš„ delete() æ–¹æ³•æ—¢å¯ä»¥åˆ é™¤ä¸€ä¸ªæ¸¸ç¦»å¯¹è±¡, ä¹Ÿå¯ä»¥åˆ é™¤ä¸€ä¸ªæŒä¹…åŒ–å¯¹è±¡</li>
  <li>è®¡åˆ’æ‰§è¡Œä¸€æ¡ delete è¯­å¥</li>
  <li>æŠŠå¯¹è±¡ä» Session ç¼“å­˜ä¸­åˆ é™¤, è¯¥å¯¹è±¡è¿›å…¥åˆ é™¤çŠ¶æ€</li>
  <li>Hibernate çš„ cfg.xml é…ç½®æ–‡ä»¶ä¸­æœ‰ä¸€ä¸ª <strong>hibernate.use_identifier_rollback</strong> å±æ€§, å…¶é»˜è®¤å€¼ä¸º false, è‹¥æŠŠå®ƒè®¾ä¸º true, å°†æ”¹å˜ delete() æ–¹æ³•çš„è¿è¡Œè¡Œä¸º: delete() æ–¹æ³•ä¼šæŠŠæŒä¹…åŒ–å¯¹è±¡æˆ–æ¸¸ç¦»å¯¹è±¡çš„ OID è®¾ç½®ä¸º null, ä½¿å®ƒä»¬å˜ä¸ºä¸´æ—¶å¯¹è±¡</li>
</ul>

<h3 id="queryæ¥å£">Queryæ¥å£</h3>

<ul>
  <li>queryæ¥å£æ˜¯hibernateçš„æŸ¥è¯¢æ¥å£ï¼Œç”¨äºå‘æ•°æ®åº“ä¸­æŸ¥è¯¢å¯¹è±¡ï¼Œå¹¶æ§åˆ¶æ‰§è¡ŒæŸ¥è¯¢çš„è¿‡ç¨‹ã€‚</li>
  <li>queryä¸­åŒ…è£…äº†ä¸€ä¸ªHQLæŸ¥è¯¢è¯­å¥</li>
</ul>

<h4 id="ä½¿ç”¨æ­¥éª¤">ä½¿ç”¨æ­¥éª¤</h4>

<ul>
  <li>é€šè¿‡sessionå®ä¾‹çš„createQueryæ–¹æ³•åˆ›å»ºä¸€ä¸ªqueryå®ä¾‹</li>
  <li>è®¾ç½®åŠ¨æ€å‚æ•°ï¼Œä½¿ç”¨setteræ–¹æ³•</li>
  <li>æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</li>
</ul>

<h4 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•</h4>

<ul>
  <li><strong>setteræ–¹æ³•</strong>ï¼šè®¾ç½®æŸ¥è¯¢è¯­å¥ä¸­çš„å‚æ•°ï¼Œé’ˆå¯¹ä¸åŒçš„æ•°æ®ç±»å‹éœ€è¦ç”¨åˆ°ä¸åŒçš„setteræ–¹æ³•</li>
  <li><strong>listæ–¹æ³•</strong>ï¼šç”¨äºæ‰§è¡ŒæŸ¥è¯¢è¯­å¥ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœä»¥listçš„å½¢å¼è¿”å›</li>
  <li><strong>iteratoræ–¹æ³•</strong>ï¼šç”¨äºæŸ¥è¯¢è¯­å¥ï¼Œè¿”å›ç»“æœæ˜¯ä¸€ä¸ªiteratorå¯¹è±¡ï¼Œåœ¨è¯»å–æ—¶åªèƒ½æŒ‰ç…§é¡ºåºæ–¹å¼è¯»å–</li>
  <li><strong>uniqueResultæ–¹æ³•</strong>ï¼šç”¨äºè¿”å›å”¯ä¸€çš„ç»“æœï¼Œåœ¨ç¡®ä¿æœ€å¤šåªæœ‰ä¸€æ¡è®°å½•çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨è¯¥æ–¹æ³•ã€‚è¿”å›çš„ç»“æœå¯ä»¥ç›´æ¥è½¬æ¢ä¸ºç›¸åº”çš„å¯¹è±¡</li>
  <li><strong>executeUpdateæ–¹æ³•</strong>ï¼šæ”¯æŒHQLè¯­å¥çš„æ›´æ–°å’Œåˆ é™¤æ“ä½œï¼Œå»ºè®®æ›´æ–°æ—¶é‡‡ç”¨æ­¤æ–¹æ³•</li>
  <li><strong>setFirstResultæ–¹æ³•</strong>ï¼šå¯ä»¥è®¾ç½®æ‰€è·å¾—çš„ç¬¬ä¸€æ¡è®°å½•çš„ä½ç½®ï¼Œä»0å¼€å§‹è®¡ç®—ï¼Œç”¨äºç­›é€‰é€‰å–è®°å½•çš„èŒƒå›´ã€‚</li>
  <li><strong>setMaxResultsæ–¹æ³•</strong>ï¼šè®¾ç½®ç»“æœé›†çš„æœ€å¤§è®°å½•æ•°ï¼Œå¯ä»¥å’ŒsetFirstResultç»“åˆä½¿ç”¨ï¼Œé™åˆ¶ç»“æœé›†çš„èŒƒå›´ï¼Œå®ç°åˆ†é¡µåŠŸèƒ½</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Query</span> <span class="n">query</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">"from User"</span><span class="o">);</span>
<span class="kt">int</span> <span class="n">currentPage</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
<span class="kt">int</span> <span class="n">pageSize</span><span class="o">=</span><span class="mi">10</span><span class="o">;</span>
<span class="n">query</span><span class="o">.</span><span class="na">setFirstResult</span><span class="o">(</span> <span class="o">(</span><span class="n">currentPage</span><span class="o">-</span><span class="mi">1</span><span class="o">)*</span><span class="n">pageSize</span><span class="o">);</span>
<span class="n">query</span><span class="o">.</span><span class="na">setMaxResults</span><span class="o">(</span><span class="n">pageSize</span><span class="o">);</span>
<span class="nc">List</span> <span class="nc">Users</span><span class="o">=</span><span class="n">query</span><span class="o">.</span><span class="na">list</span><span class="o">();</span>
<span class="n">session</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</code></pre></div></div>

<h3 id="criteriaæ¥å£">Criteriaæ¥å£</h3>

<ul>
  <li>ä¹Ÿæ˜¯æŸ¥è¯¢æ¥å£ï¼Œå®ƒå…è®¸åˆ›å»ºå¹¶æ‰§è¡Œé¢å‘å¯¹è±¡æ–¹å¼çš„æŸ¥è¯¢</li>
  <li>æ›´æ“…é•¿æ‰§è¡ŒåŠ¨æ€æŸ¥è¯¢</li>
</ul>

<h4 id="å¸¸ç”¨ç±»">å¸¸ç”¨ç±»</h4>

<ul>
  <li>Criteriaï¼šè¡¨ç¤ºä¸€æ¬¡æŸ¥è¯¢</li>
  <li>Criterionï¼šè¡¨ç¤ºä¸€ä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡Restrictionså·¥å…·ç±»æ¥åˆ›å»º</li>
  <li>Restrictionï¼šè¡¨ç¤ºæŸ¥è¯¢æ¡ä»¶çš„å·¥å…·ç±»ã€‚æä¾›äº†å¤§é‡çš„é™æ€æ–¹æ³•ï¼Œå¦‚eqï¼ˆç­‰äºï¼‰ã€geï¼ˆå¤§äºç­‰äºï¼‰ã€between</li>
</ul>

<h4 id="ä½¿ç”¨æ­¥éª¤-1">ä½¿ç”¨æ­¥éª¤</h4>

<ul>
  <li>åˆ©ç”¨sessionå®ä¾‹çš„createCriteriaæ–¹æ³•åˆ›å»ºä¸€ä¸ªå®ä¾‹</li>
  <li>è®¾å®šæŸ¥è¯¢æ¡ä»¶ï¼Œé€šè¿‡Expressionç±»æˆ–Restrictionsç±»åˆ›å»ºæŸ¥è¯¢æ¡ä»¶çš„å®ä¾‹ï¼Œå³Criterionå®ä¾‹</li>
  <li>è°ƒç”¨Criteriaçš„listï¼ˆï¼‰æ–¹æ³•æ¥æ‰§è¡ŒæŸ¥è¯¢è¯­å¥</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">users</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="nc">Restrictions</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span><span class="s">"jack"</span><span class="o">)).</span><span class="na">list</span><span class="o">();</span>
<span class="cm">/*
åœ¨è¿è¡Œæ—¶ï¼Œè½¬åŒ–ä¸ºï¼š
select * from user where name="jack";
*/</span>
</code></pre></div></div>

<h4 id="å¸¸ç”¨æ–¹æ³•-1">å¸¸ç”¨æ–¹æ³•</h4>

<ul>
  <li>addæ–¹æ³•ï¼šè®¾ç½®æŸ¥è¯¢æ¡ä»¶ï¼Œå¯ä»¥è¿½åŠ ä»»æ„ä¸ªaddæ–¹æ³•</li>
  <li>addOrderæ–¹æ³•ï¼šè®¾ç½®æŸ¥è¯¢ç»“æœé›†çš„æ’åºè§„åˆ™ï¼Œç›¸å½“äºsqlçš„order byè¯­å¥ï¼Œå‚æ•°ä¸ºOrderç±»çš„å®ä¾‹</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">users</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Restrictions</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span><span class="s">"jack"</span><span class="o">))</span>
	<span class="o">.</span><span class="na">addOrder</span><span class="o">(</span><span class="nc">Order</span><span class="o">.</span><span class="na">asc</span><span class="o">(</span><span class="s">"name"</span><span class="o">))</span>
	<span class="o">.</span><span class="na">list</span><span class="o">();</span>
</code></pre></div></div>

<ul>
  <li>createCriteriaæ–¹æ³•ï¼šæä¾›äº†å¯¹å¤šè¡¨æŸ¥è¯¢çš„æ–¹æ³•</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">users</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Restrictions</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span><span class="s">"jack"</span><span class="o">))</span>
	<span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="s">"role"</span><span class="o">)</span>
	<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Restrictions</span><span class="o">.</span><span class="na">eq</span><span class="o">(</span><span class="s">"rolename"</span><span class="o">,</span><span class="s">"admin"</span><span class="o">))</span>
	<span class="o">.</span><span class="na">list</span><span class="o">();</span>
<span class="cm">/*
select * from user,role where name="jack" and rolename="admin"
*/</span>
</code></pre></div></div>

<ul>
  <li>listæ–¹æ³•ï¼šæ‰§è¡Œæ•°æ®æŸ¥è¯¢ï¼Œå¹¶å°†æŸ¥è¯¢ç»“æœè¿”å›</li>
  <li>scrollæ–¹æ³•ï¼šä¸listæ–¹æ³•ç±»ä¼¼ï¼Œå°†ç»“æœé›†ä»¥ScrollableResultsç±»å‹è¿”å›</li>
  <li>setFetchModelæ–¹æ³•ï¼šè®¾ç½®æŠ“å–ç­–ç•¥</li>
  <li>setFetchSizeæ–¹æ³•ï¼šæŒ‡å®šä¸€æ¬¡ä»æ•°æ®åº“ä¸­æå–æ•°æ®çš„æ•°é‡å¤§å°ï¼Œé€šè¿‡è°ƒç”¨Statement.setFetchSize()æ–¹æ³•å®ç°</li>
  <li>setMaxResultsæ–¹æ³•ï¼šç”¨äºè®¾ç½®ä»æ•°æ®åº“ä¸­å–å¾—è®°å½•çš„æœ€å¤§è¡Œæ•°ï¼Œå®ç°åˆ†é¡µåŠŸèƒ½æ—¶å°†æ¯é¡µæ˜¾ç¤ºæ•°æ®çš„æ•°ç›®ä½œä¸ºå‚æ•°ä¼ å…¥è¯¥æ–¹æ³•å³å¯</li>
  <li>setFirstResultæ–¹æ³•ï¼šè®¾ç½®æ‰€è·å–å¸¦çš„ç¬¬ä¸€ä¸ªè®°å½•çš„ä½ç½®ï¼Œä»0å¼€å§‹ï¼Œç”¨äºåˆ†é¡µæŸ¥è¯¢</li>
  <li>setProjectionæ–¹æ³•ï¼šä¸»å®Œæˆä¸€äº›èšåˆæŸ¥è¯¢å’Œåˆ†ç»„æŸ¥è¯¢ã€‚</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">List</span> <span class="n">users</span><span class="o">=</span><span class="n">session</span><span class="o">.</span><span class="na">createCriteria</span><span class="o">(</span><span class="nc">User</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
	<span class="o">.</span><span class="na">setProjection</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">projectionList</span><span class="o">()</span>
		<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">rowCount</span><span class="o">())</span>
		<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">avg</span><span class="o">(</span><span class="s">"age"</span><span class="o">))</span>
		<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="s">"age"</span><span class="o">))</span>
		<span class="o">.</span><span class="na">ad</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">min</span><span class="o">(</span><span class="s">"age"</span><span class="o">))</span>
		<span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="nc">Projections</span><span class="o">.</span><span class="na">groupProperty</span><span class="o">(</span><span class="s">"sex"</span><span class="o">))</span>
	<span class="o">).</span><span class="na">list</span><span class="o">();</span>
	
<span class="cm">/*
select sex,count(*),avg(age),max(age),min(age) from user group by sex
*/</span>
</code></pre></div></div>

<ul>
  <li>uniqueResultæ–¹æ³•ï¼šå¯ä»¥å¾—åˆ°å”¯ä¸€çš„æŸ¥è¯¢ç»“æœï¼Œè¯¥ç»“æœä¸ºä¸€ä¸ªå¯¹è±¡</li>
</ul>

<h3 id="transaction">Transaction</h3>

<ul>
  <li>ä»£è¡¨ä¸€æ¬¡åŸå­æ“ä½œï¼Œå®ƒå…·æœ‰æ•°æ®åº“äº‹åŠ¡çš„æ¦‚å¿µ</li>
  <li>æ‰€æœ‰æŒä¹…å±‚éƒ½åº”è¯¥åœ¨äº‹åŠ¡ç®¡ç†ä¸‹è¿›è¡Œï¼Œå³ä½¿æ˜¯åªè¯»æ“ä½œ</li>
  <li><code class="language-plaintext highlighter-rouge">Transaction tx = session.beginTransaction();</code></li>
</ul>

<h4 id="æ–¹æ³•-1">æ–¹æ³•</h4>

<ul>
  <li>commit():æäº¤ç›¸å…³è”çš„sessionå®ä¾‹</li>
  <li>rollback():æ’¤é”€äº‹åŠ¡æ“ä½œ</li>
  <li>wasCommitted():æ£€æŸ¥äº‹åŠ¡æ˜¯å¦æäº¤</li>
</ul>
:ET