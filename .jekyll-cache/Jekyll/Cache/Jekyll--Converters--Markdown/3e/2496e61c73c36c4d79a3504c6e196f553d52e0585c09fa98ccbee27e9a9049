I"Îİ<ul id="markdown-toc">
  <li><a href="#æ•°æ®è¡¨" id="markdown-toc-æ•°æ®è¡¨">æ•°æ®è¡¨</a>    <ul>
      <li><a href="#éƒ¨é—¨è¡¨" id="markdown-toc-éƒ¨é—¨è¡¨">éƒ¨é—¨è¡¨</a></li>
      <li><a href="#è§’è‰²è¡¨" id="markdown-toc-è§’è‰²è¡¨">è§’è‰²è¡¨</a></li>
      <li><a href="#ç”¨æˆ·è¡¨" id="markdown-toc-ç”¨æˆ·è¡¨">ç”¨æˆ·è¡¨</a></li>
      <li><a href="#æƒé™æ¨¡å—è¡¨" id="markdown-toc-æƒé™æ¨¡å—è¡¨">æƒé™æ¨¡å—è¡¨</a></li>
      <li><a href="#æƒé™è¡¨" id="markdown-toc-æƒé™è¡¨">æƒé™è¡¨</a></li>
      <li><a href="#è§’è‰²æƒé™è¡¨" id="markdown-toc-è§’è‰²æƒé™è¡¨">è§’è‰²æƒé™è¡¨</a></li>
      <li><a href="#è§’è‰²ç”¨æˆ·è¡¨" id="markdown-toc-è§’è‰²ç”¨æˆ·è¡¨">è§’è‰²ç”¨æˆ·è¡¨</a></li>
      <li><a href="#æ—¥å¿—è¡¨" id="markdown-toc-æ—¥å¿—è¡¨">æ—¥å¿—è¡¨</a></li>
    </ul>
  </li>
  <li><a href="#é¡¹ç›®åˆå§‹åŒ–" id="markdown-toc-é¡¹ç›®åˆå§‹åŒ–">é¡¹ç›®åˆå§‹åŒ–</a>    <ul>
      <li><a href="#pomxml" id="markdown-toc-pomxml">pom.xml</a></li>
      <li><a href="#webxml" id="markdown-toc-webxml">web.xml</a></li>
      <li><a href="#applicationcontextxml" id="markdown-toc-applicationcontextxml">applicationContext.xml</a></li>
      <li><a href="#spring-servletxml" id="markdown-toc-spring-servletxml">spring-servlet.xml</a></li>
      <li><a href="#mybatis-configxml" id="markdown-toc-mybatis-configxml">mybatis-config.xml</a></li>
      <li><a href="#logbackxml" id="markdown-toc-logbackxml">logback.xml</a></li>
      <li><a href="#settingsproperties" id="markdown-toc-settingsproperties">settings.properties</a></li>
    </ul>
  </li>
  <li><a href="#è¾…åŠ©å·¥å…·ç±»å¼€å‘" id="markdown-toc-è¾…åŠ©å·¥å…·ç±»å¼€å‘">è¾…åŠ©å·¥å…·ç±»å¼€å‘</a>    <ul>
      <li><a href="#è¿”å›é€šç”¨jsonå¯¹è±¡" id="markdown-toc-è¿”å›é€šç”¨jsonå¯¹è±¡">è¿”å›é€šç”¨jsonå¯¹è±¡</a></li>
      <li><a href="#å…¨å±€å¼‚å¸¸ç±»å¤„ç†" id="markdown-toc-å…¨å±€å¼‚å¸¸ç±»å¤„ç†">å…¨å±€å¼‚å¸¸ç±»å¤„ç†</a></li>
      <li><a href="#å‚æ•°æ ¡éªŒå·¥å…·-validator" id="markdown-toc-å‚æ•°æ ¡éªŒå·¥å…·-validator">å‚æ•°æ ¡éªŒå·¥å…·-validator</a></li>
      <li><a href="#å¯¹è±¡ä¸jsonäº’è½¬å·¥å…·" id="markdown-toc-å¯¹è±¡ä¸jsonäº’è½¬å·¥å…·">å¯¹è±¡ä¸jsonäº’è½¬å·¥å…·</a></li>
      <li><a href="#springä¸Šä¸‹æ–‡è·å–å·¥å…·" id="markdown-toc-springä¸Šä¸‹æ–‡è·å–å·¥å…·">springä¸Šä¸‹æ–‡è·å–å·¥å…·</a></li>
      <li><a href="#httpè¯·æ±‚å‰åç›‘å¬å·¥å…·" id="markdown-toc-httpè¯·æ±‚å‰åç›‘å¬å·¥å…·">HTTPè¯·æ±‚å‰åç›‘å¬å·¥å…·</a></li>
      <li><a href="#ç”¨æˆ·å’Œè¯·æ±‚çº¿ç¨‹å·¥å…·ç±»" id="markdown-toc-ç”¨æˆ·å’Œè¯·æ±‚çº¿ç¨‹å·¥å…·ç±»">ç”¨æˆ·å’Œè¯·æ±‚çº¿ç¨‹å·¥å…·ç±»</a></li>
      <li><a href="#ç™»å½•æ‹¦æˆªå™¨" id="markdown-toc-ç™»å½•æ‹¦æˆªå™¨">ç™»å½•æ‹¦æˆªå™¨</a></li>
      <li><a href="#ipè·å–å·¥å…·ç±»" id="markdown-toc-ipè·å–å·¥å…·ç±»">IPè·å–å·¥å…·ç±»</a></li>
      <li><a href="#é‚®ä»¶å‘é€å·¥å…·ç±»" id="markdown-toc-é‚®ä»¶å‘é€å·¥å…·ç±»">é‚®ä»¶å‘é€å·¥å…·ç±»</a></li>
      <li><a href="#md5å¯†ç åŠ å¯†å·¥å…·" id="markdown-toc-md5å¯†ç åŠ å¯†å·¥å…·">MD5å¯†ç åŠ å¯†å·¥å…·</a></li>
      <li><a href="#éšæœºç”Ÿæˆå¯†ç å·¥å…·ç±»" id="markdown-toc-éšæœºç”Ÿæˆå¯†ç å·¥å…·ç±»">éšæœºç”Ÿæˆå¯†ç å·¥å…·ç±»</a></li>
      <li><a href="#æƒé™æ‹¦æˆªå™¨" id="markdown-toc-æƒé™æ‹¦æˆªå™¨">æƒé™æ‹¦æˆªå™¨</a></li>
      <li><a href="#redisç¼“å­˜" id="markdown-toc-redisç¼“å­˜">Redisç¼“å­˜</a></li>
    </ul>
  </li>
</ul>
<h3 id="æ•°æ®è¡¨">æ•°æ®è¡¨</h3>

<h4 id="éƒ¨é—¨è¡¨">éƒ¨é—¨è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/bumen.png" alt="" /></p>

<h4 id="è§’è‰²è¡¨">è§’è‰²è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/juese.png" alt="" /></p>

<h4 id="ç”¨æˆ·è¡¨">ç”¨æˆ·è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/yonghu.png" alt="" /></p>

<h4 id="æƒé™æ¨¡å—è¡¨">æƒé™æ¨¡å—è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/quanxianmokuai.png" alt="" /></p>

<h4 id="æƒé™è¡¨">æƒé™è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/quanxian.png" alt="" /></p>

<h4 id="è§’è‰²æƒé™è¡¨">è§’è‰²æƒé™è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/juesequanxian.png" alt="" /></p>

<h4 id="è§’è‰²ç”¨æˆ·è¡¨">è§’è‰²ç”¨æˆ·è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/jueseyonghu.png" alt="" /></p>

<h4 id="æ—¥å¿—è¡¨">æ—¥å¿—è¡¨</h4>

<p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/rbac/rizhi.png" alt="" /></p>

<h3 id="é¡¹ç›®åˆå§‹åŒ–">é¡¹ç›®åˆå§‹åŒ–</h3>

<h4 id="pomxml">pom.xml</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
	<span class="nt">&lt;groupId&gt;</span>com.qinfen<span class="nt">&lt;/groupId&gt;</span>
	<span class="nt">&lt;artifactId&gt;</span>permission<span class="nt">&lt;/artifactId&gt;</span>
	<span class="nt">&lt;packaging&gt;</span>war<span class="nt">&lt;/packaging&gt;</span>
	<span class="nt">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
	<span class="nt">&lt;name&gt;</span>permission Maven Webapp<span class="nt">&lt;/name&gt;</span>
	<span class="nt">&lt;url&gt;</span>http://maven.apache.org<span class="nt">&lt;/url&gt;</span>

	<span class="nt">&lt;properties&gt;</span>
		<span class="nt">&lt;springframework.version&gt;</span>4.3.10.RELEASE<span class="nt">&lt;/springframework.version&gt;</span>
	<span class="nt">&lt;/properties&gt;</span>
	<span class="nt">&lt;dependencies&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>javax.servlet<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>javax.servlet-api<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>4.0.0-b07<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-beans<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${springframework.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${springframework.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!--springmvc+springweb --&gt;</span>

		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-web<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${springframework.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${springframework.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-beans --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-jdbc<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${springframework.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- mybatis --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mybatis<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.4.0<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.mybatis<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mybatis-spring<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.3.0<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- druidæ•°æ®æº --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.0.20<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- mysql --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>5.1.30<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- lombok --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.16.12<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- Jackson --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>com.fasterxml.jackson.datatype<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>jackson-datatype-guava<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.5.3<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- logback --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>logback-core<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.1.8<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>ch.qos.logback<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>logback-classic<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.1.8<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.slf4j<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>slf4j-api<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.7.22<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- jsp api --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.tomcat<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>jsp-api<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>6.0.36<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- validator --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>javax.validation<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>validation-api<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.1.0.Final<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.hibernate<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>hibernate-validator<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>5.2.4.Final<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- tools --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>commons-collections<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-collections<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.2.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>commons-codec<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-codec<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.10<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- jackson --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.codehaus.jackson<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>jackson-core-asl<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.9.13<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.codehaus.jackson<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>jackson-mapper-asl<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.9.13<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-lang3<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.5<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- email --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.commons<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>commons-email<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>1.4<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="c">&lt;!-- redis --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>redis.clients<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>jedis<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.8.1<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;type&gt;</span>jar<span class="nt">&lt;/type&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;/dependencies&gt;</span>
	<span class="nt">&lt;build&gt;</span>
		<span class="nt">&lt;finalName&gt;</span>permission<span class="nt">&lt;/finalName&gt;</span>
	<span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>

</code></pre></div></div>

<h4 id="webxml">web.xml</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> <span class="na">xmlns:web=</span><span class="s">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span> <span class="na">id=</span><span class="s">"WebApp_ID"</span> <span class="na">version=</span><span class="s">"2.5"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;display-name&gt;</span>Archetype Created Web Application<span class="nt">&lt;/display-name&gt;</span>
  <span class="c">&lt;!--springä¸Šä¸‹æ–‡ç›‘å¬å™¨  --&gt;</span>
  <span class="nt">&lt;listener&gt;</span>
  	<span class="nt">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="nt">&lt;/listener-class&gt;</span>
  <span class="nt">&lt;/listener&gt;</span>
  
  <span class="c">&lt;!-- Spring beans é…ç½®æ–‡ä»¶æ‰€åœ¨ç›®å½• --&gt;</span>
  <span class="nt">&lt;context-param&gt;</span>
    <span class="nt">&lt;param-name&gt;</span>contextConfigLocation<span class="nt">&lt;/param-name&gt;</span>
    <span class="nt">&lt;param-value&gt;</span>classpath:applicationContext.xml<span class="nt">&lt;/param-value&gt;</span>
  <span class="nt">&lt;/context-param&gt;</span>
  
  <span class="c">&lt;!-- spring mvc é…ç½® --&gt;</span>
  <span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>spring<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
  <span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>spring<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/servlet-mapping&gt;</span>
  
  <span class="c">&lt;!-- Encodingç¼–ç è¿‡æ»¤å™¨ --&gt;</span>
  <span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>encodingFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>encoding<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>UTF-8<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
    	<span class="c">&lt;!--å¼ºåˆ¶ç¼–ç   --&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>forceEncoding<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
  <span class="nt">&lt;/filter&gt;</span>
  <span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>encodingFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span><span class="c">&lt;!--æ‹¦æˆªæ‰€æœ‰ï¼ŒåŒ…æ‹¬*.js  --&gt;</span>
  <span class="nt">&lt;/filter-mapping&gt;</span>
  
   <span class="c">&lt;!-- druid --&gt;</span>
  <span class="nt">&lt;servlet&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>DruidStatServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;servlet-class&gt;</span>com.alibaba.druid.support.http.StatViewServlet<span class="nt">&lt;/servlet-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>loginUsername<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>druid<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>loginPassword<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>druid<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
  <span class="nt">&lt;/servlet&gt;</span>
  <span class="nt">&lt;servlet-mapping&gt;</span>
    <span class="nt">&lt;servlet-name&gt;</span>DruidStatServlet<span class="nt">&lt;/servlet-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/sys/druid/*<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/servlet-mapping&gt;</span>
  <span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>DruidWebStatFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>com.alibaba.druid.support.http.WebStatFilter<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>exclusions<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>*.js,*.css,*.jpg,*.png,*.ico,*.gif,/sys/druid/*<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
  <span class="nt">&lt;/filter&gt;</span>
  <span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>DruidWebStatFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/filter-mapping&gt;</span>
<span class="c">&lt;!--ç™»å½•è¿‡æ»¤å™¨  --&gt;</span>
  <span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>loginFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>com.mmall.filter.LoginFilter<span class="nt">&lt;/filter-class&gt;</span>
  <span class="nt">&lt;/filter&gt;</span>
  
  <span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>loginFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/sys/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/admin/*<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/filter-mapping&gt;</span>
<span class="c">&lt;!--æƒé™è¿‡æ»¤å™¨ï¼Œè¦å†™åœ¨ç™»å½•è¿‡æ»¤å™¨ä¹‹åï¼Œå¹¶ä¸”å°äºç­‰äºç™»å½•æ‹¦æˆªçš„å€¼  --&gt;</span>
  <span class="nt">&lt;filter&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>aclControlFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;filter-class&gt;</span>com.mmall.filter.AclControlFilter<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>targetFilterLifecycle<span class="nt">&lt;/param-name&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>true<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
    <span class="nt">&lt;init-param&gt;</span>
      <span class="nt">&lt;param-name&gt;</span>exclusionUrls<span class="nt">&lt;/param-name&gt;</span><span class="c">&lt;!--ç™½åå•  --&gt;</span>
      <span class="nt">&lt;param-value&gt;</span>/sys/user/noAuth.page,/login.page<span class="nt">&lt;/param-value&gt;</span>
    <span class="nt">&lt;/init-param&gt;</span>
  <span class="nt">&lt;/filter&gt;</span>
  <span class="nt">&lt;filter-mapping&gt;</span>
    <span class="nt">&lt;filter-name&gt;</span>aclControlFilter<span class="nt">&lt;/filter-name&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/sys/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;url-pattern&gt;</span>/admin/*<span class="nt">&lt;/url-pattern&gt;</span>
  <span class="nt">&lt;/filter-mapping&gt;</span>

  <span class="nt">&lt;welcome-file-list&gt;</span>
    <span class="nt">&lt;welcome-file&gt;</span>signin.jsp<span class="nt">&lt;/welcome-file&gt;</span>
  <span class="nt">&lt;/welcome-file-list&gt;</span>
  
<span class="nt">&lt;/web-app&gt;</span>

</code></pre></div></div>

<h4 id="applicationcontextxml">applicationContext.xml</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:tx=</span><span class="s">"http://www.springframework.org/schema/tx"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.alibaba.com/schema/stat http://www.alibaba.com/schema/stat.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd"</span><span class="nt">&gt;</span>
    <span class="c">&lt;!--è¯»å–æ•°æ®åº“æ–‡ä»¶  --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"propertyConfigurer"</span> <span class="na">class=</span><span class="s">"org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"ignoreUnresolvablePlaceholders"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"locations"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;value&gt;</span>classpath:settings.properties<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!--é…ç½®Redis  --&gt;</span>
    <span class="nt">&lt;import</span> <span class="na">resource=</span><span class="s">"redis.xml"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--é…ç½®æ•°æ®æº  --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"dataSource"</span> <span class="na">class=</span><span class="s">"com.alibaba.druid.pool.DruidDataSource"</span> <span class="na">init-method=</span><span class="s">"init"</span> <span class="na">destroy-method=</span><span class="s">"close"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"${db.driverClassName}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"${db.url}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"${db.username}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"${db.password}"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"initialSize"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"minIdle"</span> <span class="na">value=</span><span class="s">"3"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxActive"</span> <span class="na">value=</span><span class="s">"20"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"maxWait"</span> <span class="na">value=</span><span class="s">"60000"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"filters"</span> <span class="na">value=</span><span class="s">"stat,wall"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!--mybatisä¼šè¯å·¥å‚  --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"sqlSessionFactory"</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.SqlSessionFactoryBean"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"configLocation"</span> <span class="na">value=</span><span class="s">"classpath:mybatis-config.xml"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mapperLocations"</span> <span class="na">value=</span><span class="s">"classpath:mapper/*.xml"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!--mybatisæ¥å£é…ç½®  --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"basePackage"</span> <span class="na">value=</span><span class="s">"com.mmall.dao"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sqlSessionFactoryBeanName"</span> <span class="na">value=</span><span class="s">"sqlSessionFactory"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="c">&lt;!-- txäº‹åŠ¡ç®¡ç† --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"transactionManager"</span> <span class="na">class=</span><span class="s">"org.springframework.jdbc.datasource.DataSourceTransactionManager"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"dataSource"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;tx:annotation-driven</span> <span class="na">transaction-manager=</span><span class="s">"transactionManager"</span> <span class="nt">/&gt;</span>

    <span class="c">&lt;!-- druidï¼Œå¯¹åº”æ•°æ®æºé…ç½®çš„filters --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"stat-filter"</span> <span class="na">class=</span><span class="s">"com.alibaba.druid.filter.stat.StatFilter"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"slowSqlMillis"</span> <span class="na">value=</span><span class="s">"3000"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"logSlowSql"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"mergeSql"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"wall-filter"</span> <span class="na">class=</span><span class="s">"com.alibaba.druid.wall.WallFilter"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dbType"</span> <span class="na">value=</span><span class="s">"mysql"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>

<h4 id="spring-servletxml">spring-servlet.xml</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
	<span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"</span><span class="nt">&gt;</span>

	<span class="c">&lt;!--springç®¡ç†æ³¨è§£ --&gt;</span>
	<span class="nt">&lt;context:annotation-config</span> <span class="nt">/&gt;</span>

	<span class="c">&lt;!-- å¯åŠ¨æ³¨è§£é©±åŠ¨çš„spring mvc åŠŸèƒ½ --&gt;</span>
	<span class="nt">&lt;mvc:annotation-driven</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--Httpè¯·æ±‚å‰åç›‘å¬å·¥å…·è¢«springç®¡ç† --&gt;</span>
	<span class="nt">&lt;mvc:interceptors&gt;</span>
		<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mmall.common.HttpInterceptor"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/mvc:interceptors&gt;</span>
	<span class="c">&lt;!-- å¯åŠ¨åŒ…æ‰«æåŠŸèƒ½ --&gt;</span>
	<span class="nt">&lt;context:component-scan</span>
		<span class="na">base-package=</span><span class="s">"com.mmall.controller"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;context:component-scan</span>
		<span class="na">base-package=</span><span class="s">"com.mmall.service"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--å…è®¸è®¿é—®é™æ€èµ„æº  --&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/js/"</span> <span class="na">mapping=</span><span class="s">"/js/**"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/css/"</span> <span class="na">mapping=</span><span class="s">"/css/**"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/bootstrap3.3.5/"</span>
		<span class="na">mapping=</span><span class="s">"/bootstrap3.3.5/**"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/assets/"</span> <span class="na">mapping=</span><span class="s">"/assets/**"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/ztree/"</span> <span class="na">mapping=</span><span class="s">"/ztree/**"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--è·å–springä¸Šä¸‹æ–‡å·¥å…·è¢«springç®¡ç†ï¼Œä¸ä½¿ç”¨æ‡’åŠ è½½ï¼Œé¡¹ç›®å¯åŠ¨å°±è¿è¡Œ --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mmall.common.ApplicationContextHelper"</span>
		<span class="na">lazy-init=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>

	<span class="c">&lt;!--&lt;bean class="org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping" 
		/&gt; --&gt;</span>
	<span class="c">&lt;!--åœ¨springä¸­æ³¨å†Œå…¨å±€å¼‚å¸¸å¤„ç†ç±» --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"com.mmall.common.SpringExceptionResolver"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--ä¿¡æ¯è¿”å›å½¢å¼ï¼Œå¦‚json --&gt;</span>
	<span class="nt">&lt;bean</span>
		<span class="na">class=</span><span class="s">"org.springframework.web.servlet.view.BeanNameViewResolver"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--jsonå¤„ç†ç±»ï¼Œåœ¨å…¨å±€å¼‚å¸¸å¤„ç†è¿”å›ç»“æœçš„æ—¶å€™ç”¨åˆ° --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jsonView"</span>
		<span class="na">class=</span><span class="s">"org.springframework.web.servlet.view.json.MappingJackson2JsonView"</span> <span class="nt">/&gt;</span>

	<span class="nt">&lt;bean</span>
		<span class="na">class=</span><span class="s">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"prefix"</span> <span class="na">value=</span><span class="s">"/WEB-INF/views/"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"suffix"</span> <span class="na">value=</span><span class="s">".jsp"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>       
</code></pre></div></div>

<h4 id="mybatis-configxml">mybatis-config.xml</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</span>
<span class="nt">&lt;configuration&gt;</span>

    <span class="nt">&lt;settings&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">"safeRowBoundsEnabled"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">"cacheEnabled"</span> <span class="na">value=</span><span class="s">"false"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;setting</span> <span class="na">name=</span><span class="s">"useGeneratedKeys"</span> <span class="na">value=</span><span class="s">"true"</span> <span class="nt">/&gt;</span><span class="c">&lt;!--è‡ªåŠ¨ç”Ÿæˆä¸»é”®id  --&gt;</span>
    <span class="nt">&lt;/settings&gt;</span>

    <span class="c">&lt;!--&lt;typeAliases&gt;--&gt;</span>
        <span class="c">&lt;!----&gt;</span>
    <span class="c">&lt;!--&lt;/typeAliases&gt;--&gt;</span>

    <span class="c">&lt;!--&lt;plugins&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;plugin interceptor=""&gt;&lt;/plugin&gt;--&gt;</span>
    <span class="c">&lt;!--&lt;/plugins&gt;--&gt;</span>

    <span class="c">&lt;!--&lt;typeHandlers&gt;--&gt;</span>
        <span class="c">&lt;!----&gt;</span>
    <span class="c">&lt;!--&lt;/typeHandlers&gt;--&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>

<h4 id="logbackxml">logback.xml</h4>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;configuration</span> <span class="na">scan=</span><span class="s">"true"</span> <span class="na">scanPeriod=</span><span class="s">"60 seconds"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"STDOUT"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.ConsoleAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;encoder&gt;</span>
            <span class="nt">&lt;pattern&gt;</span>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n<span class="nt">&lt;/pattern&gt;</span>
        <span class="nt">&lt;/encoder&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="c">&lt;!--&lt;appender name="permission" class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;file&gt;${catalina.home}/logs/permission.log&lt;/file&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;--&gt;</span>
            <span class="c">&lt;!--&lt;FileNamePattern&gt;${catalina.home}/logs/permission.%d{yyyy-MM-dd}.log.gz&lt;/FileNamePattern&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;/rollingPolicy&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;layout class="ch.qos.logback.classic.PatternLayout"&gt;--&gt;</span>
            <span class="c">&lt;!--&lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger - %msg%n&lt;/pattern&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;/layout&gt;--&gt;</span>
    <span class="c">&lt;!--&lt;/appender&gt;--&gt;</span>
    <span class="c">&lt;!----&gt;</span>
    <span class="c">&lt;!--&lt;logger name="xxx" level="INFO"&gt;--&gt;</span>
        <span class="c">&lt;!--&lt;appender-ref ref="permission"/&gt;--&gt;</span>
    <span class="c">&lt;!--&lt;/logger&gt;--&gt;</span>

    <span class="c">&lt;!-- TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR --&gt;</span>
    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"INFO"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"STDOUT"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>

<span class="nt">&lt;/configuration&gt;</span>
</code></pre></div></div>

<h4 id="settingsproperties">settings.properties</h4>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">db.driverClassName</span><span class="p">=</span><span class="s">com.mysql.jdbc.Driver</span>
<span class="py">db.url</span><span class="p">=</span><span class="s">jdbc:mysql://localhost:3306/test?useUnicode=true&amp;characterEncoding=UTF-8</span>
<span class="py">db.username</span><span class="p">=</span><span class="s">root</span>
<span class="py">db.password</span><span class="p">=</span><span class="s">123456</span>
</code></pre></div></div>

<h3 id="è¾…åŠ©å·¥å…·ç±»å¼€å‘">è¾…åŠ©å·¥å…·ç±»å¼€å‘</h3>

<h4 id="è¿”å›é€šç”¨jsonå¯¹è±¡">è¿”å›é€šç”¨jsonå¯¹è±¡</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="cm">/**
 * jsonæ•°æ®è¿”å›
 * @author Administrator
 *
 */</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonData</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">ret</span><span class="o">;</span><span class="c1">//ç»“æœ</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span><span class="c1">//æ¶ˆæ¯</span>

    <span class="kd">private</span> <span class="nc">Object</span> <span class="n">data</span><span class="o">;</span><span class="c1">//æ•°æ®</span>

    <span class="kd">public</span> <span class="nf">JsonData</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">ret</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">success</span><span class="o">(</span><span class="nc">Object</span> <span class="n">object</span><span class="o">,</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonData</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">jsonData</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">success</span><span class="o">(</span><span class="nc">Object</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonData</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">object</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">jsonData</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">success</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">JsonData</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">JsonData</span> <span class="nf">fail</span><span class="o">(</span><span class="nc">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">JsonData</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">jsonData</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">jsonData</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">toMap</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;();</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ret"</span><span class="o">,</span> <span class="n">ret</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"msg"</span><span class="o">,</span> <span class="n">msg</span><span class="o">);</span>
        <span class="n">result</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"data"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="å…¨å±€å¼‚å¸¸ç±»å¤„ç†">å…¨å±€å¼‚å¸¸ç±»å¤„ç†</h4>

<ul>
  <li>å®šä¹‰ä¸€ä¸ªå…¨å±€å¼‚å¸¸å¤„ç†ç±»ï¼Œå¹¶åœ¨spring-servlet.xmlä¸­æ³¨å†Œä»–</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.exception.ParamException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.exception.PermissionException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.HandlerExceptionResolver</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="cm">/**
 * å…¨å±€å¼‚å¸¸å¤„ç†ç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SpringExceptionResolver</span> <span class="kd">implements</span> <span class="nc">HandlerExceptionResolver</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ModelAndView</span> <span class="nf">resolveException</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//è¯·æ±‚çš„URL</span>
    	<span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="c1">//å¤„ç†å®Œæˆåè¿”å›ä¸€ä¸ªè§†å›¾</span>
    	<span class="nc">ModelAndView</span> <span class="n">mv</span><span class="o">;</span>
    	<span class="c1">//å…¨å±€é»˜è®¤å¼‚å¸¸</span>
        <span class="nc">String</span> <span class="n">defaultMsg</span> <span class="o">=</span> <span class="s">"System error"</span><span class="o">;</span>

        <span class="c1">// è¿™é‡Œæˆ‘ä»¬è¦æ±‚é¡¹ç›®ä¸­æ‰€æœ‰è¯·æ±‚jsonæ•°æ®ï¼Œéƒ½ä½¿ç”¨.jsonç»“å°¾,æ¥æ”¶å‰å°æ•°æ®å…ˆæ ¡éªŒæ˜¯å¦ç¬¦åˆå®ä½“ç±»è¦æ±‚</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">))</span> <span class="o">{</span>
            <span class="c1">//å¦‚æœè¿™ä¸ªå¼‚å¸¸æ—¶æˆ‘ä»¬è‡ªå®šä¹‰çš„æƒé™å¼‚å¸¸æˆ–è€…å‚æ•°å¼‚å¸¸</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">ex</span> <span class="k">instanceof</span> <span class="nc">PermissionException</span> <span class="o">||</span> <span class="n">ex</span> <span class="k">instanceof</span> <span class="nc">ParamException</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">ex</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
                <span class="c1">//ç»“åˆspring-servlet.xmlä¸­çš„é…ç½®çš„beanå‘å‰å°è¿”å›ä¸€ä¸ªjsonæ ¼å¼çš„æ•°æ®</span>
                <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"jsonView"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="c1">//å¦åˆ™æŒ‰ç…§å…¨å±€é»˜è®¤å¼‚å¸¸å¤„ç†</span>
                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"unknown json exception, url:"</span> <span class="o">+</span> <span class="n">url</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
                <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">defaultMsg</span><span class="o">);</span>
                <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"jsonView"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
            <span class="o">}</span>
        <span class="o">}</span> <span class="k">else</span> <span class="k">if</span> <span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".page"</span><span class="o">)){</span> <span class="c1">// è¿™é‡Œæˆ‘ä»¬è¦æ±‚é¡¹ç›®ä¸­æ‰€æœ‰è¯·æ±‚pageé¡µé¢ï¼Œéƒ½ä½¿ç”¨.pageç»“å°¾</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"unknown page exception, url:"</span> <span class="o">+</span> <span class="n">url</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
            <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">defaultMsg</span><span class="o">);</span>
            <span class="c1">//è¿™é‡Œè¿”å›çš„æ˜¯ä¸€ä¸ªè§†å›¾ï¼Œä¼šå»æ‰¾exception.jsp</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"exception"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"unknow exception, url:"</span> <span class="o">+</span> <span class="n">url</span><span class="o">,</span> <span class="n">ex</span><span class="o">);</span>
            <span class="nc">JsonData</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="n">defaultMsg</span><span class="o">);</span>
            <span class="n">mv</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ModelAndView</span><span class="o">(</span><span class="s">"jsonView"</span><span class="o">,</span> <span class="n">result</span><span class="o">.</span><span class="na">toMap</span><span class="o">());</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">mv</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>è‡ªå®šä¹‰æƒé™å¼‚å¸¸ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.exception</span><span class="o">;</span>
<span class="cm">/**
 * è‡ªå®šä¹‰å¼‚å¸¸ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PermissionException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="nf">PermissionException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">writableStackTrace</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">,</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="n">writableStackTrace</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>è‡ªå®šä¹‰å‚æ•°å¼‚å¸¸ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.exception</span><span class="o">;</span>
<span class="cm">/**
 * å‚æ•°å¼‚å¸¸ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ParamException</span> <span class="kd">extends</span> <span class="nc">RuntimeException</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">Throwable</span> <span class="n">cause</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">cause</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">protected</span> <span class="nf">ParamException</span><span class="o">(</span><span class="nc">String</span> <span class="n">message</span><span class="o">,</span> <span class="nc">Throwable</span> <span class="n">cause</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">writableStackTrace</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">cause</span><span class="o">,</span> <span class="n">enableSuppression</span><span class="o">,</span> <span class="n">writableStackTrace</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="å‚æ•°æ ¡éªŒå·¥å…·-validator">å‚æ•°æ ¡éªŒå·¥å…·-validator</h4>

<ul>
  <li>å®šä¹‰æ•°æ®æ ¡éªŒç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Preconditions</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Lists</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Maps</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.exception.ParamException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.collections.MapUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.ConstraintViolation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Validation</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.Validator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.ValidatorFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Iterator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.LinkedHashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="cm">/**
 * æ•°æ®æ ¡éªŒï¼ˆå®ä½“ç±»ï¼ŒåŸºäºæ³¨è§£ï¼‰
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanValidator</span> <span class="o">{</span>
	<span class="c1">//å…¨å±€æ ¡éªŒå·¥å‚</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ValidatorFactory</span> <span class="n">validatorFactory</span> <span class="o">=</span> <span class="nc">Validation</span><span class="o">.</span><span class="na">buildDefaultValidatorFactory</span><span class="o">();</span>
    
    <span class="c1">//æ ¡éªŒæ–¹æ³•ï¼Œå•ä¸ªç±»</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">validate</span><span class="o">(</span><span class="no">T</span> <span class="n">t</span><span class="o">,</span> <span class="nc">Class</span><span class="o">...</span> <span class="n">groups</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">validatorFactory</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
        <span class="c1">//è·å–æ ¡éªŒç»“æœ</span>
        <span class="nc">Set</span> <span class="n">validateResult</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="n">t</span><span class="o">,</span> <span class="n">groups</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">validateResult</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">())</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">();</span><span class="c1">//æ²¡æœ‰é”™è¯¯ä¿¡æ¯è¿”å›ç©ºmap</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="c1">//å¦‚æœå‡ºç°äº†å¼‚å¸¸ï¼Œå°è£…å¼‚å¸¸ä¿¡æ¯</span>
            <span class="nc">LinkedHashMap</span> <span class="n">errors</span> <span class="o">=</span> <span class="nc">Maps</span><span class="o">.</span><span class="na">newLinkedHashMap</span><span class="o">();</span>
            <span class="nc">Iterator</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">validateResult</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
            <span class="k">while</span> <span class="o">(</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
                <span class="nc">ConstraintViolation</span> <span class="n">violation</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ConstraintViolation</span><span class="o">)</span><span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
                <span class="c1">//å°è£…æœ‰é—®é¢˜çš„å­—æ®µå’Œé”™è¯¯ä¿¡æ¯</span>
                <span class="n">errors</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">violation</span><span class="o">.</span><span class="na">getPropertyPath</span><span class="o">().</span><span class="na">toString</span><span class="o">(),</span> <span class="n">violation</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">errors</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="c1">//æ ¡éªŒé›†åˆ</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">validateList</span><span class="o">(</span><span class="nc">Collection</span><span class="o">&lt;?&gt;</span> <span class="n">collection</span><span class="o">)</span> <span class="o">{</span>
    	<span class="c1">//åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºç©º</span>
        <span class="nc">Preconditions</span><span class="o">.</span><span class="na">checkNotNull</span><span class="o">(</span><span class="n">collection</span><span class="o">);</span>
        <span class="c1">//è¿­ä»£å™¨</span>
        <span class="nc">Iterator</span> <span class="n">iterator</span> <span class="o">=</span> <span class="n">collection</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="nc">Map</span> <span class="n">errors</span><span class="o">;</span>

        <span class="k">do</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">iterator</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
                <span class="k">return</span> <span class="nc">Collections</span><span class="o">.</span><span class="na">emptyMap</span><span class="o">();</span><span class="c1">//æ²¡æœ‰å€¼ï¼Œè¿”å›ç©ºé›†åˆ</span>
            <span class="o">}</span>
            <span class="nc">Object</span> <span class="n">object</span> <span class="o">=</span> <span class="n">iterator</span><span class="o">.</span><span class="na">next</span><span class="o">();</span><span class="c1">//å¦åˆ™è·å–å½“å‰æ•°æ®</span>
            <span class="n">errors</span> <span class="o">=</span> <span class="n">validate</span><span class="o">(</span><span class="n">object</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span><span class="c1">//è°ƒç”¨æ ¡éªŒå•ä¸ªæ–¹æ³•</span>
        <span class="o">}</span> <span class="k">while</span> <span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">());</span>

        <span class="k">return</span> <span class="n">errors</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="c1">//æ ¡éªŒä»»ä½•å¯¹è±¡</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="nf">validateObject</span><span class="o">(</span><span class="nc">Object</span> <span class="n">first</span><span class="o">,</span> <span class="nc">Object</span><span class="o">...</span> <span class="n">objects</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">objects</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">objects</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">validateList</span><span class="o">(</span><span class="nc">Lists</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">objects</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="nf">validate</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Class</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    
    <span class="cm">/**
     * åªåˆ¤æ–­æ˜¯å¦æœ‰å¼‚å¸¸
     * @param param
     * @throws ParamExceptionï¼ŒæŠ›å‡ºè‡ªå®šä¹‰çš„å‚æ•°å¼‚å¸¸com.mmall.exception.ParamException
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">check</span><span class="o">(</span><span class="nc">Object</span> <span class="n">param</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ParamException</span> <span class="o">{</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="nc">BeanValidator</span><span class="o">.</span><span class="na">validateObject</span><span class="o">(</span><span class="n">param</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">MapUtils</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">map</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ParamException</span><span class="o">(</span><span class="n">map</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>åˆ›å»ºä¸€ä¸ªæµ‹è¯•æ¥æ”¶æ•°æ®çš„å®ä½“ç±»ï¼Œå¹¶æ·»åŠ æ ¡éªŒæ³¨è§£</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.param</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.NotBlank</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.hibernate.validator.constraints.NotEmpty</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.validation.constraints.Max</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.Min</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.validation.constraints.NotNull</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="cm">/**
 * æµ‹è¯•æ ¡éªŒç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestVo</span> <span class="o">{</span>

    <span class="nd">@NotBlank</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span><span class="c1">//ä¸å…è®¸ä¸ºç©ºå€¼</span>

    <span class="nd">@NotNull</span><span class="o">(</span><span class="n">message</span> <span class="o">=</span> <span class="s">"idä¸å¯ä»¥ä¸ºç©º"</span><span class="o">)</span>
    <span class="nd">@Max</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">10</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"id ä¸èƒ½å¤§äº10"</span><span class="o">)</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="n">message</span> <span class="o">=</span> <span class="s">"id è‡³å°‘å¤§äºç­‰äº0"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">str</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•å‚æ•°æ ¡éªŒ</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/validate.json"</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="nc">JsonData</span> <span class="nf">validate</span><span class="o">(</span><span class="nc">TestVo</span> <span class="n">vo</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ParamException</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"validate"</span><span class="o">);</span>
        <span class="c1">//ä½¿ç”¨è‡ªå®šä¹‰å‚æ•°æ ¡éªŒç±»å»æ ¡éªŒæ¥æ”¶çš„å‚æ•°æ˜¯å¦ç¬¦åˆè¦æ±‚</span>
        <span class="nc">BeanValidator</span><span class="o">.</span><span class="na">check</span><span class="o">(</span><span class="n">vo</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">success</span><span class="o">(</span><span class="s">"test validate"</span><span class="o">);</span>
    <span class="o">}</span>
</code></pre></div></div>

<h4 id="å¯¹è±¡ä¸jsonäº’è½¬å·¥å…·">å¯¹è±¡ä¸jsonäº’è½¬å·¥å…·</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.DeserializationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.ObjectMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.SerializationConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.annotate.JsonSerialize</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.map.ser.impl.SimpleFilterProvider</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.codehaus.jackson.type.TypeReference</span><span class="o">;</span>
<span class="cm">/**
 * jsonè½¬æ¢å·¥å…·ï¼Œç±»å’Œjsonçš„è½¬æ¢
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">JsonMapper</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ObjectMapper</span> <span class="n">objectMapper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ObjectMapper</span><span class="o">();</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="c1">// config</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">disable</span><span class="o">(</span><span class="nc">DeserializationConfig</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">FAIL_ON_UNKNOWN_PROPERTIES</span><span class="o">);</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">configure</span><span class="o">(</span><span class="nc">SerializationConfig</span><span class="o">.</span><span class="na">Feature</span><span class="o">.</span><span class="na">FAIL_ON_EMPTY_BEANS</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">setFilters</span><span class="o">(</span><span class="k">new</span> <span class="nc">SimpleFilterProvider</span><span class="o">().</span><span class="na">setFailOnUnknownId</span><span class="o">(</span><span class="kc">false</span><span class="o">));</span>
        <span class="n">objectMapper</span><span class="o">.</span><span class="na">setSerializationInclusion</span><span class="o">(</span><span class="nc">JsonSerialize</span><span class="o">.</span><span class="na">Inclusion</span><span class="o">.</span><span class="na">NON_EMPTY</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="cm">/**
     * å¯¹è±¡è½¬å­—ç¬¦ä¸²
     * @param src
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="nc">String</span> <span class="nf">obj2String</span><span class="o">(</span><span class="no">T</span> <span class="n">src</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
        	<span class="c1">//å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œç›´æ¥è¾“å‡ºï¼Œå¦åˆ™è½¬æ¢ä¸ºå­—ç¬¦ä¸²</span>
            <span class="k">return</span> <span class="n">src</span> <span class="k">instanceof</span> <span class="nc">String</span> <span class="o">?</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">src</span> <span class="o">:</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">writeValueAsString</span><span class="o">(</span><span class="n">src</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"parse object to String exception, error:{}"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹è±¡
     * @param src
     * @param typeReference
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">string2Obj</span><span class="o">(</span><span class="nc">String</span> <span class="n">src</span><span class="o">,</span> <span class="nc">TypeReference</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">typeReference</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">src</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">typeReference</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">return</span> <span class="o">(</span><span class="no">T</span><span class="o">)</span> <span class="o">(</span><span class="n">typeReference</span><span class="o">.</span><span class="na">getType</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="o">?</span> <span class="n">src</span> <span class="o">:</span> <span class="n">objectMapper</span><span class="o">.</span><span class="na">readValue</span><span class="o">(</span><span class="n">src</span><span class="o">,</span> <span class="n">typeReference</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">warn</span><span class="o">(</span><span class="s">"parse String to Object exception, String:{}, TypeReference&lt;T&gt;:{}, error:{}"</span><span class="o">,</span> <span class="n">src</span><span class="o">,</span> <span class="n">typeReference</span><span class="o">.</span><span class="na">getType</span><span class="o">(),</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="springä¸Šä¸‹æ–‡è·å–å·¥å…·">springä¸Šä¸‹æ–‡è·å–å·¥å…·</h4>

<ul>
  <li>éœ€è¦åœ¨spring-servlet.xmlä¸­è¿›è¡Œæ³¨å†Œï¼Œå¹¶ä¸”åŠ @Componentæ³¨è§£è®©springå»ç®¡ç†</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.beans.BeansException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.context.ApplicationContextAware</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Component</span><span class="o">;</span>
<span class="cm">/**
 * è·å–springä¸Šä¸‹æ–‡å·¥å…·ç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Component</span><span class="o">(</span><span class="s">"applicationContextHelper"</span><span class="o">)</span><span class="c1">//è¢«springç®¡ç†</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContextHelper</span> <span class="kd">implements</span> <span class="nc">ApplicationContextAware</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setApplicationContext</span><span class="o">(</span><span class="nc">ApplicationContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">BeansException</span> <span class="o">{</span>
        <span class="n">applicationContext</span> <span class="o">=</span> <span class="n">context</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="cm">/**
     * ä»applicationContextä¸­å–springä¸Šä¸‹æ–‡çš„bean
     * @param clazz
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">popBean</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">applicationContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="no">T</span> <span class="nf">popBean</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">applicationContext</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBean</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">clazz</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="nc">JsonData</span> <span class="nf">validate</span><span class="o">(</span><span class="nc">TestVo</span> <span class="n">vo</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ParamException</span> <span class="o">{</span>
        <span class="nc">SysAclModuleMapper</span> <span class="n">moduleMapper</span> <span class="o">=</span> <span class="nc">ApplicationContextHelper</span><span class="o">.</span><span class="na">popBean</span><span class="o">(</span><span class="nc">SysAclModuleMapper</span><span class="o">.</span><span class="na">calss</span><span class="o">);</span>
    	<span class="nc">SysAclModule</span> <span class="n">module</span> <span class="o">=</span> <span class="n">moduleMapper</span><span class="o">.</span><span class="na">selectByPrimaryKey</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    	<span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">module</span><span class="o">));</span>
    <span class="o">}</span>
</code></pre></div></div>

<h4 id="httpè¯·æ±‚å‰åç›‘å¬å·¥å…·">HTTPè¯·æ±‚å‰åç›‘å¬å·¥å…·</h4>

<ul>
  <li>éœ€è¦åœ¨spring-servlet.xmlä¸­è¿›è¡Œæ³¨å†Œ</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.util.JsonMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.ModelAndView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.web.servlet.handler.HandlerInterceptorAdapter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="cm">/**
 * Httpè¯·æ±‚å‰åç›‘å¬å·¥å…·
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HttpInterceptor</span> <span class="kd">extends</span> <span class="nc">HandlerInterceptorAdapter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">START_TIME</span> <span class="o">=</span> <span class="s">"requestStartTime"</span><span class="o">;</span>
    <span class="cm">/**
     * è¯·æ±‚å¤„ç†ä¹‹å‰è°ƒç”¨æ‰§è¡Œ
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">preHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="c1">//è·å–å½“å‰è¯·æ±‚è·¯å¾„</span>
    	<span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="c1">//è·å–è¯·æ±‚å‚æ•°</span>
    	<span class="nc">Map</span> <span class="n">parameterMap</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"request start. url:{}, params:{}"</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">parameterMap</span><span class="o">));</span>
        <span class="c1">//è®°å½•è¯·æ±‚ç›¸åº”æ—¶é—´ï¼Œå¼€å§‹</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">request</span><span class="o">.</span><span class="na">setAttribute</span><span class="o">(</span><span class="no">START_TIME</span><span class="o">,</span> <span class="n">start</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="cm">/**
     * è¯·æ±‚å¤„ç†å®Œä¹‹åæ‰§è¡Œï¼Œåªæ‰§è¡Œæ­£å¸¸è¯·æ±‚
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">postHandle</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">ModelAndView</span> <span class="n">modelAndView</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
<span class="c1">//        String url = request.getRequestURI().toString();</span>
<span class="c1">//        long start = (Long) request.getAttribute(START_TIME);</span>
<span class="c1">//        long end = System.currentTimeMillis();</span>
<span class="c1">//        log.info("request finished. url:{}, cost:{}", url, end - start);</span>
        <span class="n">removeThreadLocalInfo</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * è¯·æ±‚å¤„ç†å®Œä¹‹åæ‰§è¡Œï¼Œä»»ä½•è¯·æ±‚ï¼ŒåŒ…æ‹¬å‡ºç°å¼‚å¸¸åä¹Ÿæ‰§è¡Œ
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">afterCompletion</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">Object</span> <span class="n">handler</span><span class="o">,</span> <span class="nc">Exception</span> <span class="n">ex</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="o">(</span><span class="nc">Long</span><span class="o">)</span> <span class="n">request</span><span class="o">.</span><span class="na">getAttribute</span><span class="o">(</span><span class="no">START_TIME</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">end</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"request completed. url:{}, cost:{}æ¯«ç§’"</span><span class="o">,</span> <span class="n">url</span><span class="o">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="o">);</span>

        <span class="n">removeThreadLocalInfo</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * ç§»é™¤å½“å‰çº¿ç¨‹çš„ä¿¡æ¯
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeThreadLocalInfo</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">remove</span><span class="o">();;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="ç”¨æˆ·å’Œè¯·æ±‚çº¿ç¨‹å·¥å…·ç±»">ç”¨æˆ·å’Œè¯·æ±‚çº¿ç¨‹å·¥å…·ç±»</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.common</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="cm">/**
 * è¯·æ±‚holderï¼Œè§£å†³é«˜å¹¶å‘ï¼Œç™»å½•æˆåŠŸåæŠŠå½“å‰ç”¨æˆ·å’Œè¯·æ±‚å­˜å…¥ï¼Œå¯åœ¨ä»»æ„åœ°æ–¹å–å‡ºä½¿ç”¨
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RequestHolder</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">SysUser</span><span class="o">&gt;</span> <span class="n">userHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">SysUser</span><span class="o">&gt;();</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;</span> <span class="n">requestHolder</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ThreadLocal</span><span class="o">&lt;</span><span class="nc">HttpServletRequest</span><span class="o">&gt;();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">SysUser</span> <span class="n">sysUser</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">userHolder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">sysUser</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">add</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">requestHolder</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">SysUser</span> <span class="nf">getCurrentUser</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">userHolder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">HttpServletRequest</span> <span class="nf">getCurrentRequest</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">requestHolder</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">remove</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">userHolder</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
        <span class="n">requestHolder</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="ç™»å½•æ‹¦æˆªå™¨">ç™»å½•æ‹¦æˆªå™¨</h4>

<ul>
  <li>åœ¨web.xmlä¸­é…ç½®</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.common.RequestHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="cm">/**
 * ç™»å½•è¿‡æ»¤å™¨
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">LoginFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletRequest</span> <span class="n">req</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
        <span class="nc">HttpServletResponse</span> <span class="n">resp</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">servletResponse</span><span class="o">;</span>

        <span class="nc">SysUser</span> <span class="n">sysUser</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SysUser</span><span class="o">)</span><span class="n">req</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getAttribute</span><span class="o">(</span><span class="s">"user"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sysUser</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">String</span> <span class="n">path</span> <span class="o">=</span> <span class="s">"/signin.jsp"</span><span class="o">;</span>
            <span class="n">resp</span><span class="o">.</span><span class="na">sendRedirect</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//å¦‚æœç™»é™†æˆåŠŸæŠŠç”¨æˆ·ä¿¡æ¯æ”¾åˆ°RequestHolderä¸­ï¼Œä½¿ç”¨çš„æ—¶å€™å†å–å‡ºæ¥</span>
        <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">sysUser</span><span class="o">);</span>
        <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">req</span><span class="o">);</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="ipè·å–å·¥å…·ç±»">IPè·å–å·¥å…·ç±»</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.InetAddress</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.UnknownHostException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Matcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.regex.Pattern</span><span class="o">;</span>
<span class="cm">/**
 * IPè·å–å·¥å…·ç±»ï¼Œä¸åŒæœåŠ¡å™¨æœ‰å·®åˆ«
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IpUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="no">ERROR_IP</span> <span class="o">=</span> <span class="s">"127.0.0.1"</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">Pattern</span> <span class="n">pattern</span> <span class="o">=</span> <span class="nc">Pattern</span><span class="o">.</span>
            <span class="nf">compile</span><span class="o">(</span><span class="s">"(2[5][0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})\\.(25[0-5]|2[0-4]\\d|1\\d{2}|\\d{1,2})"</span><span class="o">);</span>

    <span class="cm">/**
     * å–å¤–ç½‘IP
     *
     * @param request
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getRemoteIp</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"x-real-ip"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="c1">//è¿‡æ»¤åå‘ä»£ç†çš„ip</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">stemps</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">","</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">stemps</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">stemps</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">//å¾—åˆ°ç¬¬ä¸€ä¸ªIPï¼Œå³å®¢æˆ·ç«¯çœŸå®IP</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">stemps</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="o">}</span>

        <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">trim</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">23</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">23</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * è·å–ç”¨æˆ·çš„çœŸå®ip
     *
     * @param request
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getUserIP</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// ä¼˜å…ˆå–X-Real-IP</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"X-Real-IP"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getHeader</span><span class="o">(</span><span class="s">"x-forwarded-for"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">ip</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">||</span> <span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="s">"0:0:0:0:0:0:0:1"</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">ip</span> <span class="o">=</span> <span class="no">ERROR_IP</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>

        <span class="k">if</span> <span class="o">(</span><span class="s">"unknown"</span><span class="o">.</span><span class="na">equalsIgnoreCase</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="no">ERROR_IP</span><span class="o">;</span>
            <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kt">int</span> <span class="n">pos</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">indexOf</span><span class="o">(</span><span class="sc">','</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">pos</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getLastIpSegment</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getUserIP</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="sc">'.'</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValidIP</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getUserIP</span><span class="o">(</span><span class="n">request</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">isValidIP</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * åˆ¤æ–­æˆ‘ä»¬è·å–çš„ipæ˜¯å¦æ˜¯ä¸€ä¸ªç¬¦åˆè§„åˆ™ip
     *
     * @param ip
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isValidIP</span><span class="o">(</span><span class="nc">String</span> <span class="n">ip</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">ip</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"ip is null. valid result is false"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">Matcher</span> <span class="n">matcher</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="na">matcher</span><span class="o">(</span><span class="n">ip</span><span class="o">);</span>
        <span class="kt">boolean</span> <span class="n">isValid</span> <span class="o">=</span> <span class="n">matcher</span><span class="o">.</span><span class="na">matches</span><span class="o">();</span>
        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"valid ip:"</span> <span class="o">+</span> <span class="n">ip</span> <span class="o">+</span> <span class="s">" result is: "</span> <span class="o">+</span> <span class="n">isValid</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">isValid</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getLastServerIpSegment</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="n">getServerIP</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ip</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span><span class="o">.</span><span class="na">substring</span><span class="o">(</span><span class="n">ip</span><span class="o">.</span><span class="na">lastIndexOf</span><span class="o">(</span><span class="sc">'.'</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">ip</span> <span class="o">=</span> <span class="s">"0"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">ip</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">getServerIP</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">InetAddress</span> <span class="n">inet</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">inet</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">hostAddress</span> <span class="o">=</span> <span class="n">inet</span><span class="o">.</span><span class="na">getHostAddress</span><span class="o">();</span>
            <span class="k">return</span> <span class="n">hostAddress</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="s">"127.0.0.1"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h4 id="é‚®ä»¶å‘é€å·¥å…·ç±»">é‚®ä»¶å‘é€å·¥å…·ç±»</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.beans.Mail</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.lang3.StringUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.mail.EmailException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.commons.mail.HtmlEmail</span><span class="o">;</span>
<span class="cm">/**
 * å‘é€é‚®ä»¶å·¥å…·ç±»
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MailUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">send</span><span class="o">(</span><span class="nc">Mail</span> <span class="n">mail</span><span class="o">)</span> <span class="o">{</span>

        <span class="c1">// TODO</span>
        <span class="nc">String</span> <span class="n">from</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">port</span> <span class="o">=</span> <span class="mi">25</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">host</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">pass</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">nickname</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>

        <span class="nc">HtmlEmail</span> <span class="n">email</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HtmlEmail</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setHostName</span><span class="o">(</span><span class="n">host</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setCharset</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">str</span> <span class="o">:</span> <span class="n">mail</span><span class="o">.</span><span class="na">getReceivers</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">email</span><span class="o">.</span><span class="na">addTo</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setFrom</span><span class="o">(</span><span class="n">from</span><span class="o">,</span> <span class="n">nickname</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setSmtpPort</span><span class="o">(</span><span class="n">port</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setAuthentication</span><span class="o">(</span><span class="n">from</span><span class="o">,</span> <span class="n">pass</span><span class="o">);</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setSubject</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getSubject</span><span class="o">());</span>
            <span class="n">email</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
            <span class="n">email</span><span class="o">.</span><span class="na">send</span><span class="o">();</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"{} å‘é€é‚®ä»¶åˆ° {}"</span><span class="o">,</span> <span class="n">from</span><span class="o">,</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getReceivers</span><span class="o">(),</span> <span class="s">","</span><span class="o">));</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">EmailException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="n">from</span> <span class="o">+</span> <span class="s">"å‘é€é‚®ä»¶åˆ°"</span> <span class="o">+</span> <span class="nc">StringUtils</span><span class="o">.</span><span class="na">join</span><span class="o">(</span><span class="n">mail</span><span class="o">.</span><span class="na">getReceivers</span><span class="o">(),</span> <span class="s">","</span><span class="o">)</span> <span class="o">+</span> <span class="s">"å¤±è´¥"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>


</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.beans</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.AllArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Builder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.NoArgsConstructor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.Setter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.ToString</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="cm">/**
 * éœ€è¦å‘é€çš„é‚®ä»¶ä¿¡æ¯
 * @author Administrator
 *
 */</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@ToString</span>
<span class="nd">@Builder</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Mail</span> <span class="o">{</span>

	<span class="cm">/**
	 * ä¸»é¢˜
	 */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">subject</span><span class="o">;</span>
    
    <span class="cm">/**
     * å†…å®¹
     */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>

    <span class="cm">/**
     * æ¥æ”¶è€…
     */</span>
    <span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">receivers</span><span class="o">;</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="md5å¯†ç åŠ å¯†å·¥å…·">MD5å¯†ç åŠ å¯†å·¥å…·</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.security.MessageDigest</span><span class="o">;</span>
<span class="cm">/**
 * MD5å¯†ç åŠ å¯†å·¥å…·
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MD5Util</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">MD5Util</span><span class="o">.</span><span class="na">encrypt</span><span class="o">(</span><span class="s">"admin"</span><span class="o">));</span>
	<span class="o">}</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">encrypt</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">char</span> <span class="n">hexDigits</span><span class="o">[]</span> <span class="o">=</span> <span class="o">{</span> <span class="sc">'0'</span><span class="o">,</span> <span class="sc">'1'</span><span class="o">,</span> <span class="sc">'2'</span><span class="o">,</span> <span class="sc">'3'</span><span class="o">,</span> <span class="sc">'4'</span><span class="o">,</span> <span class="sc">'5'</span><span class="o">,</span> <span class="sc">'6'</span><span class="o">,</span> <span class="sc">'7'</span><span class="o">,</span> <span class="sc">'8'</span><span class="o">,</span> <span class="sc">'9'</span><span class="o">,</span> <span class="sc">'A'</span><span class="o">,</span> <span class="sc">'B'</span><span class="o">,</span> <span class="sc">'C'</span><span class="o">,</span> <span class="sc">'D'</span><span class="o">,</span> <span class="sc">'E'</span><span class="o">,</span> <span class="sc">'F'</span> <span class="o">};</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">btInput</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
            <span class="c1">// è·å¾—MD5æ‘˜è¦ç®—æ³•çš„ MessageDigest å¯¹è±¡</span>
            <span class="nc">MessageDigest</span> <span class="n">mdInst</span> <span class="o">=</span> <span class="nc">MessageDigest</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="s">"MD5"</span><span class="o">);</span>
            <span class="c1">// ä½¿ç”¨æŒ‡å®šçš„å­—èŠ‚æ›´æ–°æ‘˜è¦</span>
            <span class="n">mdInst</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">btInput</span><span class="o">);</span>
            <span class="c1">// è·å¾—å¯†æ–‡</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">md</span> <span class="o">=</span> <span class="n">mdInst</span><span class="o">.</span><span class="na">digest</span><span class="o">();</span>
            <span class="c1">// æŠŠå¯†æ–‡è½¬æ¢æˆåå…­è¿›åˆ¶çš„å­—ç¬¦ä¸²å½¢å¼</span>
            <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
            <span class="kt">char</span> <span class="n">str</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">char</span><span class="o">[</span><span class="n">j</span> <span class="o">*</span> <span class="mi">2</span><span class="o">];</span>
            <span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">j</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="kt">byte</span> <span class="n">byte0</span> <span class="o">=</span> <span class="n">md</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
                <span class="n">str</span><span class="o">[</span><span class="n">k</span><span class="o">++]</span> <span class="o">=</span> <span class="n">hexDigits</span><span class="o">[</span><span class="n">byte0</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">4</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="o">];</span>
                <span class="n">str</span><span class="o">[</span><span class="n">k</span><span class="o">++]</span> <span class="o">=</span> <span class="n">hexDigits</span><span class="o">[</span><span class="n">byte0</span> <span class="o">&amp;</span> <span class="mh">0xf</span><span class="o">];</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">String</span><span class="o">(</span><span class="n">str</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"generate md5 error, {}"</span><span class="o">,</span> <span class="n">s</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="éšæœºç”Ÿæˆå¯†ç å·¥å…·ç±»">éšæœºç”Ÿæˆå¯†ç å·¥å…·ç±»</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>
<span class="cm">/**
 * å¯†ç å¤„ç†å·¥å…·ç±»
 * @author Administrator
 *
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PasswordUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">word</span> <span class="o">=</span> <span class="o">{</span>
            <span class="s">"a"</span><span class="o">,</span> <span class="s">"b"</span><span class="o">,</span> <span class="s">"c"</span><span class="o">,</span> <span class="s">"d"</span><span class="o">,</span> <span class="s">"e"</span><span class="o">,</span> <span class="s">"f"</span><span class="o">,</span> <span class="s">"g"</span><span class="o">,</span>
            <span class="s">"h"</span><span class="o">,</span> <span class="s">"j"</span><span class="o">,</span> <span class="s">"k"</span><span class="o">,</span> <span class="s">"m"</span><span class="o">,</span> <span class="s">"n"</span><span class="o">,</span>
            <span class="s">"p"</span><span class="o">,</span> <span class="s">"q"</span><span class="o">,</span> <span class="s">"r"</span><span class="o">,</span> <span class="s">"s"</span><span class="o">,</span> <span class="s">"t"</span><span class="o">,</span>
            <span class="s">"u"</span><span class="o">,</span> <span class="s">"v"</span><span class="o">,</span> <span class="s">"w"</span><span class="o">,</span> <span class="s">"x"</span><span class="o">,</span> <span class="s">"y"</span><span class="o">,</span> <span class="s">"z"</span><span class="o">,</span>
            <span class="s">"A"</span><span class="o">,</span> <span class="s">"B"</span><span class="o">,</span> <span class="s">"C"</span><span class="o">,</span> <span class="s">"D"</span><span class="o">,</span> <span class="s">"E"</span><span class="o">,</span> <span class="s">"F"</span><span class="o">,</span> <span class="s">"G"</span><span class="o">,</span>
            <span class="s">"H"</span><span class="o">,</span> <span class="s">"J"</span><span class="o">,</span> <span class="s">"K"</span><span class="o">,</span> <span class="s">"M"</span><span class="o">,</span> <span class="s">"N"</span><span class="o">,</span>
            <span class="s">"P"</span><span class="o">,</span> <span class="s">"Q"</span><span class="o">,</span> <span class="s">"R"</span><span class="o">,</span> <span class="s">"S"</span><span class="o">,</span> <span class="s">"T"</span><span class="o">,</span>
            <span class="s">"U"</span><span class="o">,</span> <span class="s">"V"</span><span class="o">,</span> <span class="s">"W"</span><span class="o">,</span> <span class="s">"X"</span><span class="o">,</span> <span class="s">"Y"</span><span class="o">,</span> <span class="s">"Z"</span>
    <span class="o">};</span>

    <span class="kd">public</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">num</span> <span class="o">=</span> <span class="o">{</span>
            <span class="s">"2"</span><span class="o">,</span> <span class="s">"3"</span><span class="o">,</span> <span class="s">"4"</span><span class="o">,</span> <span class="s">"5"</span><span class="o">,</span> <span class="s">"6"</span><span class="o">,</span> <span class="s">"7"</span><span class="o">,</span> <span class="s">"8"</span><span class="o">,</span> <span class="s">"9"</span>
    <span class="o">};</span>
    <span class="cm">/**
     * éšæœºç”Ÿæˆå¯†ç 
     * @return
     */</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">String</span> <span class="nf">randomPassword</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">StringBuffer</span> <span class="n">stringBuffer</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuffer</span><span class="o">();</span>
        <span class="c1">//æ ¹æ®æ—¶é—´æˆ³ç”Ÿæˆéšæœºè§„åˆ™</span>
        <span class="nc">Random</span> <span class="n">random</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Random</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">());</span>
        <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="mi">8</span><span class="o">;</span><span class="c1">//å¯†ç é•¿åº¦åœ¨8åˆ°10å­—ç¬¦ä¹‹é—´</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">flag</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">num</span><span class="o">[</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">length</span><span class="o">)]);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">stringBuffer</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">word</span><span class="o">[</span><span class="n">random</span><span class="o">.</span><span class="na">nextInt</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">length</span><span class="o">)]);</span>
            <span class="o">}</span>
            <span class="n">flag</span> <span class="o">=</span> <span class="o">!</span><span class="n">flag</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">stringBuffer</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">randomPassword</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">randomPassword</span><span class="o">());</span>
        <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">randomPassword</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="æƒé™æ‹¦æˆªå™¨">æƒé™æ‹¦æˆªå™¨</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Splitter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.google.common.collect.Sets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.common.ApplicationContextHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.common.JsonData</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.common.RequestHolder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.model.SysUser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.service.SysCoreService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.util.JsonMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.Filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterChain</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.FilterConfig</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.ServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Set</span><span class="o">;</span>
<span class="cm">/**
 * æƒé™æ‹¦æˆª
 * @author Administrator
 *
 */</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AclControlFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>
	<span class="c1">//æ’é™¤URL</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">exclusionUrlSet</span> <span class="o">=</span> <span class="nc">Sets</span><span class="o">.</span><span class="na">newConcurrentHashSet</span><span class="o">();</span>
    <span class="c1">//æ— æƒé™è®¿é—®æ—¶éœ€è¦è·³è½¬åˆ°çš„é¡µé¢URL</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">noAuthUrl</span> <span class="o">=</span> <span class="s">"/sys/user/noAuth.page"</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
    	<span class="c1">//å®šä¹‰ç™½åå•</span>
        <span class="nc">String</span> <span class="n">exclusionUrls</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getInitParameter</span><span class="o">(</span><span class="s">"exclusionUrls"</span><span class="o">);</span>
        <span class="c1">//å¦‚æœæœ‰å¤šä¸ªæ‹¦æˆªè·¯å¾„ï¼Œå°±æŠŠä»–åˆ‡å‰²å¼€ï¼Œç»„è£…æˆlist</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">exclusionUrlList</span> <span class="o">=</span> <span class="nc">Splitter</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">","</span><span class="o">).</span><span class="na">trimResults</span><span class="o">().</span><span class="na">omitEmptyStrings</span><span class="o">().</span><span class="na">splitToList</span><span class="o">(</span><span class="n">exclusionUrls</span><span class="o">);</span>
        <span class="n">exclusionUrlSet</span> <span class="o">=</span> <span class="nc">Sets</span><span class="o">.</span><span class="na">newConcurrentHashSet</span><span class="o">(</span><span class="n">exclusionUrlList</span><span class="o">);</span>
        <span class="n">exclusionUrlSet</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">noAuthUrl</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletRequest</span><span class="o">)</span> <span class="n">servletRequest</span><span class="o">;</span>
        <span class="nc">HttpServletResponse</span> <span class="n">response</span> <span class="o">=</span> <span class="o">(</span><span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="n">servletResponse</span><span class="o">;</span>
        <span class="c1">//è·å–è¯·æ±‚è·¯å¾„</span>
        <span class="nc">String</span> <span class="n">servletPath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
        <span class="c1">//è·å–è¯·æ±‚å‚æ•°åˆ—è¡¨</span>
        <span class="nc">Map</span> <span class="n">requestMap</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getParameterMap</span><span class="o">();</span>
        <span class="c1">//è¯·æ±‚åœ¨ç™½åå•å†…åˆ™ä¸æ‹¦æˆªï¼Œæ”¾è¡Œ</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">exclusionUrlSet</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">servletPath</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//å–å‡ºå½“å‰ç™»å½•ç”¨æˆ·</span>
        <span class="nc">SysUser</span> <span class="n">sysUser</span> <span class="o">=</span> <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">();</span>
        <span class="c1">//å¦‚æœæ²¡æœ‰ç™»å½•å°±è®¿é—®æƒé™ï¼Œæ‰§è¡Œæ— æƒé™æ–¹æ³•</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">sysUser</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"someone visit {}, but no login, parameter:{}"</span><span class="o">,</span> <span class="n">servletPath</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">requestMap</span><span class="o">));</span>
            <span class="n">noAuth</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//ä»å·¥å…·ç±»ä¸­è·å–æƒé™serviceï¼Œè¿›è¡Œé€»è¾‘å¤„ç†</span>
        <span class="nc">SysCoreService</span> <span class="n">sysCoreService</span> <span class="o">=</span> <span class="nc">ApplicationContextHelper</span><span class="o">.</span><span class="na">popBean</span><span class="o">(</span><span class="nc">SysCoreService</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">//æ˜¯å¦æœ‰æƒé™è®¿é—®URL</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">sysCoreService</span><span class="o">.</span><span class="na">hasUrlAcl</span><span class="o">(</span><span class="n">servletPath</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"{} visit {}, but no login, parameter:{}"</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">sysUser</span><span class="o">),</span> <span class="n">servletPath</span><span class="o">,</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">requestMap</span><span class="o">));</span>
            <span class="n">noAuth</span><span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">servletResponse</span><span class="o">);</span>
        <span class="k">return</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="cm">/**
     * æ— æƒé™è®¿é—®æ–¹æ³•
     * @param request
     * @param response
     * @throws IOException
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">noAuth</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">servletPath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getServletPath</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">servletPath</span><span class="o">.</span><span class="na">endsWith</span><span class="o">(</span><span class="s">".json"</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">JsonData</span> <span class="n">jsonData</span> <span class="o">=</span> <span class="nc">JsonData</span><span class="o">.</span><span class="na">fail</span><span class="o">(</span><span class="s">"æ²¡æœ‰è®¿é—®æƒé™ï¼Œå¦‚éœ€è¦è®¿é—®ï¼Œè¯·è”ç³»ç®¡ç†å‘˜"</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"application/json"</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">jsonData</span><span class="o">));</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">clientRedirect</span><span class="o">(</span><span class="n">noAuthUrl</span><span class="o">,</span> <span class="n">response</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * æ— æƒé™ï¼Œè·³è½¬æ— æƒé™é¡µé¢
     * @param url
     * @param response
     * @throws IOException
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">clientRedirect</span><span class="o">(</span><span class="nc">String</span> <span class="n">url</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
        <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Type"</span><span class="o">,</span> <span class="s">"text/html"</span><span class="o">);</span>
        <span class="n">response</span><span class="o">.</span><span class="na">getWriter</span><span class="o">().</span><span class="na">print</span><span class="o">(</span><span class="s">"&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Strict//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd\"&gt;\n"</span>
                <span class="o">+</span> <span class="s">"&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;head&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;meta http-equiv=\"content-type\" content=\"text/html; charset=UTF-8\"/&gt;\n"</span>
                <span class="o">+</span> <span class="s">"&lt;title&gt;è·³è½¬ä¸­...&lt;/title&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;/head&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;body&gt;\n"</span> <span class="o">+</span> <span class="s">"è·³è½¬ä¸­ï¼Œè¯·ç¨å€™...\n"</span> <span class="o">+</span> <span class="s">"&lt;script type=\"text/javascript\"&gt;//&lt;![CDATA[\n"</span>
                <span class="o">+</span> <span class="s">"window.location.href='"</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s">"?ret='+encodeURIComponent(window.location.href);\n"</span> <span class="o">+</span> <span class="s">"//]]&gt;&lt;/script&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;/body&gt;\n"</span> <span class="o">+</span> <span class="s">"&lt;/html&gt;\n"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="redisç¼“å­˜">Redisç¼“å­˜</h4>

<ul>
  <li>redis.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
       <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span><span class="nt">&gt;</span>
	<span class="c">&lt;!--è¯»å–Redisé…ç½®æ–‡ä»¶å†…å®¹  --&gt;</span>
    <span class="nt">&lt;context:property-placeholder</span> <span class="na">location=</span><span class="s">"classpath:redis.properties"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--ä¸springå…³è”çš„è¿æ¥æ±   --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"jedisPoolConfig"</span> <span class="na">class=</span><span class="s">"redis.clients.jedis.JedisPoolConfig"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!--æ ¸å¿ƒé…ç½®  --&gt;</span>
    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"shardedJedisPool"</span> <span class="na">class=</span><span class="s">"redis.clients.jedis.ShardedJedisPool"</span> <span class="na">scope=</span><span class="s">"singleton"</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"0"</span> <span class="na">ref=</span><span class="s">"jedisPoolConfig"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">index=</span><span class="s">"1"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"redis.clients.jedis.JedisShardInfo"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"host"</span> <span class="na">value=</span><span class="s">"${redis.host}"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"port"</span> <span class="na">value=</span><span class="s">"${redis.port}"</span><span class="nt">/&gt;</span>
                    <span class="nt">&lt;constructor-arg</span> <span class="na">name=</span><span class="s">"timeout"</span> <span class="na">value=</span><span class="s">"${redis.timeout}"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;/bean&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/constructor-arg&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;/beans&gt;</span>
</code></pre></div></div>

<ul>
  <li>redis.properties</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">redis.host</span><span class="p">=</span><span class="s">127.0.0.1</span>
<span class="py">redis.port</span><span class="p">=</span><span class="s">6379</span>
<span class="py">redis.timeout</span><span class="p">=</span><span class="s">3000</span>
</code></pre></div></div>

<ul>
  <li>rediså®¢æˆ·ç«¯é…ç½®</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.ShardedJedis</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.ShardedJedisPool</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="o">;</span>
<span class="cm">/**
 * redisé…ç½®å®¢æˆ·ç«¯
 * @author Administrator
 *
 */</span>
<span class="nd">@Service</span><span class="o">(</span><span class="s">"redisPool"</span><span class="o">)</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RedisPool</span> <span class="o">{</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"shardedJedisPool"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">ShardedJedisPool</span> <span class="n">shardedJedisPool</span><span class="o">;</span>

    <span class="cm">/**
     * å®ä¾‹åŒ–
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">ShardedJedis</span> <span class="nf">instance</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">shardedJedisPool</span><span class="o">.</span><span class="na">getResource</span><span class="o">();</span>
    <span class="o">}</span>
    <span class="cm">/**
     * å®‰å…¨å…³é—­
     * @param shardedJedis
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">safeClose</span><span class="o">(</span><span class="nc">ShardedJedis</span> <span class="n">shardedJedis</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
           <span class="k">if</span> <span class="o">(</span><span class="n">shardedJedis</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
               <span class="n">shardedJedis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
           <span class="o">}</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"return redis resource exception"</span><span class="o">,</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>Redisç¼“å­˜çš„å­˜å‚¨äºè·å–</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.service</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.google.common.base.Joiner</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.beans.CacheKeyConstants</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.mmall.util.JsonMapper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">lombok.extern.slf4j.Slf4j</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.stereotype.Service</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">redis.clients.jedis.ShardedJedis</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.annotation.Resource</span><span class="o">;</span>
<span class="cm">/**
 * å¤„ç†ç¼“å­˜cache
 * @author Administrator
 *
 */</span>
<span class="nd">@Service</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SysCacheService</span> <span class="o">{</span>

    <span class="nd">@Resource</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"redisPool"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">RedisPool</span> <span class="n">redisPool</span><span class="o">;</span>
    <span class="cm">/**
     * ä¿å­˜cache
     * @param toSavedValue
     * @param timeoutSeconds
     * @param prefix
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveCache</span><span class="o">(</span><span class="nc">String</span> <span class="n">toSavedValue</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeoutSeconds</span><span class="o">,</span> <span class="nc">CacheKeyConstants</span> <span class="n">prefix</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">saveCache</span><span class="o">(</span><span class="n">toSavedValue</span><span class="o">,</span> <span class="n">timeoutSeconds</span><span class="o">,</span> <span class="n">prefix</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">saveCache</span><span class="o">(</span><span class="nc">String</span> <span class="n">toSavedValue</span><span class="o">,</span> <span class="kt">int</span> <span class="n">timeoutSeconds</span><span class="o">,</span> <span class="nc">CacheKeyConstants</span> <span class="n">prefix</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">keys</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//éœ€è¦ç¼“å­˜çš„å€¼ä¸ºç©ºï¼Œè¿”å›</span>
    	<span class="k">if</span> <span class="o">(</span><span class="n">toSavedValue</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="c1">//è·å–è¿æ¥</span>
        <span class="nc">ShardedJedis</span> <span class="n">shardedJedis</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
        	<span class="c1">//ç”Ÿæˆç¼“å­˜çš„key</span>
            <span class="nc">String</span> <span class="n">cacheKey</span> <span class="o">=</span> <span class="n">generateCacheKey</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="n">keys</span><span class="o">);</span>
            <span class="c1">//åˆ›å»ºRediså®ä¾‹</span>
            <span class="n">shardedJedis</span> <span class="o">=</span> <span class="n">redisPool</span><span class="o">.</span><span class="na">instance</span><span class="o">();</span>
            <span class="c1">//æ‰§è¡Œç¼“å­˜æ“ä½œ</span>
            <span class="n">shardedJedis</span><span class="o">.</span><span class="na">setex</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">,</span> <span class="n">timeoutSeconds</span><span class="o">,</span> <span class="n">toSavedValue</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"save cache exception, prefix:{}, keys:{}"</span><span class="o">,</span> <span class="n">prefix</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">keys</span><span class="o">),</span> <span class="n">e</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">redisPool</span><span class="o">.</span><span class="na">safeClose</span><span class="o">(</span><span class="n">shardedJedis</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * è·å–cache
     * @param prefix
     * @param keys
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getFromCache</span><span class="o">(</span><span class="nc">CacheKeyConstants</span> <span class="n">prefix</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">keys</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ShardedJedis</span> <span class="n">shardedJedis</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">cacheKey</span> <span class="o">=</span> <span class="n">generateCacheKey</span><span class="o">(</span><span class="n">prefix</span><span class="o">,</span> <span class="n">keys</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">shardedJedis</span> <span class="o">=</span> <span class="n">redisPool</span><span class="o">.</span><span class="na">instance</span><span class="o">();</span>
            <span class="c1">//æ ¹æ®keyè·å–ç¼“å­˜æ•°æ®</span>
            <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">shardedJedis</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cacheKey</span><span class="o">);</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"get from cache exception, prefix:{}, keys:{}"</span><span class="o">,</span> <span class="n">prefix</span><span class="o">.</span><span class="na">name</span><span class="o">(),</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">keys</span><span class="o">),</span> <span class="n">e</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="n">redisPool</span><span class="o">.</span><span class="na">safeClose</span><span class="o">(</span><span class="n">shardedJedis</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="cm">/**
     * è‡ªåŠ¨ç”Ÿæˆç¼“å­˜çš„key
     * @param prefix
     * @param keys
     * @return
     */</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="nf">generateCacheKey</span><span class="o">(</span><span class="nc">CacheKeyConstants</span> <span class="n">prefix</span><span class="o">,</span> <span class="nc">String</span><span class="o">...</span> <span class="n">keys</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//ä»æšä¸¾ä¸­è·å–å‰ç¼€</span>
    	<span class="nc">String</span> <span class="n">key</span> <span class="o">=</span> <span class="n">prefix</span><span class="o">.</span><span class="na">name</span><span class="o">();</span>
    	<span class="c1">//è¿›è¡Œkeyçš„æ‹¼æ¥</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">keys</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">keys</span><span class="o">.</span><span class="na">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">key</span> <span class="o">+=</span> <span class="s">"_"</span> <span class="o">+</span> <span class="nc">Joiner</span><span class="o">.</span><span class="na">on</span><span class="o">(</span><span class="s">"_"</span><span class="o">).</span><span class="na">join</span><span class="o">(</span><span class="n">keys</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">key</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>ç¼“å­˜å‰ç¼€æšä¸¾</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.mmall.beans</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">lombok.Getter</span><span class="o">;</span>
<span class="cm">/**
 * cacheå‰ç¼€
 * @author Administrator
 *
 */</span>
<span class="nd">@Getter</span>
<span class="kd">public</span> <span class="kd">enum</span> <span class="nc">CacheKeyConstants</span> <span class="o">{</span>

    <span class="no">SYSTEM_ACLS</span><span class="o">,</span>

    <span class="no">USER_ACLS</span><span class="o">;</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>åœ¨applicationContext.xmlä¸­å¼•å…¥redis.xml</li>
  <li>æµ‹è¯•</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="cm">/**
     * ä»cacheä¸­è·å–å½“å‰ç”¨æˆ·çš„æƒé™é›†åˆ
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SysAcl</span><span class="o">&gt;</span> <span class="nf">getCurrentUserAclListFromCache</span><span class="o">()</span> <span class="o">{</span>
    	<span class="c1">//è·å–å½“å‰ç”¨æˆ·çš„id</span>
        <span class="kt">int</span> <span class="n">userId</span> <span class="o">=</span> <span class="nc">RequestHolder</span><span class="o">.</span><span class="na">getCurrentUser</span><span class="o">().</span><span class="na">getId</span><span class="o">();</span>
        <span class="c1">//å…ˆä»Redisç¼“å­˜ä¸­è·å–æ•°æ®</span>
        <span class="nc">String</span> <span class="n">cacheValue</span> <span class="o">=</span> <span class="n">sysCacheService</span><span class="o">.</span><span class="na">getFromCache</span><span class="o">(</span><span class="nc">CacheKeyConstants</span><span class="o">.</span><span class="na">USER_ACLS</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">userId</span><span class="o">));</span>
        <span class="c1">//å¦‚æœç¼“å­˜ä¸­æ²¡æœ‰æ•°æ®ï¼Œå°±å»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ï¼Œç„¶åæ”¾å…¥Redisç¼“å­˜ä¸­</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isBlank</span><span class="o">(</span><span class="n">cacheValue</span><span class="o">))</span> <span class="o">{</span>
            <span class="nc">List</span><span class="o">&lt;</span><span class="nc">SysAcl</span><span class="o">&gt;</span> <span class="n">aclList</span> <span class="o">=</span> <span class="n">getCurrentUserAclList</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="nc">CollectionUtils</span><span class="o">.</span><span class="na">isNotEmpty</span><span class="o">(</span><span class="n">aclList</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">sysCacheService</span><span class="o">.</span><span class="na">saveCache</span><span class="o">(</span><span class="nc">JsonMapper</span><span class="o">.</span><span class="na">obj2String</span><span class="o">(</span><span class="n">aclList</span><span class="o">),</span> <span class="mi">600</span><span class="o">,</span> <span class="nc">CacheKeyConstants</span><span class="o">.</span><span class="na">USER_ACLS</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">userId</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">aclList</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="nc">JsonMapper</span><span class="o">.</span><span class="na">string2Obj</span><span class="o">(</span><span class="n">cacheValue</span><span class="o">,</span> <span class="k">new</span> <span class="nc">TypeReference</span><span class="o">&lt;</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">SysAcl</span><span class="o">&gt;&gt;()</span> <span class="o">{</span>
        <span class="o">});</span>
    <span class="o">}</span>
</code></pre></div></div>
:ET