I"Wä<ul id="markdown-toc">
  <li><a href="#å…¥é—¨" id="markdown-toc-å…¥é—¨">å…¥é—¨</a>    <ul>
      <li><a href="#æ¦‚è¿°" id="markdown-toc-æ¦‚è¿°">æ¦‚è¿°</a></li>
      <li><a href="#ç‰¹ç‚¹" id="markdown-toc-ç‰¹ç‚¹">ç‰¹ç‚¹</a></li>
      <li><a href="#sessionåŸç†" id="markdown-toc-sessionåŸç†">sessionåŸç†</a></li>
      <li><a href="#æ•°æ®ç»“æ„" id="markdown-toc-æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</a></li>
      <li><a href="#åº”ç”¨åœºæ™¯" id="markdown-toc-åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></li>
      <li><a href="#å®‰è£…" id="markdown-toc-å®‰è£…">å®‰è£…</a></li>
      <li><a href="#ä¸»è¦ç›®å½•" id="markdown-toc-ä¸»è¦ç›®å½•">ä¸»è¦ç›®å½•</a></li>
      <li><a href="#å‚æ•°è§£è¯»" id="markdown-toc-å‚æ•°è§£è¯»">å‚æ•°è§£è¯»</a></li>
    </ul>
  </li>
  <li><a href="#å†…éƒ¨åŸç†" id="markdown-toc-å†…éƒ¨åŸç†">å†…éƒ¨åŸç†</a>    <ul>
      <li><a href="#é€‰ä¸¾æœºåˆ¶" id="markdown-toc-é€‰ä¸¾æœºåˆ¶">é€‰ä¸¾æœºåˆ¶</a></li>
      <li><a href="#èŠ‚ç‚¹ç±»å‹" id="markdown-toc-èŠ‚ç‚¹ç±»å‹">èŠ‚ç‚¹ç±»å‹</a></li>
      <li><a href="#statç»“æ„ä½“" id="markdown-toc-statç»“æ„ä½“">statç»“æ„ä½“</a></li>
      <li><a href="#ç›‘å¬å™¨åŸç†" id="markdown-toc-ç›‘å¬å™¨åŸç†">ç›‘å¬å™¨åŸç†</a></li>
      <li><a href="#æƒé™æ§åˆ¶" id="markdown-toc-æƒé™æ§åˆ¶">æƒé™æ§åˆ¶</a></li>
      <li><a href="#å››å­—å‘½ä»¤" id="markdown-toc-å››å­—å‘½ä»¤">å››å­—å‘½ä»¤</a></li>
      <li><a href="#å†™æ•°æ®æµç¨‹" id="markdown-toc-å†™æ•°æ®æµç¨‹">å†™æ•°æ®æµç¨‹</a></li>
    </ul>
  </li>
  <li><a href="#å®æˆ˜demo" id="markdown-toc-å®æˆ˜demo">å®æˆ˜demo</a>    <ul>
      <li><a href="#åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²" id="markdown-toc-åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²">åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²</a></li>
      <li><a href="#å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ" id="markdown-toc-å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ">å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</a></li>
      <li><a href="#api" id="markdown-toc-api">API</a>        <ul>
          <li><a href="#ç¯å¢ƒæ­å»º" id="markdown-toc-ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</a></li>
          <li><a href="#åˆ›å»ºå®¢æˆ·ç«¯" id="markdown-toc-åˆ›å»ºå®¢æˆ·ç«¯">åˆ›å»ºå®¢æˆ·ç«¯</a></li>
          <li><a href="#åˆ›å»ºå­èŠ‚ç‚¹" id="markdown-toc-åˆ›å»ºå­èŠ‚ç‚¹">åˆ›å»ºå­èŠ‚ç‚¹</a></li>
          <li><a href="#ç›‘å¬èŠ‚ç‚¹" id="markdown-toc-ç›‘å¬èŠ‚ç‚¹">ç›‘å¬èŠ‚ç‚¹</a></li>
          <li><a href="#åˆ¤æ–­èŠ‚ç‚¹å­˜åœ¨" id="markdown-toc-åˆ¤æ–­èŠ‚ç‚¹å­˜åœ¨">åˆ¤æ–­èŠ‚ç‚¹å­˜åœ¨</a></li>
          <li><a href="#ç›‘å¬æœåŠ¡å™¨ä¸Šä¸‹çº¿" id="markdown-toc-ç›‘å¬æœåŠ¡å™¨ä¸Šä¸‹çº¿">ç›‘å¬æœåŠ¡å™¨ä¸Šä¸‹çº¿</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<h3 id="å…¥é—¨">å…¥é—¨</h3>

<h4 id="æ¦‚è¿°">æ¦‚è¿°</h4>

<ul>
  <li>Zookeeperæ˜¯ä¸€ä¸ªå¼€æºçš„åˆ†å¸ƒå¼çš„ï¼Œä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›åè°ƒæœåŠ¡çš„Apacheé¡¹ç›®ã€‚</li>
  <li>å·¥ä½œæœºåˆ¶ï¼šZookeeperä»è®¾è®¡æ¨¡å¼è§’åº¦æ¥ç†è§£ï¼šæ˜¯ä¸€ä¸ª<strong>åŸºäºè§‚å¯Ÿè€…æ¨¡å¼</strong>è®¾è®¡çš„åˆ†å¸ƒå¼æœåŠ¡ç®¡ç†æ¡†æ¶ï¼Œå®ƒ<strong>è´Ÿè´£å­˜å‚¨å’Œç®¡ç†å¤§å®¶éƒ½å…³å¿ƒçš„æ•°æ®</strong>ï¼Œç„¶åæ¥å—è§‚å¯Ÿè€…çš„æ³¨å†Œï¼Œä¸€æ—¦è¿™äº›æ•°æ®çš„çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ŒZookeeperå°±å°†<strong>è´Ÿè´£é€šçŸ¥å·²ç»åœ¨Zookeeperä¸Šæ³¨å†Œçš„é‚£äº›è§‚å¯Ÿè€…åšå‡ºç›¸åº”çš„ååº”</strong>ï¼Œä»è€Œå®ç°é›†ç¾¤ä¸­ç±»ä¼¼Master/Slaveç®¡ç†æ¨¡å¼</li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/BVd15Tc6KIAi2rX.png" alt="image.png" /></p>

<h4 id="ç‰¹ç‚¹">ç‰¹ç‚¹</h4>

<p><img src="https://i.loli.net/2020/09/06/xEidmoUOjAcw8W3.png" alt="image.png" /></p>

<ul>
  <li>1ï¼‰Zookeeperï¼šä¸€ä¸ªé¢†å¯¼è€…ï¼ˆleaderï¼‰ï¼Œå¤šä¸ªè·Ÿéšè€…ï¼ˆfollowerï¼‰ç»„æˆçš„é›†ç¾¤ã€‚</li>
  <li>2ï¼‰Leaderè´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€</li>
  <li>3ï¼‰Followerç”¨äºæ¥æ”¶å®¢æˆ·è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸¾Leaderè¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨</li>
  <li>4ï¼‰é›†ç¾¤ä¸­åªè¦æœ‰<strong>åŠæ•°ä»¥ä¸Š</strong>èŠ‚ç‚¹å­˜æ´»ï¼ŒZookeeperé›†ç¾¤å°±èƒ½æ­£å¸¸æœåŠ¡ã€‚</li>
  <li>5ï¼‰å…¨å±€æ•°æ®ä¸€è‡´ï¼šæ¯ä¸ªserverä¿å­˜ä¸€ä»½ç›¸åŒçš„æ•°æ®å‰¯æœ¬ï¼Œclientæ— è®ºè¿æ¥åˆ°å“ªä¸ªserverï¼Œæ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ã€‚</li>
  <li>6ï¼‰æ›´æ–°è¯·æ±‚é¡ºåºè¿›è¡Œï¼Œæ¥è‡ªåŒä¸€ä¸ªclientçš„æ›´æ–°è¯·æ±‚æŒ‰å…¶å‘é€é¡ºåºä¾æ¬¡æ‰§è¡Œã€‚</li>
  <li>7ï¼‰æ•°æ®æ›´æ–°åŸå­æ€§ï¼Œä¸€æ¬¡æ•°æ®æ›´æ–°è¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ã€‚</li>
  <li>8ï¼‰å®æ—¶æ€§ï¼Œåœ¨ä¸€å®šæ—¶é—´èŒƒå›´å†…ï¼Œclientèƒ½è¯»åˆ°æœ€æ–°æ•°æ®ã€‚</li>
</ul>

<h4 id="sessionåŸç†">sessionåŸç†</h4>

<ul>
  <li>1 å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„è¿æ¥å­˜åœ¨ä¼šè¯</li>
  <li>2 æ¯ä¸ªä¼šè¯éƒ½ä¼šè®¾ç½®ä¸€ä¸ªè¶…æ—¶æ—¶é—´</li>
  <li>3 å¿ƒè·³ç»“æŸï¼Œsessionè¿‡æœŸ</li>
  <li>4 sessionè¿‡æœŸï¼Œåˆ™ä¸´æ—¶èŠ‚ç‚¹znodeä¼šè¢«æŠ›å¼ƒ</li>
  <li>5 å¿ƒè·³æœºåˆ¶ï¼šå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„pingåŒ…è¯·æ±‚</li>
</ul>

<h4 id="æ•°æ®ç»“æ„">æ•°æ®ç»“æ„</h4>

<ul>
  <li>
    <p>ZooKeeperæ•°æ®æ¨¡å‹çš„ç»“æ„ä¸Unixæ–‡ä»¶ç³»ç»Ÿå¾ˆç±»ä¼¼ï¼Œæ•´ä½“ä¸Šå¯ä»¥çœ‹ä½œæ˜¯ä¸€æ£µæ ‘ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°åšä¸€ä¸ªZNodeã€‚æ¯ä¸€ä¸ªZNodeé»˜è®¤èƒ½å¤Ÿå­˜å‚¨<strong>1MBçš„æ•°æ®</strong>ï¼Œæ¯ä¸ªZNodeéƒ½å¯ä»¥é€šè¿‡å…¶è·¯å¾„å”¯ä¸€æ ‡è¯†</p>
  </li>
  <li>
    <p>æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç§°ä¸ºznodeï¼Œå®ƒå¯ä»¥æœ‰å­èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥æœ‰æ•°æ®ã€‚</p>

    <p>æ¯ä¸ªèŠ‚ç‚¹åˆ†ä¸ºä¸´æ—¶èŠ‚ç‚¹å’Œæ°¸ä¹…èŠ‚ç‚¹ï¼Œä¸´æ—¶èŠ‚ç‚¹åœ¨å®¢æˆ·ç«¯æ–­å¼€åæ¶ˆå¤±ã€‚</p>

    <p>æ¯ä¸ªzkèŠ‚ç‚¹éƒ½æœ‰å„è‡ªçš„ç‰ˆæœ¬å·ï¼Œå¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥æ˜¾ç¤ºèŠ‚ç‚¹ä¿¡æ¯</p>

    <p>æ¯å½“èŠ‚ç‚¹æ•°æ®å‘ç”Ÿå˜åŒ–ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹çš„ç‰ˆæœ¬å·ä¼šç´¯åŠ ï¼ˆä¹è§‚é”ï¼‰</p>

    <p>åˆ é™¤/ä¿®æ”¹è¿‡æ—¶èŠ‚ç‚¹ï¼Œç‰ˆæœ¬å·ä¸åŒ¹é…åˆ™ä¼šæŠ¥é”™</p>

    <p>æ¯ä¸ªzkèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®ä¸å®œè¿‡å¤§ï¼Œå‡ Kå³å¯</p>

    <p>èŠ‚ç‚¹å¯ä»¥è®¾ç½®æƒé™aclï¼Œå¯ä»¥é€šè¿‡æƒé™æ¥é™åˆ¶ç”¨æˆ·çš„è®¿é—®</p>
  </li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/sU4abRCkLQO2qNB.png" alt="image.png" /></p>

<h4 id="åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</h4>

<ul>
  <li>æä¾›çš„æœåŠ¡åŒ…æ‹¬ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€ç»Ÿä¸€é…ç½®ç®¡ç†ã€ç»Ÿä¸€é›†ç¾¤ç®¡ç†ã€æœåŠ¡å™¨èŠ‚ç‚¹åŠ¨æ€ä¸Šä¸‹çº¿ã€è½¯è´Ÿè½½å‡è¡¡ç­‰</li>
  <li>ç»Ÿä¸€å‘½åæœåŠ¡ï¼šåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œç»å¸¸éœ€è¦å¯¹åº”ç”¨/æœåŠ¡è¿›è¡Œç»Ÿä¸€å‘½åï¼Œä¾¿äºè¯†åˆ«ä¸åŒæœåŠ¡ã€‚ç±»ä¼¼äºåŸŸåä¸ipä¹‹é—´å¯¹åº”å…³ç³»ï¼Œipä¸å®¹æ˜“è®°ä½ï¼Œè€ŒåŸŸåå®¹æ˜“è®°ä½ã€‚é€šè¿‡åç§°æ¥è·å–èµ„æºæˆ–æœåŠ¡çš„åœ°å€ï¼Œæä¾›è€…ç­‰ä¿¡æ¯</li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/rl9EQ6MUysop8qk.png" alt="image.png" /></p>

<ul>
  <li>â€‹</li>
  <li>ç»Ÿä¸€é…ç½®ç®¡ç†ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œé…ç½®æ–‡ä»¶ç®¡ç†å’ŒåŒæ­¥æ˜¯ä¸€ä¸ªå¸¸è§é—®é¢˜ã€‚ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œæ‰€æœ‰èŠ‚ç‚¹çš„é…ç½®ä¿¡æ¯æ˜¯ä¸€è‡´çš„ï¼Œæ¯”å¦‚ Hadoop é›†ç¾¤ã€‚å¯¹é…ç½®æ–‡ä»¶ä¿®æ”¹åï¼Œå¸Œæœ›èƒ½å¤Ÿå¿«é€ŸåŒæ­¥åˆ°å„ä¸ªèŠ‚ç‚¹ä¸Šã€‚</li>
  <li>é…ç½®ç®¡ç†å¯äº¤ç”±ZooKeeperå®ç°ã€‚å¯å°†é…ç½®ä¿¡æ¯å†™å…¥ZooKeeperä¸Šçš„ä¸€ä¸ªZnodeã€‚å„ä¸ªèŠ‚ç‚¹ç›‘å¬è¿™ä¸ªZnodeã€‚ä¸€æ—¦Znodeä¸­çš„æ•°æ®è¢«ä¿®æ”¹ï¼ŒZooKeeperå°†é€šçŸ¥å„ä¸ªèŠ‚ç‚¹ã€‚</li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/1ryT5amSMnP4eCj.png" alt="image.png" /></p>

<ul>
  <li>
    <p>ç»Ÿä¸€é›†ç¾¤ç®¡ç†ï¼šåˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œå®æ—¶æŒæ¡æ¯ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯å¿…è¦çš„ã€‚å¯æ ¹æ®èŠ‚ç‚¹å®æ—¶çŠ¶æ€åšå‡ºä¸€äº›è°ƒæ•´ã€‚å¯å°†èŠ‚ç‚¹ä¿¡æ¯å†™å…¥ZooKeeperä¸Šçš„ä¸€ä¸ªZnodeã€‚ç›‘å¬è¿™ä¸ªZnodeå¯è·å–å®ƒçš„å®æ—¶çŠ¶æ€å˜åŒ–ã€‚ä¾‹å¦‚HBaseä¸­MasterçŠ¶æ€ç›‘æ§ä¸é€‰ä¸¾ã€‚</p>
  </li>
  <li>
    <p>æœåŠ¡å™¨åŠ¨æ€ä¸Šä¸‹çº¿ï¼šå®¢æˆ·ç«¯èƒ½å®æ—¶æ´å¯Ÿåˆ°æœåŠ¡å™¨ä¸Šä¸‹çº¿çš„å˜åŒ–</p>
  </li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/ZUCisQdKemSgJY8.png" alt="image.png" /></p>

<ul>
  <li>è½¯è´Ÿè½½å‡è¡¡ï¼š</li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/3cnwkZ6NPK7iVOe.png" alt="image.png" /></p>

<h4 id="å®‰è£…">å®‰è£…</h4>

<ul>
  <li>
    <p>ï¼ˆ1ï¼‰å®‰è£…Jdk</p>
  </li>
  <li>
    <p>ï¼ˆ2ï¼‰æ‹·è´Zookeeperå®‰è£…åŒ…åˆ°Linuxç³»ç»Ÿä¸‹</p>
  </li>
  <li>
    <p>ï¼ˆ3ï¼‰è§£å‹åˆ°æŒ‡å®šç›®å½•</p>

    <p><code class="language-plaintext highlighter-rouge"> tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/</code></p>
  </li>
  <li>
    <p>ï¼ˆ4ï¼‰å°†/opt/module/zookeeper-3.4.10/confè¿™ä¸ªè·¯å¾„ä¸‹çš„zoo_sample.cfgä¿®æ”¹ä¸ºzoo.cfgï¼›</p>

    <p><code class="language-plaintext highlighter-rouge"> mv zoo_sample.cfg zoo.cfg</code></p>
  </li>
  <li>
    <p>ï¼ˆ5ï¼‰æ‰“å¼€zoo.cfgæ–‡ä»¶ï¼Œä¿®æ”¹dataDirè·¯å¾„<code class="language-plaintext highlighter-rouge">vim zoo.cfg</code>ä¿®æ”¹å¦‚ä¸‹å†…å®¹:</p>

    <p><code class="language-plaintext highlighter-rouge">dataDir=[/opt/module/zookeeper-3.4.10/zkData]()</code></p>
  </li>
  <li>
    <p>ï¼ˆ6ï¼‰åœ¨/opt/module/zookeeper-3.4.10/è¿™ä¸ªç›®å½•ä¸Šåˆ›å»ºzkDataæ–‡ä»¶å¤¹</p>

    <p><code class="language-plaintext highlighter-rouge">mkdir zkData</code></p>
  </li>
  <li>
    <p>ï¼ˆ7ï¼‰å¯åŠ¨Zookeeper</p>

    <p><code class="language-plaintext highlighter-rouge">bin/zkServer.sh start</code></p>
  </li>
  <li>
    <p>ï¼ˆ8ï¼‰æŸ¥çœ‹è¿›ç¨‹æ˜¯å¦å¯åŠ¨</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]$ jps
4020 Jps
4001 QuorumPeerMain
</code></pre></div></div>

<ul>
  <li>ï¼ˆ9ï¼‰æŸ¥çœ‹çŠ¶æ€</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh status
ZooKeeper JMX enabled by default
Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg
Mode: standalone
</code></pre></div></div>

<ul>
  <li>ï¼ˆ10ï¼‰å¯åŠ¨å®¢æˆ·ç«¯</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkCli.sh
</code></pre></div></div>

<ul>
  <li>ï¼ˆ11ï¼‰é€€å‡ºå®¢æˆ·ç«¯</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 0] quit
</code></pre></div></div>

<ul>
  <li>ï¼ˆ12ï¼‰åœæ­¢Zookeeper</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh stop
</code></pre></div></div>

<h4 id="ä¸»è¦ç›®å½•">ä¸»è¦ç›®å½•</h4>

<ul>
  <li>binï¼šä¸»è¦çš„ä¸€äº›è¿è¡Œå‘½ä»¤</li>
  <li>confï¼šå­˜æ”¾é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­æˆ‘ä»¬éœ€è¦ä¿®æ”¹zk.cfg</li>
  <li>contribï¼šé™„åŠ çš„ä¸€äº›åŠŸèƒ½</li>
  <li>dist-mavenï¼šmvnç¼–è¯‘åçš„æ–‡ä»¶</li>
  <li>docsï¼šæ–‡æ¡£</li>
  <li>libï¼šä¾èµ–jaråŒ…</li>
  <li>recipesï¼šæ¡ˆä¾‹demo</li>
  <li>srcï¼šæºç </li>
</ul>

<h4 id="å‚æ•°è§£è¯»">å‚æ•°è§£è¯»</h4>

<ul>
  <li>
    <p><strong>tickTime =2000</strong>ï¼šé€šä¿¡å¿ƒè·³æ•°ï¼ŒZookeeperæœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å¿ƒè·³æ—¶é—´ï¼Œå•ä½æ¯«ç§’ã€‚</p>

    <p>Zookeeperä½¿ç”¨çš„åŸºæœ¬æ—¶é—´ï¼ŒæœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªtickTimeæ—¶é—´å°±ä¼šå‘é€ä¸€ä¸ªå¿ƒè·³ï¼Œæ—¶é—´å•ä½ä¸ºæ¯«ç§’ã€‚å®ƒç”¨äºå¿ƒè·³æœºåˆ¶ï¼Œå¹¶ä¸”è®¾ç½®æœ€å°çš„sessionè¶…æ—¶æ—¶é—´ä¸ºä¸¤å€å¿ƒè·³æ—¶é—´ã€‚(sessionçš„æœ€å°è¶…æ—¶æ—¶é—´æ˜¯2*tickTime)</p>
  </li>
  <li>
    <p><strong>initLimit =10</strong>ï¼šLFåˆå§‹é€šä¿¡æ—¶é™ã€‚</p>

    <p>é›†ç¾¤ä¸­çš„Followerè·Ÿéšè€…æœåŠ¡å™¨ä¸Leaderé¢†å¯¼è€…æœåŠ¡å™¨ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼ˆtickTimeçš„æ•°é‡ï¼‰ï¼Œç”¨å®ƒæ¥é™å®šé›†ç¾¤ä¸­çš„ZookeeperæœåŠ¡å™¨è¿æ¥åˆ°Leaderçš„æ—¶é™ã€‚</p>
  </li>
  <li>
    <p><strong>syncLimit =5</strong>ï¼šLFåŒæ­¥é€šä¿¡æ—¶é™ã€‚</p>

    <p>é›†ç¾¤ä¸­Leaderä¸Followerä¹‹é—´çš„æœ€å¤§å“åº”æ—¶é—´å•ä½ï¼Œå‡å¦‚å“åº”è¶…è¿‡syncLimit * tickTimeï¼ŒLeaderè®¤ä¸ºFollweræ­»æ‰ï¼Œä»æœåŠ¡å™¨åˆ—è¡¨ä¸­åˆ é™¤Follwer</p>
  </li>
  <li>
    <p><strong>dataDir</strong>ï¼šæ•°æ®æ–‡ä»¶ç›®å½•+æ•°æ®æŒä¹…åŒ–è·¯å¾„</p>

    <p>ä¸»è¦ç”¨äºä¿å­˜Zookeeperä¸­çš„æ•°æ®ã€‚</p>
  </li>
  <li>
    <p><strong>clientPort =2181</strong>ï¼šå®¢æˆ·ç«¯è¿æ¥ç«¯å£</p>

    <p>ç›‘å¬å®¢æˆ·ç«¯è¿æ¥çš„ç«¯å£</p>
  </li>
</ul>

<h3 id="å†…éƒ¨åŸç†">å†…éƒ¨åŸç†</h3>

<h4 id="é€‰ä¸¾æœºåˆ¶">é€‰ä¸¾æœºåˆ¶</h4>

<ul>
  <li>1ï¼‰<strong>åŠæ•°æœºåˆ¶</strong>ï¼šé›†ç¾¤ä¸­åŠæ•°ä»¥ä¸Šæœºå™¨å­˜æ´»ï¼Œé›†ç¾¤å¯ç”¨ã€‚æ‰€ä»¥Zookeeperé€‚åˆå®‰è£…å¥‡æ•°å°æœåŠ¡å™¨ã€‚</li>
  <li>2ï¼‰Zookeeperè™½ç„¶åœ¨é…ç½®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰æŒ‡å®šMasterå’ŒSlaveã€‚ä½†æ˜¯ï¼ŒZookeeperå·¥ä½œæ—¶ï¼Œæ˜¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹ä¸ºLeaderï¼Œå…¶ä»–åˆ™ä¸ºFollowerï¼ŒLeaderæ˜¯é€šè¿‡å†…éƒ¨çš„é€‰ä¸¾æœºåˆ¶ä¸´æ—¶äº§ç”Ÿçš„ã€‚</li>
  <li>å‡è®¾æœ‰äº”å°æœåŠ¡å™¨ç»„æˆçš„Zookeeperé›†ç¾¤ï¼Œå®ƒä»¬çš„idä»1-5ï¼ŒåŒæ—¶å®ƒä»¬éƒ½æ˜¯æœ€æ–°å¯åŠ¨çš„ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰å†å²æ•°æ®ï¼Œåœ¨å­˜æ”¾æ•°æ®é‡è¿™ä¸€ç‚¹ä¸Šï¼Œéƒ½æ˜¯ä¸€æ ·çš„ã€‚å‡è®¾è¿™äº›æœåŠ¡å™¨ä¾åºå¯åŠ¨</li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/VKDWdvUiRCwJ3GO.png" alt="image.png" /></p>

<ul>
  <li>æœåŠ¡å™¨1å¯åŠ¨ï¼Œæ­¤æ—¶åªæœ‰å®ƒä¸€å°æœåŠ¡å™¨å¯åŠ¨äº†ï¼Œå®ƒå‘å‡ºå»çš„æŠ¥æ–‡æ²¡æœ‰ä»»ä½•å“åº”ï¼Œæ‰€ä»¥å®ƒçš„é€‰ä¸¾çŠ¶æ€ä¸€ç›´æ˜¯LOOKINGçŠ¶æ€</li>
  <li>æœåŠ¡å™¨2å¯åŠ¨ï¼Œå®ƒä¸æœ€å¼€å§‹å¯åŠ¨çš„æœåŠ¡å™¨1è¿›è¡Œé€šä¿¡ï¼Œäº’ç›¸äº¤æ¢è‡ªå·±çš„é€‰ä¸¾ç»“æœï¼Œç”±äºä¸¤è€…éƒ½æ²¡æœ‰å†å²æ•°æ®ï¼Œæ‰€ä»¥idå€¼è¾ƒå¤§çš„æœåŠ¡å™¨2èƒœå‡ºï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰è¾¾åˆ°è¶…è¿‡åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨éƒ½åŒæ„é€‰ä¸¾å®ƒ(è¿™ä¸ªä¾‹å­ä¸­çš„åŠæ•°ä»¥ä¸Šæ˜¯3)ï¼Œæ‰€ä»¥æœåŠ¡å™¨1ã€2è¿˜æ˜¯ç»§ç»­ä¿æŒLOOKINGçŠ¶æ€ã€‚</li>
  <li>æœåŠ¡å™¨3å¯åŠ¨ï¼Œæ ¹æ®å‰é¢çš„ç†è®ºåˆ†æï¼ŒæœåŠ¡å™¨3æˆä¸ºæœåŠ¡å™¨1ã€2ã€3ä¸­çš„è€å¤§ï¼Œè€Œä¸ä¸Šé¢ä¸åŒçš„æ˜¯ï¼Œæ­¤æ—¶æœ‰ä¸‰å°æœåŠ¡å™¨é€‰ä¸¾äº†å®ƒï¼Œæ‰€ä»¥å®ƒæˆä¸ºäº†è¿™æ¬¡é€‰ä¸¾çš„Leaderã€‚</li>
  <li>æœåŠ¡å™¨4å¯åŠ¨ï¼Œæ ¹æ®å‰é¢çš„åˆ†æï¼Œç†è®ºä¸ŠæœåŠ¡å™¨4åº”è¯¥æ˜¯æœåŠ¡å™¨1ã€2ã€3ã€4ä¸­æœ€å¤§çš„ï¼Œä½†æ˜¯ç”±äºå‰é¢å·²ç»æœ‰åŠæ•°ä»¥ä¸Šçš„æœåŠ¡å™¨é€‰ä¸¾äº†æœåŠ¡å™¨3ï¼Œæ‰€ä»¥å®ƒåªèƒ½æ¥æ”¶å½“å°å¼Ÿçš„å‘½äº†ã€‚æœåŠ¡å™¨5å¯åŠ¨ï¼ŒåŒ4ä¸€æ ·å½“å°å¼Ÿã€‚</li>
</ul>

<h4 id="èŠ‚ç‚¹ç±»å‹">èŠ‚ç‚¹ç±»å‹</h4>

<ul>
  <li>
    <p>Znodeæœ‰ä¸¤ç§ç±»å‹ï¼š</p>

    <p>çŸ­æš‚ï¼ˆephemeralï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹è‡ªåŠ¨åˆ é™¤</p>

    <p>æŒä¹…ï¼ˆpersistentï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯æ–­å¼€è¿æ¥åï¼Œåˆ›å»ºçš„èŠ‚ç‚¹ä¸åˆ é™¤</p>
  </li>
  <li>
    <p>Znodeæœ‰å››ç§å½¢å¼çš„ç›®å½•èŠ‚ç‚¹ï¼ˆé»˜è®¤æ˜¯persistent ï¼‰</p>

    <ul>
      <li>ï¼ˆ1ï¼‰æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹ï¼ˆPERSISTENTï¼‰ï¼šå®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨</li>
      <li>ï¼ˆ2ï¼‰æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼ˆPERSISTENT_SEQUENTIALï¼‰ï¼šå®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å·</li>
      <li>ï¼ˆ3ï¼‰ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ï¼ˆEPHEMERALï¼‰ï¼šå®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤</li>
      <li>ï¼ˆ4ï¼‰ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ï¼ˆEPHEMERAL_SEQUENTIALï¼‰ï¼šå®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å·</li>
    </ul>
  </li>
  <li>
    <p>è¯´æ˜ï¼šåˆ›å»ºznodeæ—¶è®¾ç½®é¡ºåºæ ‡è¯†ï¼Œznodeåç§°åä¼šé™„åŠ ä¸€ä¸ªå€¼ï¼Œé¡ºåºå·æ˜¯ä¸€ä¸ªå•è°ƒé€’å¢çš„è®¡æ•°å™¨ï¼Œç”±çˆ¶èŠ‚ç‚¹ç»´æŠ¤</p>
  </li>
  <li>
    <p>æ³¨æ„ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œé¡ºåºå·å¯ä»¥è¢«ç”¨äºä¸ºæ‰€æœ‰çš„äº‹ä»¶è¿›è¡Œå…¨å±€æ’åºï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡é¡ºåºå·æ¨æ–­äº‹ä»¶çš„é¡ºåº</p>
  </li>
</ul>

<h4 id="statç»“æ„ä½“">statç»“æ„ä½“</h4>

<ul>
  <li>
    <p>czxid-åˆ›å»ºèŠ‚ç‚¹çš„äº‹åŠ¡zxid</p>

    <p>æ¯æ¬¡ä¿®æ”¹ZooKeeperçŠ¶æ€éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªzxidå½¢å¼çš„æ—¶é—´æˆ³ï¼Œä¹Ÿå°±æ˜¯ZooKeeperäº‹åŠ¡ID</p>

    <p>äº‹åŠ¡IDæ˜¯ZooKeeperä¸­æ‰€æœ‰ä¿®æ”¹æ€»çš„æ¬¡åºã€‚æ¯ä¸ªä¿®æ”¹éƒ½æœ‰å”¯ä¸€çš„zxidï¼Œå¦‚æœzxid1å°äºzxid2ï¼Œé‚£ä¹ˆzxid1åœ¨zxid2ä¹‹å‰å‘ç”Ÿ</p>
  </li>
  <li>
    <p>ctime - znodeè¢«åˆ›å»ºçš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</p>
  </li>
  <li>
    <p>mzxid - znodeæœ€åæ›´æ–°çš„äº‹åŠ¡zxid</p>
  </li>
  <li>
    <p>mtime - znodeæœ€åä¿®æ”¹çš„æ¯«ç§’æ•°(ä»1970å¹´å¼€å§‹)</p>
  </li>
  <li>
    <p>pZxid-znodeæœ€åæ›´æ–°çš„å­èŠ‚ç‚¹zxid</p>
  </li>
  <li>
    <p>cversion - znodeå­èŠ‚ç‚¹å˜åŒ–å·ï¼Œznodeå­èŠ‚ç‚¹ä¿®æ”¹æ¬¡æ•°</p>
  </li>
  <li>
    <p>dataversion - znodeæ•°æ®å˜åŒ–å·</p>
  </li>
  <li>
    <p>aclVersion - znodeè®¿é—®æ§åˆ¶åˆ—è¡¨çš„å˜åŒ–å·</p>
  </li>
  <li>
    <p>ephemeralOwner- å¦‚æœæ˜¯ä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä¸ªæ˜¯znodeæ‹¥æœ‰è€…çš„session idã€‚å¦‚æœä¸æ˜¯ä¸´æ—¶èŠ‚ç‚¹åˆ™æ˜¯0</p>
  </li>
  <li>
    <p><strong>dataLength- znodeçš„æ•°æ®é•¿åº¦</strong></p>
  </li>
  <li>
    <p><strong>numChildren - znodeå­èŠ‚ç‚¹æ•°é‡</strong></p>
  </li>
</ul>

<h4 id="ç›‘å¬å™¨åŸç†">ç›‘å¬å™¨åŸç†</h4>

<p><img src="https://i.loli.net/2020/09/06/tvEKoDa8SFP2JIM.png" alt="image.png" /></p>

<ul>
  <li>ç›‘å¬å™¨åŸç†è¯¦è§£
    <ul>
      <li>1ï¼‰é¦–å…ˆè¦æœ‰ä¸€ä¸ªmain()çº¿ç¨‹</li>
      <li>2ï¼‰åœ¨mainçº¿ç¨‹ä¸­åˆ›å»ºZookeeperå®¢æˆ·ç«¯ï¼Œè¿™æ—¶å°±ä¼šåˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªè´Ÿè´£ç½‘ç»œè¿æ¥é€šä¿¡ï¼ˆconnetï¼‰ï¼Œä¸€ä¸ªè´Ÿè´£ç›‘å¬ï¼ˆlistenerï¼‰</li>
      <li>3ï¼‰é€šè¿‡connectçº¿ç¨‹å°†æ³¨å†Œçš„ç›‘å¬äº‹ä»¶å‘é€ç»™Zookeeper</li>
      <li>4ï¼‰åœ¨Zookeeperçš„æ³¨å†Œç›‘å¬å™¨åˆ—è¡¨ä¸­å°†æ³¨å†Œçš„ç›‘å¬äº‹ä»¶æ·»åŠ åˆ°åˆ—è¡¨ä¸­</li>
      <li>5ï¼‰Zookeeperç›‘å¬åˆ°æœ‰æ•°æ®æˆ–è·¯å¾„å˜åŒ–ï¼Œå°±ä¼šå°†è¿™ä¸ªæ¶ˆæ¯å‘é€ç»™listenerçº¿ç¨‹</li>
      <li>6ï¼‰listenerçº¿ç¨‹å†…éƒ¨è°ƒç”¨äº†processï¼ˆï¼‰æ–¹æ³•</li>
    </ul>
  </li>
  <li>å¸¸è§ç›‘å¬ï¼š
    <ul>
      <li>ï¼ˆ1ï¼‰ç›‘å¬èŠ‚ç‚¹æ•°æ®çš„å˜åŒ–ï¼š<code class="language-plaintext highlighter-rouge">get path [watch]</code></li>
      <li>ï¼ˆ2ï¼‰ç›‘å¬å­èŠ‚ç‚¹å¢å‡çš„å˜åŒ–ï¼š<code class="language-plaintext highlighter-rouge">ls path [watch]</code></li>
    </ul>
  </li>
  <li>
    <p>é’ˆå¯¹æ¯ä¸ªèŠ‚ç‚¹çš„æ“ä½œï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªç›‘ç£è€…â€”ã€‹watcher</p>

    <p>å½“ç›‘æ§çš„æŸä¸ªå¯¹è±¡ï¼ˆznodeï¼‰å‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™è§¦å‘watcheräº‹ä»¶</p>

    <p>zkä¸­çš„watcheræ˜¯ä¸€æ¬¡æ€§çš„ï¼Œè§¦å‘åç«‹å³é”€æ¯</p>

    <p>çˆ¶èŠ‚ç‚¹ï¼Œå­èŠ‚ç‚¹å¢åˆ æ”¹æŸ¥éƒ½èƒ½å¤Ÿè§¦å‘watcher</p>
  </li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/ApDnRjmy2hGv6QT.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/06/zs42reP57Vx6iXL.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/06/FWuz4MnDt3O2GJp.png" alt="image.png" /></p>

<h4 id="æƒé™æ§åˆ¶">æƒé™æ§åˆ¶</h4>

<ul>
  <li>
    <p>å¼€å‘/æµ‹è¯•ç¯å¢ƒåˆ†ç¦»ï¼Œå¼€å‘è€…æ— æƒæ“ä½œæµ‹è¯•åº“çš„èŠ‚ç‚¹ï¼Œåªèƒ½çœ‹
ç”Ÿäº§ç¯å¢ƒä¸Šæ§åˆ¶æŒ‡å®šipçš„æœåŠ¡å¯ä»¥è®¿é—®ç›¸å…³èŠ‚ç‚¹ï¼Œé˜²æ­¢æ··ä¹±</p>
  </li>
  <li>
    <p>ACLï¼ˆaccess control listsï¼‰æƒé™æ§åˆ¶</p>

    <p>é’ˆå¯¹èŠ‚ç‚¹å¯ä»¥è®¾ç½®ç›¸å…³è¯»å†™ç­‰æƒé™ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¿éšœæ•°æ®å®‰å…¨æ€§</p>

    <p>æƒé™permissionå¯ä»¥æŒ‡å®šä¸åŒçš„æƒé™èŒƒå›´ä»¥åŠè§’è‰²</p>
  </li>
  <li>
    <p>getAclï¼šè·å–æŸä¸ªèŠ‚ç‚¹çš„aclæƒé™ä¿¡æ¯</p>
  </li>
  <li>
    <p>setAclï¼šè®¾ç½®æŸä¸ªèŠ‚ç‚¹çš„aclæƒé™ä¿¡æ¯</p>
  </li>
  <li>
    <p>addauthï¼šè¾“å…¥è®¤è¯æˆæƒä¿¡æ¯ï¼Œæ³¨å†Œæ—¶è¾“å…¥æ˜æ–‡å¯†ç ï¼ˆç™»å½•ï¼‰ï¼Œä½†æ˜¯åœ¨zkç³»ç»Ÿé‡Œï¼Œå¯†ç æ˜¯ä»¥åŠ å¯†çš„å½¢å¼å­˜åœ¨çš„</p>
  </li>
  <li>
    <p>zkçš„aclé€šè¿‡<code class="language-plaintext highlighter-rouge">[scheme:id:permissions]</code>æ¥æ„æˆæƒé™åˆ—è¡¨</p>

    <p>schemeï¼šä»£è¡¨é‡‡ç”¨çš„æŸç§æƒé™æœºåˆ¶</p>

    <p>idï¼šä»£è¡¨å…è®¸è®¿é—®çš„ç”¨æˆ·</p>

    <p>permissionsï¼šæƒé™ç»„åˆå­—ç¬¦ä¸²</p>
  </li>
  <li>
    <p>aclæ„æˆä¹‹schemeï¼š</p>

    <ul>
      <li>worldï¼šworldä¸‹åªæœ‰ä¸€ä¸ªidï¼Œå³åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼Œä¹Ÿå°±æ˜¯anyoneï¼Œé‚£ä¹ˆç»„åˆçš„å†™æ³•å°±æ˜¯<code class="language-plaintext highlighter-rouge">world:anyone:[permissions]</code></li>
      <li>authï¼šä»£è¡¨è®¤è¯ç™»å½•ï¼Œéœ€è¦æ³¨å†Œç”¨æˆ·æœ‰æƒé™å°±å¯ä»¥ï¼Œå½¢å¼ä¸ºï¼š<code class="language-plaintext highlighter-rouge">auth:user:passowrd:[permissions]</code></li>
      <li>digestï¼šéœ€è¦å¯¹å¯†ç è¿›è¡ŒåŠ å¯†æ‰èƒ½è®¿é—®ï¼Œç»„åˆå½¢å¼ä¸ºï¼š<code class="language-plaintext highlighter-rouge">digest:username:BASE64(SH1(passowrd)):[permissions]</code></li>
      <li>ç®€è€Œè¨€ä¹‹ï¼Œauthä¸digeståŒºåˆ«æ˜¯ï¼Œå‰è€…æ˜æ–‡ï¼Œåè€…å¯†æ–‡</li>
      <li>ipï¼šå½“è®¾ç½®ipä¸ºæŒ‡å®šçš„ipåœ°å€ï¼Œæ­¤æ—¶é™åˆ¶ipè®¿é—®ï¼Œæ¯”å¦‚ï¼š<code class="language-plaintext highlighter-rouge">ip:192.168.1.1:[permissions]</code></li>
      <li>superï¼šä»£è¡¨è¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™</li>
    </ul>
  </li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/WskOEqnBRVCe1Uj.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/06/reKaJcOWgB7INM5.png" alt="image.png" /></p>

<ul>
  <li>aclæ„æˆä¹‹permissions
    <ul>
      <li>CREATE:åˆ›å»ºå­èŠ‚ç‚¹</li>
      <li>READï¼šè·å–èŠ‚ç‚¹æˆ–å­èŠ‚ç‚¹</li>
      <li>WRITEï¼šè®¾ç½®èŠ‚ç‚¹æ•°æ®</li>
      <li>DELETEï¼šåˆ é™¤å­èŠ‚ç‚¹</li>
      <li>ADMINï¼šè®¾ç½®æƒé™</li>
    </ul>
  </li>
</ul>

<h4 id="å››å­—å‘½ä»¤">å››å­—å‘½ä»¤</h4>

<ul>
  <li>zkå¯ä»¥é€šè¿‡å®ƒè‡ªèº«æä¾›çš„ç®€å†™å‘½ä»¤æ¥å’ŒæœåŠ¡å™¨è¿›è¡Œäº¤äº’</li>
  <li>éœ€è¦ä½¿ç”¨åˆ°ncå‘½ä»¤ï¼Œå®‰è£…ï¼šyum install nc</li>
  <li><code class="language-plaintext highlighter-rouge">echo [commond] | nc [ip] [port]</code></li>
</ul>

<p><img src="https://i.loli.net/2020/09/06/mg9pP2bvYKMSXq8.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/06/SyrXK3BM8AVEnj2.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/06/NHavDpnJzKPAZgO.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/06/8JyZ9Hzof71F3mr.png" alt="image.png" /></p>

<h4 id="å†™æ•°æ®æµç¨‹">å†™æ•°æ®æµç¨‹</h4>

<p><img src="https://i.loli.net/2020/09/06/RMW9lF3dpm5PYBt.png" alt="image.png" /></p>

<h3 id="å®æˆ˜demo">å®æˆ˜demo</h3>

<h4 id="åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²">åˆ†å¸ƒå¼å®‰è£…éƒ¨ç½²</h4>

<ul>
  <li>é›†ç¾¤è§„åˆ’ï¼šåœ¨hadoop102ã€hadoop103å’Œhadoop104ä¸‰ä¸ªèŠ‚ç‚¹ä¸Šéƒ¨ç½²Zookeeper</li>
  <li>è§£å‹Zookeeperå®‰è£…åŒ…åˆ°/opt/module/ç›®å½•ä¸‹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 software]$ tar -zxvf zookeeper-3.4.10.tar.gz -C /opt/module/
</code></pre></div></div>

<ul>
  <li>åŒæ­¥/opt/module/zookeeper-3.4.10ç›®å½•å†…å®¹åˆ°hadoop103ã€hadoop104</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 module]$ xsync zookeeper-3.4.10/
</code></pre></div></div>

<ul>
  <li>åœ¨/opt/module/zookeeper-3.4.10/è¿™ä¸ªç›®å½•ä¸‹åˆ›å»ºzkData</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]$ mkdir -p zkData
</code></pre></div></div>

<ul>
  <li>åœ¨/opt/module/zookeeper-3.4.10/zkDataç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªmyidçš„æ–‡ä»¶</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zkData]$ touch myid
</code></pre></div></div>

<ul>
  <li>ç¼–è¾‘myidæ–‡ä»¶</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zkData]$ vi myid

åœ¨æ–‡ä»¶ä¸­æ·»åŠ ä¸serverå¯¹åº”çš„ç¼–å·ï¼š
2
</code></pre></div></div>

<ul>
  <li>æ‹·è´é…ç½®å¥½çš„zookeeperåˆ°å…¶ä»–æœºå™¨ä¸Š,å¹¶åˆ†åˆ«åœ¨hadoop102ã€hadoop103ä¸Šä¿®æ”¹myidæ–‡ä»¶ä¸­å†…å®¹ä¸º3ã€4</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zkData]$ xsync myid
</code></pre></div></div>

<ul>
  <li>é‡å‘½å/opt/module/zookeeper-3.4.10/confè¿™ä¸ªç›®å½•ä¸‹çš„zoo_sample.cfgä¸ºzoo.cfg</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 conf]$ mv zoo_sample.cfg zoo.cfg
</code></pre></div></div>

<ul>
  <li>æ‰“å¼€zoo.cfgæ–‡ä»¶,ä¿®æ”¹æ•°æ®å­˜å‚¨è·¯å¾„é…ç½®</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 conf]$ vim zoo.cfg
dataDir=/opt/module/zookeeper-3.4.10/zkData

å¢åŠ å¦‚ä¸‹é…ç½®
#######################cluster##########################
server.2=hadoop102:2888:3888
server.3=hadoop103:2888:3888
server.4=hadoop104:2888:3888

server.A=B:C:D
Aæ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯ç¬¬å‡ å·æœåŠ¡å™¨
é›†ç¾¤æ¨¡å¼ä¸‹é…ç½®ä¸€ä¸ªæ–‡ä»¶myidï¼Œè¿™ä¸ªæ–‡ä»¶åœ¨dataDirç›®å½•ä¸‹ï¼Œè¿™ä¸ªæ–‡ä»¶é‡Œé¢æœ‰ä¸€ä¸ªæ•°æ®å°±æ˜¯Açš„å€¼ï¼ŒZookeeperå¯åŠ¨æ—¶è¯»å–æ­¤æ–‡ä»¶ï¼Œæ‹¿åˆ°é‡Œé¢çš„æ•°æ®ä¸zoo.cfgé‡Œé¢çš„é…ç½®ä¿¡æ¯æ¯”è¾ƒä»è€Œåˆ¤æ–­åˆ°åº•æ˜¯å“ªä¸ªserver
Bæ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ipåœ°å€
Cæ˜¯è¿™ä¸ªæœåŠ¡å™¨ä¸é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨äº¤æ¢ä¿¡æ¯çš„ç«¯å£
Dæ˜¯ä¸‡ä¸€é›†ç¾¤ä¸­çš„LeaderæœåŠ¡å™¨æŒ‚äº†ï¼Œéœ€è¦ä¸€ä¸ªç«¯å£æ¥é‡æ–°è¿›è¡Œé€‰ä¸¾ï¼Œé€‰å‡ºä¸€ä¸ªæ–°çš„Leaderï¼Œè€Œè¿™ä¸ªç«¯å£å°±æ˜¯ç”¨æ¥æ‰§è¡Œé€‰ä¸¾æ—¶æœåŠ¡å™¨ç›¸äº’é€šä¿¡çš„ç«¯å£
</code></pre></div></div>

<ul>
  <li>åŒæ­¥zoo.cfgé…ç½®æ–‡ä»¶</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 conf]$ xsync zoo.cfg
</code></pre></div></div>

<ul>
  <li>åˆ†åˆ«å¯åŠ¨Zookeeper</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]$ bin/zkServer.sh start
[atguigu@hadoop103 zookeeper-3.4.10]$ bin/zkServer.sh start
[atguigu@hadoop104 zookeeper-3.4.10]$ bin/zkServer.sh start

</code></pre></div></div>

<ul>
  <li>æŸ¥çœ‹çŠ¶æ€</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop102 zookeeper-3.4.10]# bin/zkServer.sh status
JMX enabled by default
Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg
Mode: follower

[atguigu@hadoop103 zookeeper-3.4.10]# bin/zkServer.sh status
JMX enabled by default
Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg
Mode: leader

[atguigu@hadoop104 zookeeper-3.4.5]# bin/zkServer.sh status
JMX enabled by default
Using config: /opt/module/zookeeper-3.4.10/bin/../conf/zoo.cfg
Mode: follower

</code></pre></div></div>

<ul>
  <li>é‡å¯ä¸å…³é—­</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./zkServer.sh restart
./zkServer.sh stop
</code></pre></div></div>

<h4 id="å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ">å®¢æˆ·ç«¯å‘½ä»¤è¡Œæ“ä½œ</h4>

<table>
  <thead>
    <tr>
      <th style="text-align: center">å‘½ä»¤åŸºæœ¬è¯­æ³•</th>
      <th style="text-align: center">åŠŸèƒ½æè¿°</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">help</td>
      <td style="text-align: center">æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</td>
    </tr>
    <tr>
      <td style="text-align: center">ls path [watch]</td>
      <td style="text-align: center">ä½¿ç”¨ ls å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹</td>
    </tr>
    <tr>
      <td style="text-align: center">ls2 path [watch]</td>
      <td style="text-align: center">æŸ¥çœ‹å½“å‰èŠ‚ç‚¹æ•°æ®å¹¶èƒ½çœ‹åˆ°æ›´æ–°æ¬¡æ•°ç­‰æ•°æ®</td>
    </tr>
    <tr>
      <td style="text-align: center">create</td>
      <td style="text-align: center">æ™®é€šåˆ›å»º&lt;/br&gt;-s å«æœ‰åºåˆ—&lt;/br&gt;-e ä¸´æ—¶</td>
    </tr>
    <tr>
      <td style="text-align: center">get path [watch]</td>
      <td style="text-align: center">è·å¾—èŠ‚ç‚¹çš„å€¼</td>
    </tr>
    <tr>
      <td style="text-align: center">set</td>
      <td style="text-align: center">è®¾ç½®èŠ‚ç‚¹çš„å…·ä½“å€¼</td>
    </tr>
    <tr>
      <td style="text-align: center">stat</td>
      <td style="text-align: center">æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</td>
    </tr>
    <tr>
      <td style="text-align: center">delete</td>
      <td style="text-align: center">åˆ é™¤èŠ‚ç‚¹</td>
    </tr>
    <tr>
      <td style="text-align: center">rmr</td>
      <td style="text-align: center">é€’å½’åˆ é™¤èŠ‚ç‚¹</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>å¯åŠ¨å®¢æˆ·ç«¯</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[atguigu@hadoop103 zookeeper-3.4.10]$ bin/zkCli.sh
</code></pre></div></div>

<ul>
  <li>æ˜¾ç¤ºæ‰€æœ‰æ“ä½œå‘½ä»¤</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 1] help
</code></pre></div></div>

<ul>
  <li>æŸ¥çœ‹å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 0] ls /
[zookeeper]
</code></pre></div></div>

<ul>
  <li>æŸ¥çœ‹å½“å‰èŠ‚ç‚¹è¯¦ç»†æ•°æ®</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 1] ls2 /
[zookeeper]
cZxid = 0x0
ctime = Thu Jan 01 08:00:00 CST 1970
mZxid = 0x0
mtime = Thu Jan 01 08:00:00 CST 1970
pZxid = 0x0
cversion = -1
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 0
numChildren = 1

</code></pre></div></div>

<ul>
  <li>åˆ†åˆ«åˆ›å»º2ä¸ªæ™®é€šèŠ‚ç‚¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 3] create /sanguo "jinlian"
Created /sanguo
[zk: localhost:2181(CONNECTED) 4] create /sanguo/shuguo "liubei"
Created /sanguo/shuguo
</code></pre></div></div>

<ul>
  <li>è·å¾—èŠ‚ç‚¹çš„å€¼</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 5] get /sanguo
jinlian
cZxid = 0x100000003
ctime = Wed Aug 29 00:03:23 CST 2018
mZxid = 0x100000003
mtime = Wed Aug 29 00:03:23 CST 2018
pZxid = 0x100000004
cversion = 1
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 7
numChildren = 1
[zk: localhost:2181(CONNECTED) 6]
[zk: localhost:2181(CONNECTED) 6] get /sanguo/shuguo
liubei
cZxid = 0x100000004
ctime = Wed Aug 29 00:04:35 CST 2018
mZxid = 0x100000004
mtime = Wed Aug 29 00:04:35 CST 2018
pZxid = 0x100000004
cversion = 0
dataVersion = 0
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 6
numChildren = 0

</code></pre></div></div>

<ul>
  <li>åˆ›å»ºçŸ­æš‚èŠ‚ç‚¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 7] create -e /sanguo/wuguo "zhouyu"
Created /sanguo/wuguo

</code></pre></div></div>

<ul>
  <li>åœ¨å½“å‰å®¢æˆ·ç«¯æ˜¯èƒ½æŸ¥çœ‹åˆ°çš„</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 3] ls /sanguo 
[wuguo, shuguo]
</code></pre></div></div>

<ul>
  <li>é€€å‡ºå½“å‰å®¢æˆ·ç«¯ç„¶åå†é‡å¯å®¢æˆ·ç«¯</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 12] quit
[atguigu@hadoop104 zookeeper-3.4.10]$ bin/zkCli.sh
</code></pre></div></div>

<ul>
  <li>å†æ¬¡æŸ¥çœ‹æ ¹ç›®å½•ä¸‹çŸ­æš‚èŠ‚ç‚¹å·²ç»åˆ é™¤</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 0] ls /sanguo
[shuguo]
</code></pre></div></div>

<ul>
  <li>å…ˆåˆ›å»ºä¸€ä¸ªæ™®é€šçš„æ ¹èŠ‚ç‚¹/sanguo/weiguo</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 1] create /sanguo/weiguo "caocao"
Created /sanguo/weiguo
</code></pre></div></div>

<ul>
  <li>åˆ›å»ºå¸¦åºå·çš„èŠ‚ç‚¹ã€‚å¦‚æœåŸæ¥æ²¡æœ‰åºå·èŠ‚ç‚¹ï¼Œåºå·ä»0å¼€å§‹ä¾æ¬¡é€’å¢ã€‚å¦‚æœåŸèŠ‚ç‚¹ä¸‹å·²æœ‰2ä¸ªèŠ‚ç‚¹ï¼Œåˆ™å†æ’åºæ—¶ä»2å¼€å§‹ï¼Œä»¥æ­¤ç±»æ¨</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 2] create -s /sanguo/weiguo/xiaoqiao "jinlian"
Created /sanguo/weiguo/xiaoqiao0000000000
[zk: localhost:2181(CONNECTED) 3] create -s /sanguo/weiguo/daqiao "jinlian"
Created /sanguo/weiguo/daqiao0000000001
[zk: localhost:2181(CONNECTED) 4] create -s /sanguo/weiguo/diaocan "jinlian"
Created /sanguo/weiguo/diaocan0000000002

</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹èŠ‚ç‚¹æ•°æ®å€¼</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 6] set /sanguo/weiguo "simayi"
</code></pre></div></div>

<ul>
  <li>åœ¨hadoop104ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/sanguoèŠ‚ç‚¹æ•°æ®å˜åŒ–</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 26] [zk: localhost:2181(CONNECTED) 8] get /sanguo watch
</code></pre></div></div>

<ul>
  <li>åœ¨hadoop103ä¸»æœºä¸Šä¿®æ”¹/sanguoèŠ‚ç‚¹çš„æ•°æ®</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 1] set /sanguo "xisi"
</code></pre></div></div>

<ul>
  <li>è§‚å¯Ÿhadoop104ä¸»æœºæ”¶åˆ°æ•°æ®å˜åŒ–çš„ç›‘å¬</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WATCHER::
WatchedEvent state:SyncConnected type:NodeDataChanged path:/sanguo

</code></pre></div></div>

<ul>
  <li>åœ¨hadoop104ä¸»æœºä¸Šæ³¨å†Œç›‘å¬/sanguoèŠ‚ç‚¹çš„å­èŠ‚ç‚¹å˜åŒ–</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 1] ls /sanguo watch
[aa0000000001, server101]

</code></pre></div></div>

<ul>
  <li>åœ¨hadoop103ä¸»æœº/sanguoèŠ‚ç‚¹ä¸Šåˆ›å»ºå­èŠ‚ç‚¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 2] create /sanguo/jin "simayi"
Created /sanguo/jin
</code></pre></div></div>

<ul>
  <li>è§‚å¯Ÿhadoop104ä¸»æœºæ”¶åˆ°å­èŠ‚ç‚¹å˜åŒ–çš„ç›‘å¬</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>WATCHER::
WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/sanguo

</code></pre></div></div>

<ul>
  <li>åˆ é™¤èŠ‚ç‚¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 4] delete /sanguo/jin
</code></pre></div></div>

<ul>
  <li>é€’å½’åˆ é™¤èŠ‚ç‚¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 15] rmr /sanguo/shuguo
</code></pre></div></div>

<ul>
  <li>æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 17] stat /sanguo
cZxid = 0x100000003
ctime = Wed Aug 29 00:03:23 CST 2018
mZxid = 0x100000011
mtime = Wed Aug 29 00:21:23 CST 2018
pZxid = 0x100000014
cversion = 9
dataVersion = 1
aclVersion = 0
ephemeralOwner = 0x0
dataLength = 4
numChildren = 1

</code></pre></div></div>

<ul>
  <li>â€‹</li>
</ul>

<h4 id="api">API</h4>

<h5 id="ç¯å¢ƒæ­å»º">ç¯å¢ƒæ­å»º</h5>

<ul>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>RELEASE<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.logging.log4j<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>log4j-core<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.8.2<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.4.10<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>

</code></pre></div></div>

<ul>
  <li>éœ€è¦åœ¨é¡¹ç›®çš„src/main/resourcesç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå‘½åä¸ºâ€œlog4j.propertiesâ€ï¼Œåœ¨æ–‡ä»¶ä¸­å¡«å…¥</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">log4j.rootLogger</span><span class="p">=</span><span class="s">INFO, stdout  </span>
<span class="py">log4j.appender.stdout</span><span class="p">=</span><span class="s">org.apache.log4j.ConsoleAppender  </span>
<span class="py">log4j.appender.stdout.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout  </span>
<span class="py">log4j.appender.stdout.layout.ConversionPattern</span><span class="p">=</span><span class="s">%d %p [%c] - %m%n  </span>
<span class="py">log4j.appender.logfile</span><span class="p">=</span><span class="s">org.apache.log4j.FileAppender  </span>
<span class="py">log4j.appender.logfile.File</span><span class="p">=</span><span class="s">target/spring.log  </span>
<span class="py">log4j.appender.logfile.layout</span><span class="p">=</span><span class="s">org.apache.log4j.PatternLayout  </span>
<span class="py">log4j.appender.logfile.layout.ConversionPattern</span><span class="p">=</span><span class="s">%d %p [%c] - %m%n  </span>

</code></pre></div></div>

<h5 id="åˆ›å»ºå®¢æˆ·ç«¯">åˆ›å»ºå®¢æˆ·ç«¯</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">connectString</span> <span class="o">=</span><span class="s">"hadoop102:2181,hadoop103:2181,hadoop104:2181"</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">sessionTimeout</span> <span class="o">=</span> <span class="mi">2000</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">ZooKeeper</span> <span class="n">zkClient</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

	<span class="nd">@Before</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

	<span class="n">zkClient</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ZooKeeper</span><span class="o">(</span><span class="n">connectString</span><span class="o">,</span> <span class="n">sessionTimeout</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Watcher</span><span class="o">()</span> <span class="o">{</span>

			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nc">WatchedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>

				<span class="c1">// æ”¶åˆ°äº‹ä»¶é€šçŸ¥åçš„å›è°ƒå‡½æ•°ï¼ˆç”¨æˆ·çš„ä¸šåŠ¡é€»è¾‘ï¼‰</span>
				<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">event</span><span class="o">.</span><span class="na">getType</span><span class="o">()</span> <span class="o">+</span> <span class="s">"--"</span> <span class="o">+</span> <span class="n">event</span><span class="o">.</span><span class="na">getPath</span><span class="o">());</span>

				<span class="c1">// å†æ¬¡å¯åŠ¨ç›‘å¬</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">zkClient</span><span class="o">.</span><span class="na">getChildren</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>

</code></pre></div></div>

<h5 id="åˆ›å»ºå­èŠ‚ç‚¹">åˆ›å»ºå­èŠ‚ç‚¹</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆ›å»ºå­èŠ‚ç‚¹</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">create</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

		<span class="c1">// å‚æ•°1ï¼šè¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è·¯å¾„ï¼› å‚æ•°2ï¼šèŠ‚ç‚¹æ•°æ® ï¼› å‚æ•°3ï¼šèŠ‚ç‚¹æƒé™ ï¼›å‚æ•°4ï¼šèŠ‚ç‚¹çš„ç±»å‹</span>
		<span class="nc">String</span> <span class="n">nodeCreated</span> <span class="o">=</span> <span class="n">zkClient</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"/atguigu"</span><span class="o">,</span> <span class="s">"jinlian"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="nc">Ids</span><span class="o">.</span><span class="na">OPEN_ACL_UNSAFE</span><span class="o">,</span> <span class="nc">CreateMode</span><span class="o">.</span><span class="na">PERSISTENT</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<h5 id="ç›‘å¬èŠ‚ç‚¹">ç›‘å¬èŠ‚ç‚¹</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// è·å–å­èŠ‚ç‚¹</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getChildren</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">zkClient</span><span class="o">.</span><span class="na">getChildren</span><span class="o">(</span><span class="s">"/"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

		<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
			<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
		<span class="o">}</span>

		<span class="c1">// å»¶æ—¶é˜»å¡</span>
		<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<h5 id="åˆ¤æ–­èŠ‚ç‚¹å­˜åœ¨">åˆ¤æ–­èŠ‚ç‚¹å­˜åœ¨</h5>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åˆ¤æ–­znodeæ˜¯å¦å­˜åœ¨</span>
<span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">exist</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

	<span class="nc">Stat</span> <span class="n">stat</span> <span class="o">=</span> <span class="n">zkClient</span><span class="o">.</span><span class="na">exists</span><span class="o">(</span><span class="s">"/eclipse"</span><span class="o">,</span> <span class="kc">false</span><span class="o">);</span>

	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">stat</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">"not exist"</span> <span class="o">:</span> <span class="s">"exist"</span><span class="o">);</span>
<span class="o">}</span>

</code></pre></div></div>

<h5 id="ç›‘å¬æœåŠ¡å™¨ä¸Šä¸‹çº¿">ç›‘å¬æœåŠ¡å™¨ä¸Šä¸‹çº¿</h5>

<ul>
  <li>æŸåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸»èŠ‚ç‚¹å¯ä»¥æœ‰å¤šå°ï¼Œå¯ä»¥åŠ¨æ€ä¸Šä¸‹çº¿ï¼Œä»»æ„ä¸€å°å®¢æˆ·ç«¯éƒ½èƒ½å®æ—¶æ„ŸçŸ¥åˆ°ä¸»èŠ‚ç‚¹æœåŠ¡å™¨çš„ä¸Šä¸‹çº¿</li>
  <li>å…ˆåœ¨é›†ç¾¤ä¸Šåˆ›å»º/serversèŠ‚ç‚¹</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[zk: localhost:2181(CONNECTED) 10] create /servers "servers"
Created /servers
</code></pre></div></div>

<ul>
  <li>æœåŠ¡å™¨ç«¯å‘Zookeeperæ³¨å†Œä»£ç </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.CreateMode</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.WatchedEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.Watcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.ZooKeeper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.ZooDefs.Ids</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DistributeServer</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">connectString</span> <span class="o">=</span> <span class="s">"hadoop102:2181,hadoop103:2181,hadoop104:2181"</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">sessionTimeout</span> <span class="o">=</span> <span class="mi">2000</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">ZooKeeper</span> <span class="n">zk</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">parentNode</span> <span class="o">=</span> <span class="s">"/servers"</span><span class="o">;</span>
	
	<span class="c1">// åˆ›å»ºåˆ°zkçš„å®¢æˆ·ç«¯è¿æ¥</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getConnect</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">{</span>
		
		<span class="n">zk</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ZooKeeper</span><span class="o">(</span><span class="n">connectString</span><span class="o">,</span> <span class="n">sessionTimeout</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Watcher</span><span class="o">()</span> <span class="o">{</span>

			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nc">WatchedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>

			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>
	
	<span class="c1">// æ³¨å†ŒæœåŠ¡å™¨</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registServer</span><span class="o">(</span><span class="nc">String</span> <span class="n">hostname</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>

		<span class="nc">String</span> <span class="n">create</span> <span class="o">=</span> <span class="n">zk</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">parentNode</span> <span class="o">+</span> <span class="s">"/server"</span><span class="o">,</span> <span class="n">hostname</span><span class="o">.</span><span class="na">getBytes</span><span class="o">(),</span> <span class="nc">Ids</span><span class="o">.</span><span class="na">OPEN_ACL_UNSAFE</span><span class="o">,</span> <span class="nc">CreateMode</span><span class="o">.</span><span class="na">EPHEMERAL_SEQUENTIAL</span><span class="o">);</span>
		
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hostname</span> <span class="o">+</span><span class="s">" is online "</span><span class="o">+</span> <span class="n">create</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="c1">// ä¸šåŠ¡åŠŸèƒ½</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">business</span><span class="o">(</span><span class="nc">String</span> <span class="n">hostname</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">hostname</span><span class="o">+</span><span class="s">" is working ..."</span><span class="o">);</span>
		
		<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
	<span class="o">}</span>
	
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		
<span class="c1">// 1è·å–zkè¿æ¥</span>
		<span class="nc">DistributeServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DistributeServer</span><span class="o">();</span>
		<span class="n">server</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>
		
		<span class="c1">// 2 åˆ©ç”¨zkè¿æ¥æ³¨å†ŒæœåŠ¡å™¨ä¿¡æ¯</span>
		<span class="n">server</span><span class="o">.</span><span class="na">registServer</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
		
		<span class="c1">// 3 å¯åŠ¨ä¸šåŠ¡åŠŸèƒ½</span>
		<span class="n">server</span><span class="o">.</span><span class="na">business</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>å®¢æˆ·ç«¯ä»£ç </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.WatchedEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.Watcher</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.zookeeper.ZooKeeper</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DistributeClient</span> <span class="o">{</span>

	<span class="kd">private</span> <span class="kd">static</span> <span class="nc">String</span> <span class="n">connectString</span> <span class="o">=</span> <span class="s">"hadoop102:2181,hadoop103:2181,hadoop104:2181"</span><span class="o">;</span>
	<span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">sessionTimeout</span> <span class="o">=</span> <span class="mi">2000</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">ZooKeeper</span> <span class="n">zk</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
	<span class="kd">private</span> <span class="nc">String</span> <span class="n">parentNode</span> <span class="o">=</span> <span class="s">"/servers"</span><span class="o">;</span>

	<span class="c1">// åˆ›å»ºåˆ°zkçš„å®¢æˆ·ç«¯è¿æ¥</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getConnect</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
		<span class="n">zk</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ZooKeeper</span><span class="o">(</span><span class="n">connectString</span><span class="o">,</span> <span class="n">sessionTimeout</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Watcher</span><span class="o">()</span> <span class="o">{</span>

			<span class="nd">@Override</span>
			<span class="kd">public</span> <span class="kt">void</span> <span class="nf">process</span><span class="o">(</span><span class="nc">WatchedEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>

				<span class="c1">// å†æ¬¡å¯åŠ¨ç›‘å¬</span>
				<span class="k">try</span> <span class="o">{</span>
					<span class="n">getServerList</span><span class="o">();</span>
				<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
					<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
				<span class="o">}</span>
			<span class="o">}</span>
		<span class="o">});</span>
	<span class="o">}</span>

	<span class="c1">// è·å–æœåŠ¡å™¨åˆ—è¡¨ä¿¡æ¯</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">getServerList</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		
		<span class="c1">// 1è·å–æœåŠ¡å™¨å­èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¹¶ä¸”å¯¹çˆ¶èŠ‚ç‚¹è¿›è¡Œç›‘å¬</span>
		<span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">children</span> <span class="o">=</span> <span class="n">zk</span><span class="o">.</span><span class="na">getChildren</span><span class="o">(</span><span class="n">parentNode</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="c1">// 2å­˜å‚¨æœåŠ¡å™¨ä¿¡æ¯åˆ—è¡¨</span>
		<span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">servers</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
		
        <span class="c1">// 3éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œè·å–èŠ‚ç‚¹ä¸­çš„ä¸»æœºåç§°ä¿¡æ¯</span>
		<span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">child</span> <span class="o">:</span> <span class="n">children</span><span class="o">)</span> <span class="o">{</span>
			<span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="n">zk</span><span class="o">.</span><span class="na">getData</span><span class="o">(</span><span class="n">parentNode</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">child</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>

			<span class="n">servers</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">data</span><span class="o">));</span>
		<span class="o">}</span>

        <span class="c1">// 4æ‰“å°æœåŠ¡å™¨åˆ—è¡¨ä¿¡æ¯</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">servers</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="c1">// ä¸šåŠ¡åŠŸèƒ½</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">business</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>

		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"client is working ..."</span><span class="o">);</span>
<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="nc">Long</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">);</span>
	<span class="o">}</span>

	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

		<span class="c1">// 1è·å–zkè¿æ¥</span>
		<span class="nc">DistributeClient</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DistributeClient</span><span class="o">();</span>
		<span class="n">client</span><span class="o">.</span><span class="na">getConnect</span><span class="o">();</span>

		<span class="c1">// 2è·å–serversçš„å­èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»ä¸­è·å–æœåŠ¡å™¨ä¿¡æ¯åˆ—è¡¨</span>
		<span class="n">client</span><span class="o">.</span><span class="na">getServerList</span><span class="o">();</span>

		<span class="c1">// 3ä¸šåŠ¡è¿›ç¨‹å¯åŠ¨</span>
		<span class="n">client</span><span class="o">.</span><span class="na">business</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

:ET