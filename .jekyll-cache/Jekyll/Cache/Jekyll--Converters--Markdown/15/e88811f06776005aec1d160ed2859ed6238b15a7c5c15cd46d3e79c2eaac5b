I"Pà<ul id="markdown-toc">
  <li><a href="#1åŸºç¡€ç†è®º" id="markdown-toc-1åŸºç¡€ç†è®º">1ï¼šåŸºç¡€ç†è®º</a>    <ul>
      <li><a href="#11å¾®æœåŠ¡å„ç»„ä»¶æ¦‚è§ˆ" id="markdown-toc-11å¾®æœåŠ¡å„ç»„ä»¶æ¦‚è§ˆ">1.1å¾®æœåŠ¡å„ç»„ä»¶æ¦‚è§ˆ</a></li>
      <li><a href="#12å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º" id="markdown-toc-12å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º">1.2å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</a>        <ul>
          <li><a href="#121çˆ¶å·¥ç¨‹" id="markdown-toc-121çˆ¶å·¥ç¨‹">1.2.1çˆ¶å·¥ç¨‹</a></li>
          <li><a href="#122commonæ¨¡å—" id="markdown-toc-122commonæ¨¡å—">1.2.2commonæ¨¡å—</a></li>
          <li><a href="#123å¾®æœåŠ¡æä¾›è€…æ”¯ä»˜æ¨¡å—8001" id="markdown-toc-123å¾®æœåŠ¡æä¾›è€…æ”¯ä»˜æ¨¡å—8001">1.2.3å¾®æœåŠ¡æä¾›è€…æ”¯ä»˜æ¨¡å—8001</a></li>
          <li><a href="#124å¾®æœåŠ¡æ¶ˆè´¹è€…è®¢å•æ¨¡å—80" id="markdown-toc-124å¾®æœåŠ¡æ¶ˆè´¹è€…è®¢å•æ¨¡å—80">1.2.4å¾®æœåŠ¡æ¶ˆè´¹è€…è®¢å•æ¨¡å—80</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#2eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°" id="markdown-toc-2eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°">2ï¼šEurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</a>    <ul>
      <li><a href="#21åŸºç¡€çŸ¥è¯†" id="markdown-toc-21åŸºç¡€çŸ¥è¯†">2.1åŸºç¡€çŸ¥è¯†</a></li>
      <li><a href="#22å•æœºæ„å»º" id="markdown-toc-22å•æœºæ„å»º">2.2å•æœºæ„å»º</a>        <ul>
          <li><a href="#221eurekaserver7001" id="markdown-toc-221eurekaserver7001">2.2.1eurekaServer7001</a></li>
          <li><a href="#222eurekaclient" id="markdown-toc-222eurekaclient">2.2.2eurekaClient</a>            <ul>
              <li><a href="#æ³¨å†ŒæœåŠ¡æä¾›è€…8001" id="markdown-toc-æ³¨å†ŒæœåŠ¡æä¾›è€…8001">æ³¨å†ŒæœåŠ¡æä¾›è€…8001</a></li>
              <li><a href="#æ³¨å†ŒæœåŠ¡æ¶ˆè´¹è€…80" id="markdown-toc-æ³¨å†ŒæœåŠ¡æ¶ˆè´¹è€…80">æ³¨å†ŒæœåŠ¡æ¶ˆè´¹è€…80</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li><a href="#23é›†ç¾¤æ„å»º" id="markdown-toc-23é›†ç¾¤æ„å»º">2.3é›†ç¾¤æ„å»º</a>        <ul>
          <li><a href="#eurekaé›†ç¾¤" id="markdown-toc-eurekaé›†ç¾¤">Eurekaé›†ç¾¤</a></li>
          <li><a href="#æœåŠ¡æä¾›è€…é›†ç¾¤" id="markdown-toc-æœåŠ¡æä¾›è€…é›†ç¾¤">æœåŠ¡æä¾›è€…é›†ç¾¤</a></li>
          <li><a href="#è´Ÿè½½å‡è¡¡" id="markdown-toc-è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</a></li>
          <li><a href="#discoveryæœåŠ¡å‘ç°" id="markdown-toc-discoveryæœåŠ¡å‘ç°">DiscoveryæœåŠ¡å‘ç°</a></li>
          <li><a href="#è‡ªæˆ‘ä¿æŠ¤" id="markdown-toc-è‡ªæˆ‘ä¿æŠ¤">è‡ªæˆ‘ä¿æŠ¤</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#3zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°" id="markdown-toc-3zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°">3ï¼šZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°</a>    <ul>
      <li><a href="#31æœåŠ¡æä¾›è€…8004" id="markdown-toc-31æœåŠ¡æä¾›è€…8004">3.1æœåŠ¡æä¾›è€…8004</a></li>
      <li><a href="#32æœåŠ¡æ¶ˆè´¹è€…80" id="markdown-toc-32æœåŠ¡æ¶ˆè´¹è€…80">3.2æœåŠ¡æ¶ˆè´¹è€…80</a></li>
    </ul>
  </li>
  <li><a href="#4consulæœåŠ¡æ³¨å†Œä¸å‘ç°" id="markdown-toc-4consulæœåŠ¡æ³¨å†Œä¸å‘ç°">4:ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°</a>    <ul>
      <li><a href="#41å®‰è£…ä¸è¿è¡Œ" id="markdown-toc-41å®‰è£…ä¸è¿è¡Œ">4.1å®‰è£…ä¸è¿è¡Œ</a></li>
      <li><a href="#42æœåŠ¡æä¾›è€…8006" id="markdown-toc-42æœåŠ¡æä¾›è€…8006">4.2æœåŠ¡æä¾›è€…8006</a></li>
      <li><a href="#43æœåŠ¡æ¶ˆè´¹è€…80" id="markdown-toc-43æœåŠ¡æ¶ˆè´¹è€…80">4.3æœåŠ¡æ¶ˆè´¹è€…80</a></li>
    </ul>
  </li>
  <li><a href="#5æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ" id="markdown-toc-5æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ">5ï¼šæ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</a></li>
  <li><a href="#6ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨" id="markdown-toc-6ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨">6ï¼šRibbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨</a>    <ul>
      <li><a href="#resttemplate" id="markdown-toc-resttemplate">RestTemplate</a></li>
      <li><a href="#æ ¸å¿ƒç»„ä»¶irule" id="markdown-toc-æ ¸å¿ƒç»„ä»¶irule">æ ¸å¿ƒç»„ä»¶IRule</a></li>
      <li><a href="#è´Ÿè½½å‡è¡¡ç®—æ³•" id="markdown-toc-è´Ÿè½½å‡è¡¡ç®—æ³•">è´Ÿè½½å‡è¡¡ç®—æ³•</a></li>
    </ul>
  </li>
  <li><a href="#7openfeignæœåŠ¡æ¥å£è°ƒç”¨" id="markdown-toc-7openfeignæœåŠ¡æ¥å£è°ƒç”¨">7ï¼šOpenFeignæœåŠ¡æ¥å£è°ƒç”¨</a>    <ul>
      <li><a href="#71ä½¿ç”¨æ­¥éª¤" id="markdown-toc-71ä½¿ç”¨æ­¥éª¤">7.1ä½¿ç”¨æ­¥éª¤</a></li>
      <li><a href="#72è¶…æ—¶æ§åˆ¶" id="markdown-toc-72è¶…æ—¶æ§åˆ¶">7.2è¶…æ—¶æ§åˆ¶</a></li>
      <li><a href="#73æ—¥å¿—æ‰“å°" id="markdown-toc-73æ—¥å¿—æ‰“å°">7.3æ—¥å¿—æ‰“å°</a></li>
    </ul>
  </li>
  <li><a href="#8hystrixæ–­è·¯å™¨" id="markdown-toc-8hystrixæ–­è·¯å™¨">8ï¼šHystrixæ–­è·¯å™¨</a>    <ul>
      <li><a href="#81æœåŠ¡æä¾›è€…8001" id="markdown-toc-81æœåŠ¡æä¾›è€…8001">8.1æœåŠ¡æä¾›è€…8001</a></li>
      <li><a href="#82æœåŠ¡æ¶ˆè´¹è€…80" id="markdown-toc-82æœåŠ¡æ¶ˆè´¹è€…80">8.2æœåŠ¡æ¶ˆè´¹è€…80</a></li>
      <li><a href="#83æœåŠ¡é™çº§" id="markdown-toc-83æœåŠ¡é™çº§">8.3æœåŠ¡é™çº§</a></li>
      <li><a href="#84æœåŠ¡ç†”æ–­" id="markdown-toc-84æœåŠ¡ç†”æ–­">8.4æœåŠ¡ç†”æ–­</a></li>
      <li><a href="#85æœåŠ¡ç›‘æ§9001" id="markdown-toc-85æœåŠ¡ç›‘æ§9001">8.5æœåŠ¡ç›‘æ§9001</a></li>
    </ul>
  </li>
  <li><a href="#9gatewayæ–°ä¸€ä»£ç½‘å…³" id="markdown-toc-9gatewayæ–°ä¸€ä»£ç½‘å…³">9ï¼šGatewayæ–°ä¸€ä»£ç½‘å…³</a>    <ul>
      <li><a href="#91æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œæµç¨‹" id="markdown-toc-91æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œæµç¨‹">9.1æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œæµç¨‹</a></li>
      <li><a href="#92å…¥é—¨é…ç½®9527" id="markdown-toc-92å…¥é—¨é…ç½®9527">9.2å…¥é—¨é…ç½®9527</a></li>
      <li><a href="#93åŠ¨æ€è·¯ç”±" id="markdown-toc-93åŠ¨æ€è·¯ç”±">9.3åŠ¨æ€è·¯ç”±</a></li>
      <li><a href="#94predicateçš„ä½¿ç”¨" id="markdown-toc-94predicateçš„ä½¿ç”¨">9.4Predicateçš„ä½¿ç”¨</a></li>
      <li><a href="#95filterçš„ä½¿ç”¨" id="markdown-toc-95filterçš„ä½¿ç”¨">9.5Filterçš„ä½¿ç”¨</a></li>
    </ul>
  </li>
  <li><a href="#10configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ" id="markdown-toc-10configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ">10ï¼šConfigåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</a>    <ul>
      <li><a href="#101æœåŠ¡ç«¯é…ç½®3344" id="markdown-toc-101æœåŠ¡ç«¯é…ç½®3344">10.1æœåŠ¡ç«¯é…ç½®3344</a></li>
      <li><a href="#102å®¢æˆ·ç«¯é…ç½®3355" id="markdown-toc-102å®¢æˆ·ç«¯é…ç½®3355">10.2å®¢æˆ·ç«¯é…ç½®3355</a></li>
      <li><a href="#103å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°" id="markdown-toc-103å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°">10.3å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°</a></li>
    </ul>
  </li>
  <li><a href="#11busæ¶ˆæ¯æ€»çº¿" id="markdown-toc-11busæ¶ˆæ¯æ€»çº¿">11ï¼šBusæ¶ˆæ¯æ€»çº¿</a>    <ul>
      <li><a href="#111rabbitmqç¯å¢ƒé…ç½®" id="markdown-toc-111rabbitmqç¯å¢ƒé…ç½®">11.1RabbitMQç¯å¢ƒé…ç½®</a></li>
      <li><a href="#112busåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­" id="markdown-toc-112busåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­">11.2BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­</a></li>
      <li><a href="#113busåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥" id="markdown-toc-113busåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥">11.3BusåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥</a></li>
    </ul>
  </li>
  <li><a href="#12streamæ¶ˆæ¯é©±åŠ¨" id="markdown-toc-12streamæ¶ˆæ¯é©±åŠ¨">12ï¼šStreamæ¶ˆæ¯é©±åŠ¨</a>    <ul>
      <li><a href="#121æ¶ˆæ¯é©±åŠ¨ç”Ÿäº§è€…8801" id="markdown-toc-121æ¶ˆæ¯é©±åŠ¨ç”Ÿäº§è€…8801">12.1æ¶ˆæ¯é©±åŠ¨ç”Ÿäº§è€…8801</a></li>
      <li><a href="#122æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…8802" id="markdown-toc-122æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…8802">12.2æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…8802</a></li>
      <li><a href="#123åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–" id="markdown-toc-123åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–">12.3åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–</a></li>
    </ul>
  </li>
  <li><a href="#13sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª" id="markdown-toc-13sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª">13ï¼šSleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª</a></li>
</ul>
<h3 id="1åŸºç¡€ç†è®º">1ï¼šåŸºç¡€ç†è®º</h3>

<h4 id="11å¾®æœåŠ¡å„ç»„ä»¶æ¦‚è§ˆ">1.1å¾®æœåŠ¡å„ç»„ä»¶æ¦‚è§ˆ</h4>

<ul>
  <li>æœåŠ¡æ³¨å†Œä¸­å¿ƒï¼š
    <ul>
      <li>Eureka</li>
      <li>Zookeeper</li>
      <li>Consul</li>
      <li>Nacos</li>
    </ul>
  </li>
  <li>æœåŠ¡è°ƒç”¨ï¼š
    <ul>
      <li>Ribbon</li>
      <li>LoadBalancer</li>
      <li>Feign</li>
      <li>OpenFeign</li>
    </ul>
  </li>
  <li>æœåŠ¡é™çº§ï¼š
    <ul>
      <li>Hyxtrix</li>
      <li>resilience4j</li>
      <li>sentienl</li>
    </ul>
  </li>
  <li>æœåŠ¡ç½‘å…³ï¼š
    <ul>
      <li>Zuul</li>
      <li>Zuul2</li>
      <li>gateway</li>
    </ul>
  </li>
  <li>æœåŠ¡é…ç½®ï¼š
    <ul>
      <li>Config</li>
      <li>Nacos</li>
    </ul>
  </li>
  <li>æœåŠ¡æ€»çº¿ï¼š
    <ul>
      <li>Bus</li>
      <li>Nacos</li>
    </ul>
  </li>
</ul>

<h4 id="12å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º">1.2å¾®æœåŠ¡æ¶æ„ç¼–ç æ„å»º</h4>

<ul>
  <li><strong>çº¦å®š&gt;é…ç½®&gt;ç¼–ç </strong></li>
</ul>

<h5 id="121çˆ¶å·¥ç¨‹">1.2.1çˆ¶å·¥ç¨‹</h5>

<ul>
  <li>æ–°å»ºmavenå·¥ç¨‹ï¼Œé€‰<code class="language-plaintext highlighter-rouge">maven-archetype-site</code></li>
  <li>å·¥ç¨‹åç§°å’Œé¡¹ç›®åç§°ä¸ºï¼šcloud2020</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

  <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
  <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
  <span class="nt">&lt;packaging&gt;</span>pom<span class="nt">&lt;/packaging&gt;</span>


  <span class="c">&lt;!-- ç»Ÿä¸€ç®¡ç†jaråŒ…ç‰ˆæœ¬ --&gt;</span>
  <span class="nt">&lt;properties&gt;</span>
    <span class="nt">&lt;project.build.sourceEncoding&gt;</span>UTF-8<span class="nt">&lt;/project.build.sourceEncoding&gt;</span>
    <span class="nt">&lt;maven.compiler.source&gt;</span>1.8<span class="nt">&lt;/maven.compiler.source&gt;</span>
    <span class="nt">&lt;maven.compiler.target&gt;</span>1.8<span class="nt">&lt;/maven.compiler.target&gt;</span>
    <span class="nt">&lt;junit.version&gt;</span>4.12<span class="nt">&lt;/junit.version&gt;</span>
    <span class="nt">&lt;log4j.version&gt;</span>1.2.17<span class="nt">&lt;/log4j.version&gt;</span>
    <span class="nt">&lt;lombok.version&gt;</span>1.16.18<span class="nt">&lt;/lombok.version&gt;</span>
    <span class="nt">&lt;mysql.version&gt;</span>5.1.47<span class="nt">&lt;/mysql.version&gt;</span>
    <span class="nt">&lt;druid.version&gt;</span>1.1.16<span class="nt">&lt;/druid.version&gt;</span>
    <span class="nt">&lt;mybatis.spring.boot.version&gt;</span>1.3.0<span class="nt">&lt;/mybatis.spring.boot.version&gt;</span>
  <span class="nt">&lt;/properties&gt;</span>

  <span class="c">&lt;!-- å­æ¨¡å—ç»§æ‰¿ä¹‹åï¼Œæä¾›ä½œç”¨ï¼šé”å®šç‰ˆæœ¬+å­modlueä¸ç”¨å†™groupIdå’Œversion  --&gt;</span>
  <span class="nt">&lt;dependencyManagement&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
      <span class="c">&lt;!--spring boot 2.2.2--&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-dependencies<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.2.2.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="c">&lt;!--spring cloud Hoxton.SR1--&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-dependencies<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>Hoxton.SR1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="c">&lt;!--spring cloud alibaba 2.1.0.RELEASE--&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.alibaba.cloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-alibaba-dependencies<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>2.1.0.RELEASE<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;type&gt;</span>pom<span class="nt">&lt;/type&gt;</span>
        <span class="nt">&lt;scope&gt;</span>import<span class="nt">&lt;/scope&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>

      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${mysql.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>druid<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${druid.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${mybatis.spring.boot.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${junit.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>log4j<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>log4j<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${log4j.version}<span class="nt">&lt;/version&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
      <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${lombok.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
      <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
  <span class="nt">&lt;/dependencyManagement&gt;</span>

  <span class="nt">&lt;build&gt;</span>
    <span class="nt">&lt;plugins&gt;</span>
      <span class="nt">&lt;plugin&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;configuration&gt;</span>
          <span class="nt">&lt;fork&gt;</span>true<span class="nt">&lt;/fork&gt;</span>
          <span class="nt">&lt;addResources&gt;</span>true<span class="nt">&lt;/addResources&gt;</span>
        <span class="nt">&lt;/configuration&gt;</span>
      <span class="nt">&lt;/plugin&gt;</span>
    <span class="nt">&lt;/plugins&gt;</span>
  <span class="nt">&lt;/build&gt;</span>

<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>çˆ¶å·¥ç¨‹åˆ›å»ºå®Œæˆæ‰§è¡Œmvn:installå°†çˆ¶å·¥ç¨‹å‘å¸ƒåˆ°ä»“åº“æ–¹ä¾¿å­å·¥ç¨‹ç»§æ‰¿</li>
</ul>

<h5 id="122commonæ¨¡å—">1.2.2commonæ¨¡å—</h5>

<ul>
  <li>ç³»ç»Ÿä¸­æœ‰é‡å¤éƒ¨åˆ†ï¼Œé‡æ„</li>
  <li>åœ¨çˆ¶å·¥ç¨‹ä¸‹åˆ›å»ºcloud-api-commons</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
           <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/cn.hutool/hutool-all --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>cn.hutool<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>hutool-all<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>5.1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>å®ä½“ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Payment</span> <span class="kd">implements</span> <span class="nc">Serializable</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serial</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>jsonå°è£…ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Data</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CommonResult</span> <span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;{</span>

    <span class="kd">private</span> <span class="nc">Integer</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">message</span><span class="o">;</span>
    <span class="kd">private</span> <span class="no">T</span> <span class="n">data</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">code</span><span class="o">,</span><span class="nc">String</span> <span class="n">message</span><span class="o">){</span>
        <span class="k">this</span><span class="o">(</span><span class="n">code</span><span class="o">,</span><span class="n">message</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>mavenå‘½ä»¤clean install</li>
</ul>

<h5 id="123å¾®æœåŠ¡æä¾›è€…æ”¯ä»˜æ¨¡å—8001">1.2.3å¾®æœåŠ¡æä¾›è€…æ”¯ä»˜æ¨¡å—8001</h5>

<ul>
  <li>åœ¨çˆ¶å·¥ç¨‹ä¸‹å»ºcloud-provider-payment8001é¡¹ç›®</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-provider-payment8001<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--å¼•ç”¨commonæ¨¡å—--&gt;</span>
      	<span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/druid --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.alibaba<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>druid-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.1.10<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-jdbc --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-jdbc<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
           <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


    <span class="nt">&lt;/dependencies&gt;</span>


<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>


<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-payment-service</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">com.alibaba.druid.pool.DruidDataSource</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">org.gjt.mm.mysql.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/db2019?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">password</span><span class="pi">:</span> <span class="m">123456</span>

<span class="na">mybatis</span><span class="pi">:</span>
  <span class="na">mapperLocations</span><span class="pi">:</span> <span class="s">classpath:mapper/*.xml</span>
  <span class="na">type-aliases-package</span><span class="pi">:</span> <span class="s">com.atguigu.springcloud.entities</span>
 
 

</code></pre></div></div>

<ul>
  <li>å»ºè¡¨</li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`zhifu`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`serial`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'æµæ°´å·'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>mybatisæ˜ å°„</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="cp">&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">"com.atguigu.springcloud.dao.PaymentDao"</span><span class="nt">&gt;</span>


    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">"create"</span> <span class="na">parameterType=</span><span class="s">"Payment"</span> <span class="na">useGeneratedKeys=</span><span class="s">"true"</span> <span class="na">keyProperty=</span><span class="s">"id"</span><span class="nt">&gt;</span>
            insert into payment(serial) values(${serial});

    <span class="nt">&lt;/insert&gt;</span>

    <span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">"BaseResultMap"</span> <span class="na">type=</span><span class="s">"com.atguigu.springcloud.entities.Payment"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">"id"</span> <span class="na">property=</span><span class="s">"id"</span> <span class="na">jdbcType=</span><span class="s">"BIGINT"</span><span class="nt">&gt;&lt;/id&gt;</span>
        <span class="nt">&lt;id</span> <span class="na">column=</span><span class="s">"serial"</span> <span class="na">property=</span><span class="s">"serial"</span> <span class="na">jdbcType=</span><span class="s">"VARCHAR"</span><span class="nt">&gt;&lt;/id&gt;</span>
    <span class="nt">&lt;/resultMap&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">"getPaymentById"</span>  <span class="na">parameterType=</span><span class="s">"Long"</span> <span class="na">resultMap=</span><span class="s">"BaseResultMap"</span><span class="nt">&gt;</span>
            select * from payment where id=#{id}
    <span class="nt">&lt;/select&gt;</span>


<span class="nt">&lt;/mapper&gt;</span>
</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentServiceImpl</span> <span class="kd">implements</span> <span class="nc">PaymentService</span> <span class="o">{</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentDao</span> <span class="n">paymentDao</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Payment</span> <span class="n">payment</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">paymentDao</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">payment</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Payment</span> <span class="nf">getPaymentById</span><span class="o">(</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">){</span>

        <span class="k">return</span> <span class="n">paymentDao</span><span class="o">.</span><span class="na">getPaymentById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentController</span> <span class="o">{</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentService</span> <span class="n">paymentService</span><span class="o">;</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/create"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">Payment</span> <span class="n">payment</span><span class="o">){</span>
       <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">payment</span><span class="o">);</span>
       <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*****æ’å…¥ç»“æœï¼š"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
       <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">){</span>  <span class="c1">//æˆåŠŸ</span>
           <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="s">"æ’å…¥æ•°æ®åº“æˆåŠŸ"</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
       <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
           <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">444</span><span class="o">,</span><span class="s">"æ’å…¥æ•°æ®åº“å¤±è´¥"</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
       <span class="o">}</span>
    <span class="o">}</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/get/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span> <span class="nf">getPaymentById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">getPaymentById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*****æŸ¥è¯¢ç»“æœï¼š"</span><span class="o">+</span><span class="n">payment</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">payment</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>  <span class="c1">//è¯´æ˜æœ‰æ•°æ®ï¼Œèƒ½æŸ¥è¯¢æˆåŠŸ</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="s">"æŸ¥è¯¢æˆåŠŸ"</span><span class="o">,</span><span class="n">payment</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">444</span><span class="o">,</span><span class="s">"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š"</span><span class="o">+</span><span class="n">id</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h5 id="124å¾®æœåŠ¡æ¶ˆè´¹è€…è®¢å•æ¨¡å—80">1.2.4å¾®æœåŠ¡æ¶ˆè´¹è€…è®¢å•æ¨¡å—80</h5>

<ul>
  <li>åœ¨çˆ¶å·¥ç¨‹ä¸‹å»ºcloud-consumer-order80</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-consumer-order80<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
      	<span class="c">&lt;!--å¼•ç”¨commonæ¨¡å—--&gt;</span>
      	<span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
 
 

</code></pre></div></div>

<ul>
  <li>é…ç½®ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContextConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RestTemplate</span> <span class="nf">getRestTemplate</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RestTemplate</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>RestTemplateï¼šæä¾›äº†å¤šç§ä¾¿æ·è®¿é—®è¿œç¨‹HTTPæœåŠ¡çš„æ–¹æ³•ï¼Œæ˜¯ä¸€ç§ç®€å•çš„è®¿é—®restfulæœåŠ¡æ¨¡æ¿ç±»ï¼Œæ˜¯springæä¾›çš„ç”¨äºè®¿é—®restæœåŠ¡çš„<strong>å®¢æˆ·ç«¯æ¨¡æ¿å·¥å…·é›†</strong></li>
  <li>ä¸‰ä¸ªå‚æ•°
    <ul>
      <li>urlï¼šrestè¯·æ±‚åœ°å€</li>
      <li>requestMapï¼šè¯·æ±‚å‚æ•°</li>
      <li>ResponseBean.classï¼šHTTPå“åº”è¢«è½¬æ¢æˆçš„å¯¹è±¡ç±»å‹</li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">PAYMENT_URL</span> <span class="o">=</span> <span class="s">"http://localhost:8001"</span><span class="o">;</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/create"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span>   <span class="nf">create</span><span class="o">(</span><span class="nc">Payment</span> <span class="n">payment</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">postForObject</span><span class="o">(</span><span class="no">PAYMENT_URL</span><span class="o">+</span><span class="s">"/payment/create"</span><span class="o">,</span><span class="n">payment</span><span class="o">,</span><span class="nc">CommonResult</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>  <span class="c1">//å†™æ“ä½œ</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/get/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="nf">getPayment</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="no">PAYMENT_URL</span><span class="o">+</span><span class="s">"/payment/get/"</span><span class="o">+</span><span class="n">id</span><span class="o">,</span><span class="nc">CommonResult</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼šå…ˆå¯åŠ¨cloud-provider-payment8001ï¼Œå†å¯åŠ¨cloud-consumer-order80</li>
</ul>

<h3 id="2eurekaæœåŠ¡æ³¨å†Œä¸å‘ç°">2ï¼šEurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</h3>

<h4 id="21åŸºç¡€çŸ¥è¯†">2.1åŸºç¡€çŸ¥è¯†</h4>

<ul>
  <li>ä»€ä¹ˆæ˜¯æœåŠ¡æ²»ç†ï¼šåœ¨ä¼ ç»Ÿçš„rpcè¿œç¨‹è°ƒç”¨æ¡†æ¶ä¸­ï¼Œç®¡ç†æ¯ä¸ªæœåŠ¡ä¸æœåŠ¡ä¹‹é—´çš„ä¾èµ–å…³ç³»æ¯”è¾ƒå¤æ‚ï¼Œæ‰€ä»¥éœ€è¦æœåŠ¡æ²»ç†ï¼Œå¯ä»¥å®ç°<strong>æœåŠ¡è°ƒç”¨ï¼Œè´Ÿè½½å‡è¡¡ï¼Œå®¹é”™</strong>ç­‰ï¼Œå®ç°æœåŠ¡æ³¨å†Œä¸å‘ç°ã€‚</li>
  <li>ä»€ä¹ˆæ˜¯æœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šeurekaé‡‡ç”¨äº†csçš„è®¾è®¡æ¶æ„ï¼Œeureka serverä½œä¸ºæœåŠ¡æ³¨å†ŒåŠŸèƒ½çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯æœåŠ¡æ³¨å†Œä¸­å¿ƒã€‚è€Œç³»ç»Ÿä¸­çš„å…¶ä»–å¾®æœåŠ¡ï¼Œä½¿ç”¨eurekaå®¢æˆ·ç«¯è¿æ¥åˆ°eureka serverå¹¶ç»´æŒå¿ƒè·³è¿æ¥ã€‚è¿™æ ·ç³»ç»Ÿçš„ç»´æŠ¤äººå‘˜å°±å¯ä»¥é€šè¿‡eureka serveræ¥ç›‘æ§ç³»ç»Ÿä¸­å„ä¸ªå¾®æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚</li>
  <li>ä¸¤ä¸ªç»„ä»¶
    <ul>
      <li>eureka serverï¼šæä¾›æœåŠ¡æ³¨å†Œï¼Œå„ä¸ªå¾®æœåŠ¡èŠ‚ç‚¹é€šè¿‡é…ç½®å¯åŠ¨åï¼Œä¼šåœ¨eureka serverä¸­è¿›è¡Œæ³¨å†Œï¼Œè¿™æ ·eureka serverzä¸­çš„æœåŠ¡æ³¨å†Œè¡¨ä¸­å°†ä¼šå­˜å‚¨æ‰€æœ‰å¯ç”¨æœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯ï¼ŒæœåŠ¡èŠ‚ç‚¹çš„ä¿¡æ¯å¯ä»¥åœ¨ç•Œé¢ä¸­ç›´æ¥çœ‹åˆ°ã€‚</li>
      <li>eureka clientï¼šé€šè¿‡æ³¨å†Œä¸­å¿ƒè¿›è¡Œè®¿é—®ã€‚æ˜¯ä¸€ä¸ªJavaå®¢æˆ·ç«¯ï¼Œç”¨äºç®€åŒ–eureka serverçš„äº¤äº’ï¼Œå®¢æˆ·ç«¯åŒæ—¶ä¹Ÿå…·å¤‡ä¸€ä¸ªå†…ç½®çš„ï¼Œä½¿ç”¨è½®è¯¢ï¼ˆround-robinï¼‰è´Ÿè½½ç®—æ³•çš„è´Ÿè½½å‡è¡¡å™¨ã€‚åœ¨åº”ç”¨å¯åŠ¨åï¼Œå°†ä¼šå‘eureka serverå‘é€å¿ƒè·³ï¼ˆé»˜è®¤å‘¨æœŸä¸º30ç§’ï¼‰ã€‚å¦‚æœeureka serveråœ¨å¤šä¸ªå¿ƒè·³å‘¨æœŸå†…æ²¡æœ‰æ”¶åˆ°æŸä¸ªèŠ‚ç‚¹çš„å¿ƒè·³ï¼Œeureka serverä¼šå°†èŠ‚ç‚¹ä»æœåŠ¡æ³¨å†Œè¡¨ä¸­ç§»é™¤ï¼ˆé»˜è®¤90ç§’ï¼‰ã€‚</li>
    </ul>
  </li>
</ul>

<h4 id="22å•æœºæ„å»º">2.2å•æœºæ„å»º</h4>

<h5 id="221eurekaserver7001">2.2.1eurekaServer7001</h5>

<ul>
  <li>åˆ›å»ºeurekaServerç«¯æœåŠ¡æ³¨å†Œä¸­å¿ƒæ¨¡å—ï¼šcloud-eureka-server7001</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-eureka-server7001<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web  --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">7001</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="c1">#è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤true</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
    <span class="c1"># æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span>
    <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="c1">#è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://localhost:7001/eureka</span>
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableEurekaServer</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">EurekaMain7001</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">EurekaMain7001</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼š<code class="language-plaintext highlighter-rouge">http://localhost:7001/</code>ï¼Œä¼šå‡ºç°ç•Œé¢</li>
</ul>

<h5 id="222eurekaclient">2.2.2eurekaClient</h5>

<h6 id="æ³¨å†ŒæœåŠ¡æä¾›è€…8001">æ³¨å†ŒæœåŠ¡æä¾›è€…8001</h6>

<ul>
  <li>EurekaClientç«¯cloud-provider-payment8001ï¼ˆ1.2.3ï¼‰å°†æ³¨å†Œè¿›EurekaServeræˆä¸ºæœåŠ¡æä¾›è€…provider</li>
  <li>æ”¹pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>å†™yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="c1"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤true</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
    <span class="c1"># æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span>
       <span class="na">fetchRegistry</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://localhost:7001/eureka</span> 
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableEurekaClient</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentMain8001</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">PaymentMain8001</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼šå…ˆè¦å¯åŠ¨EurekaServerï¼Œ<code class="language-plaintext highlighter-rouge">http://localhost:7001/</code></li>
</ul>

<h6 id="æ³¨å†ŒæœåŠ¡æ¶ˆè´¹è€…80">æ³¨å†ŒæœåŠ¡æ¶ˆè´¹è€…80</h6>

<ul>
  <li>EurekaClientç«¯cloud-consumer-order80ï¼ˆ1.2.4ï¼‰å°†æ³¨å†Œè¿›EurekaServeræˆä¸ºæœåŠ¡æ¶ˆè´¹è€…consumer</li>
  <li>æ”¹pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>æ”¹yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-order-service</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">fetchRegistry</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://localhost:7001/eureka</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£<code class="language-plaintext highlighter-rouge">@EnableEurekaClient</code></p>
  </li>
  <li>
    <p>æµ‹è¯•ï¼š</p>

    <p>å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001æœåŠ¡</p>

    <p>å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001æœåŠ¡</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/get/31</code></p>
  </li>
</ul>

<h4 id="23é›†ç¾¤æ„å»º">2.3é›†ç¾¤æ„å»º</h4>

<h5 id="eurekaé›†ç¾¤">Eurekaé›†ç¾¤</h5>

<ul>
  <li>æ­å»ºEurekaæ³¨å†Œä¸­å¿ƒé›†ç¾¤ï¼Œå®ç°è´Ÿè½½å‡è¡¡+æ•…éšœå®¹é”™</li>
  <li>æ ¹æ®cloud-eureka-server7001åˆ›å»ºæ–°å»ºcloud-eureka-server7002</li>
  <li>ä¿®æ”¹hostsæ–‡ä»¶</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>127.0.0.1  eureka7001.com
127.0.0.1  eureka7002.com
</code></pre></div></div>

<ul>
  <li>7001YML</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">7001</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="c1">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åå­—</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">eureka7001.com</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="c1">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">false</span>
    <span class="c1">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span>
    <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="c1">#è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7002.com:7002/eureka/</span>
</code></pre></div></div>

<ul>
  <li>7002YML</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">7002</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="c1">#eurekaæœåŠ¡ç«¯çš„å®ä¾‹åå­—</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">eureka7002.com</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="c1">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">false</span>
    <span class="c1">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span>
    <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="c1">#è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka/</span>
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹æ”¯ä»˜æœåŠ¡8001å¾®æœåŠ¡å’Œæ¶ˆè´¹æœåŠ¡80å¾®æœåŠ¡çš„YML</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">service-url</span><span class="pi">:</span>
  <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span>  <span class="c1">#é›†ç¾¤ç‰ˆ</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡</p>

    <p>å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001æœåŠ¡</p>

    <p>å†è¦å¯åŠ¨æ¶ˆè´¹è€…ï¼Œ80</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/get/31</code></p>
  </li>
</ul>

<h5 id="æœåŠ¡æä¾›è€…é›†ç¾¤">æœåŠ¡æä¾›è€…é›†ç¾¤</h5>

<ul>
  <li>å‚è€ƒcloud-provider-payment8001æ–°å»ºcloud-provider-payment8002ï¼ˆdaoï¼Œserviceï¼Œmapperï¼Œcontrollerï¼‰</li>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8002</span>


<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">zhifu</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">com.alibaba.druid.pool.DruidDataSource</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">org.gjt.mm.mysql.Driver</span>
    <span class="na">url</span><span class="pi">:</span> <span class="s">jdbc:mysql://localhost:3306/springcloud?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">password</span><span class="pi">:</span> <span class="m">123456</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="c1"># è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServerï¼Œé»˜è®¤true</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
    <span class="c1"># æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span>
    <span class="na">fetchRegistry</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span>  <span class="c1">#é›†ç¾¤ç‰ˆ</span>
    <span class="na">instance</span><span class="pi">:</span>
      <span class="na">instance-id</span><span class="pi">:</span> <span class="s">payment8002</span> <span class="c1">#ä¸»æœºåé—®é¢˜</span>
      <span class="na">prefer-ip-address</span><span class="pi">:</span> <span class="no">true</span> <span class="c1">#è®¿é—®è·¯å¾„å¯ä»¥æ˜¾ç¤ºIPåœ°å€</span>


<span class="na">mybatis</span><span class="pi">:</span>
  <span class="na">mapperLocations</span><span class="pi">:</span> <span class="s">classpath:mapper/*.xml</span>
  <span class="na">type-aliases-package</span><span class="pi">:</span> <span class="s">com.atguigu.springcloud.entities</span>

</code></pre></div></div>

<ul>
  <li>8001ï¼Œ8002 Controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentController</span> <span class="o">{</span>
    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentService</span> <span class="n">paymentService</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/create"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span> <span class="nf">create</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">Payment</span> <span class="n">payment</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="n">payment</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*****æ’å…¥ç»“æœï¼š"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">result</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">){</span>  <span class="c1">//æˆåŠŸ</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="s">"æ’å…¥æ•°æ®åº“æˆåŠŸ,serverPort:"</span><span class="o">+</span><span class="n">serverPort</span><span class="o">,</span><span class="n">result</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">444</span><span class="o">,</span><span class="s">"æ’å…¥æ•°æ®åº“å¤±è´¥,serverPort:"</span><span class="o">+</span><span class="n">serverPort</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/get/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span> <span class="nf">getPaymentById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">Payment</span> <span class="n">payment</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">getPaymentById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*****æŸ¥è¯¢ç»“æœï¼š"</span><span class="o">+</span><span class="n">payment</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">payment</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>  <span class="c1">//è¯´æ˜æœ‰æ•°æ®ï¼Œèƒ½æŸ¥è¯¢æˆåŠŸ</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span><span class="s">"æŸ¥è¯¢æˆåŠŸ,serverPort:"</span><span class="o">+</span><span class="n">serverPort</span><span class="o">,</span><span class="n">payment</span><span class="o">);</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">CommonResult</span><span class="o">(</span><span class="mi">444</span><span class="o">,</span><span class="s">"æ²¡æœ‰å¯¹åº”è®°å½•ï¼ŒæŸ¥è¯¢IDï¼š"</span><span class="o">+</span><span class="n">id</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/lb"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getPaymentLB</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">serverPort</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></div></div>

<h5 id="è´Ÿè½½å‡è¡¡">è´Ÿè½½å‡è¡¡</h5>

<ul>
  <li>è®¢å•æœåŠ¡è®¿é—®åœ°å€ä¸èƒ½å†™æ­»ï¼Œåº”è¯¥å†™å¾®æœåŠ¡åç§°ï¼Œä¿®æ”¹80controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderController</span> <span class="o">{</span>


    <span class="c1">//æ”¹ä¸ºå¾®æœåŠ¡åœ°å€,å°±æ˜¯åœ¨ymlä¸­é…ç½®çš„spring:application:name: zhifu</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">PAYMENT_URL</span> <span class="o">=</span> <span class="s">"http://ZHIFU"</span><span class="o">;</span>


    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/create"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="nf">create</span><span class="o">(</span><span class="nc">Payment</span> <span class="n">payment</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">postForObject</span><span class="o">(</span><span class="no">PAYMENT_URL</span> <span class="o">+</span> <span class="s">"/payment/create"</span><span class="o">,</span> <span class="n">payment</span><span class="o">,</span> <span class="nc">CommonResult</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/get/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="nf">getPayment</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="no">PAYMENT_URL</span><span class="o">+</span><span class="s">"/payment/get/"</span><span class="o">+</span><span class="n">id</span><span class="o">,</span><span class="nc">CommonResult</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹é…ç½®ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * é…ç½®ç±»
 */</span>
<span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContextConfig</span> <span class="o">{</span>

    <span class="cm">/**æ³¨å…¥restè¿œç¨‹è°ƒç”¨æœåŠ¡
     * @return
     */</span>
    <span class="nd">@Bean</span>
    <span class="nd">@LoadBalanced</span>
    <span class="kd">public</span> <span class="nc">RestTemplate</span> <span class="nf">getRestTemplate</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RestTemplate</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡</p>

    <p>å†è¦å¯åŠ¨æœåŠ¡æä¾›è€…providerï¼Œ8001/8002æœåŠ¡</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/get/31</code></p>

    <p>è´Ÿè½½å‡è¡¡æ•ˆæœè¾¾åˆ°,8001/8002ç«¯å£äº¤æ›¿å‡ºç°</p>

    <p>Ribbonå’ŒEurekaæ•´åˆåConsumerå¯ä»¥ç›´æ¥è°ƒç”¨æœåŠ¡è€Œä¸ç”¨å†å…³å¿ƒåœ°å€å’Œç«¯å£å·ï¼Œä¸”è¯¥æœåŠ¡è¿˜æœ‰è´Ÿè½½åŠŸèƒ½äº†</p>
  </li>
</ul>

<h5 id="discoveryæœåŠ¡å‘ç°">DiscoveryæœåŠ¡å‘ç°</h5>

<ul>
  <li>å¯¹äºæ³¨å†Œè¿›eurekaé‡Œé¢çš„å¾®æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡æœåŠ¡å‘ç°æ¥è·å¾—è¯¥æœåŠ¡çš„ä¿¡æ¯</li>
  <li>ä¿®æ”¹cloud-provider-payment8001çš„Controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Resource</span>
<span class="kd">private</span> <span class="nc">DiscoveryClient</span> <span class="n">discoveryClient</span><span class="o">;</span>
 
 
<span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/discovery"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">Object</span> <span class="nf">discovery</span><span class="o">(){</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">services</span> <span class="o">=</span> <span class="n">discoveryClient</span><span class="o">.</span><span class="na">getServices</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">element</span> <span class="o">:</span> <span class="n">services</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"***** element:"</span><span class="o">+</span><span class="n">element</span><span class="o">);</span>
    <span class="o">}</span>
     <span class="c1">//é€šè¿‡å¾®æœåŠ¡åç§°è·å–å¾®æœåŠ¡ä¿¡æ¯</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">ServiceInstance</span><span class="o">&gt;</span> <span class="n">instances</span> <span class="o">=</span> <span class="n">discoveryClient</span><span class="o">.</span><span class="na">getInstances</span><span class="o">(</span><span class="s">"CLOUD-PAYMENT-SERVICE"</span><span class="o">);</span>
    <span class="k">for</span> <span class="o">(</span><span class="nc">ServiceInstance</span> <span class="n">instance</span> <span class="o">:</span> <span class="n">instances</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">instance</span><span class="o">.</span><span class="na">getServiceId</span><span class="o">()+</span><span class="s">"\t"</span><span class="o">+</span><span class="n">instance</span><span class="o">.</span><span class="na">getHost</span><span class="o">()+</span><span class="s">"\t"</span><span class="o">+</span><span class="n">instance</span><span class="o">.</span><span class="na">getPort</span><span class="o">()+</span><span class="s">"\t"</span><span class="o">+</span><span class="n">instance</span><span class="o">.</span><span class="na">getUri</span><span class="o">());</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">discoveryClient</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ³¨è§£<code class="language-plaintext highlighter-rouge">@EnableDiscoveryClient</code></p>
  </li>
  <li>
    <p>æµ‹è¯•</p>

    <p>å…ˆè¦å¯åŠ¨EurekaServerï¼Œ7001/7002æœåŠ¡</p>

    <p>å†å¯åŠ¨8001ä¸»å¯åŠ¨ç±»ï¼Œéœ€è¦ç¨ç­‰ä¸€ä¼š</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost:8001/payment/discovery</code></p>
  </li>
</ul>

<h5 id="è‡ªæˆ‘ä¿æŠ¤">è‡ªæˆ‘ä¿æŠ¤</h5>

<ul>
  <li>ä¸€å¥è¯ï¼šæŸæ—¶åˆ»æŸä¸€ä¸ªå¾®æœåŠ¡ä¸å¯ç”¨äº†ï¼ŒEurekaä¸ä¼šç«‹åˆ»æ¸…ç†ï¼Œä¾æ—§ä¼šå¯¹è¯¥å¾®æœåŠ¡çš„ä¿¡æ¯è¿›è¡Œä¿å­˜</li>
</ul>

<h3 id="3zookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°">3ï¼šZookeeperæœåŠ¡æ³¨å†Œä¸å‘ç°</h3>

<ul>
  <li>zookeeperæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼åè°ƒå·¥å…·ï¼Œå¯ä»¥å®ç°æ³¨å†Œä¸­å¿ƒåŠŸèƒ½</li>
  <li>å…³é—­LinuxæœåŠ¡å™¨é˜²ç«å¢™åå¯åŠ¨zookeeperæœåŠ¡å™¨</li>
  <li>zookeeperæœåŠ¡å™¨å–ä»£EurekaæœåŠ¡å™¨ï¼Œzkä½œä¸ºæœåŠ¡æ³¨å†Œä¸­å¿ƒ</li>
</ul>

<h4 id="31æœåŠ¡æä¾›è€…8004">3.1æœåŠ¡æä¾›è€…8004</h4>

<ul>
  <li>æ–°å»ºcloud-provider-payment8004</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-provider-payment8004<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- springbootæ•´åˆzookeeperå®¢æˆ·ç«¯h --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="nt">&lt;/artifactId&gt;</span>
          	<span class="c">&lt;!--æ’é™¤zk3.5.3--&gt;</span>
            <span class="nt">&lt;exclusions&gt;</span>
                <span class="nt">&lt;exclusion&gt;</span>
                    <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
                    <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;/exclusion&gt;</span>
            <span class="nt">&lt;/exclusions&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
      	<span class="c">&lt;!--æ·»åŠ è‡ªå·±å®‰è£…çš„zookeeperç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œæ˜¯zk 3.5.6ç‰ˆæœ¬--&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>3.5.6<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># 8004è¡¨ç¤ºæ³¨å†Œåˆ°zookeeperæœåŠ¡å™¨çš„æ”¯ä»˜æœåŠ¡æä¾›è€…ç«¯å£å·</span>
<span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8004</span>
 
<span class="c1"># æœåŠ¡åˆ«å---æ³¨å†Œzookeeperåˆ°æ³¨å†Œä¸­å¿ƒåç§°</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-provider-payment</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">zookeeper</span><span class="pi">:</span>
      <span class="na">connect-string</span><span class="pi">:</span> <span class="s">192.168.136.140:2181</span> <span class="c1">#zookeeperæ‰€åœ¨æœåŠ¡å™¨çš„IPå’Œç«¯å£å·</span>
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>  <span class="c1">//è¯¥æ³¨è§£ç”¨äºå‘ä½¿ç”¨consulæˆ–è€…zookeeperä½œä¸ºæ³¨å†Œä¸­å¿ƒæ—¶æ³¨å†ŒæœåŠ¡</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentMain8004</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">PaymentMain8004</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/zk"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentzk</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"springcloud with zookeeper:"</span><span class="o">+</span><span class="n">serverPort</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•ï¼š<code class="language-plaintext highlighter-rouge">http://localhost:8004/payment/zk</code></p>
  </li>
  <li>
    <p>æœåŠ¡èŠ‚ç‚¹æ˜¯ä¸´æ—¶èŠ‚ç‚¹è¿˜æ˜¯æŒä¹…èŠ‚ç‚¹ï¼Ÿæ˜¯ä¸´æ—¶èŠ‚ç‚¹</p>
  </li>
</ul>

<h4 id="32æœåŠ¡æ¶ˆè´¹è€…80">3.2æœåŠ¡æ¶ˆè´¹è€…80</h4>

<ul>
  <li>æ–°å»ºcloud-consumerzk-order80</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.example<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>


    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- springbootæ•´åˆzookeeperå®¢æˆ·ç«¯h --&gt;</span>
    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-zookeeper-discovery --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-zookeeper-discovery<span class="nt">&lt;/artifactId&gt;</span>
        <span class="c">&lt;!--æ’é™¤zk3.5.3--&gt;</span>
        <span class="nt">&lt;exclusions&gt;</span>
            <span class="nt">&lt;exclusion&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;/exclusion&gt;</span>
        <span class="nt">&lt;/exclusions&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="c">&lt;!--æ·»åŠ è‡ªå·±å®‰è£…çš„zookeeperç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œæ˜¯zk 3.5.6ç‰ˆæœ¬--&gt;</span>
    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.apache.zookeeper/zookeeper --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.apache.zookeeper<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>zookeeper<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>3.5.6<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>


    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>


<span class="nt">&lt;/dependencies&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-consumer-order</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">zookeeper</span><span class="pi">:</span>
      <span class="na">connect-string</span><span class="pi">:</span> <span class="s">192.168.136.140:2181</span>
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderZKMain80</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">OrderZKMain80</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>é…ç½®ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContextConfig</span> <span class="o">{</span>

    <span class="nd">@LoadBalanced</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RestTemplate</span> <span class="nf">getRestTemplate</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RestTemplate</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderZKController</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">INVOME_URL</span> <span class="o">=</span> <span class="s">"http://cloud-provider-payment"</span><span class="o">;</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/zk"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">payment</span> <span class="o">(){</span>
      <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="no">INVOME_URL</span><span class="o">+</span><span class="s">"/payment/zk"</span><span class="o">,</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼š<code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/zk</code></li>
</ul>

<h3 id="4consulæœåŠ¡æ³¨å†Œä¸å‘ç°">4:ConsulæœåŠ¡æ³¨å†Œä¸å‘ç°</h3>

<ul>
  <li>consulæ˜¯ä¸€å¥—å¼€æºçš„åˆ†å¸ƒå¼æœåŠ¡å‘ç°å’Œé…ç½®ç®¡ç†ç³»ç»Ÿï¼Œç”¨goè¯­è¨€å¼€å‘ã€‚</li>
  <li><a href="https://www.consul.io/intro/index.html">å®˜ç½‘</a></li>
  <li>æä¾›äº†å¾®æœåŠ¡ç³»ç»Ÿä¸­çš„æœåŠ¡æ²»ç†ï¼Œé…ç½®ä¸­å¿ƒï¼Œæ§åˆ¶æ€»çº¿ç­‰åŠŸèƒ½ã€‚è¿™äº›åŠŸèƒ½ä¸­çš„æ¯ä¸€ä¸ªéƒ½å¯ä»¥æ ¹æ®éœ€è¦å•ç‹¬ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥ä¸€èµ·ä½¿ç”¨æ„å»ºå…¨æ–¹ä½çš„å¾®æœåŠ¡ã€‚</li>
  <li>åŸºäºraftåè®®ï¼Œæ¯”è¾ƒç®€æ´ï¼›key , Valueçš„å­˜å‚¨æ–¹å¼ï¼›Consulæ”¯æŒå¤šæ•°æ®ä¸­å¿ƒï¼›æ”¯æŒå¥åº·æ£€æŸ¥ï¼ŒåŒæ—¶æ”¯æŒHTTPå’ŒDNSåè®®ï¼Œæ”¯æŒè·¨æ•°æ®ä¸­å¿ƒçš„WANé›†ç¾¤ï¼Œæä¾›å›¾å½¢ç•Œé¢ï¼Œè·¨å¹³å°</li>
</ul>

<h4 id="41å®‰è£…ä¸è¿è¡Œ">4.1å®‰è£…ä¸è¿è¡Œ</h4>

<ul>
  <li>ä¸‹è½½å®Œæˆååªæœ‰ä¸€ä¸ªconsul.exeæ–‡ä»¶ï¼Œç¡¬ç›˜è·¯å¾„ä¸‹åŒå‡»è¿è¡Œï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</li>
  <li>ä½¿ç”¨å¼€å‘æ¨¡å¼å¯åŠ¨<code class="language-plaintext highlighter-rouge">consul agent -dev</code></li>
  <li>é€šè¿‡ä»¥ä¸‹åœ°å€å¯ä»¥è®¿é—®Consulçš„é¦–é¡µï¼šhttp;//localhost:8500</li>
</ul>

<h4 id="42æœåŠ¡æä¾›è€…8006">4.2æœåŠ¡æä¾›è€…8006</h4>

<ul>
  <li>æ–°å»ºcloud-providerconsul-payment8006</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-providerconsul-payment8006<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>



    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
 
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">### consul æœåŠ¡ç«¯å£å·</span>
<span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8006</span>


<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">consul-provider-payment</span>
<span class="c1"># consulæ³¨å†Œä¸­å¿ƒåœ°å€</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">consul</span><span class="pi">:</span>
      <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8500</span>
      <span class="na">discovery</span><span class="pi">:</span>
        <span class="na">service-name</span><span class="pi">:</span> <span class="s">${spring.application.name}</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentMain8006</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">PaymentMain8006</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/consul"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentConsul</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"springcloud with consul: "</span><span class="o">+</span><span class="n">serverPort</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼š<code class="language-plaintext highlighter-rouge">http://localhost:8006/payment/consul</code></li>
</ul>

<h4 id="43æœåŠ¡æ¶ˆè´¹è€…80">4.3æœåŠ¡æ¶ˆè´¹è€…80</h4>

<ul>
  <li>æ–°å»ºcloud-consumerconsul-order80</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-consumerconsul-order80<span class="nt">&lt;/artifactId&gt;</span>



    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-consul-discovery --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-consul-discovery<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>



    <span class="nt">&lt;/dependencies&gt;</span>


<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>


<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">consul-consumer-order</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">consul</span><span class="pi">:</span>
      <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
      <span class="na">port</span><span class="pi">:</span> <span class="m">8500</span>
      <span class="na">discovery</span><span class="pi">:</span>
        <span class="na">service-name</span><span class="pi">:</span> <span class="s">${spring.application.name}</span>
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableDiscoveryClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderConsulMain80</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">OrderConsulMain80</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>é…ç½®ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ApplicationContextConfig</span> <span class="o">{</span>

    <span class="nd">@LoadBalanced</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">RestTemplate</span> <span class="nf">getRestTemplate</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RestTemplate</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderConsulController</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">String</span> <span class="no">INVOME_URL</span> <span class="o">=</span> <span class="s">"http://consul-provider-payment"</span><span class="o">;</span>

    <span class="nd">@Resource</span> 
    <span class="kd">private</span> <span class="nc">RestTemplate</span> <span class="n">restTemplate</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/consul"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">payment</span> <span class="o">(){</span>
      <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="no">INVOME_URL</span><span class="o">+</span><span class="s">"/payment/consul"</span><span class="o">,</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
      <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>


<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼š<code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/consul</code></li>
</ul>

<h3 id="5æ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ">5ï¼šæ³¨å†Œä¸­å¿ƒæ¯”è¾ƒ</h3>

<ul>
  <li>æ¯”è¾ƒ</li>
</ul>

<table>
  <thead>
    <tr>
      <th>ç»„ä»¶å</th>
      <th>è¯­è¨€</th>
      <th>CAP</th>
      <th>å¥åº·æ£€æŸ¥</th>
      <th>å¯¹å¤–æš´éœ²æ¥å£</th>
      <th>cloudé›†æˆ</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Eureka</td>
      <td>Java</td>
      <td>AP</td>
      <td>å¯é…æ”¯æŒ</td>
      <td>HTTP</td>
      <td>å·²é›†æˆ</td>
    </tr>
    <tr>
      <td>Zookeeper</td>
      <td>GO</td>
      <td>CP</td>
      <td>æ”¯æŒ</td>
      <td>http/DNS</td>
      <td>å·²é›†æˆ</td>
    </tr>
    <tr>
      <td>Consul</td>
      <td>Java</td>
      <td>CP</td>
      <td>æ”¯æŒ</td>
      <td>å®¢æˆ·ç«¯</td>
      <td>å·²é›†æˆ</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>CAPè¯¦è§£
    <ul>
      <li>C:Consistency(å¼ºä¸€è‡´æ€§)</li>
      <li>A:Availability(å¯ç”¨æ€§)</li>
      <li>P:Partition tolerance(åˆ†åŒºå®¹é”™)</li>
    </ul>
  </li>
  <li>CAPç†è®ºå…³æ³¨ç²’åº¦æ˜¯æ•°æ®ï¼Œè€Œä¸æ˜¯æ•´ä½“ç³»ç»Ÿè®¾è®¡çš„ç­–ç•¥</li>
  <li>æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ª</li>
  <li>CAPç†è®ºçš„æ ¸å¿ƒæ˜¯ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªéœ€æ±‚ã€‚å› æ­¤æ ¹æ®CAPåŸåˆ™å°†NoSqlæ•°æ®åº“åˆ†ä¸ºæ»¡è¶³CAåŸåˆ™ï¼ŒCPåŸåˆ™å’ŒAPåŸåˆ™ä¸‰å¤§ç±»ã€‚</li>
  <li>CAï¼šå•ç‚¹é›†ç¾¤ï¼Œæ»¡è¶³ä¸€è‡´æ€§ï¼Œå¯ç”¨æ€§çš„ç³»ç»Ÿï¼Œé€šå¸¸åœ¨å¯æ‰©å±•æ€§ä¸Šä¸å¼ºå¤§</li>
  <li>CPï¼šæ»¡è¶³ä¸€è‡´æ€§ï¼Œåˆ†åŒºå®¹é”™çš„ç³»ç»Ÿï¼Œé€šå¸¸æ€§èƒ½ä¸é«˜ï¼ˆConsulï¼ŒZookeeperï¼‰</li>
  <li>APï¼šæ»¡è¶³å¯ç”¨æ€§ï¼Œåˆ†åŒºå®¹é”™çš„ç³»ç»Ÿï¼Œå¯¹ä¸€è‡´æ€§è¦æ±‚æ¯”è¾ƒä½ï¼ˆEurekaï¼‰</li>
</ul>

<h3 id="6ribbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨">6ï¼šRibbonè´Ÿè½½å‡è¡¡æœåŠ¡è°ƒç”¨</h3>

<ul>
  <li>springCloud Ribbonæ˜¯åŸºäºNetflixå®ç°çš„ä¸€å¥—å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„å·¥å…·ï¼›</li>
  <li>ä¸»è¦åŠŸèƒ½æ˜¯æä¾›å®¢æˆ·ç«¯çš„è½¯ä»¶è´Ÿè½½å‡è¡¡ç®—æ³•å’ŒæœåŠ¡è°ƒç”¨ã€‚æä¾›äº†ä¸€ç³»åˆ—å®Œå–„çš„é…ç½®é¡¹ï¼Œå¦‚è¿æ¥è¶…æ—¶ï¼Œé‡è¯•ç­‰ã€‚</li>
  <li>è´Ÿè½½å‡è¡¡ï¼šå°†ç”¨æˆ·çš„è¯·æ±‚å¹³æ‘Šçš„åˆ†é…åˆ°å¤šä¸ªæœåŠ¡ä¸Šï¼Œä»è€Œè¾¾åˆ°ç³»ç»Ÿçš„HAï¼ˆé«˜å¯ç”¨ï¼‰</li>
  <li>å¯¹æ¯”Ribbonå’ŒNginx
    <ul>
      <li>Nginxæ˜¯æœåŠ¡å™¨è´Ÿè½½å‡è¡¡ï¼Œå®¢æˆ·ç«¯æ‰€æœ‰è¯·æ±‚éƒ½ä¼šäº¤ç»™Nginxï¼Œç„¶åç”±Nginxå®ç°è½¬å‘è¯·æ±‚ã€‚å³è´Ÿè½½å‡è¡¡æ˜¯ç”±æœåŠ¡ç«¯å®ç°çš„</li>
      <li>Ribbonæœ¬åœ°è´Ÿè½½å‡è¡¡ï¼Œåœ¨è°ƒç”¨å¾®æœåŠ¡æ¥å£çš„æ—¶å€™ï¼Œä¼šåœ¨æ³¨å†Œä¸­å¿ƒä¸Šè·å–æ³¨å†Œä¿¡æ¯æœåŠ¡åˆ—è¡¨ä¹‹åç¼“å­˜åˆ°JVMæœ¬åœ°ï¼Œä»è€Œåœ¨æœ¬åœ°å®ç°RPCè¿œç¨‹æœåŠ¡è°ƒç”¨ã€‚</li>
    </ul>
  </li>
  <li>é›†ä¸­å¼LBï¼šåœ¨æœåŠ¡çš„æ¶ˆè´¹æ–¹å’Œæä¾›æ–¹ä¹‹é—´ä½¿ç”¨ç‹¬ç«‹çš„LBè®¾æ–½ï¼ˆå¯ä»¥æ˜¯ç¡¬ä»¶ï¼Œå¦‚F5ï¼Œå¯ä»¥æ˜¯è½¯ä»¶ï¼Œå¦‚Nginxï¼‰ï¼Œç”±è¯¥è®¾æ–½è´Ÿè´£æŠŠè®¿é—®è¯·æ±‚é€šè¿‡æŸç§ç­–ç•¥è½¬å‘åˆ°æœåŠ¡çš„æä¾›æ–¹ã€‚</li>
  <li>è¿›ç¨‹å†…LBï¼šå°†LBé€»è¾‘é›†æˆåˆ°æ¶ˆè´¹æ–¹ï¼Œæ¶ˆè´¹æ–¹ä»æœåŠ¡æ³¨å†Œä¸­å¿ƒè·çŸ¥æœ‰å“ªäº›åœ°å€å¯ç”¨ï¼Œç„¶åè‡ªå·±å†ä»è¿™äº›åœ°å€ä¸­é€‰æ‹©å‡ºåˆé€‚çš„æœåŠ¡å™¨ã€‚Ribbonå°±å±äºè¿™ç§ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»åº“ï¼Œé›†æˆåœ¨æ¶ˆè´¹æ–¹è¿›ç¨‹ä¸­ï¼Œæ¶ˆè´¹æ–¹é€šè¿‡å®ƒæ¥è·å–åˆ°æœåŠ¡æä¾›æ–¹çš„åœ°å€ã€‚</li>
  <li>Ribbonåœ¨å·¥ä½œæ—¶åˆ†ä¸ºä¸¤æ­¥
    <ul>
      <li>å…ˆé€‰æ‹©EurekaServerï¼Œå®ƒä¼˜å…ˆé€‰æ‹©åœ¨åŒä¸€åŒºåŸŸå†…è´Ÿè½½è¾ƒå°‘çš„server</li>
      <li>å†æ ¹æ®ç”¨æˆ·æŒ‡å®šçš„ç­–ç•¥ï¼Œä»serverå–åˆ°çš„æœåŠ¡æ³¨å†Œåˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªåœ°å€ã€‚</li>
    </ul>
  </li>
  <li>Ribbonæä¾›äº†å¤šç§ç­–ç•¥ï¼šè½®è¯¢ï¼Œéšæœºï¼Œæ ¹æ®å“åº”æ—¶é—´åŠ æƒ</li>
</ul>

<h4 id="resttemplate">RestTemplate</h4>

<ul>
  <li>getForObjectæ–¹æ³•ï¼šè¿”å›å¯¹è±¡ä¸ºå“åº”ä½“ä¸­æ•°æ®è½¬åŒ–æˆçš„å¯¹è±¡ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç†è§£ä¸ºjson</li>
  <li>getForEntityæ–¹æ³•ï¼šè¿”å›å¯¹è±¡ä¸ºResponseEntityå¯¹è±¡ï¼ŒåŒ…å«äº†å“åº”ä¸­çš„ä¸€äº›é‡è¦æ•°æ®ï¼Œæ¯”å¦‚å“åº”å¤´ï¼Œå“åº”çŠ¶æ€ç ï¼Œå“åº”ä½“ç­‰ã€‚</li>
  <li>API</li>
</ul>

<h4 id="æ ¸å¿ƒç»„ä»¶irule">æ ¸å¿ƒç»„ä»¶IRule</h4>

<ul>
  <li>IRule:æ ¹æ®ç‰¹å®šç®—æ³•ä»æœåŠ¡åˆ—è¡¨ä¸­é€‰å–ä¸€ä¸ªè¦è®¿é—®çš„æœåŠ¡
    <ul>
      <li>com.netflix.loadbalancer.RoundRobinRuleï¼šè½®è¯¢</li>
      <li>com.netflix.loadbalancer.RandomRuleï¼šéšæœº</li>
      <li>com.netflix.loadbalancer.RetryRuleï¼šå…ˆæŒ‰ç…§RoundRobinRuleçš„ç­–ç•¥è·å–æœåŠ¡ï¼Œå¦‚æœè·å–æœåŠ¡å¤±è´¥åˆ™åœ¨æŒ‡å®šæ—¶é—´å†…ä¼šè¿›è¡Œé‡è¯•</li>
      <li>WeightedResponseTimeRule ï¼šå¯¹RoundRobinRuleçš„æ‰©å±•ï¼Œå“åº”é€Ÿåº¦è¶Šå¿«çš„å®ä¾‹é€‰æ‹©æƒé‡è¶Šå¤§ï¼Œè¶Šå®¹æ˜“è¢«é€‰æ‹©</li>
      <li>BestAvailableRule ï¼šä¼šå…ˆè¿‡æ»¤æ‰ç”±äºå¤šæ¬¡è®¿é—®æ•…éšœè€Œå¤„äºæ–­è·¯å™¨è·³é—¸çŠ¶æ€çš„æœåŠ¡ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¹¶å‘é‡æœ€å°çš„æœåŠ¡</li>
      <li>AvailabilityFilteringRule ï¼šå…ˆè¿‡æ»¤æ‰æ•…éšœå®ä¾‹ï¼Œå†é€‰æ‹©å¹¶å‘è¾ƒå°çš„å®ä¾‹</li>
      <li>ZoneAvoidanceRuleï¼šé»˜è®¤è§„åˆ™ï¼Œå¤åˆåˆ¤æ–­serveræ‰€åœ¨åŒºåŸŸçš„æ€§èƒ½å’Œserverçš„å¯ç”¨æ€§é€‰æ‹©æœåŠ¡å™¨</li>
    </ul>
  </li>
  <li>ä¿®æ”¹cloud-consumer-order80</li>
  <li>è‡ªå®šä¹‰é…ç½®ç±»ä¸èƒ½æ”¾åœ¨@ComponentScanæ‰€æ‰«æçš„å½“å‰åŒ…ä¸‹ä»¥åŠå­åŒ…ä¸‹ã€‚å¦åˆ™è‡ªå®šä¹‰é…ç½®ç±»å°±ä¼šè¢«æ‰€æœ‰Ribbonå®¢æˆ·ç«¯å…±äº«ï¼Œè¾¾ä¸åˆ°ç‰¹æ®Šå®šåˆ¶çš„ç›®çš„</li>
  <li>æ–°å»ºMySelfRuleè§„åˆ™ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySelfRule</span> <span class="o">{</span>

    <span class="cm">/**
     * @return ribbonè´Ÿè½½å‡è¡¡è§„åˆ™
     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">IRule</span> <span class="nf">myRule</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">RandomRule</span><span class="o">();</span><span class="c1">//å®šä¹‰ä¸ºéšæœºè§„åˆ™</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableEurekaClient</span>
<span class="nd">@SpringBootApplication</span>
<span class="c1">//æ³¨æ„ä¿®æ”¹nameä¸ºè‡ªå·±çš„å¾®æœåŠ¡åç§°</span>
<span class="nd">@RibbonClient</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"CLOUD-PAYMENT-SERVICE"</span><span class="o">,</span><span class="n">configuration</span> <span class="o">=</span> <span class="nc">MySelfRule</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderMain80</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">OrderMain80</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æµ‹è¯•ï¼š<code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/get/31</code></li>
</ul>

<h4 id="è´Ÿè½½å‡è¡¡ç®—æ³•">è´Ÿè½½å‡è¡¡ç®—æ³•</h4>

<ul>
  <li>è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯årestæ¥å£è®¡æ•°ä»1å¼€å§‹</li>
  <li>è‡ªå®ç°è´Ÿè½½å‡è¡¡</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">/**</span>
<span class="o">*</span><span class="n">ä½¿ç”¨CASå’Œè‡ªæ—‹é”å®ç°è½®è¯¢ç®—æ³•</span>
<span class="o">/</span>
<span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLB</span> <span class="kd">implements</span> <span class="nc">LoadBalancer</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">AtomicInteger</span> <span class="n">atomicInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">AtomicInteger</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>

    <span class="c1">//åæ ‡</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="nf">getAndIncrement</span><span class="o">(){</span>
        <span class="kt">int</span> <span class="n">current</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">next</span><span class="o">;</span>
        <span class="k">do</span> <span class="o">{</span>
            <span class="n">current</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">atomicInteger</span><span class="o">.</span><span class="na">get</span><span class="o">();</span>
            <span class="n">next</span> <span class="o">=</span> <span class="n">current</span> <span class="o">&gt;=</span> <span class="mi">2147483647</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">current</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span><span class="k">while</span> <span class="o">(!</span><span class="k">this</span><span class="o">.</span><span class="na">atomicInteger</span><span class="o">.</span><span class="na">compareAndSet</span><span class="o">(</span><span class="n">current</span><span class="o">,</span><span class="n">next</span><span class="o">));</span>  <span class="c1">//ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æœŸæœ›å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¿®æ”¹å€¼æ˜¯</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"*******ç¬¬å‡ æ¬¡è®¿é—®ï¼Œæ¬¡æ•°next: "</span><span class="o">+</span><span class="n">next</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">next</span><span class="o">;</span>
    <span class="o">}</span>
 
   <span class="c1">//è´Ÿè½½å‡è¡¡ç®—æ³•ï¼šrestæ¥å£ç¬¬å‡ æ¬¡è¯·æ±‚æ•° % æœåŠ¡å™¨é›†ç¾¤æ€»æ•°é‡ = å®é™…è°ƒç”¨æœåŠ¡å™¨ä½ç½®ä¸‹æ ‡ï¼Œæ¯æ¬¡æœåŠ¡é‡å¯årestæ¥å£è®¡æ•°ä»1å¼€å§‹</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ServiceInstance</span> <span class="nf">instances</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">ServiceInstance</span><span class="o">&gt;</span> <span class="n">serviceInstances</span><span class="o">)</span> <span class="o">{</span>  <span class="c1">//å¾—åˆ°æœºå™¨çš„åˆ—è¡¨</span>
       <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="n">getAndIncrement</span><span class="o">()</span> <span class="o">%</span> <span class="n">serviceInstances</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="c1">//å¾—åˆ°æœåŠ¡å™¨çš„ä¸‹æ ‡ä½ç½®</span>
        <span class="k">return</span> <span class="n">serviceInstances</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">index</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="7openfeignæœåŠ¡æ¥å£è°ƒç”¨">7ï¼šOpenFeignæœåŠ¡æ¥å£è°ƒç”¨</h3>

<ul>
  <li>Feignæ˜¯ä¸€ä¸ªå£°æ˜å¼WebServiceå®¢æˆ·ç«¯ã€‚</li>
  <li>ä½¿ç”¨æ–¹æ³•æ˜¯å®šä¹‰ä¸€ä¸ªæœåŠ¡æ¥å£ç„¶ååœ¨ä¸Šé¢æ·»åŠ æ³¨è§£ã€‚Feignä¹Ÿæ”¯æŒå¯æ‹”æ’å¼çš„ç¼–ç å™¨å’Œè§£ç å™¨ã€‚springcloudå¯¹Feignè¿›è¡Œäº†å°è£…ã€‚ä½¿ä»–æ”¯æŒspringmvcæ ‡å‡†æ³¨è§£å’ŒHttpMessageConvertersã€‚Feignå¯ä»¥å’ŒEurekaå’ŒRibbonç»„åˆä½¿ç”¨æ”¯æŒè´Ÿè½½å‡è¡¡ã€‚</li>
  <li>ä»¥å‰åœ¨ä½¿ç”¨Ribbon+RestTemplateæ—¶ï¼Œåˆ©ç”¨RestTemplateå¯¹HTTPè¯·æ±‚çš„å°è£…å¤„ç†ï¼Œå½¢æˆä¸€å¥—æ¨¡æ¿åŒ–çš„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å®é™…å¼€å‘ä¸­ï¼Œç”±äºå¯¹æœåŠ¡ä¾èµ–çš„è°ƒç”¨å¯èƒ½ä¸æ­¢ä¸€å¤„ï¼Œä¸€ä¸ªæ¥å£å¯èƒ½è¢«å¤šå¤„è°ƒç”¨ï¼Œé€šå¸¸ä¼šé’ˆå¯¹æ¯ä¸ªå¾®æœåŠ¡è‡ªè¡Œå°è£…ä¸€äº›å®¢æˆ·ç«¯æ¥åŒ…è£…è¿™äº›æœåŠ¡ä¾èµ–çš„è°ƒç”¨ã€‚æ‰€ä»¥Feignåšäº†è¿›ä¸€æ­¥å°è£…ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å®šä¹‰å’Œå®ç°ä¾èµ–æœåŠ¡æ¥å£çš„å®šä¹‰ã€‚åœ¨Feignä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºä¸€ä¸ªæ¥å£å¹¶ä½¿ç”¨æ³¨è§£çš„æ–¹å¼ï¼ˆä»¥å‰æ˜¯Daoæ¥å£ä¸Šé¢æ ‡æ³¨Mapperæ³¨è§£ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªå¾®æœåŠ¡æ¥å£ä¸Šæ ‡æ³¨ä¸€ä¸ªFeignæ³¨è§£ï¼‰å³å¯å®Œæˆå¯¹æœåŠ¡æä¾›æ–¹çš„æ¥å£ç»‘å®šã€‚</li>
  <li>Feignå’ŒOpenFeignåŒºåˆ«
    <ul>
      <li>Feignï¼šæ˜¯springcloudä¸­çš„ä¸€ä¸ªè½»é‡çº§RESTFulçš„HTTPæœåŠ¡å®¢æˆ·ç«¯ï¼ŒFeignå†…ç½®äº†Ribbonï¼Œç”¨æ¥åšå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡ï¼Œå»è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚ä½¿ç”¨æ–¹å¼æ˜¯ä½¿ç”¨Feignçš„æ³¨è§£å®šä¹‰æ¥å£ï¼Œè°ƒç”¨è¿™ä¸ªæ¥å£ï¼Œå°±å¯ä»¥è°ƒç”¨æœåŠ¡æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡ã€‚</li>
      <li>OpenFeignï¼šåœ¨FeignåŸºç¡€ä¸Šæ”¯æŒäº†springmvcçš„æ³¨è§£ï¼Œå¦‚@RequestMappingç­‰ã€‚OpenFeignçš„@FeignClientå¯ä»¥è§£æ@RequestMappingä¸‹çš„æ¥å£ï¼Œå¹¶é€šè¿‡åŠ¨æ€ä»£ç†çš„æ–¹å¼äº§ç”Ÿå®ç°ç±»ï¼Œå®ç°ç±»ä¸­åšè´Ÿè½½å‡è¡¡å¹¶è°ƒç”¨å…¶ä»–æœåŠ¡ã€‚</li>
    </ul>
  </li>
</ul>

<h4 id="71ä½¿ç”¨æ­¥éª¤">7.1ä½¿ç”¨æ­¥éª¤</h4>

<ul>
  <li>æ–°å»ºcloud-consumer-feign-order80</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-consumer-feign-order80<span class="nt">&lt;/artifactId&gt;</span>


    <span class="c">&lt;!--openfeign--&gt;</span>
    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">false</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka, http://eureka7002.com:7002/eureka</span>
</code></pre></div></div>

<ul>
  <li>å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableFeignClients</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderFeignMain80</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">OrderFeignMain80</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡é€»è¾‘æ¥å£+@FeignClienté…ç½®è°ƒç”¨provideræœåŠ¡</li>
  <li>æ–°å»ºPaymentFeignServiceæ¥å£å¹¶æ–°å¢æ³¨è§£@FeignClient</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@FeignClient</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"CLOUD-PAYMENT-SERVICE"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PaymentFeignService</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/get/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span> <span class="nf">getPaymentById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderFeignController</span> <span class="o">{</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentFeignService</span> <span class="n">paymentFeignService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/consumer/payment/get/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">CommonResult</span><span class="o">&lt;</span><span class="nc">Payment</span><span class="o">&gt;</span> <span class="nf">getPaymentById</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">){</span>
       <span class="k">return</span> <span class="n">paymentFeignService</span><span class="o">.</span><span class="na">getPaymentById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>å…ˆå¯åŠ¨2ä¸ªeurekaé›†ç¾¤7001/7002</p>

    <p>å†å¯åŠ¨2ä¸ªå¾®æœåŠ¡8001/8002</p>

    <p>å¯åŠ¨OpenFeignå¯åŠ¨</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/get/31</code></p>

    <p>Feignè‡ªå¸¦è´Ÿè½½å‡è¡¡é…ç½®é¡¹</p>
  </li>
</ul>

<h4 id="72è¶…æ—¶æ§åˆ¶">7.2è¶…æ—¶æ§åˆ¶</h4>

<ul>
  <li>æœåŠ¡æä¾›æ–¹8001æ•…æ„å†™æš‚åœç¨‹åº</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/feign/timeout"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentFeignTimeout</span><span class="o">(){</span>
    <span class="k">try</span> <span class="o">{</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span> <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
    <span class="k">return</span> <span class="n">serverPort</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æœåŠ¡æ¶ˆè´¹æ–¹80æ·»åŠ è¶…æ—¶æ–¹æ³•PaymentFeignService</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/payment/feign/timeout"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentFeignTimeout</span><span class="o">();</span>
</code></pre></div></div>

<ul>
  <li>æœåŠ¡æ¶ˆè´¹æ–¹80æ·»åŠ è¶…æ—¶æ–¹æ³•OrderFeignController</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/consumer/payment/feign/timeout"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentFeignTimeout</span><span class="o">(){</span>
  <span class="c1">//openfeign-ribbonï¼Œå®¢æˆ·ç«¯ä¸€èˆ¬é»˜è®¤ç­‰å¾…ä¸€ç§’é’Ÿ</span>
   <span class="k">return</span> <span class="n">paymentFeignService</span><span class="o">.</span><span class="na">paymentFeignTimeout</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•åå‡ºç°è¯·æ±‚è¶…æ—¶<code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/feign/timeout</code></p>
  </li>
  <li>OpenFeigné»˜è®¤ç­‰å¾…ä¸€ç§’é’Ÿï¼Œè¶…è¿‡åæŠ¥é”™</li>
  <li>YMLæ–‡ä»¶é‡Œéœ€è¦å¼€å¯OpenFeignå®¢æˆ·ç«¯è¶…æ—¶æ§åˆ¶</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># è®¾ç½®feignå®¢æˆ·ç«¯è¶…æ—¶æ—¶é—´ï¼ˆopenFeigné»˜è®¤æ”¯æŒribbonï¼‰</span>
<span class="na">ribbon</span><span class="pi">:</span>
<span class="c1"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥æ‰€ç”¨çš„æ—¶é—´ï¼Œé€‚ç”¨äºç½‘ç»œçŠ¶å†µæ­£å¸¸çš„æƒ…å†µä¸‹ï¼Œä¸¤ç«¯è¿æ¥æ‰€ç”¨çš„æ—¶é—´</span>
  <span class="na">ReadTimeout</span><span class="pi">:</span>  <span class="m">5000</span>
<span class="c1"># æŒ‡çš„æ˜¯å»ºç«‹è¿æ¥åä»æœåŠ¡å™¨è¯»å–åˆ°å¯ç”¨èµ„æºæ‰€ç”¨çš„æ—¶é—´</span>
  <span class="na">ConnectTimeout</span><span class="pi">:</span> <span class="m">5000</span>
</code></pre></div></div>

<h4 id="73æ—¥å¿—æ‰“å°">7.3æ—¥å¿—æ‰“å°</h4>

<ul>
  <li>å¯¹Feignæ¥å£çš„è°ƒç”¨æƒ…å†µè¿›è¡Œç›‘æ§å’Œè¾“å‡º</li>
  <li>æ—¥å¿—çº§åˆ«
    <ul>
      <li>NONEï¼šé»˜è®¤çš„ï¼Œä¸æ˜¾ç¤ºä»»ä½•æ—¥å¿—</li>
      <li>BASICï¼šä»…è®°å½•è¯·æ±‚æ–¹æ³•ï¼ŒURLï¼Œå“åº”çŠ¶æ€ç ä»¥åŠæ‰§è¡Œæ—¶é—´</li>
      <li>HEADERSï¼šé™¤äº†BASICåŒ…å«ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜åŒ…å«è¯·æ±‚å’Œå“åº”çš„å¤´ä¿¡æ¯</li>
      <li>FULLï¼šé™¤äº†HEADERåŒ…å«ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜åŒ…å«è¯·æ±‚å’Œå“åº”çš„æ­£æ–‡å’Œå…ƒæ•°æ®ã€‚</li>
    </ul>
  </li>
  <li>é…ç½®æ—¥å¿—bean</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FeignConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="nc">Logger</span><span class="o">.</span><span class="na">Level</span> <span class="nf">feignLoggerLevel</span><span class="o">(){</span>
        <span class="k">return</span> <span class="nc">Logger</span><span class="o">.</span><span class="na">Level</span><span class="o">.</span><span class="na">FULL</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>YMLæ–‡ä»¶é‡Œéœ€è¦å¼€å¯æ—¥å¿—çš„Feignå®¢æˆ·ç«¯</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">logging</span><span class="pi">:</span>
  <span class="na">level</span><span class="pi">:</span>
<span class="c1"># feignæ—¥å¿—ä»¥ä»€ä¹ˆçº§åˆ«ç›‘æ§å“ªä¸ªæ¥å£</span>
    <span class="s">com.atguigu.springcloud.service.PaymentFeignService</span><span class="pi">:</span> <span class="s">debug</span>
</code></pre></div></div>

<h3 id="8hystrixæ–­è·¯å™¨">8ï¼šHystrixæ–­è·¯å™¨</h3>

<ul>
  <li>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é—®é¢˜ï¼šå¤æ‚åˆ†å¸ƒå¼ä½“ç³»ç»“æ„ä¸­çš„åº”ç”¨ç¨‹åºæœ‰æ•°åä¸ªä¾èµ–å…³ç³»ï¼Œæ¯ä¸ªä¾èµ–å…³ç³»åœ¨æŸäº›æ—¶å€™å°†ä¸å¯é¿å…çš„å¤±è´¥ã€‚</li>
  <li>ä»€ä¹ˆæ˜¯æœåŠ¡é›ªå´©
    <ul>
      <li>å¤šä¸ªå¾®æœåŠ¡è°ƒç”¨çš„æ—¶å€™ï¼Œå‡è®¾Aè°ƒç”¨Bå’ŒCï¼ŒBå’ŒCåˆè°ƒç”¨å…¶ä»–å¾®æœåŠ¡ï¼Œè¿™å°±æ˜¯â€œæ‰‡å‡ºâ€ã€‚å¦‚æœæ‰‡å‡ºçš„é“¾è·¯ä¸ŠæŸä¸ªå¾®æœåŠ¡çš„è°ƒç”¨æ—¶é—´è¿‡é•¿æˆ–è€…ä¸å¯ç”¨ï¼Œå¯¹Açš„è°ƒç”¨å°±ä¼šå ç”¨è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿèµ„æºï¼Œè¿›è€Œå¼•èµ·ç³»ç»Ÿå´©æºƒï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é›ªå´©æ•ˆåº”ã€‚</li>
      <li>å¯¹äºé«˜æµé‡çš„åº”ç”¨æ¥è¯´ï¼Œå•ä¸€çš„åç«¯ä¾èµ–å¯èƒ½ä¼šå¯¼è‡´æ‰€æœ‰çš„æœåŠ¡å™¨ä¸Šçš„æ‰€æœ‰èµ„æºåœ¨å‡ ç§’å†…é¥±å’Œï¼Œæ¯”è¿™æ›´ç³Ÿçš„æ˜¯ï¼Œè¿™äº›åº”ç”¨ç¨‹åºå¯èƒ½è¿˜å¯¼è‡´æœåŠ¡ä¹‹é—´çš„å»¶è¿Ÿå¢åŠ ï¼Œå¤‡ä»½é˜Ÿåˆ—ï¼Œçº¿ç¨‹å’Œå…¶ä»–ç³»ç»Ÿèµ„æºç´§å¼ ï¼Œå¯¼è‡´ç³»ç»Ÿå‘ç”Ÿçº§è”æ•…éšœï¼Œéœ€è¦å¯¹æ•…éšœå’Œå»¶è¿Ÿè¿›è¡Œéš”ç¦»å’Œç®¡ç†ï¼Œä»¥ä¾¿å•ä¸ªä¾èµ–å…³ç³»çš„å¤±è´¥ï¼Œä¸èƒ½å–æ¶ˆæ•´ä¸ªåº”ç”¨ç³»ç»Ÿã€‚</li>
    </ul>
  </li>
  <li>Hystrixæ˜¯ä¸€ä¸ªç”¨äºå¤„ç†åˆ†å¸ƒå¼ç³»ç»Ÿçš„å»¶è¿Ÿå’Œå®¹é”™çš„å¼€æºåº“ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿé‡Œï¼Œè®¸å¤šä¾èµ–ä¼šå‘ç”Ÿä¸å¯é¿å…çš„è°ƒç”¨å¤±è´¥ï¼Œæ¯”å¦‚è¶…æ—¶ï¼Œå¼‚å¸¸ç­‰ã€‚Hystrixèƒ½ä¿è¯åœ¨ä¸€ä¸ªä¾èµ–å‡ºç°é—®é¢˜çš„æƒ…å†µä¸‹ï¼Œä¸ä¼šå¯¼è‡´æ•´ä½“æœåŠ¡å¤±è´¥ï¼Œé¿å…çº§è”æ•…éšœï¼Œæé«˜åˆ†å¸ƒå¼ç³»ç»Ÿçš„å¼¹æ€§ã€‚</li>
  <li>â€œæ–­è·¯å™¨â€æœ¬èº«æ˜¯ä¸€ç§å¼€å…³è£…ç½®ï¼Œå½“æŸä¸ªæœåŠ¡å•å…ƒå‘ç”Ÿæ•…éšœåï¼Œé€šè¿‡æ–­è·¯å™¨çš„æ•…éšœç›‘æ§ï¼ˆç±»ä¼¼ç†”æ–­ä¿é™©ä¸ï¼‰ï¼Œå‘è°ƒç”¨æ–¹å‘é€ä¸€ä¸ªç¬¦åˆé¢„æœŸçš„å¯å¤„ç†çš„å¤‡é€‰å“åº”ï¼ˆFallBackï¼‰ï¼Œè€Œä¸æ˜¯é•¿æ—¶é—´çš„ç­‰å¾…æˆ–è€…æŠ›å‡ºè°ƒç”¨æ–¹æ— æ³•å¤„ç†çš„å¼‚å¸¸ã€‚è¿™æ ·å°±ä¿è¯äº†æœåŠ¡è°ƒç”¨æ–¹çš„çº¿ç¨‹ä¸ä¼šè¢«é•¿æ—¶é—´ï¼Œä¸å¿…è¦çš„å ç”¨ï¼Œä»è€Œé¿å…æ•…éšœè”“å»¶ï¼Œå‘ç”Ÿé›ªå´©ã€‚</li>
  <li>
    <p>Hystrixèƒ½åšåˆ°æœåŠ¡é™çº§ï¼ŒæœåŠ¡ç†”æ–­ï¼Œæ¥è¿‘å®æ—¶çš„ç›‘æ§ã€‚</p>
  </li>
  <li>æœåŠ¡é™çº§ï¼šæœåŠ¡å™¨å¿™ï¼Œè¯·ç¨å€™å†è¯•ï¼Œä¸è®©å®¢æˆ·ç«¯ç­‰å¾…å¹¶ç«‹åˆ»è¿”å›ä¸€ä¸ªå‹å¥½æç¤ºï¼Œfallbackã€‚å“ªäº›æƒ…å†µä¼šè§¦å‘é™çº§ï¼ˆç¨‹åºè¿è¡Œå¼‚å¸¸ï¼Œè¶…æ—¶ï¼ŒæœåŠ¡ç†”æ–­è§¦å‘æœåŠ¡é™çº§ï¼Œçº¿ç¨‹æ± /ä¿¡å·é‡æ‰“æ»¡ä¹Ÿä¼šå¯¼è‡´æœåŠ¡é™çº§ï¼‰</li>
  <li>æœåŠ¡ç†”æ–­ï¼šç±»æ¯”ä¿é™©ä¸è¾¾åˆ°æœ€å¤§æœåŠ¡è®¿é—®åï¼Œç›´æ¥æ‹’ç»è®¿é—®ï¼Œæ‹‰é—¸é™ç”µï¼Œç„¶åè°ƒç”¨æœåŠ¡é™çº§çš„æ–¹æ³•å¹¶è¿”å›å‹å¥½æç¤ºã€‚æœåŠ¡çš„é™çº§-&gt;è¿›è€Œç†”æ–­-&gt;æ¢å¤è°ƒç”¨é“¾è·¯</li>
  <li>æœåŠ¡é™æµï¼šç§’æ€é«˜å¹¶å‘ç­‰æ“ä½œï¼Œä¸¥ç¦ä¸€çªèœ‚çš„è¿‡æ¥æ‹¥æŒ¤ï¼Œå¤§å®¶æ’é˜Ÿï¼Œä¸€ç§’é’ŸNä¸ªï¼Œæœ‰åºè¿›è¡Œ</li>
</ul>

<h4 id="81æœåŠ¡æä¾›è€…8001">8.1æœåŠ¡æä¾›è€…8001</h4>

<ul>
  <li>æ–°å»ºcloud-provider-hystrix-payment8001</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-provider-hystrix-payment8001<span class="nt">&lt;/artifactId&gt;</span>


    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--æ–°å¢hystrix--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>


<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>    <span class="c1">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span>
    <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">true</span>   <span class="c1">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="c1"># defaultZone: http://eureka7002.com:7002/eureka/    #è®¾ç½®ä¸eureka serveräº¤äº’çš„åœ°å€æŸ¥è¯¢æœåŠ¡å’Œæ³¨å†ŒæœåŠ¡éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªåœ°å€</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka/</span>
<span class="c1">#  server:</span>
<span class="c1">#    enable-self-preservation: false</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-provider-hystrix-payment</span>
<span class="c1">#    eviction-interval-timer-in-ms: 2000</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableEurekaClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentHystrixMain8001</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">PaymentHystrixMain8001</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>service</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentService</span> <span class="o">{</span>

    <span class="c1">//æˆåŠŸ</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="s">"çº¿ç¨‹æ± ï¼š"</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">"   paymentInfo_OK,idï¼š  "</span><span class="o">+</span><span class="n">id</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span><span class="s">"å“ˆå“ˆå“ˆ"</span>  <span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//å¤±è´¥</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">timeNumber</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span> <span class="nc">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="n">timeNumber</span><span class="o">);</span> <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span><span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();}</span>
        <span class="k">return</span> <span class="s">"çº¿ç¨‹æ± ï¼š"</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">"   paymentInfo_TimeOut,idï¼š  "</span><span class="o">+</span><span class="n">id</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span><span class="s">"å‘œå‘œå‘œ"</span><span class="o">+</span><span class="s">" è€—æ—¶(ç§’)"</span><span class="o">+</span><span class="n">timeNumber</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentController</span> <span class="o">{</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentService</span> <span class="n">paymentService</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/hystrix/ok/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">paymentInfo_OK</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*******result:"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/hystrix/timeout/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">paymentInfo_TimeOut</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*******result:"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>å¯åŠ¨eureka7001</p>

    <p>å¯åŠ¨cloud-provider-hystrix-payment8001</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost:8001/payment/hystrix/ok/31</code></p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost:8001/payment/hystrix/timeout/31</code></p>

    <p>â€‹</p>
  </li>
</ul>

<h4 id="82æœåŠ¡æ¶ˆè´¹è€…80">8.2æœåŠ¡æ¶ˆè´¹è€…80</h4>

<ul>
  <li>æ–°å»ºcloud-consumer-feign-hystrix-order80</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-consumer-feign-hystrix-order80<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--æ–°å¢hystrix--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
       <span class="nt">&lt;dependency&gt;</span>
             <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
       <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-openfeign<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>


<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>    <span class="c1">#è¡¨è¯†ä¸å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±</span>
    <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">true</span>   <span class="c1">#è¡¨ç¤ºè‡ªå·±å°±æ˜¯æ³¨å†Œä¸­å¿ƒï¼ŒèŒè´£æ˜¯ç»´æŠ¤æœåŠ¡å®ä¾‹ï¼Œå¹¶ä¸éœ€è¦å»æ£€ç´¢æœåŠ¡</span>
    <span class="na">service-url</span><span class="pi">:</span>
             <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka/</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-provider-hystrix-order</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableFeignClients</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderHystrixMain80</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">OrderHystrixMain80</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>service</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@FeignClient</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"CLOUD-PROVIDER-HYSTRIX-PAYMENT"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PaymentHystrixService</span> <span class="o">{</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/hystrix/ok/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/hystrix/timeout/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderHystrixController</span> <span class="o">{</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentHystrixService</span> <span class="n">paymentHystrixService</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/hystrix/ok/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentHystrixService</span><span class="o">.</span><span class="na">paymentInfo_OK</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*******result:"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/hystrix/timeout/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentHystrixService</span><span class="o">.</span><span class="na">paymentInfo_TimeOut</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*******result:"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>é«˜å¹¶å‘æµ‹è¯•</p>

    <p>2Wä¸ªçº¿ç¨‹å‹8001</p>

    <p>æ¶ˆè´¹ç«¯80å¾®æœåŠ¡å†å»è®¿é—®æ­£å¸¸çš„OKå¾®æœåŠ¡8001åœ°å€</p>

    <p><code class="language-plaintext highlighter-rouge">http://localhost/consumer/payment/hystrix/timeout/31</code></p>

    <p>æ¶ˆè´¹è€…80ï¼Œå‘œå‘œå‘œ</p>
  </li>
  <li>8001åŒä¸€å±‚æ¬¡çš„å…¶ä»–æ¥å£æœåŠ¡è¢«å›°æ­»ï¼Œå› ä¸ºtomcatçº¿ç¨‹é‡Œé¢çš„å·¥ä½œçº¿ç¨‹å·²ç»è¢«æŒ¤å å®Œæ¯•</li>
  <li>80æ­¤æ—¶è°ƒç”¨8001ï¼Œå®¢æˆ·ç«¯è®¿é—®å“åº”ç¼“æ…¢ï¼Œè½¬åœˆåœˆ</li>
  <li>æ­£å› ä¸ºæœ‰ä¸Šè¿°æ•…éšœæˆ–ä¸ä½³è¡¨ç°ï¼Œæ‰æœ‰æˆ‘ä»¬çš„é™çº§/å®¹é”™/é™æµç­‰æŠ€æœ¯è¯ç”Ÿ</li>
  <li>è¶…æ—¶å¯¼è‡´æœåŠ¡å™¨å˜æ…¢ï¼ˆè½¬åœˆï¼‰:è¶…æ—¶ä¸å†ç­‰å¾…</li>
  <li>å‡ºé”™ï¼ˆå®•æœºæˆ–ç¨‹åºè¿è¡Œå‡ºé”™ï¼‰:å‡ºé”™è¦æœ‰å…œåº•</li>
  <li>å¯¹æ–¹æœåŠ¡ï¼ˆ8001ï¼‰è¶…æ—¶äº†ï¼Œè°ƒç”¨è€…ï¼ˆ80ï¼‰ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§</li>
  <li>å¯¹æ–¹æœåŠ¡ï¼ˆ8001ï¼‰downæœºäº†ï¼Œè°ƒç”¨è€…ï¼ˆ80ï¼‰ä¸èƒ½ä¸€ç›´å¡æ­»ç­‰å¾…ï¼Œå¿…é¡»æœ‰æœåŠ¡é™çº§</li>
  <li>å¯¹æ–¹æœåŠ¡ï¼ˆ8001ï¼‰OKï¼Œè°ƒç”¨è€…ï¼ˆ80ï¼‰è‡ªå·±å‡ºæ•…éšœæˆ–æœ‰è‡ªæˆ‘è¦æ±‚ï¼ˆè‡ªå·±çš„ç­‰å¾…æ—¶é—´å°äºæœåŠ¡æä¾›è€…ï¼‰ï¼Œè‡ªå·±å¤„ç†é™çº§</li>
</ul>

<h4 id="83æœåŠ¡é™çº§">8.3æœåŠ¡é™çº§</h4>

<ul>
  <li>8001å…ˆä»è‡ªèº«æ‰¾é—®é¢˜ï¼šè®¾ç½®è‡ªèº«è°ƒç”¨è¶…æ—¶æ—¶é—´çš„å³°å€¼ï¼Œå³°å€¼å†…å¯ä»¥æ­£å¸¸è¿è¡Œï¼Œè¶…è¿‡äº†éœ€è¦æœ‰å…œåº•çš„æ–¹æ³•å¤„ç†ï¼Œä½œæœåŠ¡é™çº§fallbackã€‚</li>
  <li>@HystrixCommandæŠ¥å¼‚å¸¸åå¦‚ä½•å¤„ç†</li>
  <li>ä¸€æ—¦è°ƒç”¨æœåŠ¡æ–¹æ³•å¤±è´¥å¹¶æŠ›å‡ºäº†é”™è¯¯ä¿¡æ¯åï¼Œä¼šè‡ªåŠ¨è°ƒç”¨@HystrixCommandæ ‡æ³¨å¥½çš„fallbackMethodè°ƒç”¨ç±»ä¸­çš„æŒ‡å®šæ–¹æ³•</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentService</span> <span class="o">{</span>

    <span class="c1">//æˆåŠŸ</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="s">"çº¿ç¨‹æ± ï¼š"</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">"   paymentInfo_OK,idï¼š  "</span><span class="o">+</span><span class="n">id</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span><span class="s">"å“ˆå“ˆå“ˆ"</span>  <span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//å¤±è´¥</span>
<span class="c1">//fallbackMethod:æŒ‡å®šå…œåº•æ–¹æ³•</span>
    <span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">fallbackMethod</span> <span class="o">=</span> <span class="s">"paymentInfo_TimeOutHandler"</span><span class="o">,</span><span class="n">commandProperties</span> <span class="o">=</span> <span class="o">{</span>
            <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"execution.isolation.thread.timeoutInMilliseconds"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"3000"</span><span class="o">)</span>  <span class="c1">//3ç§’é’Ÿä»¥å†…å°±æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘</span>
    <span class="o">})</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
       <span class="c1">// int timeNumber = 5;</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="mi">0</span><span class="o">;</span>
       <span class="c1">// try { TimeUnit.SECONDS.sleep(timeNumber); }catch (Exception e) {e.printStackTrace();}</span>
        <span class="c1">//return "çº¿ç¨‹æ± ï¼š"+Thread.currentThread().getName()+"   paymentInfo_TimeOut,idï¼š  "+id+"\t"+"å‘œå‘œå‘œ"+" è€—æ—¶(ç§’)"+timeNumber;</span>
        <span class="k">return</span> <span class="s">"çº¿ç¨‹æ± ï¼š"</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">"   paymentInfo_TimeOut,idï¼š  "</span><span class="o">+</span><span class="n">id</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span><span class="s">"å‘œå‘œå‘œ"</span><span class="o">+</span><span class="s">" è€—æ—¶(ç§’)"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//å…œåº•æ–¹æ³•</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOutHandler</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="k">return</span> <span class="s">"çº¿ç¨‹æ± ï¼š"</span><span class="o">+</span><span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">"   ç³»ç»Ÿç¹å¿™, è¯·ç¨å€™å†è¯•  ,idï¼š  "</span><span class="o">+</span><span class="n">id</span><span class="o">+</span><span class="s">"\t"</span><span class="o">+</span><span class="s">"å“­äº†å“‡å‘œ"</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>ä¸»å¯åŠ¨ç±»æ·»åŠ æ–°æ³¨è§£@EnableCircuitBreaker</p>
  </li>
  <li>80è®¢å•å¾®æœåŠ¡ï¼Œä¹Ÿå¯ä»¥æ›´å¥½çš„ä¿æŠ¤è‡ªå·±ï¼Œè‡ªå·±ä¹Ÿä¾æ ·ç”»è‘«èŠ¦è¿›è¡Œå®¢æˆ·ç«¯é™çº§ä¿æŠ¤</li>
  <li>æˆ‘ä»¬è‡ªå·±é…ç½®è¿‡çš„çƒ­éƒ¨ç½²æ–¹å¼å¯¹javaä»£ç çš„æ”¹åŠ¨æ˜æ˜¾ï¼Œä½†å¯¹@HystrixCommandå†…å±æ€§çš„ä¿®æ”¹å»ºè®®é‡å¯å¾®æœåŠ¡</li>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">feign</span><span class="pi">:</span>
  <span class="na">hystrix</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span> <span class="c1">#å¦‚æœå¤„ç†è‡ªèº«çš„å®¹é”™å°±å¼€å¯ã€‚å¼€å¯æ–¹å¼ä¸ç”Ÿäº§ç«¯ä¸ä¸€æ ·ã€‚</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»ï¼š@EnableHystrix</li>
  <li>ä¸šåŠ¡ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/hystrix/timeout/{id}"</span><span class="o">)</span>
<span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">fallbackMethod</span> <span class="o">=</span> <span class="s">"paymentTimeOutFallbackMethod"</span><span class="o">,</span><span class="n">commandProperties</span> <span class="o">=</span> <span class="o">{</span>
        <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"execution.isolation.thread.timeoutInMilliseconds"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"1500"</span><span class="o">)</span>  <span class="c1">//3ç§’é’Ÿä»¥å†…å°±æ˜¯æ­£å¸¸çš„ä¸šåŠ¡é€»è¾‘</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentHystrixService</span><span class="o">.</span><span class="na">paymentInfo_TimeOut</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>

<span class="c1">//å…œåº•æ–¹æ³•</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentTimeOutFallbackMethod</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="k">return</span> <span class="s">"æˆ‘æ˜¯æ¶ˆè´¹è€…80ï¼Œå¯¹ä»˜æ”¯ä»˜ç³»ç»Ÿç¹å¿™è¯·10ç§’é’Ÿåå†è¯•æˆ–è€…è‡ªå·±è¿è¡Œå‡ºé”™è¯·æ£€æŸ¥è‡ªå·±,(â”¬ï¼¿â”¬)"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>é—®é¢˜ï¼šæ¯ä¸ªä¸šåŠ¡æ–¹æ³•å¯¹åº”ä¸€ä¸ªå…œåº•çš„æ–¹æ³•ï¼Œä»£ç è†¨èƒ€ï¼Œç»Ÿä¸€å’Œè‡ªå®šä¹‰çš„åˆ†å¼€</li>
  <li>ä½¿ç”¨@DefaultPropertiesè®¾ç½®å…¨å±€fullback</li>
  <li>ä¿®æ”¹80controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@Slf4j</span>
<span class="nd">@DefaultProperties</span><span class="o">(</span><span class="n">defaultFallback</span> <span class="o">=</span> <span class="s">"payment_Global_FallbackMethod"</span><span class="o">)</span>  <span class="c1">//å…¨å±€çš„</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">OrderHystrixController</span> <span class="o">{</span>

    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">PaymentHystrixService</span> <span class="n">paymentHystrixService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/hystrix/ok/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentHystrixService</span><span class="o">.</span><span class="na">paymentInfo_OK</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/hystrix/timeout/{id}"</span><span class="o">)</span>
    <span class="nd">@HystrixCommand</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
        <span class="kt">int</span> <span class="n">age</span> <span class="o">=</span> <span class="mi">10</span><span class="o">/</span><span class="mi">0</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentHystrixService</span><span class="o">.</span><span class="na">paymentInfo_TimeOut</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">//ä¸‹é¢æ˜¯å…¨å±€fallbackæ–¹æ³•</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">payment_Global_FallbackMethod</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"Globalå¼‚å¸¸å¤„ç†ä¿¡æ¯ï¼Œè¯·ç¨åå†è¯•,(â”¬ï¼¿â”¬)"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æœåŠ¡é™çº§ï¼Œå®¢æˆ·ç«¯å»è°ƒç”¨æœåŠ¡ç«¯ï¼Œç¢°ä¸ŠæœåŠ¡ç«¯å®•æœºæˆ–å…³é—­</li>
  <li>æœ¬æ¬¡æ¡ˆä¾‹æœåŠ¡é™çº§å¤„ç†æ˜¯åœ¨å®¢æˆ·ç«¯80å®ç°å®Œæˆçš„ï¼Œä¸æœåŠ¡ç«¯8001æ²¡æœ‰å…³ç³»ï¼Œåªéœ€è¦ä¸ºFeignå®¢æˆ·ç«¯å®šä¹‰çš„æ¥å£æ·»åŠ ä¸€ä¸ªæœåŠ¡é™çº§å¤„ç†çš„å®ç°ç±»å³å¯å®ç°è§£è€¦</li>
  <li>ä¿®æ”¹cloud-consumer-feign-hystrix-order80</li>
  <li>æ ¹æ®cloud-consumer-feign-hystrix-order80å·²ç»æœ‰çš„PaymentHystrixServiceæ¥å£ï¼Œé‡æ–°æ–°å»ºä¸€ä¸ªç±»ï¼ˆPaymentFallbackServiceï¼‰å®ç°è¯¥æ¥å£ï¼Œç»Ÿä¸€ä¸ºæ¥å£é‡Œé¢çš„æ–¹æ³•è¿›è¡Œå¼‚å¸¸å¤„ç†</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PaymentFallbackService</span> <span class="kd">implements</span> <span class="nc">PaymentHystrixService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"-----PaymentFallbackService fall back-paymentInfo_OK , (â”¬ï¼¿â”¬)"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nc">Integer</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"-----PaymentFallbackService fall back-paymentInfo_TimeOut , (â”¬ï¼¿â”¬)"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">feign</span><span class="pi">:</span>
  <span class="na">hystrix</span><span class="pi">:</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span> <span class="c1">#åœ¨feignä¸­å¼€å¯hystrixï¼Œå¦‚æœå¤„ç†è‡ªèº«çš„å®¹é”™å°±å¼€å¯ã€‚å¼€å¯æ–¹å¼ä¸ç”Ÿäº§ç«¯ä¸ä¸€æ ·ã€‚</span>
</code></pre></div></div>

<ul>
  <li>PaymentFeignClientServiceæ¥å£ï¼ŒæŒ‡å®šfullbackå¤„ç†ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@FeignClient</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"CLOUD-PROVIDER-HYSTRIX-PAYMENT"</span><span class="o">,</span><span class="n">fallback</span> <span class="o">=</span> <span class="nc">PaymentFallbackService</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PaymentHystrixService</span> <span class="o">{</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/hystrix/ok/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_OK</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">);</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/hystrix/timeout/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentInfo_TimeOut</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">);</span>


<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>å•ä¸ªeurekaå…ˆå¯åŠ¨7001</p>

    <p>PaymentHystrixMain8001å¯åŠ¨</p>

    <p>æ­£å¸¸è®¿é—®æµ‹è¯•ï¼šhttp://localhost/consumer/payment/hystrix/ok/31</p>

    <p>æ•…æ„å…³é—­å¾®æœåŠ¡8001</p>

    <p>æ­¤æ—¶æœåŠ¡ç«¯providerå·²ç»downäº†ï¼Œä½†æ˜¯æˆ‘ä»¬åšäº†æœåŠ¡é™çº§å¤„ç†ï¼Œè®©å®¢æˆ·ç«¯åœ¨æœåŠ¡ç«¯ä¸å¯ç”¨æ—¶ä¹Ÿä¼šè·å¾—æç¤ºä¿¡æ¯è€Œä¸ä¼šæŒ‚èµ·è€—æ­»æœåŠ¡å™¨</p>
  </li>
</ul>

<h4 id="84æœåŠ¡ç†”æ–­">8.4æœåŠ¡ç†”æ–­</h4>

<ul>
  <li>ç†”æ–­æœºåˆ¶æ˜¯åº”å¯¹é›ªå´©æ•ˆåº”çš„ä¸€ç§å¾®æœåŠ¡é“¾è·¯çš„ä¿æŠ¤æœºåˆ¶ã€‚å½“æ‰‡å‡ºé“¾è·¯çš„æŸä¸ªå¾®æœåŠ¡å‡ºé”™ä¸å¯ç”¨æˆ–å“åº”æ—¶é—´å¤ªé•¿æ—¶ï¼Œä¼šè¿›è¡ŒæœåŠ¡çš„é™çº§ï¼Œè¿›è€Œç†”æ–­è¯¥èŠ‚ç‚¹çš„å¾®æœåŠ¡è°ƒç”¨ï¼Œå¿«é€Ÿè¿”å›é”™è¯¯çš„å“åº”ä¿¡æ¯ã€‚å½“æ£€æµ‹åˆ°è¯¥èŠ‚ç‚¹å¾®æœåŠ¡è°ƒç”¨çš„å“åº”æ­£å¸¸åï¼Œæ¢å¤è°ƒç”¨é“¾è·¯ã€‚</li>
  <li>ç†”æ–­æœºåˆ¶é€šè¿‡Hystrixå®ç°ï¼Œé€šè¿‡æ£€æµ‹å¾®æœåŠ¡é—´çš„è°ƒç”¨æƒ…å†µï¼Œå½“å¤±è´¥çš„è°ƒç”¨è¾¾åˆ°ä¸€å®šé˜ˆå€¼ï¼Œç¼ºçœæ˜¯5ç§’å†…20æ¬¡å¤±è´¥ï¼Œå°±ä¼šå¯åŠ¨ç†”æ–­æœºåˆ¶ï¼Œæ³¨è§£æ˜¯@HystrixCommandã€‚</li>
  <li>ä¿®æ”¹cloud-provider-hystrix-payment8001</li>
  <li>PaymentService</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//æœåŠ¡ç†”æ–­</span>
<span class="nd">@HystrixCommand</span><span class="o">(</span><span class="n">fallbackMethod</span> <span class="o">=</span> <span class="s">"paymentCircuitBreaker_fallback"</span><span class="o">,</span><span class="n">commandProperties</span> <span class="o">=</span> <span class="o">{</span>
        <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"circuitBreaker.enabled"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"true"</span><span class="o">),</span>  <span class="c1">//æ˜¯å¦å¼€å¯æ–­è·¯å™¨</span>
        <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"circuitBreaker.requestVolumeThreshold"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"10"</span><span class="o">),</span>   <span class="c1">//è¯·æ±‚æ¬¡æ•°</span>
        <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"circuitBreaker.sleepWindowInMilliseconds"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"10000"</span><span class="o">),</span>  <span class="c1">//æ—¶é—´èŒƒå›´</span>
        <span class="nd">@HystrixProperty</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"circuitBreaker.errorThresholdPercentage"</span><span class="o">,</span><span class="n">value</span> <span class="o">=</span> <span class="s">"60"</span><span class="o">),</span> <span class="c1">//å¤±è´¥ç‡è¾¾åˆ°å¤šå°‘åè·³é—¸</span>
<span class="o">})</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentCircuitBreaker</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">id</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">){</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="o">(</span><span class="s">"*****id ä¸èƒ½è´Ÿæ•°"</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="nc">String</span> <span class="n">serialNumber</span> <span class="o">=</span> <span class="nc">IdUtil</span><span class="o">.</span><span class="na">simpleUUID</span><span class="o">();</span>

    <span class="k">return</span> <span class="nc">Thread</span><span class="o">.</span><span class="na">currentThread</span><span class="o">().</span><span class="na">getName</span><span class="o">()+</span><span class="s">"\t"</span><span class="o">+</span><span class="s">"è°ƒç”¨æˆåŠŸ,æµæ°´å·ï¼š"</span><span class="o">+</span><span class="n">serialNumber</span><span class="o">;</span>
<span class="o">}</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentCircuitBreaker_fallback</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="k">return</span> <span class="s">"id ä¸èƒ½è´Ÿæ•°ï¼Œè¯·ç¨å€™å†è¯•,(â”¬ï¼¿â”¬)/~~     id: "</span> <span class="o">+</span><span class="n">id</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>PaymentController</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//===æœåŠ¡ç†”æ–­</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/circuit/{id}"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentCircuitBreaker</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">id</span><span class="o">){</span>
    <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">paymentService</span><span class="o">.</span><span class="na">paymentCircuitBreaker</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
    <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*******result:"</span><span class="o">+</span><span class="n">result</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>è‡ªæµ‹cloud-provider-hystrix-payment8001</p>

    <p>æ­£ç¡®ï¼šhttp://localhost:8001/payment/circuit/31</p>

    <p>é”™è¯¯ï¼šhttp://localhost:8001/payment/circuit/-31</p>

    <p>å¤šæ¬¡é”™è¯¯,ç„¶åæ…¢æ…¢æ­£ç¡®ï¼Œå‘ç°åˆšå¼€å§‹ä¸æ»¡è¶³æ¡ä»¶ï¼Œå°±ç®—æ˜¯æ­£ç¡®çš„è®¿é—®åœ°å€ä¹Ÿä¸èƒ½è¿›è¡Œè®¿é—®ï¼Œéœ€è¦æ…¢æ…¢çš„æ¢å¤é“¾è·¯</p>
  </li>
  <li>ç†”æ–­ç±»å‹
    <ul>
      <li>ç†”æ–­æ‰“å¼€ï¼šè¯·æ±‚ä¸å†è¿›è¡Œè°ƒç”¨å½“å‰æœåŠ¡ï¼Œå†…éƒ¨è®¾ç½®æ—¶é’Ÿä¸€èˆ¬ä¸ºMTTR(å¹³å‡æ•…éšœå¤„ç†æ—¶é—´)ï¼Œå½“æ‰“å¼€æ—¶é•¿è¾¾åˆ°æ‰€è®¾æ—¶é’Ÿåˆ™è¿›å…¥ç†”æ–­çŠ¶æ€</li>
      <li>ç†”æ–­å…³é—­ï¼šç†”æ–­å…³é—­ä¸ä¼šå¯¹æœåŠ¡è¿›è¡Œç†”æ–­</li>
      <li>ç†”æ–­åŠå¼€ï¼šéƒ¨åˆ†è¯·æ±‚æ ¹æ®è§„åˆ™è°ƒç”¨å½“å‰æœåŠ¡ï¼Œå¦‚æœè¯·æ±‚æˆåŠŸä¸”ç¬¦åˆè§„åˆ™åˆ™è®¤ä¸ºå½“å‰æœåŠ¡æ¢å¤æ­£å¸¸ï¼Œå…³é—­ç†”æ–­</li>
    </ul>
  </li>
  <li>æ–­è·¯å™¨åœ¨ä»€ä¹ˆæƒ…å†µä¸‹èµ·ä½œç”¨ï¼Ÿ
    <ul>
      <li>å¿«ç…§æ—¶é—´çª—ï¼šæ–­è·¯å™¨ç¡®å®šæ˜¯å¦æ‰“å¼€éœ€è¦ç»Ÿè®¡ä¸€äº›è¯·æ±‚å’Œé”™è¯¯æ•°æ®ï¼Œè€Œç»Ÿè®¡çš„æ—¶é—´èŒƒå›´å°±æ˜¯å¿«ç…§æ—¶é—´çª—ï¼Œé»˜è®¤ä¸ºæœ€è¿‘çš„10ç§’</li>
      <li>è¯·æ±‚æ€»æ•°é˜ˆå€¼ï¼šåœ¨å¿«ç…§æ—¶é—´çª—å†…ï¼Œå¿…é¡»æ»¡è¶³è¯·æ±‚æ€»æ•°é˜ˆå€¼æ‰èƒ½ç†”æ–­ï¼Œé»˜è®¤ä¸º20ï¼Œä¹Ÿå°±æ˜¯10ç§’å†…è¯¥å‘½ä»¤è°ƒç”¨ä¸è¶³20æ¬¡ï¼Œå³ä½¿æ‰€æœ‰çš„è¯·æ±‚éƒ½è¶…æ—¶æˆ–å¤±è´¥ï¼Œæ–­è·¯å™¨éƒ½ä¸ä¼šæ‰“å¼€</li>
      <li>é”™è¯¯ç™¾åˆ†æ¯”é˜ˆå€¼ï¼šå½“è¯·æ±‚æ€»æ•°åœ¨å¿«ç…§æ—¶é—´çª—å†…è¶…è¿‡é˜ˆå€¼ï¼Œæ¯”å¦‚è°ƒç”¨äº†30æ¬¡ï¼Œ15æ¬¡ä¸ºè¶…æ—¶ï¼Œä¹Ÿå°±æ˜¯è¾¾åˆ°äº†50%çš„é”™è¯¯ï¼Œå½“é»˜è®¤è®¾å®š50%é˜ˆå€¼æƒ…å†µä¸‹ï¼Œæ–­è·¯å™¨æ‰“å¼€ã€‚</li>
    </ul>
  </li>
  <li>å½“å¼€å¯çš„æ—¶å€™ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½ä¸ä¼šè¿›è¡Œè½¬å‘ã€‚ä¸€æ®µæ—¶é—´ä¹‹åï¼ˆé»˜è®¤æ˜¯5ç§’ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™æ–­è·¯å™¨æ˜¯åŠå¼€çŠ¶æ€ï¼Œä¼šè®©å…¶ä¸­ä¸€ä¸ªè¯·æ±‚è¿›è¡Œè½¬å‘ã€‚å¦‚æœæˆåŠŸï¼Œæ–­è·¯å™¨ä¼šå…³é—­ï¼Œè‹¥å¤±è´¥ï¼Œç»§ç»­å¼€å¯ã€‚é‡å¤</li>
  <li>æ–­è·¯å™¨æ‰“å¼€ä¹‹åï¼Œå†æœ‰è¯·æ±‚è°ƒç”¨çš„æ—¶å€™ï¼Œå°†ä¸ä¼šè°ƒç”¨ä¸»é€»è¾‘ï¼Œè€Œæ˜¯ç›´æ¥è°ƒç”¨é™çº§fullbackï¼Œé€šè¿‡æ–­è·¯å™¨ï¼Œå®ç°äº†è‡ªåŠ¨çš„å‘ç°é”™è¯¯å¹¶å°†é™çº§é€»è¾‘åˆ‡æ¢ä¸ºä¸»é€»è¾‘ï¼Œå‡å°‘å“åº”å»¶è¿Ÿçš„æ•ˆæœã€‚</li>
  <li>åŸæ¥çš„ä¸»é€»è¾‘å¦‚ä½•æ¢å¤ï¼Ÿå®ç°äº†è‡ªåŠ¨æ¢å¤åŠŸèƒ½ï¼Œæ–­è·¯å™¨æ‰“å¼€å¯¹ä¸»é€»è¾‘è¿›è¡Œç†”æ–­åï¼Œhystrixä¼šå¯åŠ¨ä¸€ä¸ªä¼‘çœ æ—¶é—´çª—ï¼Œåœ¨æ—¶é—´çª—å†…ï¼Œé™çº§é€»è¾‘æ˜¯æš‚æ—¶çš„ä¸»é€»è¾‘ï¼Œå½“ä¼‘çœ æ—¶é—´çª—åˆ°æœŸåï¼Œæ–­è·¯å™¨è¿›å…¥åŠå¼€çŠ¶æ€ï¼Œé‡Šæ”¾ä¸€æ¬¡è¯·æ±‚åˆ°åŸæ¥ä¸»é€»è¾‘ä¸Šï¼Œå¦‚æœè¯·æ±‚æ­£å¸¸è¿”å›ï¼Œæ–­è·¯å™¨é—­åˆï¼Œä¸»é€»è¾‘æ¢å¤ï¼Œè‹¥è¿™æ¬¡è¯·æ±‚ä¾ç„¶æœ‰é—®é¢˜ï¼Œç»§ç»­ä¿æŒç†”æ–­çŠ¶æ€ï¼Œä¼‘çœ æ—¶é—´çª—é‡æ–°è®¡æ—¶ã€‚</li>
</ul>

<h4 id="85æœåŠ¡ç›‘æ§9001">8.5æœåŠ¡ç›‘æ§9001</h4>

<ul>
  <li>æ–°å»ºcloud-consumer-hystrix-dashboard9001</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-consumer-hystrix-dashboard9001<span class="nt">&lt;/artifactId&gt;</span>


    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--æ–°å¢hystrix dashboard--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix-dashboard<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">9001</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»HystrixDashboardMain9001+æ–°æ³¨è§£@EnableHystrixDashboard</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableHystrixDashboard</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HystrixDashboardMain9001</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">HystrixDashboardMain9001</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æ‰€æœ‰Providerå¾®æœåŠ¡æä¾›ç±»ï¼ˆ8001/8002/8003ï¼‰éƒ½éœ€è¦ç›‘æ§ä¾èµ–é…ç½®</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>
    <p>å¯åŠ¨cloud-consumer-hystrix-dashboard9001è¯¥å¾®æœåŠ¡åç»­å°†ç›‘æ§å¾®æœåŠ¡8001</p>

    <p>http://localhost:9001/hystrix</p>
  </li>
  <li>
    <p>ä¿®æ”¹cloud-provider-hystrix-payment8001</p>
  </li>
  <li>
    <p>æ³¨æ„ï¼šæ–°ç‰ˆæœ¬Hystrixéœ€è¦åœ¨ä¸»å¯åŠ¨ç±»MainAppHystrix8001ä¸­æŒ‡å®šç›‘æ§è·¯å¾„</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
* æ­¤é…ç½®æ˜¯ä¸ºäº†æœåŠ¡ç›‘æ§è€Œé…ç½®ï¼Œä¸æœåŠ¡å®¹é”™æœ¬èº«æ— å…³ï¼Œspringcloudå‡çº§åçš„å‘
* ServletRegistrationBeanå› ä¸ºspringbootçš„é»˜è®¤è·¯å¾„ä¸æ˜¯â€œ/hystrix.streamâ€
* åªè¦åœ¨è‡ªå·±çš„é¡¹ç›®é‡Œé…ç½®ä¸Šä¸‹é¢çš„servletå°±å¯ä»¥äº†
*/</span> 
<span class="nd">@Bean</span>
<span class="kd">public</span> <span class="nc">ServletRegistrationBean</span> <span class="nf">getServlet</span><span class="o">(){</span>
    <span class="nc">HystrixMetricsStreamServlet</span> <span class="n">streamServlet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HystrixMetricsStreamServlet</span><span class="o">();</span>
    <span class="nc">ServletRegistrationBean</span> <span class="n">registrationBean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServletRegistrationBean</span><span class="o">(</span><span class="n">streamServlet</span><span class="o">);</span>
    <span class="n">registrationBean</span><span class="o">.</span><span class="na">setLoadOnStartup</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
    <span class="n">registrationBean</span><span class="o">.</span><span class="na">addUrlMappings</span><span class="o">(</span><span class="s">"/hystrix.stream"</span><span class="o">);</span>
    <span class="n">registrationBean</span><span class="o">.</span><span class="na">setName</span><span class="o">(</span><span class="s">"HystrixMetricsStreamServlet"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">registrationBean</span><span class="o">;</span>
<span class="o">}</span>
 

</code></pre></div></div>

<ul>
  <li>
    <p>å¯åŠ¨1ä¸ªeurekaæˆ–è€…3ä¸ªeurekaé›†ç¾¤å‡å¯</p>
  </li>
  <li>
    <p>9001ç›‘æ§8001</p>

    <p>å¡«å†™ç›‘æ§åœ°å€http://localhost:8001/hystrix.stream</p>
  </li>
  <li>
    <p>æµ‹è¯•åœ°å€</p>

    <p>http://localhost:8001/payment/circuit/31</p>

    <p>http://localhost:8001/payment/circuit/-31</p>

    <p>ä¸Šè¿°æµ‹è¯•é€šè¿‡</p>

    <p>å…ˆè®¿é—®æ­£ç¡®åœ°å€ï¼Œå†è®¿é—®é”™è¯¯åœ°å€ï¼Œå†æ­£ç¡®åœ°å€ï¼Œä¼šå‘ç°å›¾ç¤ºæ–­è·¯å™¨éƒ½æ˜¯æ…¢æ…¢æ”¾å¼€çš„</p>
  </li>
  <li>
    <p>å¦‚ä½•çœ‹</p>

    <ul>
      <li>å®å¿ƒåœ†ï¼šé€šè¿‡é¢œè‰²ä»£è¡¨å®ä¾‹çš„å¥åº·ç¨‹åº¦ï¼Œç»¿è‰²&lt;é»„è‰²&lt;æ©™è‰²&lt;çº¢è‰²ã€‚å¤§å°ååº”è¯·æ±‚æµé‡ï¼Œæµé‡è¶Šå¤§å®å¿ƒåœ†è¶Šå¤§ã€‚</li>
      <li>æ›²çº¿ï¼šç”¨æ¥è®°å½•ä¸¤åˆ†é’Ÿå†…æµé‡çš„ç›¸å¯¹å˜åŒ–</li>
    </ul>
  </li>
</ul>

<p><img src="https://i.loli.net/2020/09/19/wK8JgMpbCcSItrn.png" alt="image.png" /></p>

<p><img src="https://i.loli.net/2020/09/19/Abm7qZYNDsLVR6E.png" alt="image.png" /></p>

<h3 id="9gatewayæ–°ä¸€ä»£ç½‘å…³">9ï¼šGatewayæ–°ä¸€ä»£ç½‘å…³</h3>

<ul>
  <li>
    <p>gatewayæ˜¯ä¸Šä¸€ä»£ç½‘å…³zuul1.xçš„ä»£æ›¿</p>
  </li>
  <li>
    <p>gatewayæ˜¯springcloudçš„ä¸€ä¸ªå…¨æ–°é¡¹ç›®ï¼ŒåŸºäºspringboot2.0+spring5.0å’Œproject reactorç­‰æŠ€æœ¯ï¼Œæ—¨åœ¨ä¸ºå¾®æœåŠ¡æ¶æ„æä¾›ä¸€ç§ç®€å•æœ‰æ•ˆçš„ç»Ÿä¸€APIè·¯ç”±ç®¡ç†æ–¹å¼ã€‚</p>
  </li>
  <li>
    <p>gatewayæ˜¯åŸºäºWebFluxæ¡†æ¶å®ç°çš„ï¼Œåº•å±‚ä½¿ç”¨äº†é«˜æ€§èƒ½Reactoræ¨¡å¼é€šä¿¡æ¡†æ¶Netty</p>
  </li>
  <li>
    <p>gatewayç›®æ ‡æ˜¯æä¾›ç»Ÿä¸€çš„è·¯ç”±æ–¹å¼ä¸”åŸºäºFilteré“¾çš„æ–¹å¼æä¾›äº†ç½‘å…³åŸºæœ¬åŠŸèƒ½ï¼Œä¾‹å¦‚å®‰å…¨ï¼Œç›‘æ§æŒ‡æ ‡å’Œé™æµ</p>
  </li>
  <li>
    <p>gatewayç‰¹æ€§</p>

    <p>åŠ¨æ€è·¯ç”±ï¼šèƒ½å¤ŸåŒ¹é…ä»»ä½•è¯·æ±‚å±æ€§</p>

    <p>å¯ä»¥å¯¹è·¯ç”±æŒ‡å®špredictï¼ˆæ–­è¨€ï¼‰å’Œfilterï¼ˆè¿‡æ»¤å™¨ï¼‰</p>

    <p>é›†æˆHystrixçš„æ–­è·¯å™¨åŠŸèƒ½</p>

    <p>é›†æˆspringcloudæœåŠ¡å‘ç°åŠŸèƒ½</p>

    <p>è¯·æ±‚é™æµåŠŸèƒ½</p>

    <p>æ”¯æŒè·¯å¾„é‡å†™</p>
  </li>
</ul>

<h4 id="91æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œæµç¨‹">9.1æ ¸å¿ƒæ¦‚å¿µå’Œå·¥ä½œæµç¨‹</h4>

<ul>
  <li>Route(è·¯ç”±)ï¼šè·¯ç”±æ˜¯æ„å»ºç½‘å…³çš„åŸºæœ¬æ¨¡å—ï¼Œå®ƒç”±IDï¼Œç›®æ ‡URIï¼Œä¸€ç³»åˆ—çš„æ–­è¨€å’Œè¿‡æ»¤å™¨ç»„æˆï¼Œå¦‚æœæ–­è¨€ä¸ºtrueåˆ™åŒ¹é…è¯¥è·¯ç”±</li>
  <li>Predicateï¼ˆæ–­è¨€ï¼‰ï¼šå‚è€ƒçš„æ˜¯java8çš„java.util.function.Predicateå¼€å‘äººå‘˜å¯ä»¥åŒ¹é…HTTPè¯·æ±‚ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ˆä¾‹å¦‚è¯·æ±‚å¤´æˆ–è¯·æ±‚å‚æ•°ï¼‰ï¼Œå¦‚æœè¯·æ±‚ä¸æ–­è¨€ç›¸åŒ¹é…åˆ™è¿›è¡Œè·¯ç”±</li>
  <li>
    <p>Filter(è¿‡æ»¤)ï¼šæŒ‡çš„æ˜¯Springæ¡†æ¶ä¸­GatewayFilterçš„å®ä¾‹ï¼Œä½¿ç”¨è¿‡æ»¤å™¨ï¼Œå¯ä»¥åœ¨è¯·æ±‚è¢«è·¯ç”±å‰æˆ–è€…ä¹‹åå¯¹è¯·æ±‚è¿›è¡Œä¿®æ”¹ã€‚</p>
  </li>
  <li>å·¥ä½œæµç¨‹
    <ul>
      <li>å®¢æˆ·ç«¯å‘gatewayå‘é€è¯·æ±‚ï¼Œç„¶ååœ¨gateway handler mappingä¸­æ‰¾åˆ°ä¸è¯·æ±‚ç›¸åŒ¹é…çš„è·¯ç”±ï¼Œå°†å…¶å‘é€åˆ°gateway web handler</li>
      <li>handlerå†é€šè¿‡æŒ‡å®šçš„è¿‡æ»¤å™¨é“¾æ¥å°†è¯·æ±‚å‘é€åˆ°æˆ‘ä»¬å®é™…çš„æœåŠ¡æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè¿”å›ã€‚è¿‡æ»¤å™¨å¯èƒ½ä¼šåœ¨å‘é€ä»£ç†è¯·æ±‚ä¹‹å‰æˆ–ä¹‹åæ‰§è¡Œä¸šåŠ¡é€»è¾‘</li>
      <li>filteråœ¨â€œpreâ€ç±»å‹çš„è¿‡æ»¤å™¨å¯ä»¥åšå‚æ•°æ ¡éªŒï¼Œæƒé™æ ¡éªŒï¼Œæµé‡ç›‘æ§ï¼Œæ—¥å¿—è¾“å‡ºï¼Œåè®®è½¬æ¢ç­‰ã€‚åœ¨â€œpostâ€ç±»å‹çš„è¿‡æ»¤å™¨ä¸­å¯ä»¥åšå“åº”å†…å®¹ï¼Œå“åº”å¤´çš„ä¿®æ”¹ï¼Œæ—¥å¿—çš„è¾“å‡ºï¼Œæµé‡ç›‘æ§ç­‰ã€‚</li>
    </ul>
  </li>
</ul>

<h4 id="92å…¥é—¨é…ç½®9527">9.2å…¥é—¨é…ç½®9527</h4>

<ul>
  <li>æ–°å»ºcloud-gateway-gateway9527</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-gateway-gateway9527<span class="nt">&lt;/artifactId&gt;</span>


    <span class="nt">&lt;dependencies&gt;</span>
        <span class="c">&lt;!--æ–°å¢gateway--&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-gateway<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-hystrix<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">9527</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-gateway</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">gateway</span><span class="pi">:</span>
      <span class="na">routes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh</span> <span class="c1">#è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:8001</span>   <span class="c1">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/payment/get/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>

        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh2</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:8001</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/payment/lb/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>


<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">cloud-gateway-service</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableEurekaClient</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GateWayMain9527</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span> <span class="nc">GateWayMain9527</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>9527ç½‘å…³å¦‚ä½•åšè·¯ç”±æ˜ å°„é‚£ï¼Ÿï¼Ÿï¼Ÿ</p>

    <p>cloud-provider-payment8001çœ‹çœ‹controllerçš„è®¿é—®åœ°å€</p>

    <p>æˆ‘ä»¬ç›®å‰ä¸æƒ³æš´éœ²8001ç«¯å£ï¼Œå¸Œæœ›åœ¨8001å¤–é¢å¥—ä¸€å±‚9527</p>
  </li>
  <li>
    <p>YMLæ–°å¢ç½‘å…³é…ç½®</p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">9527</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-gateway</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">gateway</span><span class="pi">:</span>
      <span class="na">routes</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh</span> <span class="c1">#è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>
      <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:8001</span>   <span class="c1">#åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
      <span class="na">predicates</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Path=/payment/get/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>

    <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh2</span>
      <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:8001</span>
      <span class="na">predicates</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">Path=/payment/lb/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>


<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">cloud-gateway-service</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
 
 

</code></pre></div></div>

<ul>
  <li>
    <p>test</p>

    <p>å¯åŠ¨7001,cloud-provider-payment8001</p>

    <p>å¯åŠ¨9527ç½‘å…³</p>

    <p>æ·»åŠ ç½‘å…³å‰:http://localhost:8001/payment/get/31</p>

    <p>æ·»åŠ ç½‘å…³å:http://localhost:9527/payment/get/31</p>

    <p>â€‹</p>
  </li>
</ul>

<h4 id="93åŠ¨æ€è·¯ç”±">9.3åŠ¨æ€è·¯ç”±</h4>

<ul>
  <li>
    <p>é»˜è®¤æƒ…å†µä¸‹Gatewayä¼šæ ¹æ®æ³¨å†Œä¸­å¿ƒçš„æœåŠ¡åˆ—è¡¨ï¼Œä»¥æ³¨å†Œä¸­å¿ƒä¸Šå¾®æœåŠ¡åä¸ºè·¯å¾„åˆ›å»ºåŠ¨æ€è·¯ç”±è¿›è¡Œè½¬å‘ï¼Œä»è€Œå®ç°åŠ¨æ€è·¯ç”±çš„åŠŸèƒ½</p>
  </li>
  <li>
    <p>å¯åŠ¨ä¸€ä¸ªeureka7001+ä¸¤ä¸ªæœåŠ¡æä¾›è€…8001/8002</p>
  </li>
  <li>
    <p>yml</p>

    <p>éœ€è¦æ³¨æ„çš„æ˜¯uriçš„åè®®ä¸ºlbï¼Œè¡¨ç¤ºå¯ç”¨Gatewayçš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ã€‚</p>

    <p>lb://serviceNameæ˜¯spring cloud gatewayåœ¨å¾®æœåŠ¡ä¸­è‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„è´Ÿè½½å‡è¡¡uri</p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">9527</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-gateway</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">gateway</span><span class="pi">:</span>
      <span class="na">discovery</span><span class="pi">:</span>
        <span class="na">locator</span><span class="pi">:</span>
          <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>  <span class="c1">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span>
      <span class="na">routes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh</span> <span class="c1">#è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>
          <span class="c1">#uri: http://localhost:8001   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">lb://cloud-payment-service</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/payment/get/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>

        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh2</span>
          <span class="c1">#uri: http://localhost:8001   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">lb://cloud-payment-service</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/payment/lb/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>


<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">cloud-gateway-service</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
 
</code></pre></div></div>

<ul>
  <li>
    <p>test</p>

    <p>http://localhost:9527/payment/lb</p>

    <p>8001/8002ä¸¤ä¸ªç«¯å£åˆ‡æ¢</p>
  </li>
</ul>

<h4 id="94predicateçš„ä½¿ç”¨">9.4Predicateçš„ä½¿ç”¨</h4>

<ul>
  <li>
    <p>è¯´ç™½äº†ï¼ŒPredicateå°±æ˜¯ä¸ºäº†å®ç°ä¸€ç»„åŒ¹é…è§„åˆ™ï¼Œè®©è¯·æ±‚è¿‡æ¥æ‰¾åˆ°å¯¹åº”çš„Routeè¿›è¡Œå¤„ç†</p>
  </li>
  <li>
    <p>å¸¸ç”¨çš„Route Predicate</p>

    <p>After Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">After=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span>
</code></pre></div>    </div>

    <p>Before Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">After=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span>
<span class="pi">-</span> <span class="s">Before=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span>
</code></pre></div>    </div>

    <p>Between Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">Between=2020-03-08T10:59:34.102+08:00[Asia/Shanghai] ,  2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span>

</code></pre></div>    </div>

    <p>Cookie Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">Cookie=username,atguigu</span>    <span class="c1">#å¹¶ä¸”Cookieæ˜¯username=zhangshuaiæ‰èƒ½è®¿é—®</span>
</code></pre></div>    </div>

    <p>Header Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">Header=X-Request-Id, \d+</span>   <span class="c1">#è¯·æ±‚å¤´ä¸­è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span>
</code></pre></div>    </div>

    <p>Host Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">Host=**.atguigu.com</span>
</code></pre></div>    </div>

    <p>Method Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">Method=GET</span>
</code></pre></div>    </div>

    <p>Path Route Predicate</p>

    <p>Query Route Predicate</p>

    <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="s">Query=username, \d+</span> <span class="c1">#è¦æœ‰å‚æ•°åç§°å¹¶ä¸”æ˜¯æ­£æ•´æ•°æ‰èƒ½è·¯ç”±</span>
</code></pre></div>    </div>

    <p>â€‹</p>
  </li>
  <li>
    <p>æ€»ç»“</p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">9527</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-gateway</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">gateway</span><span class="pi">:</span>
      <span class="na">discovery</span><span class="pi">:</span>
        <span class="na">locator</span><span class="pi">:</span>
          <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>  <span class="c1">#å¼€å¯ä»æ³¨å†Œä¸­å¿ƒåŠ¨æ€åˆ›å»ºè·¯ç”±çš„åŠŸèƒ½ï¼Œåˆ©ç”¨å¾®æœåŠ¡åè¿›è¡Œè·¯ç”±</span>
      <span class="na">routes</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh</span> <span class="c1">#è·¯ç”±çš„IDï¼Œæ²¡æœ‰å›ºå®šè§„åˆ™ä½†è¦æ±‚å”¯ä¸€ï¼Œå»ºè®®é…åˆæœåŠ¡å</span>
          <span class="c1">#uri: http://localhost:8001   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">lb://cloud-payment-service</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/payment/get/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
 
        <span class="pi">-</span> <span class="na">id</span><span class="pi">:</span> <span class="s">payment_routh2</span>
          <span class="c1">#uri: http://localhost:8001   #åŒ¹é…åæä¾›æœåŠ¡çš„è·¯ç”±åœ°å€</span>
          <span class="na">uri</span><span class="pi">:</span> <span class="s">lb://cloud-payment-service</span>
          <span class="na">predicates</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">Path=/payment/lb/**</span>   <span class="c1">#æ–­è¨€,è·¯å¾„ç›¸åŒ¹é…çš„è¿›è¡Œè·¯ç”±</span>
            <span class="c1">#- After=2020-03-08T10:59:34.102+08:00[Asia/Shanghai]</span>
            <span class="c1">#- Cookie=username,zhangshuai #å¹¶ä¸”Cookieæ˜¯username=zhangshuaiæ‰èƒ½è®¿é—®</span>
            <span class="c1">#- Header=X-Request-Id, \d+ #è¯·æ±‚å¤´ä¸­è¦æœ‰X-Request-Idå±æ€§å¹¶ä¸”å€¼ä¸ºæ•´æ•°çš„æ­£åˆ™è¡¨è¾¾å¼</span>
            <span class="c1">#- Host=**.atguigu.com</span>
            <span class="c1">#- Method=GET</span>
            <span class="c1">#- Query=username, \d+ #è¦æœ‰å‚æ•°åç§°å¹¶ä¸”æ˜¯æ­£æ•´æ•°æ‰èƒ½è·¯ç”±</span>
 
 
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">hostname</span><span class="pi">:</span> <span class="s">cloud-gateway-service</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">fetch-registry</span><span class="pi">:</span> <span class="no">true</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>

</code></pre></div></div>

<h4 id="95filterçš„ä½¿ç”¨">9.5Filterçš„ä½¿ç”¨</h4>

<ul>
  <li>
    <p>è·¯ç”±è¿‡æ»¤å™¨å¯ä»¥ç”¨äºä¿®æ”¹è¿›å…¥çš„HTTPè¯·æ±‚å’Œè¿”å›çš„HTTPå“åº”ï¼Œè·¯ç”±è¿‡æ»¤å™¨åªèƒ½æŒ‡å®šè·¯ç”±è¿›è¡Œä½¿ç”¨</p>
  </li>
  <li>
    <p>è·¯ç”±è¿‡æ»¤å™¨ç”±GatewayFilterå·¥å‚ç±»æ¥äº§ç”Ÿ</p>
  </li>
  <li>
    <p>ç”Ÿå‘½å‘¨æœŸ</p>

    <p>preï¼šåœ¨ä¸šåŠ¡é€»è¾‘ä¹‹å‰</p>

    <p>postï¼šåœ¨ä¸šåŠ¡é€»è¾‘ä¹‹å</p>
  </li>
  <li>
    <p>ç§ç±»</p>

    <p>GatewayFilterï¼šå•ä¸€</p>

    <p>GlobalFilterï¼šå…¨å±€</p>
  </li>
  <li>
    <p>è‡ªå®šä¹‰å…¨å±€GlobalFilter</p>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyLogGateWayFilter</span> <span class="kd">implements</span> <span class="nc">GlobalFilter</span><span class="o">,</span><span class="nc">Ordered</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">Void</span><span class="o">&gt;</span> <span class="nf">filter</span><span class="o">(</span><span class="nc">ServerWebExchange</span> <span class="n">exchange</span><span class="o">,</span> <span class="nc">GatewayFilterChain</span> <span class="n">chain</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*********come in MyLogGateWayFilter: "</span><span class="o">+</span><span class="k">new</span> <span class="nc">Date</span><span class="o">());</span>
        <span class="nc">String</span> <span class="n">uname</span> <span class="o">=</span> <span class="n">exchange</span><span class="o">.</span><span class="na">getRequest</span><span class="o">().</span><span class="na">getQueryParams</span><span class="o">().</span><span class="na">getFirst</span><span class="o">(</span><span class="s">"username"</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="nc">StringUtils</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">(</span><span class="n">uname</span><span class="o">)){</span>
            <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"*****ç”¨æˆ·åä¸ºNull éæ³•ç”¨æˆ·,(â”¬ï¼¿â”¬)"</span><span class="o">);</span>
            <span class="n">exchange</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">setStatusCode</span><span class="o">(</span><span class="nc">HttpStatus</span><span class="o">.</span><span class="na">NOT_ACCEPTABLE</span><span class="o">);</span><span class="c1">//ç»™äººå®¶ä¸€ä¸ªå›åº”</span>
            <span class="k">return</span> <span class="n">exchange</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">setComplete</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">chain</span><span class="o">.</span><span class="na">filter</span><span class="o">(</span><span class="n">exchange</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getOrder</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•</p>

    <p>å¯åŠ¨eureka7001ï¼Œpayment8001ï¼Œ8002ï¼Œgateway9527</p>

    <p>http://localhost:9527/payment/lb?uname=z3</p>
  </li>
</ul>

<h3 id="10configåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ">10ï¼šConfigåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒ</h3>

<ul>
  <li>
    <p>åˆ†å¸ƒå¼ç³»ç»Ÿé¢ä¸´çš„é…ç½®é—®é¢˜ï¼šæ¯ä¸€ä¸ªå¾®æœåŠ¡é¡¹ç›®éƒ½æœ‰ä¸€ä¸ªapplication.ymlé…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡å¤šäº†ä¹‹åå°±ä¸å¥½ç®¡ç†äº†ã€‚</p>
  </li>
  <li>
    <p>Configä¸ºå¾®æœåŠ¡æ¶æ„ä¸­çš„å¾®æœåŠ¡æä¾›é›†ä¸­åŒ–çš„å¤–éƒ¨é…ç½®æ”¯æŒï¼Œé…ç½®æœåŠ¡å™¨ä¸ºå„ä¸ªä¸åŒå¾®æœåŠ¡åº”ç”¨çš„æ‰€æœ‰ç¯å¢ƒæä¾›äº†ä¸€ä¸ªä¸­å¿ƒåŒ–çš„å¤–éƒ¨é…ç½®ã€‚</p>
  </li>
  <li>
    <p>Configåˆ†ä¸ºæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸¤éƒ¨åˆ†</p>

    <p>æœåŠ¡ç«¯ä¹Ÿç§°ä¸ºåˆ†å¸ƒå¼é…ç½®ä¸­å¿ƒï¼Œå®ƒæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡åº”ç”¨ã€‚ç”¨æ¥è¿æ¥é…ç½®æœåŠ¡å™¨å¹¶ä¸ºå®¢æˆ·ç«¯æä¾›è·å–é…ç½®ä¿¡æ¯ï¼ŒåŠ å¯†è§£å¯†ç­‰æœåŠ¡æ¥å£</p>

    <p>å®¢æˆ·ç«¯é€šè¿‡æŒ‡å®šçš„é…ç½®ä¸­å¿ƒæ¥ç®¡ç†åº”ç”¨èµ„æºï¼Œä»¥åŠä¸ä¸šåŠ¡æœ‰å…³çš„é…ç½®å†…å®¹ï¼Œå¹¶åœ¨å¯åŠ¨çš„æ—¶å€™ä»é…ç½®ä¸­å¿ƒè·å–å’ŒåŠ è½½é…ç½®ä¿¡æ¯ï¼Œé…ç½®æœåŠ¡å™¨é»˜è®¤é‡‡ç”¨gitæ¥å­˜å‚¨é…ç½®ä¿¡æ¯ï¼Œè¿™æ ·å°±æœ‰åŠ©äºå¯¹ç¯å¢ƒé…ç½®è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡Gitå®¢æˆ·ç«¯æ¥ç®¡ç†å’Œè®¿é—®é…ç½®å†…å®¹ã€‚</p>
  </li>
  <li>
    <p>Configè¿è¡ŒæœŸé—´åŠ¨æ€è°ƒæ•´é…ç½®ï¼Œä¸å†éœ€è¦åœ¨æ¯ä¸ªæœåŠ¡éƒ¨ç½²çš„æœºå™¨ä¸Šç¼–å†™é…ç½®æ–‡ä»¶ï¼ŒæœåŠ¡ä¼šå‘é…ç½®ä¸­å¿ƒç»Ÿä¸€æ‹‰å–é…ç½®è‡ªå·±çš„ä¿¡æ¯ã€‚å½“é…ç½®å‘ç”Ÿå˜åŠ¨æ—¶ï¼ŒæœåŠ¡ä¸éœ€è¦é‡å¯å³å¯æ„ŸçŸ¥åˆ°é…ç½®çš„å˜åŒ–å¹¶åº”ç”¨æ–°çš„é…ç½®ã€‚å°†é…ç½®ä¿¡æ¯ä»¥RESTæ¥å£çš„å½¢å¼æš´éœ²</p>
  </li>
</ul>

<h4 id="101æœåŠ¡ç«¯é…ç½®3344">10.1æœåŠ¡ç«¯é…ç½®3344</h4>

<ul>
  <li>
    <p>ç”¨ä½ è‡ªå·±çš„è´¦å·åœ¨Githubä¸Šæ–°å»ºä¸€ä¸ªåä¸ºsprincloud-configçš„æ–°Repository</p>
  </li>
  <li>
    <p>æœ¬åœ°ç¡¬ç›˜ä¸Šæ–°å»ºgitä»“åº“å¹¶cloneï¼Œæ­¤æ—¶åœ¨æœ¬åœ°Dç›˜ç¬¦ä¸‹D:\44\SpringCloud2020\springcloud-config</p>

    <p>åˆ›å»ºä¸‰ä¸ªymlæ–‡ä»¶ï¼Œåˆ†åˆ«ä¸ºdevï¼Œprodï¼Œtestè¡¨ç¤ºå¤šä¸ªç¯å¢ƒçš„é…ç½®æ–‡ä»¶</p>

    <p>ä¿å­˜æ ¼å¼å¿…é¡»ä¸ºUTF-8</p>
  </li>
  <li>æ–°å»ºModuleæ¨¡å—cloud-config-center-3344å®ƒæ—¢ä¸ºCloudçš„é…ç½®ä¸­å¿ƒæ¨¡å—cloudConfig Center</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-config-center-3344<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>


        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-config-server<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">3344</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-config-center</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">server</span><span class="pi">:</span>
        <span class="na">git</span><span class="pi">:</span>
          <span class="na">uri</span><span class="pi">:</span>  <span class="s">å¡«å†™ä½ è‡ªå·±çš„githubè·¯å¾„</span>
          <span class="c1"># æœç´¢ç›®å½•</span>
          <span class="na">search-paths</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">springcloud-config</span>
      <span class="c1"># è¯»å–åˆ†æ”¯</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s">master</span>
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span>  <span class="s">http://localhost:7001/eureka</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="nd">@EnableConfigServer</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigCenterMain3344</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">ConfigCenterMain3344</span> <span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>windowsä¸‹ä¿®æ”¹hostsæ–‡ä»¶ï¼Œå¢åŠ æ˜ å°„:<code class="language-plaintext highlighter-rouge">127.0.0.1 config-3344.com</code></p>
  </li>
  <li>
    <p>æµ‹è¯•é€šè¿‡Configå¾®æœåŠ¡æ˜¯å¦å¯ä»¥ä»Githubä¸Šè·å–é…ç½®å†…å®¹</p>

    <p>å¯åŠ¨å¾®æœåŠ¡3344</p>

    <p>http://config-3344.com:3344/master/config-dev.yml</p>
  </li>
  <li>
    <p>é…ç½®è¯»å–è§„åˆ™</p>
  </li>
  <li>
    <p>/{label}/{application}-{profile}.ymlï¼ˆæœ€æ¨èä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰</p>

    <p>masteråˆ†æ”¯</p>

    <p>http://config-3344.com:3344/master/config-dev.yml</p>

    <p>devåˆ†æ”¯</p>

    <p>http://config-3344.com:3344/dev/config-dev.yml</p>
  </li>
  <li>
    <p>/{application}-{profile}.yml</p>

    <p>http://config-3344.com:3344/config-dev.yml</p>
  </li>
  <li>
    <p>/{application}-{profile}[/{label}]</p>

    <p>http://config-3344.com:3344/config/dev/master</p>
  </li>
  <li>
    <p>labelï¼šåˆ†æ”¯</p>

    <p>nameï¼šæœåŠ¡å</p>

    <p>profilesï¼šç¯å¢ƒï¼ˆdevï¼Œtestï¼Œprodï¼‰</p>
  </li>
</ul>

<h4 id="102å®¢æˆ·ç«¯é…ç½®3355">10.2å®¢æˆ·ç«¯é…ç½®3355</h4>

<ul>
  <li>æ–°å»ºcloud-config-client-3355</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-config-client-3355<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-config<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>bootstap.yml
    <ul>
      <li>application.ymlæ˜¯ç”¨æˆ·çº§åˆ«çš„èµ„æºé…ç½®é¡¹</li>
      <li>bootstrap.ymlæ˜¯ç³»ç»Ÿçº§åˆ«çš„èµ„æºé…ç½®é¡¹ï¼ˆä¼˜å…ˆçº§æ›´é«˜ï¼‰</li>
    </ul>
  </li>
  <li>springcloudä¼šåˆ›å»ºä¸€ä¸ªâ€œBootstrap Contextâ€ï¼Œä½œä¸ºspringçš„â€œApplication contextâ€çš„çˆ¶ä¸Šä¸‹æ–‡ã€‚åˆå§‹åŒ–çš„æ—¶å€™ï¼Œâ€œBootstrap Contextâ€è´Ÿè´£ä»å¤–éƒ¨æºåŠ è½½é…ç½®å±æ€§å¹¶è§£æé…ç½®ã€‚è¿™ä¸¤ä¸ªä¸Šä¸‹æ–‡å…±äº«ä¸€ä¸ªä»å¤–éƒ¨è·å–çš„â€œEnvironmentâ€ã€‚â€œBootstrap Contextâ€å’Œâ€œApplication contextâ€æœ‰ä¸åŒçš„çº¦å®šï¼Œæ‰€ä»¥æ–°å¢bootstrap.ymlæ–‡ä»¶ï¼Œä¿è¯â€œBootstrap Contextâ€å’Œâ€œApplication contextâ€é…ç½®çš„åˆ†ç¦»</li>
  <li>è¦å°†Clientæ¨¡å—çš„application.ymlæ”¹ä¸ºbootstrap.ymlã€‚å› ä¸ºbootstrap.ymlæ˜¯å…ˆåŠ è½½çš„ï¼Œä¼˜å…ˆçº§é«˜</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">3355</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">config-client</span>
  <span class="na">cloud</span><span class="pi">:</span>
   <span class="c1"># configå®¢æˆ·ç«¯è®¾ç½®</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s">master</span> <span class="c1"># åˆ†æ”¯åç§°</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>  <span class="c1"># é…ç½®æ–‡ä»¶åç§°</span>
      <span class="na">profile</span><span class="pi">:</span> <span class="s">dev</span>  <span class="c1"># è¯»å–åç¼€åç§°</span>
      <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:3344</span>  <span class="c1"># é…ç½®ä¸­å¿ƒåœ°å€</span>
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹config-dev.ymlé…ç½®å¹¶æäº¤åˆ°GitHubä¸­ï¼Œæ¯”å¦‚åŠ ä¸ªå˜é‡ageæˆ–è€…ç‰ˆæœ¬å·version</li>
  <li>ä¸»å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigClientMain3355</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span> <span class="nc">ConfigClientMain3355</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigClientController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${config.info}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">configInfo</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/configInfo"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getConfigInfo</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">configInfo</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>
    <p>test</p>

    <p>å¯åŠ¨Configé…ç½®ä¸­å¿ƒ3344å¾®æœåŠ¡å¹¶è‡ªæµ‹</p>

    <p>http://config-3344.com:3344/master/config-dev.yml</p>

    <p>http://config-3344.com:3344/master/config-test.yml</p>

    <p>å¯åŠ¨3355ä½œä¸ºClientå‡†å¤‡è®¿é—®</p>

    <p>http://localhost:3355/configInfo</p>

    <p>æˆåŠŸå®ç°äº†å®¢æˆ·ç«¯3355è®¿é—®SpringCloud Config3344é€šè¿‡GitHubè·å–é…ç½®ä¿¡æ¯</p>
  </li>
  <li>
    <p>é—®é¢˜éšæ—¶è€Œæ¥ï¼Œåˆ†å¸ƒå¼é…ç½®çš„åŠ¨æ€åˆ·æ–°</p>

    <p>Linuxè¿ç»´ä¿®æ”¹GitHubä¸Šçš„é…ç½®æ–‡ä»¶å†…å®¹åšè°ƒæ•´</p>

    <p>åˆ·æ–°3344ï¼Œå‘ç°ConfigServeré…ç½®ä¸­å¿ƒç«‹åˆ»å“åº”</p>

    <p>åˆ·æ–°3355ï¼Œå‘ç°ConfigServerå®¢æˆ·ç«¯æ²¡æœ‰ä»»ä½•å“åº”</p>

    <p>3355æ²¡æœ‰å˜åŒ–é™¤éè‡ªå·±é‡å¯æˆ–è€…é‡æ–°åŠ è½½</p>

    <p>éš¾é“æ¯æ¬¡è¿ç»´ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå®¢æˆ·ç«¯éƒ½éœ€è¦é‡å¯ï¼Ÿï¼Ÿå™©æ¢¦</p>
  </li>
</ul>

<h4 id="103å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°">10.3å®¢æˆ·ç«¯åŠ¨æ€åˆ·æ–°</h4>

<ul>
  <li>é¿å…æ¯æ¬¡æ›´æ–°é…ç½®éƒ½è¦é‡å¯å®¢æˆ·ç«¯å¾®æœåŠ¡3355</li>
  <li>ä¿®æ”¹3355æ¨¡å—</li>
  <li>POMå¼•å…¥actuatorç›‘æ§</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>ä¿®æ”¹YMLï¼Œæš´éœ²ç›‘æ§ç«¯å£</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">3355</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">config-client</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s">master</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">profile</span><span class="pi">:</span> <span class="s">dev</span>
      <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:3344</span>
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
 
<span class="c1"># æš´éœ²ç›‘æ§ç«¯ç‚¹</span>
<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡ç±»æ·»åŠ æ³¨è§£</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RefreshScope</span>
<span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigClientController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${config.info}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">configInfo</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/configInfo"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getConfigInfo</span><span class="o">(){</span>
        <span class="k">return</span> <span class="n">configInfo</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æ­¤æ—¶ä¿®æ”¹github</p>
  </li>
  <li>
    <p>éœ€è¦è¿ç»´äººå‘˜å‘é€Postè¯·æ±‚åˆ·æ–°3355ï¼Œå¿…é¡»æ˜¯Postè¯·æ±‚</p>

    <p>curl -X POST â€œhttp://localhost:3355/actuator/refreshâ€</p>

    <p>è®¿é—®http://localhost:3355/configInfo</p>

    <p>æ›´æ”¹æˆåŠŸï¼ŒæˆåŠŸå®ç°äº†å®¢æˆ·ç«¯3355åˆ·æ–°åˆ°æœ€æ–°é…ç½®å†…å®¹ï¼Œé¿å…äº†æœåŠ¡çš„é‡å¯</p>
  </li>
  <li>
    <p>å¼•å‡ºæ–°çš„é—®é¢˜</p>

    <p>å‡å¦‚æœ‰å¤šä¸ªå¾®æœåŠ¡å®¢æˆ·ç«¯3355/3366/3377ã€‚ã€‚ã€‚ã€‚</p>

    <p>æ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰§è¡Œä¸€æ¬¡postè¯·æ±‚ï¼Œæ‰‹åŠ¨åˆ·æ–°ï¼Ÿ</p>

    <p>å¯å¦å¹¿æ’­ï¼Œä¸€æ¬¡é€šçŸ¥ï¼Œå¤„å¤„ç”Ÿæ•ˆï¼Ÿ</p>

    <p>æˆ‘ä»¬æƒ³å¤§èŒƒå›´çš„è‡ªåŠ¨åˆ·æ–°ï¼Œæ±‚æ–¹æ³•</p>
  </li>
</ul>

<h3 id="11busæ¶ˆæ¯æ€»çº¿">11ï¼šBusæ¶ˆæ¯æ€»çº¿</h3>

<ul>
  <li>åˆ†å¸ƒå¼è‡ªåŠ¨åˆ·æ–°é…ç½®åŠŸèƒ½</li>
  <li>Spring Cloud Busé…åˆSpring Cloud Configä½¿ç”¨å¯ä»¥å®ç°é…ç½®çš„åŠ¨æ€åˆ·æ–°</li>
  <li>Busæ˜¯ç”¨æ¥å°†åˆ†å¸ƒå¼ç³»ç»Ÿçš„èŠ‚ç‚¹ä¸è½»é‡çº§æ¶ˆæ¯ç³»ç»Ÿé“¾æ¥èµ·æ¥çš„æ¡†æ¶ï¼Œå®ƒæ•´åˆäº†Javaçš„äº‹ä»¶å¤„ç†æœºåˆ¶å’Œæ¶ˆæ¯ä¸­é—´ä»¶çš„åŠŸèƒ½ã€‚ç›®å‰æ”¯æŒRabbitMQå’ŒKafka</li>
  <li>Busèƒ½ç®¡ç†å’Œä¼ æ’­åˆ†å¸ƒå¼ç³»ç»Ÿé—´çš„æ¶ˆæ¯ï¼Œå°±åƒä¸€ä¸ªåˆ†å¸ƒå¼æ‰§è¡Œå™¨ï¼Œå¯ç”¨äºå¹¿æ’­çŠ¶æ€æ›´æ”¹ï¼Œäº‹ä»¶æ¨é€ç­‰ï¼Œä¹Ÿå¯ä»¥å½“åšå¾®æœåŠ¡é—´çš„é€šä¿¡é€šé“ã€‚</li>
  <li>ä»€ä¹ˆæ˜¯æ€»çº¿ï¼šåœ¨å¾®æœåŠ¡æ¶æ„ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ä¼šä½¿ç”¨è½»é‡çº§çš„æ¶ˆæ¯ä»£ç†æ¥æ„å»ºä¸€ä¸ªå…±åŒçš„æ¶ˆæ¯ä¸»é¢˜ï¼Œå¹¶è®©ç³»ç»Ÿä¸­æ‰€æœ‰å¾®æœåŠ¡å®ä¾‹éƒ½è¿æ¥ä¸Šæ¥ï¼Œç”±äºè¯¥ä¸»é¢˜ä¸­äº§ç”Ÿçš„æ¶ˆæ¯ä¼šè¢«æ‰€æœ‰å®ä¾‹ç›‘å¬å’Œæ¶ˆè´¹ï¼Œæ‰€ä»¥ç§°ä¸ºæ¶ˆæ¯æ€»çº¿ã€‚</li>
  <li>åŸºæœ¬åŸç†ï¼šConfigClientå®ä¾‹éƒ½ç›‘å¬MQä¸­åŒä¸€ä¸ªtopicï¼ˆé»˜è®¤æ˜¯springCloudBusï¼‰ï¼Œå½“ä¸€ä¸ªæœåŠ¡åˆ·æ–°æ•°æ®çš„æ—¶å€™ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªä¿¡æ¯æ”¾å…¥åˆ°topicä¸­ï¼Œè¿™æ ·å…¶ä»–ç›‘å¬åŒä¸€ä¸ªtopicçš„æœåŠ¡å°±èƒ½å¾—åˆ°é€šçŸ¥ï¼Œç„¶åå»æ›´æ–°è‡ªèº«çš„é…ç½®ã€‚</li>
</ul>

<h4 id="111rabbitmqç¯å¢ƒé…ç½®">11.1RabbitMQç¯å¢ƒé…ç½®</h4>

<ul>
  <li>
    <p>å®‰è£…Erlang</p>
  </li>
  <li>
    <p>å®‰è£…RabbitMQ</p>
  </li>
  <li>
    <p>è¿›å…¥RabbitMQå®‰è£…ç›®å½•ä¸‹çš„sbinç›®å½•</p>

    <p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ç®¡ç†åŠŸèƒ½<code class="language-plaintext highlighter-rouge">rabbitmq-plugins enable rabbitmq_management</code></p>

    <p>è®¿é—®åœ°å€æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</p>

    <p>http://localhost:15672/</p>

    <p>è¾“å…¥è´¦å·å¯†ç å¹¶ç™»å½•: guest guest</p>
  </li>
</ul>

<h4 id="112busåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­">11.2BusåŠ¨æ€åˆ·æ–°å…¨å±€å¹¿æ’­</h4>

<ul>
  <li>å¿…é¡»å…ˆå…·å¤‡è‰¯å¥½çš„RabbitMQç¯å¢ƒå…ˆ</li>
  <li>æ¼”ç¤ºå¹¿æ’­æ•ˆæœï¼Œå¢åŠ å¤æ‚åº¦ï¼Œå†ä»¥3355ä¸ºæ¨¡æ¿å†åˆ¶ä½œä¸€ä¸ª3366</li>
  <li>æ–°å»ºcloud-config-client-3366</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nt">&lt;dependencies&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-config<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;dependency&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
    <span class="nt">&lt;/dependency&gt;</span>
<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">3366</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">config-client</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s">master</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">profile</span><span class="pi">:</span> <span class="s">dev</span>
      <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:3344</span>
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableEurekaClient</span>
<span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigClientMain3366</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span> <span class="nc">ConfigClientMain3366</span><span class="o">.</span><span class="na">class</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
        <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RefreshScope</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ConfigClientController</span> <span class="o">{</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${config.info}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">configInfo</span><span class="o">;</span>


    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/configInfo"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getConfigInfo</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"serverPort:"</span><span class="o">+</span><span class="n">serverPort</span><span class="o">+</span><span class="s">"\t\n\n configInfo: "</span><span class="o">+</span><span class="n">configInfo</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>è®¾è®¡æ€æƒ³</p>

    <p>1) åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ª<strong>å®¢æˆ·ç«¯</strong>/bus/refresh,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®</p>

    <p>2) åˆ©ç”¨æ¶ˆæ¯æ€»çº¿è§¦å‘ä¸€ä¸ª<strong>æœåŠ¡ç«¯</strong>ConfigServerçš„/bus/refreshç«¯ç‚¹,è€Œåˆ·æ–°æ‰€æœ‰å®¢æˆ·ç«¯çš„é…ç½®ï¼ˆæ›´åŠ æ¨èï¼‰</p>
  </li>
  <li>
    <p>æ–¹å¼1ä¸é€‚åˆçš„åŸå› </p>

    <p>æ‰“ç ´äº†å¾®æœåŠ¡çš„èŒè´£å•ä¸€æ€§ï¼Œå› ä¸ºå¾®æœåŠ¡æœ¬èº«æ˜¯ä¸šåŠ¡æ¨¡å—ï¼Œå®ƒæœ¬ä¸åº”è¯¥æ‰¿æ‹…é…ç½®åˆ·æ–°èŒè´£</p>

    <p>ç ´åäº†å¾®æœåŠ¡å„èŠ‚ç‚¹çš„å¯¹ç­‰æ€§</p>

    <p>æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå¾®æœåŠ¡åœ¨è¿ç§»æ—¶ï¼Œå®ƒçš„ç½‘ç»œåœ°å€å¸¸å¸¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œæ­¤æ—¶å¦‚æœæƒ³è¦åšåˆ°è‡ªåŠ¨åˆ·æ–°ï¼Œé‚£å°±ä¼šå¢åŠ æ›´å¤šçš„ä¿®æ”¹</p>
  </li>
  <li>ç»™cloud-config-center-3344é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--æ·»åŠ æ”¯æŒæ¶ˆæ¯æ€»çº¿rabbitmq--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bus-amqp<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">3344</span>
<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-config-center</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">server</span><span class="pi">:</span>
        <span class="na">git</span><span class="pi">:</span>
          <span class="na">uri</span><span class="pi">:</span>  <span class="s">https://github.com/hhf19906/springcloud-config.git</span>  <span class="c1">#git@github.com:hhf19906/springcloud-config.git</span>
          <span class="na">search-paths</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="s">springcloud-config</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s">master</span>
 
<span class="c1"># rabbitmqç›¸å…³é…ç½®</span>
<span class="na">rabbitmq</span><span class="pi">:</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">5672</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">guest</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">guest</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span>  <span class="s">http://localhost:7001/eureka</span>
 
<span class="c1"># rabbitmqç›¸å…³é…ç½®ï¼Œæš´éœ²busåˆ·æ–°é…ç½®çš„ç«¯ç‚¹</span>
<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span> 
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span> <span class="s1">'</span><span class="s">bus-refresh'</span>
</code></pre></div></div>

<ul>
  <li>ç»™cloud-config-center-3355å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-bus-amqp<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">3355</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">config-client</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">config</span><span class="pi">:</span>
      <span class="na">label</span><span class="pi">:</span> <span class="s">master</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">config</span>
      <span class="na">profile</span><span class="pi">:</span> <span class="s">dev</span>
      <span class="na">uri</span><span class="pi">:</span> <span class="s">http://localhost:3344</span>

<span class="na">rabbitmq</span><span class="pi">:</span>
    <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
    <span class="na">port</span><span class="pi">:</span> <span class="m">5672</span>
    <span class="na">username</span><span class="pi">:</span> <span class="s">guest</span>
    <span class="na">password</span><span class="pi">:</span> <span class="s">guest</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka</span>
<span class="na">management</span><span class="pi">:</span>
  <span class="na">endpoints</span><span class="pi">:</span>
    <span class="na">web</span><span class="pi">:</span>
      <span class="na">exposure</span><span class="pi">:</span>
        <span class="na">include</span><span class="pi">:</span> <span class="s2">"</span><span class="s">*"</span>

</code></pre></div></div>

<ul>
  <li>ç»™cloud-config-center-3366å®¢æˆ·ç«¯æ·»åŠ æ¶ˆæ¯æ€»çº¿æ”¯æŒ</li>
  <li>pomåŒä¸Š</li>
  <li>
    <p>ymlåŒä¸Š</p>
  </li>
  <li>
    <p>æµ‹è¯•</p>
  </li>
  <li>
    <p>è¿ç»´å·¥ç¨‹å¸ˆ</p>

    <p>ä¿®æ”¹Githubä¸Šé…ç½®æ–‡ä»¶å¢åŠ ç‰ˆæœ¬å·</p>

    <p>å‘é€Postè¯·æ±‚<code class="language-plaintext highlighter-rouge">curl -X POST "http://localhost:3344/actuator/bus-refresh"</code></p>

    <p>ä¸€æ¬¡å‘é€ï¼Œå¤„å¤„ç”Ÿæ•ˆ</p>
  </li>
  <li>
    <p>é…ç½®ä¸­å¿ƒ</p>

    <p>http://config-3344.com/config-dev.yml</p>
  </li>
  <li>
    <p>å®¢æˆ·ç«¯</p>

    <p>http://localhost:3355/configInfo</p>

    <p>http://localhost:3366/configInfo</p>

    <p>è·å–é…ç½®ä¿¡æ¯ï¼Œå‘ç°éƒ½å·²ç»åˆ·æ–°äº†</p>
  </li>
</ul>

<h4 id="113busåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥">11.3BusåŠ¨æ€åˆ·æ–°å®šç‚¹é€šçŸ¥</h4>

<ul>
  <li>
    <p>ä¸æƒ³å…¨éƒ¨é€šçŸ¥ï¼Œåªæƒ³å®šç‚¹é€šçŸ¥ã€‚åªé€šçŸ¥3355ï¼Œä¸é€šçŸ¥3366</p>
  </li>
  <li>
    <p>/bus/refreshè¯·æ±‚ä¸å†å‘é€åˆ°å…·ä½“çš„æœåŠ¡å®ä¾‹ä¸Šï¼Œè€Œæ˜¯å‘ç»™config serverå¹¶é€šè¿‡destinationå‚æ•°ç±»æŒ‡å®šéœ€è¦æ›´æ–°é…ç½®çš„æœåŠ¡æˆ–å®ä¾‹</p>
  </li>
  <li>
    <p>å…¬å¼ï¼š<code class="language-plaintext highlighter-rouge">http://localhost:é…ç½®ä¸­å¿ƒçš„ç«¯å£å·/actuator/bus-refresh/{destination}</code></p>

    <p><code class="language-plaintext highlighter-rouge">curl -X POST "http://localhost:3344/actuator/bus-refresh/config-client:3355"</code></p>
  </li>
</ul>

<h3 id="12streamæ¶ˆæ¯é©±åŠ¨">12ï¼šStreamæ¶ˆæ¯é©±åŠ¨</h3>

<ul>
  <li>
    <p>ä»€ä¹ˆæ˜¯streamï¼šstreamæ˜¯ä¸€ä¸ªæ„å»ºæ¶ˆæ¯é©±åŠ¨å¾®æœåŠ¡çš„æ¡†æ¶ï¼Œé€šè¿‡è¾“å…¥è¾“å‡ºæµæ¥ä¸streamä¸­çš„binderäº¤äº’ã€‚é€šè¿‡æˆ‘ä»¬é…ç½®æ¥bindingï¼ˆç»‘å®šï¼‰ï¼Œstreamçš„binderè´Ÿè´£ä¸æ¶ˆæ¯ä¸­é—´ä»¶äº¤äº’ã€‚ç›®å‰ï¼šä¸€å¥è¯åªæ”¯æŒRabbitMQï¼ŒKafkaã€‚</p>
  </li>
  <li>
    <p>ä¸€å¥è¯ï¼šå°±åƒJDBCä¸€æ ·ï¼Œ<strong>å±è”½åº•å±‚æ¶ˆæ¯ä¸­é—´ä»¶çš„å·®å¼‚ï¼Œé™ä½åˆ‡æ¢ç‰ˆæœ¬ï¼Œç»Ÿä¸€æ¶ˆæ¯çš„ç¼–ç¨‹æ¨¡å‹</strong>ï¼ˆæ¯”å¦‚ç³»ç»ŸAç”¨Rabbitmqï¼Œç³»ç»ŸBç”¨Kafkaï¼Œä¸¤ä¸ªç³»ç»Ÿè¿›è¡Œäº¤äº’ï¼Œéœ€è¦æœ‰ä¸€ä¸ªç»Ÿä¸€è§„èŒƒï¼‰</p>
  </li>
  <li>
    <p>æ ‡å‡†MQï¼š</p>

    <p>ç”Ÿäº§è€…/æ¶ˆè´¹è€…ä¹‹é—´é æ¶ˆæ¯åª’ä»‹ä¼ é€’ä¿¡æ¯å†…å®¹</p>

    <p>æ¶ˆæ¯å¿…é¡»èµ°ç‰¹å®šçš„é€šé“ï¼Œæ¶ˆæ¯é€šé“MessageChannel</p>

    <p>æ¶ˆæ¯é€šé“MessageChannelçš„å­æ¥å£SubscribableChannel,ç”±MessageHandleræ¶ˆæ¯å¤„ç†å™¨è®¢é˜…</p>
  </li>
  <li>
    <p>ä¸ºä»€ä¹ˆä½¿ç”¨stream</p>

    <p>ä¸åŒçš„æ¶ˆæ¯ä¸­é—´ä»¶åœ¨æ¶æ„ä¸Šä¸åŒï¼ŒåƒrabbitMQæœ‰exchangeï¼ŒKafkaæœ‰topicå’Œpartitionsåˆ†åŒºï¼Œè¿™äº›ä¸­é—´ä»¶çš„å·®å¼‚æ€§å¯¼è‡´æˆ‘ä»¬åœ¨ä¸šåŠ¡éœ€æ±‚ä¸­æƒ³å¾€å¦å¤–ä¸€ç§æ¶ˆæ¯é˜Ÿåˆ—è¿›è¡Œè¿ç§»ï¼Œè¿™æ—¶ä¸€å †ä¸œè¥¿éœ€è¦é‡åšï¼Œå› ä¸ºå®ƒè·Ÿæˆ‘ä»¬çš„ç³»ç»Ÿè€¦åˆäº†ï¼Œè¿™æ—¶streamç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è§£è€¦æ–¹å¼ã€‚</p>
  </li>
  <li>
    <p>streamæ€æ ·ç»Ÿä¸€åº•å±‚å·®å¼‚</p>

    <p>åœ¨æ²¡æœ‰ç»‘å®šå™¨è¿™ä¸ªæ¦‚å¿µæ—¶ï¼Œæˆ‘ä»¬çš„bootåº”ç”¨ç›´æ¥ä¸æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œä¿¡æ¯äº¤äº’çš„æ—¶å€™ï¼Œç”±äºå„ä¸­é—´ä»¶æ„å»ºåˆè¡·ä¸åŒï¼Œå®ç°ç»†èŠ‚ä¸Šä¹Ÿæœ‰å·®å¼‚ã€‚é€šè¿‡å®šä¹‰ç»‘å®šå™¨ä½œä¸ºä¸­é—´å±‚ï¼Œå®Œç¾å®ç°äº†åº”ç”¨ç¨‹åºä¸ä¸­é—´ä»¶ç»†èŠ‚ä¹‹é—´çš„éš”ç¦»ã€‚é€šè¿‡å‘åº”ç”¨ç¨‹åºæš´éœ²ç»Ÿä¸€çš„channelé€šé“ï¼Œä½¿å¾—åº”ç”¨ç¨‹åºä¸ç”¨è€ƒè™‘å„ä¸­é—´ä»¶çš„å®ç°ã€‚</p>

    <p>INPUTå¯¹åº”æ¶ˆè´¹è€…</p>

    <p>OUTPUTå¯¹åº”ç”Ÿäº§è€…</p>
  </li>
  <li>
    <p>Streamä¸­çš„æ¶ˆæ¯é€šä¿¡æ–¹å¼éµå¾ªäº†å‘å¸ƒ-è®¢é˜…æ¨¡å¼</p>

    <p>Topicä¸»é¢˜è¿›è¡Œå¹¿æ’­</p>

    <p>åœ¨RabbitMQå°±æ˜¯Exchange</p>

    <p>åœ¨kafkaä¸­å°±æ˜¯Topic</p>
  </li>
  <li>
    <p>Spring Cloud Streamæ ‡å‡†æµç¨‹å¥—è·¯</p>

    <p>Binderï¼šå¾ˆæ–¹ä¾¿çš„è¿æ¥ä¸­é—´ä»¶ï¼Œå±è”½å·®å¼‚</p>

    <p>Channelï¼šé€šé“ï¼Œæ˜¯é˜Ÿåˆ—Queueçš„ä¸€ç§æŠ½è±¡ï¼Œåœ¨æ¶ˆæ¯é€šè®¯ç³»ç»Ÿä¸­å°±æ˜¯å®ç°å­˜å‚¨å’Œè½¬å‘çš„åª’ä»‹ï¼Œé€šè¿‡å¯¹Channelå¯¹é˜Ÿåˆ—è¿›è¡Œé…ç½®</p>

    <p>Sourceå’ŒSinkï¼šç®€å•çš„å¯ç†è§£ä¸ºå‚ç…§å¯¹è±¡æ˜¯Spring Cloud Streamè‡ªèº«ï¼Œä»Streamå‘å¸ƒæ¶ˆæ¯å°±æ˜¯è¾“å‡ºï¼Œæ¥å—æ¶ˆæ¯å°±æ˜¯è¾“å…¥</p>
  </li>
  <li>
    <p>ç¼–ç APIå’Œå¸¸ç”¨æ³¨è§£</p>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>ç»„æˆ</th>
      <th>è¯´æ˜</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Middleware</td>
      <td>ä¸­é—´ä»¶ï¼Œç›®å‰æ”¯æŒRabbitMQï¼ŒKafka</td>
    </tr>
    <tr>
      <td>Binder</td>
      <td>Binderæ˜¯åº”ç”¨äºä¸­é—´ä»¶ä¹‹é—´çš„å°è£…ï¼Œå¯ä»¥åŠ¨æ€æ”¹å˜æ¶ˆæ¯ç±»å‹,é€šè¿‡é…ç½®æ–‡ä»¶å®ç°</td>
    </tr>
    <tr>
      <td>@Input</td>
      <td>æ³¨è§£æ ‡è¯†è¾“å…¥é€šé“ï¼Œé€šè¿‡è¯¥è¾“å…¥é€šé“æ¥æ”¶åˆ°çš„æ¶ˆæ¯è¿›å…¥åº”ç”¨ç¨‹åº</td>
    </tr>
    <tr>
      <td>@Output</td>
      <td>æ³¨è§£æ ‡è¯†è¾“å‡ºé€šé“ï¼Œå‘å¸ƒçš„æ¶ˆæ¯é€šè¿‡è¯¥é€šé“ç¦»å¼€åº”ç”¨ç¨‹åº</td>
    </tr>
    <tr>
      <td>@StreamListener</td>
      <td>ç›‘å¬é˜Ÿåˆ—ï¼Œç”¨äºæ¶ˆè´¹è€…çš„æ¶ˆæ¯æ¥æ”¶</td>
    </tr>
    <tr>
      <td>@EnableBinding</td>
      <td>æŒ‡é€šé“channelå’Œexchangeç»‘å®šåœ¨ä¸€èµ·</td>
    </tr>
  </tbody>
</table>

<h4 id="121æ¶ˆæ¯é©±åŠ¨ç”Ÿäº§è€…8801">12.1æ¶ˆæ¯é©±åŠ¨ç”Ÿäº§è€…8801</h4>

<ul>
  <li>æ–°å»ºcloud-stream-rabbitmq-provider8801</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-stream-rabbitmq-provider8801<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>


        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-stream-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

     
        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>



    <span class="nt">&lt;/dependencies&gt;</span>

<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8801</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-stream-provider</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">stream</span><span class="pi">:</span>
      <span class="na">binders</span><span class="pi">:</span> <span class="c1"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span>
        <span class="na">defaultRabbit</span><span class="pi">:</span> <span class="c1"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">rabbit</span> <span class="c1"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span>
          <span class="na">environment</span><span class="pi">:</span> <span class="c1"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span>
            <span class="na">spring</span><span class="pi">:</span>
              <span class="na">rabbitmq</span><span class="pi">:</span>
                <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
                <span class="na">port</span><span class="pi">:</span> <span class="m">5672</span>
                <span class="na">username</span><span class="pi">:</span> <span class="s">guest</span>
                <span class="na">password</span><span class="pi">:</span> <span class="s">guest</span>
      <span class="na">bindings</span><span class="pi">:</span> <span class="c1"># æœåŠ¡çš„æ•´åˆå¤„ç†</span>
        <span class="na">output</span><span class="pi">:</span> <span class="c1"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span>
          <span class="na">destination</span><span class="pi">:</span> <span class="s">studyExchange</span> <span class="c1"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span>
          <span class="na">content-type</span><span class="pi">:</span> <span class="s">application/json</span> <span class="c1"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span>
          <span class="na">binder</span><span class="pi">:</span> <span class="s">defaultRabbit</span>  <span class="c1"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span> <span class="c1"># å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½®</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://localhost:7001/eureka</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">lease-renewal-interval-in-seconds</span><span class="pi">:</span> <span class="m">2</span> <span class="c1"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span>
    <span class="na">lease-expiration-duration-in-seconds</span><span class="pi">:</span> <span class="m">5</span> <span class="c1"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span>
    <span class="na">instance-id</span><span class="pi">:</span> <span class="s">send-8801.com</span>  <span class="c1"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span>
    <span class="na">prefer-ip-address</span><span class="pi">:</span> <span class="no">true</span>     <span class="c1"># è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamMQMain8801</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">StreamMQMain8801</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>å‘é€æ¶ˆæ¯æ¥å£</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">IMessageProvider</span>
<span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">send</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>å‘é€æ¶ˆæ¯æ¥å£å®ç°ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">Source</span><span class="o">.</span><span class="na">class</span><span class="o">)</span> <span class="c1">//å®šä¹‰æ¶ˆæ¯çš„æ¨é€ç®¡é“</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MessageProviderImpl</span> <span class="kd">implements</span> <span class="nc">IMessageProvider</span>
<span class="o">{</span>
    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">MessageChannel</span> <span class="n">output</span><span class="o">;</span> <span class="c1">// æ¶ˆæ¯å‘é€ç®¡é“</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">send</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="nc">String</span> <span class="n">serial</span> <span class="o">=</span> <span class="no">UUID</span><span class="o">.</span><span class="na">randomUUID</span><span class="o">().</span><span class="na">toString</span><span class="o">();</span>
        <span class="n">output</span><span class="o">.</span><span class="na">send</span><span class="o">(</span><span class="nc">MessageBuilder</span><span class="o">.</span><span class="na">withPayload</span><span class="o">(</span><span class="n">serial</span><span class="o">).</span><span class="na">build</span><span class="o">());</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"*****serial: "</span><span class="o">+</span><span class="n">serial</span><span class="o">);</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>controller</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SendMessageController</span>
<span class="o">{</span>
    <span class="nd">@Resource</span>
    <span class="kd">private</span> <span class="nc">IMessageProvider</span> <span class="n">messageProvider</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/sendMessage"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">sendMessage</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="k">return</span> <span class="n">messageProvider</span><span class="o">.</span><span class="na">send</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>
    <p>test</p>

    <p>å¯åŠ¨7001eureka</p>

    <p>å¯åŠ¨rabbitmq</p>

    <p><code class="language-plaintext highlighter-rouge">rabbitmq-plugins enable rabbitmq_management</code></p>

    <p>http://localhost:15672/</p>

    <p>å¯åŠ¨8801</p>

    <p>http://localhost:8801/sendMessage</p>
  </li>
</ul>

<h4 id="122æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…8802">12.2æ¶ˆæ¯é©±åŠ¨ä¹‹æ¶ˆè´¹è€…8802</h4>

<ul>
  <li>æ–°å»ºcloud-stream-rabbitmq-consumer8802</li>
  <li>pom</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;parent&gt;</span>
        <span class="nt">&lt;artifactId&gt;</span>cloud2020<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
        <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;/parent&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;artifactId&gt;</span>cloud-stream-rabbitmq-consumer8802<span class="nt">&lt;/artifactId&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>


        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-stream-rabbit<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.cloud/spring-cloud-starter-eureka-server --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>com.atguigu.springcloud<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>cloud-api-commons<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-actuator<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>


        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-devtools --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-devtools<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>runtime<span class="nt">&lt;/scope&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.projectlombok/lombok --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="c">&lt;!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-test --&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

    <span class="nt">&lt;/dependencies&gt;</span>


<span class="nt">&lt;/project&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8802</span>

<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-stream-consumer</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">stream</span><span class="pi">:</span>
      <span class="na">binders</span><span class="pi">:</span> <span class="c1"># åœ¨æ­¤å¤„é…ç½®è¦ç»‘å®šçš„rabbitmqçš„æœåŠ¡ä¿¡æ¯ï¼›</span>
        <span class="na">defaultRabbit</span><span class="pi">:</span> <span class="c1"># è¡¨ç¤ºå®šä¹‰çš„åç§°ï¼Œç”¨äºäºbindingæ•´åˆ</span>
          <span class="na">type</span><span class="pi">:</span> <span class="s">rabbit</span> <span class="c1"># æ¶ˆæ¯ç»„ä»¶ç±»å‹</span>
          <span class="na">environment</span><span class="pi">:</span> <span class="c1"># è®¾ç½®rabbitmqçš„ç›¸å…³çš„ç¯å¢ƒé…ç½®</span>
            <span class="na">spring</span><span class="pi">:</span>
              <span class="na">rabbitmq</span><span class="pi">:</span>
                <span class="na">host</span><span class="pi">:</span> <span class="s">localhost</span>
                <span class="na">port</span><span class="pi">:</span> <span class="m">5672</span>
                <span class="na">username</span><span class="pi">:</span> <span class="s">guest</span>
                <span class="na">password</span><span class="pi">:</span> <span class="s">guest</span>
      <span class="na">bindings</span><span class="pi">:</span> <span class="c1"># æœåŠ¡çš„æ•´åˆå¤„ç†</span>
        <span class="na">input</span><span class="pi">:</span> <span class="c1"># è¿™ä¸ªåå­—æ˜¯ä¸€ä¸ªé€šé“çš„åç§°</span>
          <span class="na">destination</span><span class="pi">:</span> <span class="s">studyExchange</span> <span class="c1"># è¡¨ç¤ºè¦ä½¿ç”¨çš„Exchangeåç§°å®šä¹‰</span>
          <span class="na">content-type</span><span class="pi">:</span> <span class="s">application/json</span> <span class="c1"># è®¾ç½®æ¶ˆæ¯ç±»å‹ï¼Œæœ¬æ¬¡ä¸ºjsonï¼Œæ–‡æœ¬åˆ™è®¾ç½®â€œtext/plainâ€</span>
          <span class="na">binder</span><span class="pi">:</span> <span class="s">defaultRabbit</span>  <span class="c1"># è®¾ç½®è¦ç»‘å®šçš„æ¶ˆæ¯æœåŠ¡çš„å…·ä½“è®¾ç½®</span>

<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span> <span class="c1"># å®¢æˆ·ç«¯è¿›è¡ŒEurekaæ³¨å†Œçš„é…ç½®</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://localhost:7001/eureka</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">lease-renewal-interval-in-seconds</span><span class="pi">:</span> <span class="m">2</span> <span class="c1"># è®¾ç½®å¿ƒè·³çš„æ—¶é—´é—´éš”ï¼ˆé»˜è®¤æ˜¯30ç§’ï¼‰</span>
    <span class="na">lease-expiration-duration-in-seconds</span><span class="pi">:</span> <span class="m">5</span> <span class="c1"># å¦‚æœç°åœ¨è¶…è¿‡äº†5ç§’çš„é—´éš”ï¼ˆé»˜è®¤æ˜¯90ç§’ï¼‰</span>
    <span class="na">instance-id</span><span class="pi">:</span> <span class="s">receive-8802.com</span>  <span class="c1"># åœ¨ä¿¡æ¯åˆ—è¡¨æ—¶æ˜¾ç¤ºä¸»æœºåç§°</span>
    <span class="na">prefer-ip-address</span><span class="pi">:</span> <span class="no">true</span>     <span class="c1"># è®¿é—®çš„è·¯å¾„å˜ä¸ºIPåœ°å€</span>
</code></pre></div></div>

<ul>
  <li>ä¸»å¯åŠ¨ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootApplication</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StreamMQMain8802</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">SpringApplication</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="nc">StreamMQMain8802</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span>
<span class="nd">@EnableBinding</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ReceiveMessageListenerController</span> <span class="o">{</span>
    <span class="nd">@Value</span><span class="o">(</span><span class="s">"${server.port}"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">serverPort</span><span class="o">;</span>

    <span class="nd">@StreamListener</span><span class="o">(</span><span class="nc">Sink</span><span class="o">.</span><span class="na">INPUT</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">input</span><span class="o">(</span><span class="nc">Message</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">message</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æ¶ˆè´¹è€…1å·ï¼Œæ¥å—ï¼š"</span><span class="o">+</span><span class="n">message</span><span class="o">.</span><span class="na">getPayload</span><span class="o">()+</span><span class="s">"\t port:"</span><span class="o">+</span><span class="n">serverPort</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>æµ‹è¯•8801å‘é€8802æ¥æ”¶æ¶ˆæ¯</p>

    <p>http://localhost:8801/sendMessage</p>
  </li>
</ul>

<h4 id="123åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–">12.3åˆ†ç»„æ¶ˆè´¹ä¸æŒä¹…åŒ–</h4>

<ul>
  <li>
    <p>ä¾ç…§8802ï¼Œcloneå‡ºæ¥ä¸€ä»½è¿è¡Œ8803</p>
  </li>
  <li>
    <p>è¿è¡Œåä¸¤ä¸ªé—®é¢˜</p>

    <p>æœ‰é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œ8802ï¼Œ8803éƒ½æ¶ˆè´¹äº†æ¶ˆæ¯</p>

    <p>æ¶ˆæ¯æŒä¹…åŒ–é—®é¢˜ï¼Œ8803æ²¡æœ‰åˆ†ç»„é‡å¯åæ²¡æœ‰æ¶ˆè´¹æ¶ˆæ¯</p>
  </li>
  <li>
    <p>å¾®æœåŠ¡åº”ç”¨æ”¾ç½®äºåŒä¸€ä¸ªgroupä¸­ï¼Œå°±èƒ½å¤Ÿä¿è¯æ¶ˆæ¯åªä¼šè¢«å…¶ä¸­ä¸€ä¸ªåº”ç”¨æ¶ˆè´¹ä¸€æ¬¡ã€‚ä¸åŒçš„ç»„æ˜¯å¯ä»¥æ¶ˆè´¹çš„ï¼ŒåŒä¸€ä¸ªç»„å†…ä¼šå‘ç”Ÿç«äº‰å…³ç³»ï¼Œåªæœ‰å…¶ä¸­ä¸€ä¸ªå¯ä»¥æ¶ˆè´¹ã€‚</p>
  </li>
  <li>
    <p>8802/8803å®ç°äº†è½®è¯¢åˆ†ç»„ï¼Œæ¯æ¬¡åªæœ‰ä¸€ä¸ªæ¶ˆè´¹è€… 8801æ¨¡å—çš„å‘çš„æ¶ˆæ¯åªèƒ½è¢«8802æˆ–8803å…¶ä¸­ä¸€ä¸ªæ¥æ”¶åˆ°ï¼Œè¿™æ ·é¿å…äº†é‡å¤æ¶ˆè´¹</p>
  </li>
  <li>
    <p>8802/8803éƒ½å˜æˆç›¸åŒç»„ï¼Œgroupä¸¤ä¸ªç›¸åŒï¼Œgroup: atguiguA</p>
  </li>
  <li>
    <p>8802ä¿®æ”¹YML,8803ä¿®æ”¹YML</p>
  </li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">group</span><span class="pi">:</span>  <span class="s">atguiguA</span>
</code></pre></div></div>

<ul>
  <li>
    <p>åŒä¸€ä¸ªç»„çš„å¤šä¸ªå¾®æœåŠ¡å®ä¾‹ï¼Œæ¯æ¬¡åªä¼šæœ‰ä¸€ä¸ªæ‹¿åˆ°</p>
  </li>
  <li>
    <p>é€šè¿‡ä¸Šè¿°ï¼Œè§£å†³äº†é‡å¤æ¶ˆè´¹é—®é¢˜ï¼Œå†çœ‹çœ‹æŒä¹…åŒ–</p>

    <p>åœæ­¢8802/8803å¹¶å»é™¤æ‰8802çš„åˆ†ç»„group:atguiguAï¼Œ8803çš„åˆ†ç»„group:atguiguAæ²¡æœ‰å»æ‰</p>

    <p>8801å…ˆå‘é€4æ¡ä¿¡æ¯åˆ°rabbitmq</p>

    <p>å…ˆå¯åŠ¨8802ï¼Œæ— åˆ†ç»„å±æ€§é…ç½®ï¼Œåå°æ²¡æœ‰æ‰“å‡ºæ¥æ¶ˆæ¯</p>

    <p>å…ˆå¯åŠ¨8803ï¼Œæœ‰åˆ†ç»„å±æ€§é…ç½®ï¼Œåå°æ‰“å‡ºæ¥äº†MQä¸Šçš„æ¶ˆæ¯</p>
  </li>
</ul>

<h3 id="13sleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª">13ï¼šSleuthåˆ†å¸ƒå¼è¯·æ±‚é“¾è·¯è¿½è¸ª</h3>

<ul>
  <li>
    <p>åœ¨å¾®æœåŠ¡æ¶æ„ä¸­ï¼Œä¸€ä¸ªç”±å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚åœ¨åç«¯ç³»ç»Ÿä¸­ä¼šç»è¿‡å¤šä¸ªä¸åŒçš„æœåŠ¡èŠ‚ç‚¹ï¼ŒååŒäº§ç”Ÿæœ€åçš„ç»“æœï¼Œæ¯ä¸€ä¸ªå‰ç«¯è¯·æ±‚éƒ½ä¼šå½¢æˆä¸€æ¡å¤æ‚çš„åˆ†å¸ƒå¼æœåŠ¡è°ƒç”¨é“¾è·¯ï¼Œé“¾è·¯çš„ä»»ä½•ä¸€ç¯å‡ºç°é«˜å»¶è¿Ÿæˆ–é”™è¯¯éƒ½ä¼šå¼•èµ·è¯·æ±‚çš„å¤±è´¥ã€‚</p>
  </li>
  <li>
    <p>Spring Cloud Sleuthæä¾›äº†ä¸€å¥—å®Œæ•´çš„æœåŠ¡è·Ÿè¸ªçš„è§£å†³æ–¹æ¡ˆï¼Œæ¥ç›‘æ§æ•´ä¸ªé“¾è·¯</p>
  </li>
  <li>
    <p>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æä¾›è¿½è¸ªè§£å†³æ–¹æ¡ˆå¹¶ä¸”å…¼å®¹æ”¯æŒäº†zipkin</p>
  </li>
  <li>
    <p>SpringCloudä»Fç‰ˆèµ·å·²ä¸éœ€è¦è‡ªå·±æ„å»ºZipkin serveräº†ï¼Œåªéœ€è¦è°ƒç”¨jaråŒ…å³å¯</p>

    <p>https://dl.bintray.com/openzipkin/maven/io/zipkin/java/zipkin-server/</p>

    <p>zipkin-server-2.12.9.exec.jar</p>

    <p>java -jar zipkin-server-2.12.9-exec.jar</p>

    <p>http://localhost:9411/zipkin/</p>
  </li>
  <li>
    <p>è¡¨ç¤ºä¸€æ¡è¯·æ±‚é“¾è·¯ï¼Œä¸€æ¡é“¾è·¯é€šè¿‡Trace Idå”¯ä¸€æ ‡è¯†ï¼ŒSpanæ ‡è¯†å‘èµ·çš„è¯·æ±‚ä¿¡æ¯ï¼Œå„spané€šè¿‡parent idå…³è”èµ·æ¥</p>

    <p>Trace:ç±»ä¼¼äºæ ‘ç»“æ„çš„Spané›†åˆï¼Œè¡¨ç¤ºä¸€æ¡è°ƒç”¨é“¾è·¯ï¼Œå­˜åœ¨å”¯ä¸€æ ‡è¯†</p>

    <p>span:è¡¨ç¤ºè°ƒç”¨é“¾è·¯æ¥æºï¼Œé€šä¿—çš„ç†è§£spanå°±æ˜¯ä¸€æ¬¡è¯·æ±‚ä¿¡æ¯</p>
  </li>
  <li>
    <p>cloud-provider-payment8001</p>
  </li>
  <li>
    <p>pom</p>
  </li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!--åŒ…å«äº†sleuth+zipkin--&gt;</span>
<span class="nt">&lt;dependency&gt;</span>
  <span class="nt">&lt;groupId&gt;</span>org.springframework.cloud<span class="nt">&lt;/groupId&gt;</span>
  <span class="nt">&lt;artifactId&gt;</span>spring-cloud-starter-zipkin<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">8001</span>


<span class="na">spring</span><span class="pi">:</span>
  <span class="na">application</span><span class="pi">:</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-payment-service</span>
    <span class="c1"># é“¾è·¯è¿½è¸ªbegin</span>
  <span class="na">zipkin</span><span class="pi">:</span>
    <span class="na">base-url</span><span class="pi">:</span> <span class="s">http://localhost:9411</span>
  <span class="na">sleuth</span><span class="pi">:</span>
    <span class="na">sampler</span><span class="pi">:</span>
     <span class="c1"># é‡‡æ ·ç‡å€¼ä»‹äº0åˆ°1ä¹‹é—´ï¼Œ1åˆ™ä»£è¡¨å…¨éƒ¨é‡‡é›†</span>
    <span class="na">probability</span><span class="pi">:</span> <span class="m">1</span>
    <span class="c1"># é“¾è·¯è¿½è¸ªend</span>
  <span class="na">datasource</span><span class="pi">:</span>
    <span class="na">type</span><span class="pi">:</span> <span class="s">com.alibaba.druid.pool.DruidDataSource</span>   <span class="c1"># å½“å‰æ•°æ®æºæ“ä½œç±»å‹</span>
    <span class="na">driver-class-name</span><span class="pi">:</span> <span class="s">org.gjt.mm.mysql.Driver</span>     <span class="c1"># MySQLé©±åŠ¨åŒ…</span>
    <span class="na">url</span><span class="pi">:</span> 
    <span class="na">username</span><span class="pi">:</span> <span class="s">root</span>
    <span class="na">password</span><span class="pi">:</span> 

<span class="na">mybatis</span><span class="pi">:</span>
  <span class="na">mapperLocations</span><span class="pi">:</span> <span class="s">classpath:mapper/*.xml</span>
  <span class="na">type-aliases-package</span><span class="pi">:</span> <span class="s">com.atguigu.springcloud.entities</span>


<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">fetchRegistry</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span>  <span class="c1">#é›†ç¾¤ç‰ˆ</span>
  <span class="na">instance</span><span class="pi">:</span>
    <span class="na">instance-id</span><span class="pi">:</span> <span class="s">payment8001</span>
    <span class="na">prefer-ip-address</span><span class="pi">:</span> <span class="no">true</span>
 
</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡ç±»PaymentController</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/payment/zipkin"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentZipkin</span><span class="o">()</span>
<span class="o">{</span>
  <span class="k">return</span> <span class="s">"hi ,i'am paymentzipkin server fall backï¼Œwelcome to atguiguï¼ŒO(âˆ©_âˆ©)Oå“ˆå“ˆ~"</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>cloud-consumer-order80</li>
  <li>pomåŒä¸Š</li>
  <li>yml</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">server</span><span class="pi">:</span>
  <span class="na">port</span><span class="pi">:</span> <span class="m">80</span>
 
<span class="na">spring</span><span class="pi">:</span>
    <span class="na">application</span><span class="pi">:</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">cloud-order-service</span>
    <span class="na">zipkin</span><span class="pi">:</span>
      <span class="na">base-url</span><span class="pi">:</span> <span class="s">http://localhost:9411</span>
    <span class="na">sleuth</span><span class="pi">:</span>
      <span class="na">sampler</span><span class="pi">:</span>
        <span class="na">probability</span><span class="pi">:</span> <span class="m">1</span>
 
<span class="na">eureka</span><span class="pi">:</span>
  <span class="na">client</span><span class="pi">:</span>
    <span class="c1">#è¡¨ç¤ºæ˜¯å¦å°†è‡ªå·±æ³¨å†Œè¿›EurekaServeré»˜è®¤ä¸ºtrueã€‚</span>
    <span class="na">register-with-eureka</span><span class="pi">:</span> <span class="no">false</span>
    <span class="c1">#æ˜¯å¦ä»EurekaServeræŠ“å–å·²æœ‰çš„æ³¨å†Œä¿¡æ¯ï¼Œé»˜è®¤ä¸ºtrueã€‚å•èŠ‚ç‚¹æ— æ‰€è°“ï¼Œé›†ç¾¤å¿…é¡»è®¾ç½®ä¸ºtrueæ‰èƒ½é…åˆribbonä½¿ç”¨è´Ÿè½½å‡è¡¡</span>
    <span class="na">fetchRegistry</span><span class="pi">:</span> <span class="no">true</span>
    <span class="na">service-url</span><span class="pi">:</span>
      <span class="c1">#å•æœº</span>
      <span class="c1">#defaultZone: http://localhost:7001/eureka</span>
      <span class="c1"># é›†ç¾¤</span>
      <span class="na">defaultZone</span><span class="pi">:</span> <span class="s">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</span>  <span class="c1"># é›†ç¾¤ç‰ˆ</span>

</code></pre></div></div>

<ul>
  <li>ä¸šåŠ¡ç±»OrderController</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="c1">// ====================&gt; zipkin+sleuth</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/consumer/payment/zipkin"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">paymentZipkin</span><span class="o">()</span>
    <span class="o">{</span>
        <span class="nc">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">restTemplate</span><span class="o">.</span><span class="na">getForObject</span><span class="o">(</span><span class="s">"http://localhost:8001"</span><span class="o">+</span><span class="s">"/payment/zipkin/"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>
    <p>test</p>

    <p>ä¾æ¬¡å¯åŠ¨eureka7001/8001/80</p>

    <p>80è°ƒç”¨8001å‡ æ¬¡æµ‹è¯•ä¸‹</p>

    <p>æ‰“å¼€æµè§ˆå™¨è®¿é—®:http:localhost:9411</p>
  </li>
</ul>
:ET