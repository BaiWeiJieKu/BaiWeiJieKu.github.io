I",ü<ul id="markdown-toc">
  <li><a href="#ç®€ä»‹" id="markdown-toc-ç®€ä»‹">ç®€ä»‹</a>    <ul>
      <li><a href="#job" id="markdown-toc-job">Job</a></li>
      <li><a href="#jobdetail" id="markdown-toc-jobdetail">JobDetail</a></li>
      <li><a href="#jobexecutioncontext" id="markdown-toc-jobexecutioncontext">JobExecutionContext</a></li>
      <li><a href="#jobdatamap" id="markdown-toc-jobdatamap">JobDataMap</a></li>
      <li><a href="#trigger" id="markdown-toc-trigger">Trigger</a></li>
      <li><a href="#scheduler" id="markdown-toc-scheduler">Scheduler</a></li>
      <li><a href="#é…ç½®æ–‡ä»¶" id="markdown-toc-é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</a></li>
    </ul>
  </li>
  <li><a href="#å®šæ—¶ä»»åŠ¡å¹¶å‘" id="markdown-toc-å®šæ—¶ä»»åŠ¡å¹¶å‘">å®šæ—¶ä»»åŠ¡å¹¶å‘</a>    <ul>
      <li><a href="#é”™è¿‡æœºåˆ¶" id="markdown-toc-é”™è¿‡æœºåˆ¶">é”™è¿‡æœºåˆ¶</a></li>
    </ul>
  </li>
  <li><a href="#æ•´åˆweb" id="markdown-toc-æ•´åˆweb">æ•´åˆWEB</a></li>
  <li><a href="#æ•´åˆspring" id="markdown-toc-æ•´åˆspring">æ•´åˆspring</a></li>
  <li><a href="#æ•´åˆspringboot" id="markdown-toc-æ•´åˆspringboot">æ•´åˆspringboot</a></li>
  <li><a href="#triggerlistenerè¯¦è§£" id="markdown-toc-triggerlistenerè¯¦è§£">TriggerListenerè¯¦è§£</a>    <ul>
      <li><a href="#api" id="markdown-toc-api">API</a></li>
      <li><a href="#spring" id="markdown-toc-spring">spring</a></li>
    </ul>
  </li>
  <li><a href="#joblistenerè¯¦è§£" id="markdown-toc-joblistenerè¯¦è§£">JobListenerè¯¦è§£</a>    <ul>
      <li><a href="#api-1" id="markdown-toc-api-1">API</a></li>
      <li><a href="#spring-1" id="markdown-toc-spring-1">spring</a></li>
    </ul>
  </li>
  <li><a href="#schedulerlistenerè¯¦è§£" id="markdown-toc-schedulerlistenerè¯¦è§£">SchedulerListenerè¯¦è§£</a>    <ul>
      <li><a href="#api-2" id="markdown-toc-api-2">API</a></li>
      <li><a href="#spring-2" id="markdown-toc-spring-2">spring</a></li>
    </ul>
  </li>
  <li><a href="#quartzé›†ç¾¤" id="markdown-toc-quartzé›†ç¾¤">quartzé›†ç¾¤</a></li>
</ul>
<h3 id="ç®€ä»‹">ç®€ä»‹</h3>

<h4 id="job">Job</h4>

<ul>
  <li>Jobï¼šå®ç°ä¸šåŠ¡é€»è¾‘çš„ä»»åŠ¡æ¥å£ã€‚jobæ¥å£å¾ˆå®¹æ˜“å®ç°ï¼Œåªæœ‰ä¸€ä¸ªexecuteæ–¹æ³•ï¼Œç±»ä¼¼TimerTaskçš„runæ–¹æ³•ï¼Œåœ¨é‡Œé¢ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</li>
  <li>Jobå®ä¾‹åœ¨quartzä¸­çš„ç”Ÿå‘½å‘¨æœŸï¼šæ¯æ¬¡è°ƒåº¦å™¨æ‰§è¡Œjobæ—¶ï¼Œå®ƒåœ¨è°ƒç”¨executeæ–¹æ³•å‰ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„jobå®ä¾‹ã€‚å½“è°ƒç”¨å®Œæˆåï¼Œå…³è”çš„jobå¯¹è±¡å®ä¾‹ä¼šè¢«é‡Šæ”¾ï¼Œé‡Šæ”¾çš„å®ä¾‹ä¼šè¢«åƒåœ¾å›æ”¶æœºåˆ¶å›æ”¶ã€‚</li>
</ul>

<h4 id="jobdetail">JobDetail</h4>

<ul>
  <li>JobDetailä¸ºJobå®ä¾‹æä¾›äº†è®¸å¤šè®¾ç½®å±æ€§ï¼Œä»¥åŠJobDataMapæˆå‘˜å˜é‡å±æ€§ï¼Œå®ƒç”¨æ¥å­˜å‚¨ç‰¹å®šJobå®ä¾‹çš„çŠ¶æ€ä¿¡æ¯ï¼Œè°ƒåº¦å™¨éœ€è¦å€ŸåŠ©JobDetailå¯¹è±¡æ¥æ·»åŠ Jobå®ä¾‹ã€‚
    <ul>
      <li>nameï¼šåç§°</li>
      <li>groupï¼šæ‰€åœ¨ç»„</li>
      <li>jobClassï¼šä»»åŠ¡ç±»</li>
      <li>jobDataMapï¼š</li>
    </ul>
  </li>
</ul>

<h4 id="jobexecutioncontext">JobExecutionContext</h4>

<ul>
  <li>å½“Schedulerè°ƒç”¨ä¸€ä¸ªjobï¼Œå°±ä¼šå°†JobExecutionContextä¼ é€’ç»™jobçš„executeæ–¹æ³•</li>
  <li>jobèƒ½é€šè¿‡JobExecutionContextå¯¹è±¡è®¿é—®åˆ°quartzè¿è¡Œæ—¶å€™çš„ç¯å¢ƒä»¥åŠjobæœ¬èº«çš„æ˜ç»†æ•°æ®</li>
</ul>

<h4 id="jobdatamap">JobDataMap</h4>

<ul>
  <li>
    <p>å±äºJobDetailçš„ä¸€éƒ¨åˆ†ï¼Œå¯ä»¥åœ¨æ„å»ºJobDetailæ—¶ä¼ é€’å‚æ•°</p>
  </li>
  <li>åœ¨è¿›è¡Œjobä»»åŠ¡è°ƒåº¦æ—¶JobDataMapå­˜å‚¨åœ¨executeæ–¹æ³•çš„å…¥å‚JobExecutionContextä¸­ï¼Œéå¸¸æ–¹ä¾¿è·å–ã€‚</li>
  <li>JobDataMapå¯ä»¥ç”¨æ¥è£…è½½ä»»ä½•å¯åºåˆ—åŒ–çš„å¯¹è±¡ï¼Œå½“jobå®ä¾‹å¯¹è±¡è¢«æ‰§è¡Œæ—¶è¿™äº›å‚æ•°å¯¹è±¡ä¼šä¼ é€’ç»™å®ƒ</li>
  <li>JobDataMapå®ç°äº†JDKä¸­çš„Mapæ¥å£ï¼Œå¹¶ä¸”æ·»åŠ äº†ä¸€äº›éå¸¸æ–¹ä¾¿çš„æ–¹æ³•æ¥å­˜å–åŸºæœ¬æ•°æ®ç±»å‹ã€‚</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJob</span> <span class="kd">implements</span> <span class="nc">Job</span> <span class="o">{</span>

    <span class="nd">@Setter@Getter</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">msg</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JobExecutionException</span> <span class="o">{</span>
        <span class="nc">LocalTime</span> <span class="n">localTime</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">localTime</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"ï¼Œmsg="</span><span class="o">+</span><span class="n">msg</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuartzDemo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SchedulerException</span> <span class="o">{</span>
        <span class="nc">Scheduler</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="nc">StdSchedulerFactory</span><span class="o">.</span><span class="na">getDefaultScheduler</span><span class="o">();</span>
        
        <span class="n">scheduler</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

        <span class="nc">JobDetail</span> <span class="n">jobDetail</span> <span class="o">=</span> <span class="nc">JobBuilder</span><span class="o">.</span><span class="na">newJob</span><span class="o">(</span><span class="nc">MyJob</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">"jobDetail1"</span><span class="o">,</span><span class="s">"group1"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">usingJobData</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span><span class="s">"value"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
        <span class="nc">Trigger</span> <span class="n">trigger</span> <span class="o">=</span> <span class="nc">TriggerBuilder</span><span class="o">.</span><span class="na">newTrigger</span><span class="o">()</span>
                <span class="o">.</span><span class="na">startNow</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withSchedule</span><span class="o">(</span>
                        <span class="nc">SimpleScheduleBuilder</span><span class="o">.</span><span class="na">simpleSchedule</span><span class="o">()</span>
            		<span class="o">.</span><span class="na">withIntervallnSeconds</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
            			<span class="o">.</span><span class="na">repeatForever</span><span class="o">()</span>
                <span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        
        <span class="n">scheduler</span><span class="o">.</span><span class="na">scheduleJob</span><span class="o">(</span><span class="n">jobDetail</span><span class="o">,</span><span class="n">trigger</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">600000</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="n">scheduler</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>å¯ä»¥ä½¿ç”¨@PersistJobDataAfterExecutionæ³¨è§£æ›´æ–°JobDataMap</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@PersistJobDataAfterExecution</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJob</span> <span class="kd">implements</span> <span class="nc">Job</span> <span class="o">{</span>

    <span class="nd">@Setter@Getter</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">count</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JobExecutionException</span> <span class="o">{</span>
        <span class="nc">LocalTime</span> <span class="n">localTime</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="n">count</span><span class="o">++;</span>
        <span class="n">context</span><span class="o">.</span><span class="na">getJobDetail</span><span class="o">().</span><span class="na">getJobDataMap</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"count"</span><span class="o">+</span><span class="n">count</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">localTime</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"ï¼Œcount="</span><span class="o">+</span><span class="n">count</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">JobDetail</span> <span class="n">jobDetail</span> <span class="o">=</span> <span class="nc">JobBuilder</span><span class="o">.</span><span class="na">newJob</span><span class="o">(</span><span class="nc">MyJob</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">"jobDetail1"</span><span class="o">,</span><span class="s">"group1"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">usingJobData</span><span class="o">(</span><span class="s">"count"</span><span class="o">,</span><span class="k">new</span> <span class="nc">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">10</span><span class="o">))</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre></div></div>

<h4 id="trigger">Trigger</h4>

<ul>
  <li>
    <p>quartzä¸­çš„è§¦å‘å™¨ç”¨æ¥å‘Šè¯‰è°ƒåº¦ç¨‹åºä½œä¸šä»€ä¹ˆæ—¶å€™è§¦å‘ã€‚å³Triggerå¯¹è±¡æ˜¯ç”¨æ¥è§¦å‘æ‰§è¡Œjobçš„</p>
  </li>
  <li>
    <p>ä¸‰ä¸ªå±æ€§ï¼š</p>

    <ul>
      <li>JobKeyï¼šè¡¨ç¤ºjobå®ä¾‹çš„æ ‡è¯†ï¼Œè§¦å‘å™¨è¢«è§¦å‘æ—¶ï¼Œè¯¥æŒ‡å®šçš„jobå®ä¾‹ä¼šæ‰§è¡Œã€‚</li>
      <li>StartTimeï¼šè¡¨ç¤ºè§¦å‘å™¨çš„æ—¶é—´è¡¨é¦–æ¬¡è¢«è§¦å‘çš„æ—¶é—´ã€‚ç±»å‹æ˜¯java.util.Date</li>
      <li>EndTimeï¼šæŒ‡å®šè§¦å‘å™¨çš„ä¸å†è¢«è§¦å‘çš„æ—¶é—´ï¼Œç±»å‹æ˜¯java.util.Date</li>
      <li>ä¼˜å…ˆçº§ï¼šå½“åŒä¸€æ—¶é—´æœ‰å¤šä¸ªTriggeråŒæ—¶è§¦å‘æ—¶éœ€è¦åˆ¤æ–­ä¼˜å…ˆçº§ï¼Œä¼˜å…ˆçº§åˆ«è¶Šé«˜è¶Šå…ˆæ‰§è¡Œ</li>
    </ul>
  </li>
  <li>
    <p>SimpleTriggerï¼šåœ¨ä¸€ä¸ªæŒ‡å®šæ—¶é—´æ®µå†…æ‰§è¡Œä¸€æ¬¡ä½œä¸šä»»åŠ¡ï¼Œæˆ–æ˜¯åœ¨æŒ‡å®šçš„æ—¶é—´é—´éš”å†…å¤šæ¬¡æ‰§è¡Œä½œä¸šä»»åŠ¡</p>

    <ul>
      <li>é‡å¤æ¬¡æ•°å¯ä»¥ä¸º0ï¼Œæ­£æ•´æ•°æˆ–SimpleTrigger.REPEAT_INDEFINITELYå¸¸é‡å€¼ã€‚</li>
      <li>é‡å¤æ‰§è¡Œé—´éš”å¿…é¡»ä¸º0æˆ–é•¿æ•´æ•°</li>
      <li>ä¸€æ—¦è¢«æŒ‡å®šäº†endTimeå‚æ•°ï¼Œé‚£ä¹ˆå®ƒä¼šé‡å¤æ¬¡æ•°å‚æ•°çš„æ•ˆæœ</li>
    </ul>
  </li>
  <li>
    <p>CronTriggerï¼šåŸºäºæ—¥å†çš„ä½œä¸šè°ƒåº¦å™¨ï¼Œè€Œä¸æ˜¯åƒSimpleTriggeré‚£æ ·ç²¾ç¡®æŒ‡å®šæ—¶é—´é—´éš”ï¼Œæ¯”SimpleTriggeræ›´å¸¸ç”¨ã€‚</p>

    <ul>
      <li>
        <p>Cronè¡¨è¾¾å¼ï¼šç”¨äºé…ç½®CronTriggerå®ä¾‹ï¼Œæ˜¯ç”±ä¸ƒä¸ªå­è¡¨è¾¾å¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œæè¿°äº†æ—¶é—´è¡¨çš„è¯¦ç»†ä¿¡æ¯ã€‚æ ¼å¼ä¸ºï¼šã€ç§’ã€‘ã€åˆ†ã€‘ã€å°æ—¶ã€‘ã€æ—¥ã€‘ã€æœˆã€‘ã€å‘¨ã€‘ã€å¹´ã€‘</p>
      </li>
      <li>
        <table>
          <thead>
            <tr>
              <th style="text-align: center">å­—æ®µ</th>
              <th style="text-align: center">æ˜¯å¦å¿…å¡«</th>
              <th style="text-align: center">å…è®¸å€¼</th>
              <th style="text-align: center">å…è®¸çš„å­—ç¬¦</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="text-align: center">ç§’</td>
              <td style="text-align: center">æ˜¯</td>
              <td style="text-align: center">0~59</td>
              <td style="text-align: center">ï¼Œ- * /</td>
            </tr>
            <tr>
              <td style="text-align: center">åˆ†</td>
              <td style="text-align: center">æ˜¯</td>
              <td style="text-align: center">0~59</td>
              <td style="text-align: center">ï¼Œ- * /</td>
            </tr>
            <tr>
              <td style="text-align: center">å°æ—¶</td>
              <td style="text-align: center">æ˜¯</td>
              <td style="text-align: center">0~23</td>
              <td style="text-align: center">ï¼Œ- * /</td>
            </tr>
            <tr>
              <td style="text-align: center">æ—¥</td>
              <td style="text-align: center">æ˜¯</td>
              <td style="text-align: center">0~31</td>
              <td style="text-align: center">ï¼Œ- * ? / L W C</td>
            </tr>
            <tr>
              <td style="text-align: center">æœˆ</td>
              <td style="text-align: center">æ˜¯</td>
              <td style="text-align: center">0~12æˆ–JAN-DEC</td>
              <td style="text-align: center">ï¼Œ- * /</td>
            </tr>
            <tr>
              <td style="text-align: center">å‘¨</td>
              <td style="text-align: center">æ˜¯</td>
              <td style="text-align: center">1~7æˆ–SUN-SAT</td>
              <td style="text-align: center">ï¼Œ- * ? / L # C</td>
            </tr>
            <tr>
              <td style="text-align: center">å¹´</td>
              <td style="text-align: center">å¦</td>
              <td style="text-align: center">emptyï¼Œ1970~2099</td>
              <td style="text-align: center">ï¼Œ- * /</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <table>
          <thead>
            <tr>
              <th>è¡¨è¾¾å¼</th>
              <th>å«ä¹‰</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>0 15 10 ï¼Ÿ * *</td>
              <td>æ¯å¤©10ç‚¹15åˆ†è§¦å‘</td>
            </tr>
            <tr>
              <td>0 0/15 14 * * ?</td>
              <td>æ¯å¤©ä¸‹åˆçš„2ç‚¹åˆ°2ç‚¹59åˆ†ï¼ˆæ•´ç‚¹å¼€å§‹ï¼Œæ¯éš”5åˆ†è§¦å‘ï¼‰</td>
            </tr>
            <tr>
              <td>0 15 10 ï¼Ÿ * MON-FRI</td>
              <td>ä»å‘¨ä¸€åˆ°å‘¨äº”æ¯å¤©ä¸Šåˆçš„10ç‚¹15åˆ†è§¦å‘</td>
            </tr>
            <tr>
              <td>0 15 10 ï¼Ÿ * 6#3</td>
              <td>æ¯æœˆçš„ç¬¬ä¸‰å‘¨çš„æ˜ŸæœŸäº”å¼€å§‹è§¦å‘</td>
            </tr>
            <tr>
              <td>0 15 10 ï¼Ÿ * 6L 2016~2017</td>
              <td>ä»2016~2017å¹´æ¯æœˆæœ€åä¸€å‘¨çš„æ˜ŸæœŸäº”çš„10ç‚¹15åˆ†è§¦å‘</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p><img src="https://raw.githubusercontent.com/BaiWeiJieKu/BaiWeiJieKu.github.io/master/images/quartz/cron.png" alt="" /></p>
      </li>
      <li>å¯å€ŸåŠ©åœ¨çº¿ç”Ÿæˆå™¨è¿›è¡Œè§„åˆ™ç”Ÿæˆ</li>
    </ul>
  </li>
</ul>

<h4 id="scheduler">Scheduler</h4>

<ul>
  <li>è°ƒåº¦å™¨ï¼Œæ‰€æœ‰çš„Schedulerå®ä¾‹åº”è¯¥ç”±SchedulerFactoryæ¥åˆ›å»º</li>
  <li>ä¸»è¦å‡½æ•°ï¼š
    <ul>
      <li>Date scheduleJob(JobDetail jobDetail,Trigger trigger);ç»‘å®šä»»åŠ¡å’Œè§¦å‘å™¨</li>
      <li>void start();å¼€å¯è°ƒåº¦å™¨</li>
      <li>void standby();æš‚åœä»»åŠ¡ï¼ŒæŒ‚èµ·ï¼Œå†æ¬¡startå¯ç»§ç»­æ‰§è¡Œä»»åŠ¡</li>
      <li>void shutdown(true/false);ç»ˆæ­¢ä»»åŠ¡ï¼Œå‚æ•°ä¸ºtrueæ—¶ç­‰å¾…ä»»åŠ¡å…¨éƒ¨æ‰§è¡Œå®Œæ¯•åå…³é—­ï¼Œå‚æ•°ä¸ºfalseç›´æ¥å…³é—­ã€‚</li>
    </ul>
  </li>
  <li>StdSchedulerFactory:
    <ul>
      <li>ä½¿ç”¨ä¸€ç»„å‚æ•°ï¼ˆjava.util.Propertiesï¼‰æ¥åˆ›å»ºå’Œåˆå§‹åŒ–Quartzè°ƒåº¦å™¨ã€‚</li>
      <li>é…ç½®å‚æ•°ä¸€èˆ¬å­˜å‚¨åœ¨quartz.propertiesä¸­</li>
      <li>è°ƒç”¨getScheduleræ–¹æ³•å°±èƒ½åˆ›å»ºå’Œåˆå§‹åŒ–è°ƒåº¦å™¨å¯¹è±¡ã€‚</li>
    </ul>
  </li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">SchedulerFactory</span> <span class="n">sfact</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StdSchedulerFactory</span><span class="o">();</span>
<span class="nc">Scheduler</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">sfact</span><span class="o">.</span><span class="na">getScheduler</span><span class="o">();</span>

<span class="nc">DirectSchedulerFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="nc">DirectSchedulerFactory</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
<span class="nc">Scheduler</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="na">getScheduler</span><span class="o">();</span>
</code></pre></div></div>

<h4 id="é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</h4>

<ul>
  <li>quartz.propertiesæ–‡ä»¶ç»„æˆéƒ¨åˆ†ï¼š
    <ul>
      <li>è°ƒåº¦å™¨å±æ€§ï¼š
        <ul>
          <li>org.quartz.scheduler.instanceNameå±æ€§ç”¨æ¥åŒºåˆ†ç‰¹å®šçš„è°ƒåº¦å™¨å®ä¾‹ï¼Œå¯ä»¥æŒ‰ç…§åŠŸèƒ½ç”¨é€”æ¥ç»™è°ƒåº¦å™¨èµ·å</li>
          <li>org.quartz.scheduler.instanceIdå±æ€§å’Œå‰è€…ä¸€æ ·ï¼Œä¹Ÿå…è®¸ä»»ä½•å­—ç¬¦ä¸²ï¼Œä½†è¿™ä¸ªå€¼å¿…é¡»æ˜¯åœ¨æ‰€æœ‰è°ƒåº¦å™¨å®ä¾‹ä¸­æ˜¯å”¯ä¸€çš„ï¼Œå°¤å…¶æ˜¯åœ¨ä¸€ä¸ªé›†ç¾¤ä¸­ï¼Œä½œä¸ºé›†ç¾¤çš„å”¯ä¸€keyã€‚å‡å¦‚æƒ³è®©quartzè‡ªåŠ¨ç”Ÿæˆè¿™ä¸ªå€¼å¾—è¯ï¼Œå¯ä»¥è®¾ç½®ä¸ºAUTO</li>
        </ul>
      </li>
      <li>ä½œä¸šå­˜å‚¨è®¾ç½®:æè¿°äº†åœ¨è°ƒåº¦å™¨å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒJobå’ŒTriggerä¿¡æ¯æ˜¯å¦‚ä½•è¢«å­˜å‚¨çš„ã€‚</li>
      <li>çº¿ç¨‹æ± å±æ€§ï¼š
        <ul>
          <li>threadCount</li>
          <li>threadPriority</li>
          <li>org.quartz.threadPool.class</li>
        </ul>
      </li>
      <li>æ’ä»¶é…ç½®ï¼šæ»¡è¶³ç‰¹å®šéœ€æ±‚ç”¨åˆ°çš„quartzæ’ä»¶é…ç½®</li>
    </ul>
  </li>
</ul>

<h3 id="å®šæ—¶ä»»åŠ¡å¹¶å‘">å®šæ—¶ä»»åŠ¡å¹¶å‘</h3>

<ul>
  <li>æ¯”å¦‚ä¸€ä¸ªä»»åŠ¡éœ€è¦æ‰§è¡Œ7sï¼Œä½†æ˜¯ä»»åŠ¡æ¯5sæ‰§è¡Œä¸€æ¬¡</li>
  <li>ä½¿ç”¨@DisallowConcurrentExecutioné˜²æ­¢å¹¶å‘</li>
  <li>æŠŠæ³¨è§£åŠ åœ¨jobç±»ä¸Š</li>
</ul>

<h4 id="é”™è¿‡æœºåˆ¶">é”™è¿‡æœºåˆ¶</h4>

<ul>
  <li>Misfireæœºåˆ¶ï¼š</li>
</ul>

<h3 id="æ•´åˆweb">æ•´åˆWEB</h3>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
		<span class="c">&lt;!-- https://mvnrepository.com/artifact/org.quartz-scheduler/quartz --&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.quartz-scheduler<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>quartz<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.2.3<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
	<span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<ul>
  <li>quartz.properties</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Default Properties file for use by StdSchedulerFactory
# to create a Quartz Scheduler Instance, if a different
# properties file is not explicitly specified.
#
# ===========================================================================
# Configure Main Scheduler Properties è°ƒåº¦å™¨å±æ€§
# ===========================================================================
</span><span class="py">org.quartz.scheduler.instanceName</span><span class="p">:</span> <span class="s">DefaultQuartzScheduler</span>
<span class="py">org.quartz.scheduler.instanceid</span><span class="p">:</span><span class="s">AUTO</span>
<span class="py">org.quartz.scheduler.rmi.export</span><span class="p">:</span> <span class="s">false</span>
<span class="py">org.quartz.scheduler.rmi.proxy</span><span class="p">:</span> <span class="s">false</span>
<span class="py">org.quartz.scheduler.wrapJobExecutionInUserTransaction</span><span class="p">:</span> <span class="s">false</span>
<span class="c"># ===========================================================================  
# Configure ThreadPool çº¿ç¨‹æ± å±æ€§  
# ===========================================================================
#çº¿ç¨‹æ± çš„å®ç°ç±»ï¼ˆä¸€èˆ¬ä½¿ç”¨SimpleThreadPoolå³å¯æ»¡è¶³å‡ ä¹æ‰€æœ‰ç”¨æˆ·çš„éœ€æ±‚ï¼‰
</span><span class="py">org.quartz.threadPool.class</span><span class="p">:</span> <span class="s">org.quartz.simpl.SimpleThreadPool</span>
<span class="c">#æŒ‡å®šçº¿ç¨‹æ•°ï¼Œè‡³å°‘ä¸º1ï¼ˆæ— é»˜è®¤å€¼ï¼‰(ä¸€èˆ¬è®¾ç½®ä¸º1-100ç›´æ¥çš„æ•´æ•°åˆé€‚)
</span><span class="py">org.quartz.threadPool.threadCount</span><span class="p">:</span> <span class="s">10</span>
<span class="c">#è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§ï¼ˆæœ€å¤§ä¸ºjava.lang.Thread.MAX_PRIORITY 10ï¼Œæœ€å°ä¸ºThread.MIN_PRIORITY 1ï¼Œé»˜è®¤ä¸º5ï¼‰
</span><span class="py">org.quartz.threadPool.threadPriority</span><span class="p">:</span> <span class="s">5</span>
<span class="c">#è®¾ç½®SimpleThreadPoolçš„ä¸€äº›å±æ€§
#è®¾ç½®æ˜¯å¦ä¸ºå®ˆæŠ¤çº¿ç¨‹
#org.quartz.threadpool.makethreadsdaemons = false
#org.quartz.threadPool.threadsInheritContextClassLoaderOfInitializingThread: true
#org.quartz.threadpool.threadsinheritgroupofinitializingthread=false
#çº¿ç¨‹å‰ç¼€é»˜è®¤å€¼æ˜¯ï¼š[Scheduler Name]_Worker
#org.quartz.threadpool.threadnameprefix=swhJobThead;
# é…ç½®å…¨å±€ç›‘å¬(TriggerListener,JobListener) åˆ™åº”ç”¨ç¨‹åºå¯ä»¥æ¥æ”¶å’Œæ‰§è¡Œ é¢„å®šçš„äº‹ä»¶é€šçŸ¥
# ===========================================================================
# Configuring a Global TriggerListener é…ç½®å…¨å±€çš„Triggerç›‘å¬å™¨
# MyTriggerListenerClass ç±»å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå’Œ å±æ€§çš„setæ–¹æ³•ï¼Œç›®å‰2.2.xåªæ”¯æŒåŸå§‹æ•°æ®ç±»å‹çš„å€¼ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²ï¼‰
# ===========================================================================
#org.quartz.triggerListener.NAME.class = com.swh.MyTriggerListenerClass
#org.quartz.triggerListener.NAME.propName = propValue
#org.quartz.triggerListener.NAME.prop2Name = prop2Value
# ===========================================================================
# Configuring a Global JobListener é…ç½®å…¨å±€çš„Jobç›‘å¬å™¨
# MyJobListenerClass ç±»å¿…é¡»æœ‰ä¸€ä¸ªæ— å‚æ•°çš„æ„é€ å‡½æ•°ï¼Œå’Œ å±æ€§çš„setæ–¹æ³•ï¼Œç›®å‰2.2.xåªæ”¯æŒåŸå§‹æ•°æ®ç±»å‹çš„å€¼ï¼ˆåŒ…æ‹¬å­—ç¬¦ä¸²ï¼‰
# ===========================================================================
#org.quartz.jobListener.NAME.class = com.swh.MyJobListenerClass
#org.quartz.jobListener.NAME.propName = propValue
#org.quartz.jobListener.NAME.prop2Name = prop2Value
# ===========================================================================  
# Configure JobStore å­˜å‚¨è°ƒåº¦ä¿¡æ¯ï¼ˆå·¥ä½œï¼Œè§¦å‘å™¨å’Œæ—¥å†ç­‰ï¼‰
# ===========================================================================
# ä¿¡æ¯ä¿å­˜æ—¶é—´ é»˜è®¤å€¼60ç§’
</span><span class="py">org.quartz.jobStore.misfireThreshold</span><span class="p">:</span> <span class="s">60000</span>
<span class="c">#ä¿å­˜jobå’ŒTriggerçš„çŠ¶æ€ä¿¡æ¯åˆ°å†…å­˜ä¸­çš„ç±»
</span><span class="py">org.quartz.jobStore.class</span><span class="p">:</span> <span class="s">org.quartz.simpl.RAMJobStore</span>
<span class="c"># ===========================================================================  
# Configure SchedulerPlugins æ’ä»¶å±æ€§ é…ç½®
# ===========================================================================
# è‡ªå®šä¹‰æ’ä»¶  
#org.quartz.plugin.NAME.class = com.swh.MyPluginClass
#org.quartz.plugin.NAME.propName = propValue
#org.quartz.plugin.NAME.prop2Name = prop2Value
#é…ç½®triggeræ‰§è¡Œå†å²æ—¥å¿—ï¼ˆå¯ä»¥çœ‹åˆ°ç±»çš„æ–‡æ¡£å’Œå‚æ•°åˆ—è¡¨ï¼‰
</span><span class="py">org.quartz.plugin.triggHistory.class</span> <span class="p">=</span> <span class="s">org.quartz.plugins.history.LoggingTriggerHistoryPlugin  </span>
<span class="py">org.quartz.plugin.triggHistory.triggerFiredMessage</span> <span class="p">=</span> <span class="s">Trigger {1}.{0} fired job {6}.{5} at: {4, date, HH:mm:ss MM/dd/yyyy}  </span>
<span class="py">org.quartz.plugin.triggHistory.triggerCompleteMessage</span> <span class="p">=</span> <span class="s">Trigger {1}.{0} completed firing job {6}.{5} at {4, date, HH:mm:ss MM/dd/yyyy} with resulting trigger instruction code: {9}  </span>
<span class="c">#é…ç½®jobè°ƒåº¦æ’ä»¶  quartz_jobs(jobs and triggerså†…å®¹)çš„XMLæ–‡æ¡£  
#åŠ è½½ Job å’Œ Trigger ä¿¡æ¯çš„ç±»   ï¼ˆ1.8ä¹‹å‰ç”¨ï¼šorg.quartz.plugins.xml.JobInitializationPluginï¼‰
</span><span class="py">org.quartz.plugin.jobInitializer.class</span> <span class="p">=</span> <span class="s">org.quartz.plugins.xml.XMLSchedulingDataProcessorPlugin</span>
<span class="c">#æŒ‡å®šå­˜æ”¾è°ƒåº¦å™¨(Job å’Œ Trigger)ä¿¡æ¯çš„xmlæ–‡ä»¶ï¼Œé»˜è®¤æ˜¯classpathä¸‹quartz_jobs.xml
</span><span class="py">org.quartz.plugin.jobInitializer.fileNames</span> <span class="p">=</span> <span class="s">my_quartz_job2.xml  </span>
<span class="c">#org.quartz.plugin.jobInitializer.overWriteExistingJobs = false  
</span><span class="py">org.quartz.plugin.jobInitializer.failOnFileNotFound</span> <span class="p">=</span> <span class="s">true  </span>
<span class="c">#è‡ªåŠ¨æ‰«æä»»åŠ¡å•å¹¶å‘ç°æ”¹åŠ¨çš„æ—¶é—´é—´éš”,å•ä½ä¸ºç§’
</span><span class="py">org.quartz.plugin.jobInitializer.scanInterval</span> <span class="p">=</span> <span class="s">10</span>
<span class="c">#è¦†ç›–ä»»åŠ¡è°ƒåº¦å™¨ä¸­åŒåçš„jobDetail,é¿å…åªä¿®æ”¹äº†CronExpressionæ‰€é€ æˆçš„ä¸èƒ½é‡æ–°ç”Ÿæ•ˆæƒ…å†µ
</span><span class="py">org.quartz.plugin.jobInitializer.wrapInUserTransaction</span> <span class="p">=</span> <span class="s">false</span>
<span class="c"># ===========================================================================  
# Sample configuration of ShutdownHookPlugin  ShutdownHookPluginæ’ä»¶çš„é…ç½®æ ·ä¾‹
# ===========================================================================
#org.quartz.plugin.shutdownhook.class = \org.quartz.plugins.management.ShutdownHookPlugin
#org.quartz.plugin.shutdownhook.cleanShutdown = true
#
# Configure RMI Settings è¿œç¨‹æœåŠ¡è°ƒç”¨é…ç½®
#
#å¦‚æœä½ æƒ³quartz-schedulerå‡ºå£æœ¬èº«é€šè¿‡RMIä½œä¸ºæœåŠ¡å™¨ï¼Œç„¶åè®¾ç½®â€œå‡ºå£â€æ ‡å¿—true(é»˜è®¤å€¼ä¸ºfalse)ã€‚
#org.quartz.scheduler.rmi.export = false
#ä¸»æœºä¸Šrmiæ³¨å†Œè¡¨(é»˜è®¤å€¼localhost)
#org.quartz.scheduler.rmi.registryhost = localhost
#æ³¨å†Œç›‘å¬ç«¯å£å·ï¼ˆé»˜è®¤å€¼1099ï¼‰
#org.quartz.scheduler.rmi.registryport = 1099
#åˆ›å»ºrmiæ³¨å†Œï¼Œfalse/neverï¼šå¦‚æœä½ å·²ç»æœ‰ä¸€ä¸ªåœ¨è¿è¡Œæˆ–ä¸æƒ³è¿›è¡Œåˆ›å»ºæ³¨å†Œ
# true/as_needed:ç¬¬ä¸€æ¬¡å°è¯•ä½¿ç”¨ç°æœ‰çš„æ³¨å†Œï¼Œç„¶åå†å›æ¥è¿›è¡Œåˆ›å»º
# always:å…ˆè¿›è¡Œåˆ›å»ºä¸€ä¸ªæ³¨å†Œï¼Œç„¶åå†ä½¿ç”¨å›æ¥ä½¿ç”¨æ³¨å†Œ
#org.quartz.scheduler.rmi.createregistry = never
#Quartz ScheduleræœåŠ¡ç«¯ç«¯å£ï¼Œé»˜è®¤æ˜¯éšæœºåˆ†é…RMIæ³¨å†Œè¡¨
#org.quartz.scheduler.rmi.serverport = 1098
#true:é“¾æ¥è¿œç¨‹æœåŠ¡è°ƒåº¦(å®¢æˆ·ç«¯),è¿™ä¸ªä¹Ÿè¦æŒ‡å®šregistryhostå’Œregistryportï¼Œé»˜è®¤ä¸ºfalse
# å¦‚æœexportå’ŒproxyåŒæ—¶æŒ‡å®šä¸ºtrueï¼Œåˆ™exportçš„è®¾ç½®å°†è¢«å¿½ç•¥
#org.quartz.scheduler.rmi.proxy = false
</span></code></pre></div></div>

<ul>
  <li>Job</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloJob</span> <span class="kd">implements</span> <span class="nc">Job</span> <span class="o">{</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">execute</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">JobExecutionException</span> <span class="o">{</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">5000L</span><span class="o">);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// TODO Auto-generated catch block</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
		<span class="c1">// æ‰“å°å½“å‰çš„æ‰§è¡Œæ—¶é—´ï¼Œæ ¼å¼ä¸º2017-01-01 00:00:00</span>
		<span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">SimpleDateFormat</span> <span class="n">sf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Current Exec Time Is : "</span> <span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">));</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World"</span><span class="o">);</span>
	<span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>Scheduler</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloScheduler</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">SchedulerException</span><span class="o">,</span> <span class="nc">InterruptedException</span> <span class="o">{</span>
		<span class="c1">// æ‰“å°å½“å‰çš„æ—¶é—´ï¼Œæ ¼å¼ä¸º2017-01-01 00:00:00</span>
		<span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">SimpleDateFormat</span> <span class="n">sf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Current Time Is : "</span> <span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">));</span>
		<span class="c1">// åˆ›å»ºä¸€ä¸ªJobDetailå®ä¾‹ï¼Œå°†è¯¥å®ä¾‹ä¸HelloJob Classç»‘å®š</span>
		<span class="nc">JobDetail</span> <span class="n">jobDetail</span> <span class="o">=</span> <span class="nc">JobBuilder</span><span class="o">.</span><span class="na">newJob</span><span class="o">(</span><span class="nc">HelloJob</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
				<span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">"myJob"</span><span class="o">).</span><span class="na">build</span><span class="o">();</span>
		<span class="nc">CronTrigger</span> <span class="n">trigger</span> <span class="o">=</span> <span class="o">(</span><span class="nc">CronTrigger</span><span class="o">)</span> <span class="nc">TriggerBuilder</span>
				<span class="o">.</span><span class="na">newTrigger</span><span class="o">()</span>
				<span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">"myTrigger"</span><span class="o">,</span> <span class="s">"group1"</span><span class="o">)</span>
				<span class="o">.</span><span class="na">withSchedule</span><span class="o">(</span>
						<span class="nc">CronScheduleBuilder</span><span class="o">.</span><span class="na">cronSchedule</span><span class="o">(</span><span class="s">"* * * * * ?"</span><span class="o">))</span>
				<span class="o">.</span><span class="na">build</span><span class="o">();</span>
		<span class="c1">// åˆ›å»ºSchedulerå®ä¾‹</span>
		<span class="nc">SchedulerFactory</span> <span class="n">sfact</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StdSchedulerFactory</span><span class="o">();</span>
		<span class="nc">Scheduler</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="n">sfact</span><span class="o">.</span><span class="na">getScheduler</span><span class="o">();</span>
		<span class="n">scheduler</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"scheduled time is :"</span>
				<span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">scheduler</span><span class="o">.</span><span class="na">scheduleJob</span><span class="o">(</span><span class="n">jobDetail</span><span class="o">,</span> <span class="n">trigger</span><span class="o">)));</span>
		<span class="c1">//scheduleræ‰§è¡Œä¸¤ç§’åæŒ‚èµ·</span>
		<span class="nc">Thread</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">2000L</span><span class="o">);</span>		
		<span class="c1">//shutdown(true)è¡¨ç¤ºç­‰å¾…æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„jobæ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œå†å…³é—­scheduler</span>
		<span class="c1">//shutdown(false)å³shutdown()è¡¨ç¤ºç›´æ¥å…³é—­scheduler</span>
		<span class="n">scheduler</span><span class="o">.</span><span class="na">shutdown</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"scheduler is shut down? "</span> <span class="o">+</span> <span class="n">scheduler</span><span class="o">.</span><span class="na">isShutdown</span><span class="o">());</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="æ•´åˆspring">æ•´åˆspring</h3>

<ul>
  <li>æ•´åˆspringæœ‰ä¸¤ç§æ–¹å¼ï¼šMethodInvokingJobDetailFactoryBeanï¼ŒJobDetailFactoryBean</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>junit<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>junit<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>3.8.1<span class="nt">&lt;/version&gt;</span>
			<span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-webmvc<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-context<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-aop<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-core<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-context-support<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.springframework<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>spring-tx<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>${spring.version}<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>

		<span class="nt">&lt;dependency&gt;</span>
			<span class="nt">&lt;groupId&gt;</span>org.quartz-scheduler<span class="nt">&lt;/groupId&gt;</span>
			<span class="nt">&lt;artifactId&gt;</span>quartz<span class="nt">&lt;/artifactId&gt;</span>
			<span class="nt">&lt;version&gt;</span>2.2.3<span class="nt">&lt;/version&gt;</span>
		<span class="nt">&lt;/dependency&gt;</span>
</code></pre></div></div>

<ul>
  <li>web.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;web-app</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
	<span class="na">xmlns=</span><span class="s">"http://java.sun.com/xml/ns/javaee"</span> <span class="na">xmlns:web=</span><span class="s">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"</span>
	<span class="na">version=</span><span class="s">"3.0"</span><span class="nt">&gt;</span>
	<span class="nt">&lt;display-name&gt;</span>Archetype Created Web Application<span class="nt">&lt;/display-name&gt;</span>
	<span class="c">&lt;!-- spring MVCçš„æ ¸å¿ƒå°±æ˜¯DispatcherServletï¼Œä½¿ç”¨springMVCçš„ç¬¬ä¸€æ­¥å°±æ˜¯å°†ä¸‹é¢çš„servletæ”¾å…¥web.xml 
		servlet-nameå±æ€§éå¸¸é‡è¦ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDispatchServletä¼šåŠ è½½è¿™ä¸ªåå­—-servlet.xmlçš„æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼Œå°±ä¼šåŠ è½½ dispather-servlet.xmlï¼Œä¹Ÿæ˜¯åœ¨WEN-INFç›®å½•ä¸‹ã€‚ --&gt;</span>
	<span class="nt">&lt;servlet&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="nt">&lt;/servlet-class&gt;</span>
		<span class="nt">&lt;load-on-startup&gt;</span>1<span class="nt">&lt;/load-on-startup&gt;</span>
	<span class="nt">&lt;/servlet&gt;</span>
	<span class="c">&lt;!-- è®¾ç½®dispatchservletçš„åŒ¹é…æ¨¡å¼ï¼Œé€šè¿‡æŠŠdispatchservletæ˜ å°„åˆ°/ï¼Œé»˜è®¤servletä¼šå¤„ç†æ‰€æœ‰çš„è¯·æ±‚ï¼ŒåŒ…æ‹¬é™æ€èµ„æº --&gt;</span>
	<span class="nt">&lt;servlet-mapping&gt;</span>
		<span class="nt">&lt;servlet-name&gt;</span>dispatcher<span class="nt">&lt;/servlet-name&gt;</span>
		<span class="nt">&lt;url-pattern&gt;</span>/<span class="nt">&lt;/url-pattern&gt;</span>
	<span class="nt">&lt;/servlet-mapping&gt;</span>
	<span class="nt">&lt;welcome-file-list&gt;</span>
		<span class="nt">&lt;welcome-file&gt;</span>index.jsp<span class="nt">&lt;/welcome-file&gt;</span>
	<span class="nt">&lt;/welcome-file-list&gt;</span>

<span class="nt">&lt;/web-app&gt;</span>  
</code></pre></div></div>

<ul>
  <li>dispatcher-servlet.xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">"http://www.springframework.org/schema/beans"</span>
	<span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:context=</span><span class="s">"http://www.springframework.org/schema/context"</span>
	<span class="na">xmlns:mvc=</span><span class="s">"http://www.springframework.org/schema/mvc"</span> <span class="na">xmlns:p=</span><span class="s">"http://www.springframework.org/schema/p"</span>
	<span class="na">xsi:schemaLocation=</span><span class="s">"http://www.springframework.org/schema/beans  
            http://www.springframework.org/schema/beans/spring-beans.xsd  
            http://www.springframework.org/schema/mvc  
            http://www.springframework.org/schema/mvc/spring-mvc.xsd  
            http://www.springframework.org/schema/context  
            http://www.springframework.org/schema/context/spring-context.xsd"</span>
	<span class="na">default-lazy-init=</span><span class="s">"true"</span><span class="nt">&gt;</span>

	<span class="c">&lt;!-- é€šè¿‡mvc:resourcesè®¾ç½®é™æ€èµ„æºï¼Œè¿™æ ·servletå°±ä¼šå¤„ç†è¿™äº›é™æ€èµ„æºï¼Œè€Œä¸é€šè¿‡æ§åˆ¶å™¨ --&gt;</span>
	<span class="c">&lt;!-- è®¾ç½®ä¸è¿‡æ»¤å†…å®¹ï¼Œæ¯”å¦‚:css,jquery,img ç­‰èµ„æºæ–‡ä»¶ --&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/*.html"</span> <span class="na">mapping=</span><span class="s">"/**.html"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/css/*"</span> <span class="na">mapping=</span><span class="s">"/css/**"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/js/*"</span> <span class="na">mapping=</span><span class="s">"/js/**"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;mvc:resources</span> <span class="na">location=</span><span class="s">"/images/*"</span> <span class="na">mapping=</span><span class="s">"/images/**"</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!-- è®¾å®šæ¶ˆæ¯è½¬æ¢çš„ç¼–ç ä¸ºutf-8é˜²æ­¢controllerè¿”å›ä¸­æ–‡ä¹±ç  --&gt;</span>
	<span class="nt">&lt;bean</span>
		<span class="na">class=</span><span class="s">"org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"messageConverters"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;list&gt;</span>
				<span class="nt">&lt;bean</span>
					<span class="na">class=</span><span class="s">"org.springframework.http.converter.StringHttpMessageConverter"</span><span class="nt">&gt;</span>
					<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"supportedMediaTypes"</span><span class="nt">&gt;</span>
						<span class="nt">&lt;list&gt;</span>
							<span class="nt">&lt;value&gt;</span>text/html;charset=UTF-8<span class="nt">&lt;/value&gt;</span>
						<span class="nt">&lt;/list&gt;</span>
					<span class="nt">&lt;/property&gt;</span>
				<span class="nt">&lt;/bean&gt;</span>
			<span class="nt">&lt;/list&gt;</span>
		<span class="nt">&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!-- æ·»åŠ æ³¨è§£é©±åŠ¨ --&gt;</span>
	<span class="nt">&lt;mvc:annotation-driven</span> <span class="nt">/&gt;</span>
	<span class="c">&lt;!-- é»˜è®¤æ‰«æçš„åŒ…è·¯å¾„ --&gt;</span>
	<span class="nt">&lt;context:component-scan</span> <span class="na">base-package=</span><span class="s">"com.imooc.springquartz"</span> <span class="nt">/&gt;</span>

	<span class="c">&lt;!-- mvc:view-controllerå¯ä»¥åœ¨ä¸éœ€è¦Controllerå¤„ç†requestçš„æƒ…å†µï¼Œè½¬å‘åˆ°è®¾ç½®çš„View --&gt;</span>
	<span class="c">&lt;!-- åƒä¸‹é¢è¿™æ ·è®¾ç½®ï¼Œå¦‚æœè¯·æ±‚ä¸º/ï¼Œåˆ™ä¸é€šè¿‡controllerï¼Œè€Œç›´æ¥è§£æä¸º/index.jsp --&gt;</span>
	<span class="nt">&lt;mvc:view-controller</span> <span class="na">path=</span><span class="s">"/"</span> <span class="na">view-name=</span><span class="s">"index"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"viewClass"</span>
			<span class="na">value=</span><span class="s">"org.springframework.web.servlet.view.JstlView"</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="c">&lt;!-- é…ç½®jspè·¯å¾„å‰ç¼€ --&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"prefix"</span> <span class="na">value=</span><span class="s">"/"</span><span class="nt">&gt;&lt;/property&gt;</span>
		<span class="c">&lt;!-- é…ç½®URlåç¼€ --&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"suffix"</span> <span class="na">value=</span><span class="s">".jsp"</span><span class="nt">&gt;&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
    
	<span class="c">&lt;!-- ç¬¬ä¸€ç§ä½œä¸š --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"simpleJobDetail"</span>
		<span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"targetObject"</span> <span class="na">ref=</span><span class="s">"myBean"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"targetMethod"</span> <span class="na">value=</span><span class="s">"printMessage"</span> <span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!-- ç¬¬äºŒç§ä½œä¸š --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"firstComplexJobDetail"</span>
		<span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.JobDetailFactoryBean"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jobClass"</span>
			<span class="na">value=</span><span class="s">"com.imooc.springquartz.quartz.FirstScheduledJob"</span> <span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jobDataMap"</span><span class="nt">&gt;</span>
			<span class="nt">&lt;map&gt;</span>
				<span class="nt">&lt;entry</span> <span class="na">key=</span><span class="s">"anotherBean"</span> <span class="na">value-ref=</span><span class="s">"anotherBean"</span> <span class="nt">/&gt;</span>
			<span class="nt">&lt;/map&gt;</span>
		<span class="nt">&lt;/property&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"Durability"</span> <span class="na">value=</span><span class="s">"true"</span><span class="nt">/&gt;</span>				
	<span class="nt">&lt;/bean&gt;</span>
    
	<span class="c">&lt;!-- ç®€å•è§¦å‘å™¨ï¼Œè·ç¦»å½“å‰æ—¶é—´1ç§’ä¹‹åæ‰§è¡Œï¼Œä¹‹åæ¯éš”ä¸¤ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mySimpleTrigger"</span> <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.SimpleTriggerFactoryBean"</span><span class="nt">&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jobDetail"</span>  <span class="na">ref=</span><span class="s">"simpleJobDetail"</span><span class="nt">/&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"startDelay"</span>  <span class="na">value=</span><span class="s">"1000"</span><span class="nt">/&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"repeatInterval"</span>  <span class="na">value=</span><span class="s">"2000"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
	<span class="c">&lt;!-- cronè§¦å‘å™¨ï¼Œæ¯éš”5ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"myCronTrigger"</span> <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.CronTriggerFactoryBean"</span><span class="nt">&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jobDetail"</span>  <span class="na">ref=</span><span class="s">"firstComplexJobDetail"</span><span class="nt">/&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"cronExpression"</span>  <span class="na">value=</span><span class="s">"0/5 * * ? * *"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	
    <span class="c">&lt;!-- ç»‘å®šä½œä¸šä»»åŠ¡å’Œè§¦å‘å™¨ --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span><span class="nt">&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"jobDetails"</span><span class="nt">&gt;</span>
	        <span class="nt">&lt;list&gt;</span>
	            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"simpleJobDetail"</span><span class="nt">/&gt;</span>
	            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"firstComplexJobDetail"</span><span class="nt">/&gt;</span>
	        <span class="nt">&lt;/list&gt;</span>
	    <span class="nt">&lt;/property&gt;</span>
	    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"triggers"</span><span class="nt">&gt;</span>
	        <span class="nt">&lt;list&gt;</span>
	            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"mySimpleTrigger"</span><span class="nt">/&gt;</span>
	            <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"myCronTrigger"</span><span class="nt">/&gt;</span>
	        <span class="nt">&lt;/list&gt;</span>
	    <span class="nt">&lt;/property&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
<span class="nt">&lt;/beans&gt;</span>  
</code></pre></div></div>

<ul>
  <li>AnotherBean</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span><span class="o">(</span><span class="s">"anotherBean"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AnotherBean</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">printAnotherMessage</span><span class="o">()</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"AnotherMessage"</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>FirstScheduledJob</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FirstScheduledJob</span> <span class="kd">extends</span> <span class="nc">QuartzJobBean</span><span class="o">{</span>
     <span class="kd">private</span> <span class="nc">AnotherBean</span> <span class="n">anotherBean</span><span class="o">;</span>
     
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAnotherBean</span><span class="o">(</span><span class="nc">AnotherBean</span> <span class="n">anotherBean</span><span class="o">){</span>
    	 <span class="k">this</span><span class="o">.</span><span class="na">anotherBean</span> <span class="o">=</span> <span class="n">anotherBean</span><span class="o">;</span>
     <span class="o">}</span>

	<span class="nd">@Override</span>
	<span class="kd">protected</span> <span class="kt">void</span> <span class="nf">executeInternal</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">arg0</span><span class="o">)</span>
			<span class="kd">throws</span> <span class="nc">JobExecutionException</span> <span class="o">{</span>
		<span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">SimpleDateFormat</span> <span class="n">sf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"FirstScheduledJob Executes!"</span> <span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">));</span>
		<span class="k">this</span><span class="o">.</span><span class="na">anotherBean</span><span class="o">.</span><span class="na">printAnotherMessage</span><span class="o">();</span>		
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>MyBean</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Component</span><span class="o">(</span><span class="s">"myBean"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyBean</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">printMessage</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// æ‰“å°å½“å‰çš„æ‰§è¡Œæ—¶é—´ï¼Œæ ¼å¼ä¸º2017-01-01 00:00:00</span>
		<span class="nc">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Date</span><span class="o">();</span>
		<span class="nc">SimpleDateFormat</span> <span class="n">sf</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SimpleDateFormat</span><span class="o">(</span><span class="s">"yyyy-MM-dd HH:mm:ss"</span><span class="o">);</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"MyBean Executes!"</span> <span class="o">+</span> <span class="n">sf</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="n">date</span><span class="o">));</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="æ•´åˆspringboot">æ•´åˆspringboot</h3>

<ul>
  <li>maven</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-quartz<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>mysql<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mysql-connector-java<span class="nt">&lt;/artifactId&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>2.0.1<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.projectlombok<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>lombok<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;optional&gt;</span>true<span class="nt">&lt;/optional&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.springframework.boot<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>spring-boot-starter-test<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;scope&gt;</span>test<span class="nt">&lt;/scope&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div></div>

<ul>
  <li>é…ç½®æ–‡ä»¶</li>
</ul>

<div class="language-properties highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="py">spring.quartz.scheduler-name</span><span class="p">=</span><span class="s">mySpringbootQuartz</span>
<span class="py">spring.quartz.job-store-type</span><span class="p">=</span><span class="s">jdbc</span>
<span class="py">spring.quartz.overwrite-existing-jobs</span><span class="p">=</span><span class="s">true</span>
<span class="py">spring.quartz.jdbc.initialize-schema</span><span class="p">=</span><span class="s">never</span>
<span class="py">spring.quartz.jdbc.comment-prefix</span><span class="p">=</span><span class="c">#
</span><span class="s">spring.quartz.wait-for-jobs-to-complete-on-shutdown=true</span>

<span class="py">spring.datasource.url</span><span class="p">=</span><span class="s">jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false</span>
<span class="py">spring.datasource.username</span><span class="p">=</span><span class="s">root</span>
<span class="py">spring.datasource.password</span><span class="p">=</span><span class="s">123456</span>
<span class="py">logging.pattern.dateformat</span><span class="p">=</span><span class="s">HH:mm:ss</span>

<span class="py">mybatis.mapper-locations</span><span class="p">=</span><span class="s">mybatis/*.xml</span>
</code></pre></div></div>

<ul>
  <li>ä½œä¸š</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Slf4j</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJob</span> <span class="kd">extends</span> <span class="nc">QuartzJobBean</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">protected</span> <span class="kt">void</span> <span class="nf">executeInternal</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">jobExecutionContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JobExecutionException</span> <span class="o">{</span>
        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"æˆ‘æ­£åœ¨æ‰§è¡Œï¼"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>quartzé…ç½®ç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">QuartzConfig</span> <span class="o">{</span>

    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">JobDetail</span> <span class="nf">myJobDetail</span><span class="o">(){</span>
        <span class="nc">JobDetail</span> <span class="n">detail</span> <span class="o">=</span> <span class="nc">JobBuilder</span><span class="o">.</span><span class="na">newJob</span><span class="o">(</span><span class="nc">MyJob</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
                <span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">"myjob"</span><span class="o">,</span><span class="s">"group1"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">storeDurably</span><span class="o">()</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">detail</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">Trigger</span> <span class="nf">myTrigger1</span><span class="o">(){</span>

        <span class="nc">Trigger</span> <span class="n">trigger</span> <span class="o">=</span> <span class="nc">TriggerBuilder</span><span class="o">.</span><span class="na">newTrigger</span><span class="o">()</span>
                <span class="o">.</span><span class="na">startNow</span><span class="o">()</span>
                <span class="o">.</span><span class="na">withIdentity</span><span class="o">(</span><span class="s">"myjobTrigger1"</span><span class="o">,</span><span class="s">"group1"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">forJob</span><span class="o">(</span><span class="n">myJobDetail</span><span class="o">())</span>
                <span class="o">.</span><span class="na">withSchedule</span><span class="o">(</span><span class="nc">CronScheduleBuilder</span><span class="o">.</span><span class="na">cronSchedule</span><span class="o">(</span><span class="s">"0/15 * * * * ?"</span><span class="o">)</span>
                <span class="o">).</span><span class="na">build</span><span class="o">();</span>

        <span class="k">return</span> <span class="n">trigger</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<h3 id="triggerlistenerè¯¦è§£">TriggerListenerè¯¦è§£</h3>

<ul>
  <li>ç›‘å¬ä¸ç›‘å¬å™¨ï¼ˆtriggerï¼‰æœ‰å…³çš„äº‹ä»¶</li>
  <li>è§¦å‘å™¨å¼€å§‹ï¼štriggerFired</li>
  <li>è§¦å‘å™¨ç»“æŸï¼štriggerComplete</li>
  <li>è§¦å‘å™¨å¦å†³ï¼švetoJobExecution</li>
</ul>

<h4 id="api">API</h4>

<ul>
  <li>triggerç›‘å¬å™¨ï¼Œå®é™…æ¡ˆä¾‹ï¼šèŠ‚å‡æ—¥ä¸æ‰§è¡Œä»»åŠ¡</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTriggerListener</span> <span class="kd">extends</span> <span class="nc">TriggerListenerSupport</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"myTriggerListener"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">vetoJobExecution</span><span class="o">(</span><span class="nc">Trigger</span> <span class="n">trigger</span><span class="o">,</span> <span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"vetoJobExecutionæ­£åœ¨æ‰§è¡Œï¼ï¼"</span><span class="o">);</span>
        <span class="c1">//å¦‚æœæ—¶é—´æ˜¯5ï¼Œ15ï¼Œ25ï¼Œå°¾æ•°æ˜¯5çš„æ—¶é—´ç‚¹ï¼Œå°±ä¸æ‰§è¡Œ</span>
        <span class="nc">Calendar</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">Calendar</span><span class="o">.</span><span class="na">getInstance</span><span class="o">();</span>
        <span class="kt">int</span> <span class="n">second</span> <span class="o">=</span> <span class="n">now</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="nc">Calendar</span><span class="o">.</span><span class="na">SECOND</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">second</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span><span class="mi">5</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"æœ¬æ¬¡Triggerä¸è§¦å‘ï¼ï¼"</span><span class="o">);</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>ä¸»ç¨‹åºç±»</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scheduler</span><span class="o">.</span><span class="na">getListenerManager</span><span class="o">().</span><span class="na">addTriggerListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyTriggerListener</span><span class="o">());</span>
</code></pre></div></div>

<h4 id="spring">spring</h4>

<ul>
  <li>trigger</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyListener</span> <span class="kd">extends</span> <span class="nc">TriggerListenerSupport</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"myTriggerListener"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">triggerFired</span><span class="o">(</span><span class="nc">Trigger</span> <span class="n">trigger</span><span class="o">,</span> <span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">triggerFired</span><span class="o">(</span><span class="n">trigger</span><span class="o">,</span> <span class="n">context</span><span class="o">);</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"Trigger is fired!!"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"myTriggerListener"</span> <span class="na">class=</span><span class="s">"com.example.job.listener.MyListener"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"schedule"</span> <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span> <span class="na">destroy-method=</span><span class="s">"destroy"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"datasource"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"triggers"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"trigger1"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"trigger2"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"globalTriggerListeners"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"myTriggerListener"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div>

<h3 id="joblistenerè¯¦è§£">JobListenerè¯¦è§£</h3>

<ul>
  <li>ç›‘å¬jobç›¸å…³äº‹ä»¶</li>
  <li>ä¸»è¦äº‹ä»¶ï¼šjobå³å°†æ‰§è¡Œï¼Œjobå®Œæˆæ‰§è¡Œ</li>
</ul>

<h4 id="api-1">API</h4>

<ul>
  <li>å®é™…æ¡ˆä¾‹ï¼šè®°å½•ä½œä¸šçš„æ‰§è¡Œæ—¶é—´</li>
  <li>å¼•å…¥dbcp2å’Œmysqlçš„pom</li>
  <li>ç¼–å†™ç›‘å¬å™¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJobListener</span> <span class="kd">extends</span> <span class="nc">JobListenerSupport</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"myJobListener"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">jobToBeExecuted</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">jobToBeExecuted</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"jobToBeExecuted"</span><span class="o">);</span>
        <span class="nc">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123456"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="k">new</span> <span class="nc">Driver</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_job_log (job_name,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">context</span><span class="o">.</span><span class="na">getJobDetail</span><span class="o">().</span><span class="na">getKey</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">jobWasExecuted</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">,</span> <span class="nc">JobExecutionException</span> <span class="n">jobException</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">jobWasExecuted</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">jobException</span><span class="o">);</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"jobWasExecuted"</span><span class="o">);</span>
        <span class="nc">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123456"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="k">new</span> <span class="nc">Driver</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_job_log (job_name,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">context</span><span class="o">.</span><span class="na">getJobDetail</span><span class="o">().</span><span class="na">getKey</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æ³¨å†Œç›‘å¬å™¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">scheduler</span><span class="o">.</span><span class="na">getListenerManager</span><span class="o">().</span><span class="na">addJobListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyJobListener</span><span class="o">());</span>
</code></pre></div></div>

<h4 id="spring-1">spring</h4>

<ul>
  <li>ç¼–å†™ç›‘å¬å™¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJobListener</span> <span class="kd">extends</span> <span class="nc">JobListenerSupport</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">"myJobListener"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">DataSource</span> <span class="nf">getDataSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDataSource</span><span class="o">(</span><span class="nc">DataSource</span> <span class="n">dataSource</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">dataSource</span> <span class="o">=</span> <span class="n">dataSource</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">jobToBeExecuted</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">jobToBeExecuted</span><span class="o">(</span><span class="n">context</span><span class="o">);</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"jobToBeExecuted"</span><span class="o">);</span>
        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_job_log (job_name,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">context</span><span class="o">.</span><span class="na">getJobDetail</span><span class="o">().</span><span class="na">getKey</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">jobWasExecuted</span><span class="o">(</span><span class="nc">JobExecutionContext</span> <span class="n">context</span><span class="o">,</span> <span class="nc">JobExecutionException</span> <span class="n">jobException</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">jobWasExecuted</span><span class="o">(</span><span class="n">context</span><span class="o">,</span> <span class="n">jobException</span><span class="o">);</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">"jobWasExecuted"</span><span class="o">);</span>
        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_job_log (job_name,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">context</span><span class="o">.</span><span class="na">getJobDetail</span><span class="o">().</span><span class="na">getKey</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"datasource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp2.BasicDataSource"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"123456"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;amp;useSSL=false"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"myJobListener"</span> <span class="na">class=</span><span class="s">"com.example.job.listener.MyJobListener"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"datasource"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"schedule"</span> <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span> <span class="na">destroy-method=</span><span class="s">"destroy"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"datasource"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"triggers"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"trigger1"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"trigger2"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"globalJobListeners"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"myJobListener"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div>

<h3 id="schedulerlistenerè¯¦è§£">SchedulerListenerè¯¦è§£</h3>

<h4 id="api-2">API</h4>

<ul>
  <li>è®°å½•å®šæ—¶ä»»åŠ¡çš„å¯åœ</li>
  <li>ç¼–å†™ç›‘å¬å™¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySchedulerListener</span> <span class="kd">extends</span> <span class="nc">SchedulerListenerSupport</span> <span class="o">{</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">schedulerStarting</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">schedulerStarting</span><span class="o">();</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">",schedulerStarting!!"</span><span class="o">);</span>
        <span class="nc">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123456"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="k">new</span> <span class="nc">Driver</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_scheduler_log (ip,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">().</span><span class="na">getHostAddress</span><span class="o">();</span>

            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">ip</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">schedulerShuttingdown</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">schedulerShuttingdown</span><span class="o">();</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">",schedulerShuttingdown!!"</span><span class="o">);</span>
        <span class="nc">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123456"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="k">new</span> <span class="nc">Driver</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_scheduler_log (ip,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">().</span><span class="na">getHostAddress</span><span class="o">();</span>

            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">ip</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>æ³¨å†Œç›‘å¬å™¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Scheduler</span> <span class="n">scheduler</span> <span class="o">=</span> <span class="nc">StdSchedulerFactory</span><span class="o">.</span><span class="na">getDefaultScheduler</span><span class="o">();</span>
<span class="n">scheduler</span><span class="o">.</span><span class="na">getListenerManager</span><span class="o">().</span><span class="na">addSchedulerListener</span><span class="o">(</span><span class="k">new</span> <span class="nc">MySchedulerListener</span><span class="o">());</span>
<span class="nc">Runtime</span><span class="o">.</span><span class="na">getRuntime</span><span class="o">().</span><span class="na">addShutdownHook</span><span class="o">(</span><span class="k">new</span> <span class="nc">Thread</span><span class="o">(){</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">scheduler</span><span class="o">.</span><span class="na">shutdown</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SchedulerException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">});</span>
<span class="n">scheduler</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
</code></pre></div></div>

<h4 id="spring-2">spring</h4>

<ul>
  <li>ç¼–å†™ç›‘å¬å™¨</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySchedulerListener</span> <span class="kd">extends</span> <span class="nc">SchedulerListenerSupport</span> <span class="o">{</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">schedulerStarting</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">schedulerStarting</span><span class="o">();</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">",schedulerStarting!!"</span><span class="o">);</span>
        <span class="nc">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123456"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="k">new</span> <span class="nc">Driver</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_scheduler_log (ip,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">().</span><span class="na">getHostAddress</span><span class="o">();</span>

            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">ip</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">schedulerShutdown</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">.</span><span class="na">schedulerShuttingdown</span><span class="o">();</span>
        <span class="nc">LocalTime</span> <span class="n">now</span> <span class="o">=</span> <span class="nc">LocalTime</span><span class="o">.</span><span class="na">now</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">now</span><span class="o">.</span><span class="na">toString</span><span class="o">()+</span><span class="s">",schedulerShuttingdown!!"</span><span class="o">);</span>
        <span class="nc">BasicDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BasicDataSource</span><span class="o">();</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUsername</span><span class="o">(</span><span class="s">"root"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"123456"</span><span class="o">);</span>
        <span class="n">dataSource</span><span class="o">.</span><span class="na">setUrl</span><span class="o">(</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;useSSL=false"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">setDriver</span><span class="o">(</span><span class="k">new</span> <span class="nc">Driver</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">DataSourceConnectionFactory</span> <span class="n">connectionFactory</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataSourceConnectionFactory</span><span class="o">(</span><span class="n">dataSource</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Connection</span> <span class="n">connection</span> <span class="o">=</span> <span class="n">connectionFactory</span><span class="o">.</span><span class="na">createConnection</span><span class="o">();</span>
            <span class="nc">PreparedStatement</span> <span class="n">preparedStatement</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="na">prepareStatement</span><span class="o">(</span><span class="s">"insert into quartz_scheduler_log (ip,type,time) values (?,?,?)"</span><span class="o">);</span>
            <span class="nc">String</span> <span class="n">ip</span> <span class="o">=</span> <span class="nc">InetAddress</span><span class="o">.</span><span class="na">getLocalHost</span><span class="o">().</span><span class="na">getHostAddress</span><span class="o">();</span>

            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setString</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="n">ip</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setInt</span><span class="o">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">2</span><span class="o">);</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">setTime</span><span class="o">(</span><span class="mi">3</span><span class="o">,</span><span class="k">new</span> <span class="nc">Time</span><span class="o">(</span><span class="k">new</span> <span class="nc">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()));</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
            <span class="n">preparedStatement</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">connection</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnknownHostException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">dataSource</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">SQLException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>xml</li>
</ul>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"mySchedulerListener"</span> <span class="na">class=</span><span class="s">"com.example.job.listener.MySchedulerListener"</span><span class="nt">/&gt;</span>

<span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"schedule"</span> <span class="na">class=</span><span class="s">"org.springframework.scheduling.quartz.SchedulerFactoryBean"</span> <span class="na">destroy-method=</span><span class="s">"destroy"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"dataSource"</span> <span class="na">ref=</span><span class="s">"datasource"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"triggers"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"trigger1"</span><span class="nt">/&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"trigger2"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"schedulerListeners"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;list&gt;</span>
                <span class="nt">&lt;ref</span> <span class="na">bean=</span><span class="s">"mySchedulerListener"</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/list&gt;</span>
        <span class="nt">&lt;/property&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">"datasource"</span> <span class="na">destroy-method=</span><span class="s">"close"</span> <span class="na">class=</span><span class="s">"org.apache.commons.dbcp2.BasicDataSource"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"username"</span> <span class="na">value=</span><span class="s">"root"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"password"</span> <span class="na">value=</span><span class="s">"123456"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"url"</span> <span class="na">value=</span><span class="s">"jdbc:mysql://localhost:3306/order?serverTimezone=Asia/Shanghai&amp;amp;useSSL=false"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"driverClassName"</span> <span class="na">value=</span><span class="s">"com.mysql.cj.jdbc.Driver"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>
</code></pre></div></div>

<h3 id="quartzé›†ç¾¤">quartzé›†ç¾¤</h3>

<ul>
  <li>æ”¯æŒå¤±æ•ˆè½¬ä¹‰ï¼Œä¸æ”¯æŒåˆ†å¸ƒå¼</li>
  <li>æ¡ˆä¾‹ï¼šæŒ‰å°æ—¶ç»Ÿè®¡è®¢å•æ•°é‡</li>
</ul>
:ET